<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>CBC字节翻转攻击 - Tlife</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Tlife"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Tlife"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="CBC加密流程首先将明文分组，常见的以16个字节为一组，位数不足的使用特殊字符填充——&amp;gt;生成一个随机的初始化向量(IV)和一个密钥——&amp;gt;将IV和第一组明文异或——&amp;gt;用密钥对3中XOR后产生的密文加密——&amp;gt;用4中产生的密文对第二组明文进行XOR操作——&amp;gt;用密钥对5中产生的密文加密——&amp;gt;c重复步骤4-7，到最后一组明文——&amp;gt;将IV和加密后的密文拼接在一起，得到"><meta property="og:type" content="article"><meta property="og:title" content="CBC字节翻转攻击"><meta property="og:url" content="http://example.com/2021/02/05/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/"><meta property="og:site_name" content="Tlife"><meta property="og:description" content="CBC加密流程首先将明文分组，常见的以16个字节为一组，位数不足的使用特殊字符填充——&amp;gt;生成一个随机的初始化向量(IV)和一个密钥——&amp;gt;将IV和第一组明文异或——&amp;gt;用密钥对3中XOR后产生的密文加密——&amp;gt;用4中产生的密文对第二组明文进行XOR操作——&amp;gt;用密钥对5中产生的密文加密——&amp;gt;c重复步骤4-7，到最后一组明文——&amp;gt;将IV和加密后的密文拼接在一起，得到"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206115835.png"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206120000.png"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206121506.png"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206125759.png"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206192521.png"><meta property="article:published_time" content="2021-02-05T10:01:49.000Z"><meta property="article:modified_time" content="2021-02-07T11:53:20.387Z"><meta property="article:author" content="vague huang"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206115835.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2021/02/05/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/"},"headline":"CBC字节翻转攻击","image":["https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206115835.png","https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206120000.png","https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206121506.png","https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206125759.png","https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206192521.png"],"datePublished":"2021-02-05T10:01:49.000Z","dateModified":"2021-02-07T11:53:20.387Z","author":{"@type":"Person","name":"vague huang"},"publisher":{"@type":"Organization","name":"Tlife","logo":{"@type":"ImageObject"}},"description":"CBC加密流程首先将明文分组，常见的以16个字节为一组，位数不足的使用特殊字符填充——&gt;生成一个随机的初始化向量(IV)和一个密钥——&gt;将IV和第一组明文异或——&gt;用密钥对3中XOR后产生的密文加密——&gt;用4中产生的密文对第二组明文进行XOR操作——&gt;用密钥对5中产生的密文加密——&gt;c重复步骤4-7，到最后一组明文——&gt;将IV和加密后的密文拼接在一起，得到"}</script><link rel="canonical" href="http://example.com/2021/02/05/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Tlife</a></div><div class="navbar-menu"><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-02-05T10:01:49.000Z" title="2021/2/5 下午6:01:49">2021-02-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-02-07T11:53:20.387Z" title="2021/2/7 下午7:53:20">2021-02-07</time></span></div></div><h1 class="title is-3 is-size-4-mobile">CBC字节翻转攻击</h1><div class="content"><h2 id="CBC加密流程"><a href="#CBC加密流程" class="headerlink" title="CBC加密流程"></a>CBC加密流程</h2><p>首先将明文分组，常见的以16个字节为一组，位数不足的使用特殊字符填充——&gt;生成一个随机的初始化向量(IV)和一个密钥——&gt;将IV和第一组明文异或——&gt;用密钥对3中XOR后产生的密文加密——&gt;用4中产生的密文对第二组明文进行XOR操作——&gt;用密钥对5中产生的密文加密——&gt;c重复步骤4-7，到最后一组明文——&gt;将IV和加密后的密文拼接在一起，得到最终的密文。</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206115835.png" alt="img" style="zoom:67%;">
Plaintext：待加密的数据——也就是明文       <a id="more"></a>
IV：初始化向量，用于随机化加密的比特块，保证即使对相同明文多次加密，也可以得到不同的密文。
Ciphertext：加密后的数据——也就是密文
Key：密钥

<h2 id="CBC解密过程"><a href="#CBC解密过程" class="headerlink" title="CBC解密过程"></a>CBC解密过程</h2><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206120000.png" alt="img" style="zoom:67%;">

<p>从密文中提取出IV，然后将密文分组——&gt;使用密钥对第一组的密文解密，然后和IV进行xor得到明文——&gt;使用密钥对第二组密文解密，然后和2中的密文xor得到明文——&gt;重复2-3，直到最后一组密文</p>
<h2 id="攻击原理"><a href="#攻击原理" class="headerlink" title="攻击原理"></a>攻击原理</h2><p>Ciphertext-N-1（密文-N-1）是用来产生下一块明文；这就是字节翻转攻击开始发挥作用的地方。如果我们改变Ciphertext-N-1（密文-N-1）的一个字节，然后与下一个解密后的组块异或，我们就可以得到一个不同的明文了。<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206121506.png" alt="img" style="zoom:67%;"><br>注意在加密时，明文中的微小改变会导致其后的全部密文块发生改变，而在解密时，从两个邻接的密文块中即可得到一个明文块。因此，解密过程可以被并行化，而解密时，密文中一位的改变只会导致其对应的明文块完全改变和下一个明文块中对应位发生改变，不会影响到其它明文的内容。</p>
<p>参考:<a target="_blank" rel="noopener" href="https://maplege.github.io/2018/11/19/CBC-reverse/">https://maplege.github.io/2018/11/19/CBC-reverse/</a></p>
<h3 id="异或运算"><a href="#异或运算" class="headerlink" title="异或运算"></a>异或运算</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">已知A&#x3D;B^C</span><br><span class="line">可以得到结论B&#x3D;A^C</span><br><span class="line">并且也能得到A^C^B&#x3D;0</span><br></pre></td></tr></table></figure>

<h3 id="攻击核心"><a href="#攻击核心" class="headerlink" title="攻击核心"></a>攻击核心</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">设第一块的密文第4个字节设为变量A，第二块的明文中第4个字节设为变量C，在第二块加密产生的第4个字节设为变量B</span><br><span class="line">因为A^B&#x3D;C，根据结论有B&#x3D;A^C</span><br><span class="line">如果人为将A变量值改变为A^C的结果，那么参与运算后A^B将等于A^C^B&#x3D;B^B&#x3D;0，第二个产生的明文的第4个字节将变为0</span><br><span class="line">如果将A变量值改变为A^C^X（这里X是任意字符），那么参与运算后，A^B将等于A^C^X^B&#x3D;B^X^B&#x3D;X，第二个产生的明文的第4个字节将变为X字符，这样，第二块密文块解密的结果就可控了</span><br></pre></td></tr></table></figure>

<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>首先先扫一下目录，看看有没有源码<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206125759.png" alt="img"><br>可以看到有一个有文件，打开以后发现，由于不管怎么打开都是乱码，所以直接复制了网上wp的源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置cookie的流程调用的函数，返回一个随机的iv和使用该iv加密的post提交的username和password的结果——cipher</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">$info</span>)</span>&#123;</span><br><span class="line">    $iv = get_random_iv();</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[<span class="string">&#x27;username&#x27;</span>] = $info[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    setcookie(<span class="string">&quot;iv&quot;</span>, base64_encode($iv));</span><br><span class="line">    setcookie(<span class="string">&quot;cipher&quot;</span>, base64_encode($cipher));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//检查函数，这里是对cookie中cipher和iv进行CBC翻转的利用点</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//如果cookie中设置了cipher和iv参数</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;cipher&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_COOKIE[<span class="string">&#x27;iv&#x27;</span>]))&#123;</span><br><span class="line">        <span class="comment">//将cipher和iv参数都进行base64解码</span></span><br><span class="line">        $cipher = base64_decode($_COOKIE[<span class="string">&#x27;cipher&#x27;</span>]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[<span class="string">&quot;iv&quot;</span>]);</span><br><span class="line">        <span class="comment">//进行CBC模式的AES解密</span></span><br><span class="line">        <span class="keyword">if</span>($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            <span class="comment">//对解密结果进行反序列化，设置session中的username为反序列化后数组中的username的值</span></span><br><span class="line">            $info = unserialize($plain) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;&lt;p&gt;base64_decode(&#x27;&quot;</span>.base64_encode($plain).<span class="string">&quot;&#x27;) can&#x27;t unserialize&lt;/p&gt;&quot;</span>);</span><br><span class="line">            $_SESSION[<span class="string">&#x27;username&#x27;</span>] = $info[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;ERROR!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据session中username参数，控制显示结果</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_homepage</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//如果session中的username为admin，则返回flag</span></span><br><span class="line">    <span class="keyword">if</span> ($_SESSION[<span class="string">&quot;username&quot;</span>]===<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Hello admin&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Flag is $flag&lt;/p&gt;&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;hello &#x27;</span>.$_SESSION[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Only admin can see flag&lt;/p&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;&lt;a href=&quot;loginout.php&quot;&gt;Log out&lt;/a&gt;&lt;/p&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//检查是否带有username和password参数，如果有参数，进入设置cookie的路径</span></span><br><span class="line"><span class="comment">//如果没有设置参数，进入判断cookie路径</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">    $username = (<span class="keyword">string</span>)$_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    $password = (<span class="keyword">string</span>)$_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="comment">//不允许提交的username为admin</span></span><br><span class="line">    <span class="keyword">if</span>($username === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;&lt;p&gt;admin are not allowed to login&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $info = <span class="keyword">array</span>(<span class="string">&#x27;username&#x27;</span>=&gt;$username,<span class="string">&#x27;password&#x27;</span>=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//如果session中的username字段已经存在了，既登陆过了，则进入</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">&quot;username&quot;</span>]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    .................</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>上面说，不让我们直接提交admin，但是又说结果需要admin，联想到上面的攻击原理，改变解码中的某个字节，指挥影响该段明文，以及下一段明文对应的字节，也就是说我们要构造xdmin，或者axmmin，然后通过CBC字节翻转攻击，是的x还原为a或d。。。</p>
<h3 id="攻击过程"><a href="#攻击过程" class="headerlink" title="攻击过程"></a>攻击过程</h3><p>代码中涉及到了序列化，数组序列化结果参考如下（这里使用ydmin和123作为username和password）：<br> <code>a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;ydmin&quot;;s:8:&quot;password&quot;;s:3:&quot;123&quot;&#125;</code><br>到这里，算是大致理解这个CBC翻转字节攻击是如何实现的了，首先我们知道前一段密文会影响后一段明文的解密，所以我们就对第一段<code>a:2:&#123;s:8:&quot;userna</code>的密文进行修改，使得在于第二段密文异或运算时ydmin变成admin<br>这个时候，我们将修改后的密文直接拿去也是不行的，因为这个时候IV没有更换，前面的数据会出现匹配乱码<br>我们知道 第一节明文=IV^第一节密文<br>所以 新IV=第一节明文^第一节密文（修改之前的，因为修改之前的密文所对应的明文才是正确的）</p>
<h3 id="编写脚本"><a href="#编写脚本" class="headerlink" title="编写脚本"></a>编写脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">cipher=<span class="string">&quot;ut%2F2iZbrbm1dq9PpRb0dUGN5xneMrTkNo1pMCTL6DjhABvPsODND9N%2BLwENXWiXXPyy5PQ7YXn2HCfcIkYNAIw%3D%3D&quot;</span></span><br><span class="line">iv=<span class="string">&quot;Ub5Pn6gmMNuctLwfJggaOA%3D%3D&quot;</span></span><br><span class="line"></span><br><span class="line">cipher_de=base64.b64decode(urllib.unquote(cipher))</span><br><span class="line">tran=<span class="string">&#x27;a:2:&#123;s:8:&quot;username&quot;;s:5:&quot;bdmin&quot;;s:d&quot;;s:3:&quot;123&quot;&#125;8:&quot;passwor&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#tran[16:32]=me&quot;;s:5:&quot;bdmin&quot;;</span></span><br><span class="line"><span class="comment"># 这里用之前的攻击核心的字母来指代一下       A       ^    c   ^   x                             </span></span><br><span class="line">cipher_new=cipher_de[<span class="number">0</span>:<span class="number">9</span>]+chr(ord(cipher_de[<span class="number">9</span>])^ord(<span class="string">&#x27;b&#x27;</span>)^ord(<span class="string">&#x27;a&#x27;</span>))+cipher_de[<span class="number">10</span>:]</span><br><span class="line">cipher_new=urllib.quote(base64.b64encode(cipher_new))</span><br><span class="line">print(cipher_new)</span><br><span class="line">cipher_new=base64.b64decode(<span class="string">&#x27;wXAR7J/AKHmukMZ9U0lgO21lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7fQ==&#x27;</span>)<span class="comment">#这里记得用burp跑出来的那个，不然待会又解码不吻合。</span></span><br><span class="line">print(cipher_new)</span><br><span class="line">iv_raw=base64.b64decode(urllib.unquote(iv))</span><br><span class="line">iv_new=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">16</span>):</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">	       iv_new+=chr(ord(tran[i])^ord(iv_raw[i])^ord(cipher_new[i]))</span><br><span class="line">iv_new=urllib.quote(base64.b64encode(iv_new))</span><br><span class="line">print(iv_new)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210206192521.png" alt="img" style="zoom:67%;">
最后也终于是拿到了flag

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>一开始做的时候，就看不下去了，因为感觉很陌生，而且又感觉很绕，但其实只要专注看一会，其实很快就可以理解了<br>卡了比较久的地方是，删除下面post 的内容的时候，把那一行删掉就行了，不要不要把那一行上面那行空白的也删掉，这样是跑不出来的，每次都手贱直接整个删掉，然后就好久都没出来结果，无语了。。<br>参考:<a target="_blank" rel="noopener" href="https://blog.csdn.net/u013577244/article/details/86310881?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-3.not_use_machine_learn_pai&amp;depth_1-utm_source=distribute.pc_relevant.no">https://blog.csdn.net/u013577244/article/details/86310881?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-3.not_use_machine_learn_pai&amp;depth_1-utm_source=distribute.pc_relevant.no</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a958f757a2b2">https://www.jianshu.com/p/a958f757a2b2</a></p>
</div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/02/06/getshell/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">bypass_disable_functions</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/02/03/linux%E5%8F%8D%E5%BC%B9shell%E7%9A%84%E6%9C%AC%E8%B4%A8-%E4%BA%8C/"><span class="level-item">linux反弹shell的本质(二)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Tlife</a><p class="is-size-7"><span>&copy; 2023 vague huang</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><!--!--><script src="/js/main.js" defer></script><!--!--><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>