<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">260</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Tlife</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/java%E6%89%A7%E8%A1%8C%E5%AD%97%E8%8A%82%E7%A0%81/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>##字节码<br>能够恢复成一个类并在jvm中加载的字节序列<br>##利用URLClassLoader加载远程class文件<br><code>ClassLoader</code>是java的类加载器，告诉java虚拟机如何加载这个类，默认根据类名加载类，并且这个类名是类完整路径，例如java.lang.Runtime<br>###URLClassLoader<br>正常情况下，java会根据sun.boot.class.path和java.class.path中列举的基础路径（这些路径是经过处理后的java.net.URl类）来寻找.class文件进行加载,基础路径有三种情况</p>
<ul>
<li>URL未以斜杠 / 结尾，则认为是一个JAR文件，使用 JarLoader 来寻找类，即为在Jar包中寻找.class文件</li>
<li>URL以斜杠 / 结尾，且协议名是 file ，则使用 FileLoader 来寻找类，即为在本地文件系统中寻找.class文件</li>
<li>URL以斜杠 / 结尾，且协议名不是 file ，则使用最基础的 Loader 来寻找类<br>###defineClass<br>在加载远程class文件、本地class或者jar包时，java都经历了<br><img src="/.com//2022-11-30-19-39-00.png"><br>其中</li>
<li>loadClass 的作用是从已加载的类缓存、父加载器等位置寻找类（这里实际上是双亲委派机制），在前面没有找到的情况下，执行 findClass</li>
<li>findClass 的作用是根据基础URL指定的方式来加载类的字节码，就像上一节中说到的，可能会在<br>本地文件系统、jar包或远程http服务器上读取字节码，然后交给defineClass </li>
<li>defineClass 的作用是处理前面传入的字节码，将其处理成真正的Java类<br>###defineClass加载字节码<br>####使用反射进行加载<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Method defineclass &#x3D; ClassLoader.class.getDeclaredMethod(&quot;defineClass&quot;,String.class,byte[].class,int.class,int.class);</span><br><span class="line">defineClass,setAccessible(true);</span><br><span class="line">byte[] code&#x3D; Base64.getDecoder().decode(&quot;&quot;);</span><br><span class="line">Class hello &#x3D; (Class) defineclass.invoke(ClassLoader.getSystemClassLoader(),&quot;hello&quot;,code,0,code.length);</span><br><span class="line">hello.newInstance();</span><br></pre></td></tr></table></figure>
####利用TemplatesImpl加载字节码<br><code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</code>这个类中定义了一个内部类<br>TransletClassLoader ：<br><img src="/.com//2022-11-30-19-50-00.png"><br>重写了<code>defineClass</code>方法，并且没有显式地声明其定义域。如果没有显式声明，则其作用域为default，可以被类外部调用，而<code>TransletClassLoader#defineClass()</code>向前追溯调用链以后可以发现，其最前面的两个方法为法 TemplatesImpl#getOutputProperties() 、 TemplatesImpl#newTransformer()<br>#####使用newTransformer()构造poc<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] code=Base64.getDecoder().decode(<span class="string">&quot;&quot;</span>);</span><br><span class="line">TemplatesImpl obj = <span class="keyword">new</span> TemplatesImpl();</span><br><span class="line">setFieldValue(obj,<span class="string">&quot;_bytecodes&quot;</span>,<span class="keyword">new</span> <span class="keyword">byte</span>[][]&#123;code&#125;);</span><br><span class="line">setFieldValue(obj,<span class="string">&quot;_name&quot;</span>,<span class="string">&quot;HelloTemplatesImpl&quot;</span>);</span><br><span class="line">setFieldValue(obj,<span class="string">&quot;_tfactory&quot;</span>,<span class="keyword">new</span> TransformerFactoryImpl);</span><br><span class="line">obj.newTransformer();</span><br></pre></td></tr></table></figure>
其中：<br>setFieldValue 方法用来设置私有属性，可见，这里我设置了三个属性： _bytecodes 、 _name 和 _tfactory 。<br>_bytecodes 是由字节码组成的数组； _name 可以是任意字符串，只要不为null即可；<br>_tfactory 需要是一个 TransformerFactoryImpl 对象，因为<br>TemplatesImpl#defineTransletClasses() 方法里有调用到<br>_tfactory.getExternalExtensionsMap() ，如果是null会出错。<br>另外，值得注意的是， TemplatesImpl 中对加载的字节码是有一定要求的：这个字节码对应的类必须<br>是 com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet 的子类。<br>因此在构造这个类的时候要写extends<br><img src="/.com//2022-11-30-20-03-01.png"></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/java-tabby%E5%AE%89%E8%A3%85/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>##Neo4j<br>如果经过很多的导入/删除操作，图数据库占用了很多的硬盘存储，那么可以将原有的图数据库删除，重新按照上面的步骤新建图数据库。 删除所有约束</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DROP CONSTRAINT c1;</span><br><span class="line">DROP CONSTRAINT c2;</span><br><span class="line">DROP CONSTRAINT c3;</span><br><span class="line">DROP CONSTRAINT c4;</span><br><span class="line">DROP INDEX index1;</span><br><span class="line">DROP INDEX index2;</span><br><span class="line">DROP INDEX index3;</span><br><span class="line">DROP INDEX index4;</span><br><span class="line">DROP INDEX index5;</span><br><span class="line">DROP INDEX index6;</span><br><span class="line">DROP INDEX index7;</span><br></pre></td></tr></table></figure>
<p>##使用教程<br><code>这里使用的java版本是</code><br><img src="/.com//2022-11-28-09-06-47.png"><br>要使用tabby，首先需要导出项目所有Jar包。在IDEA中，可以通过”File -&gt; Project Structure -&gt; Project Settings -&gt; Artifacts”中添加一个Artifact，将项目打包出来，这样便能顺利导出所有项目相关的jar包以供tabby分析。<br><img src="/.com//2022-11-28-08-59-56.png"><br>随后运行”Build -&gt; Build Artifacts -&gt; Rebuild”即可导出到/out目录中。随后我们将这些jar包全放到上文”安装tabby“一节中，创建的jars目录下。在运行最好将/cache目录下的文件删除。随后运行命令<br>##Neo4j查询</p>
<ul>
<li>Neo4j是一个图数据库</li>
<li>Neo4j是一个图数据库，需要先明白如下几点：</li>
<li>Neo4j用的是CQL查询语言的图数据库，和MySQL这些使用SQL查询语言的关系型数据库语法不一样。但是思路还是一样的，无非是 数据查询+条件筛选关系型数据库存放的数据是按行和列查询，而图数据库是用节点和关系边进行查询。<br>在代码分析中，有两个关键术语：Source和Sink。Source是输入，即用户可控部分；Sink是汇聚点，即危险代码。Tabby的思路是：通过Neo4j图数据库的节点和关系边，将每个方法之间的调用链用Neo4j的关系边串联起来。我们便可查询Source到Sink之间的调用路径。</li>
</ul>
<p>##查询模版</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">match (source:Method &#123;NAME:&quot;execute&quot;&#125;)</span><br><span class="line">match (sink:Method &#123;IS_SINK:true, NAME:&quot;getInstance&quot;&#125;)&lt;-[:CALL]-(m1:Method)</span><br><span class="line">call apoc.algo.allSimplePaths(m1, source, &quot;&lt;CALL|ALIAS&quot;, 20) yield path </span><br><span class="line">return * limit 20</span><br></pre></td></tr></table></figure>
<p>其中match()表示匹配哪些节点，类似于SQL中的select。<br>在match(source:Method{NAME:”execute”})这句话中，source是别名，Method是节点类,{NAME:”execute”}是匹配的节点内容，——》都是来自tabby生成的csv文件，并且一般是类json格式，有两个关键的节点：Method和Class</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/java%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E9%97%AE%E9%A2%98/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>##调试源码<br>调试的源码一般在官网可以找到<br><a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/rev/a58fca2f8a5d">http://hg.openjdk.java.net/jdk8u/jdk8u/jdk/rev/a58fca2f8a5d</a><br>其中，需要什么源码可以点击搜索，并且输入对应类的名称<br><img src="/.com//img/2023-01-25-20-28-24.png.png"><br>然后对应去下载就可以，如果有的源码没下载到，要去看看，这个的file路径<br><img src="/.com//2023-01-25-20-30-24.png"><br>需要下载是有修复版本的jdk，可以先来这里看看对应类最新的补丁的发布日期，然后再去官网下载对应的jdk<br><a target="_blank" rel="noopener" href="https://www.java.com/releases/">https://www.java.com/releases/</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/java-jdbc+%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>##jdbc反序列化</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/ibos%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>1.mysql配置<br><img src="/.com//2022-09-18-20-49-50.png"><br>2.漏洞利用链<br><img src="/.com//2022-09-18-20-50-42.png"><br>漏洞利用点在这里，这里使用了eval，但是应该可以闭合，可以试试看</p>
<p><img src="/.com//2022-09-18-20-51-25.png"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/2022Dest0g3%E8%BF%8E%E6%96%B0%E8%B5%9B/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>##phpdest<br><img src="/.com//2022-09-21-20-44-27.png"><br>绕过require_once限制</p>
<ul>
<li>/proc/self指向当前进程的/proc/pid/，/proc/self/root/是指向/的符号链接<br>payload:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self</span><br></pre></td></tr></table></figure>
##EasyPHP<br>在这里可以看到自定义了一个报错，当产生错误的时候，就会执行这个报错内容<br><img src="/.com//2022-09-21-21-22-31.png"><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">set_error_handler(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">use</span>(<span class="params">&amp;$fl4g</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">print</span> $fl4g;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<img src="/.com//2022-09-21-21-20-11.png"><br>前面的代码都是干扰，我们重点需要关注的其实是我们的输入会做出什么操作，可以发现，我们输入的内容最后会和$fl4g做拼接操作，结合前面的自定义报错，那我们只需要让输入的内容为数组即可，因为数组和字符串直接拼接时会产生报错</li>
<li>突然想到之前，如果不知道题目的考察点，数组啥的都先试试再说<br>##simplerce</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/access%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>###</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/hello-world/">Hello World</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>##可访问文件收集<br>如果存在反序列化，这里可以直接利用<br>.//wp-content/plugins/product-import-export-for-woo/admin/modules/product_tags/import/import.php:272 : 读取文件函数中存在变量，可能存在任意文件读取漏洞</p>
<p>如果可以覆盖文件写入的话<br>.//wp-content/plugins/woocommerce-germanized/vendor/globalcitizen/php-iban/php-iban.php:607 : 读取文件函数中存在变量，可能存在任意文件读取漏洞</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2023/02/10/%E5%9F%BA%E4%BA%8Efabric%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE%E9%A1%B9%E7%9B%AE/">No title</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-10</time><div class="content"><p>#搭建fabric环境<br>##配置证书<br>fabric网络中节点之间通讯都需要提供证书用来标识自己的身份<br><code>cryptogen</code>工具快速生成相关证书<br>##配置系统链创世块<br>fabric系统配置是存放在区块链上的，系统成功运行至少要有一个链<br><code>configtxgen</code>生成系统链，第一个数据块保存了用户定义的一些配置，</p>
<ul>
<li>会读取configtx.yaml和<code>crypto-config</code>文件下的证书用于生成channel的创世块<br>生成的 genesis.block 是系统链的第一个区块，里面存放了 Orderer 节点、Orderer 管理员的证书，在 Orderer 节点启动时会用到这个数据块。<br>##如何理解fabric<br>类似于一个服务器，然后，<br>fabric用go语言实现链码，实现对peer节点的操作，也即是智能合约。<br>###链码<br>一共有五个节点，分为农户【farmer】，原料厂商【material】，生产厂商【productinfo+productProcess】，物流厂商【driver】，零售商【retailer】<br>####物流厂商<br>定义上链的信息结构体<br><img src="/.com//2022-12-07-20-44-20.png"><br>通过api接口使用各函数<br><img src="/.com//2022-12-07-20-48-56.png"><br>其他的链码定义方式同上<br>####路由<br>定义各个节点的路由<br><img src="/.com//2022-12-07-20-52-20.png"><br>####api代码<br>引入fabric-client模块，基于此模块进行fabric区块链网络的节点功能调用<br><img src="/.com//2022-12-07-20-54-05.png"><br>通过定义多个路由，利用以下代码进行区块链的上链查询等操作<br><img src="/.com//2022-12-07-21-10-06.png"></li>
</ul>
<p>在区块链环境中，每个希望于网络交互的参与者都需要一个身份，ca提供可验证的数字身份</p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>