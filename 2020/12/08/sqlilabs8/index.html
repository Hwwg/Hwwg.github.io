<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>sqlilabs8 - Tlife</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Tlife"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Tlife"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="第46关在这一关中我们看标题 是order by注入 那么我们就先再把order by了解一下吧"><meta property="og:type" content="article"><meta property="og:title" content="sqlilabs8"><meta property="og:url" content="http://example.com/2020/12/08/sqlilabs8/"><meta property="og:site_name" content="Tlife"><meta property="og:description" content="第46关在这一关中我们看标题 是order by注入 那么我们就先再把order by了解一下吧"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201211010924.png"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201208221422.png"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201208221816.png"><meta property="og:image" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201217165349.png"><meta property="article:published_time" content="2020-12-08T14:00:02.000Z"><meta property="article:modified_time" content="2020-12-18T13:11:03.490Z"><meta property="article:author" content="vague huang"><meta property="article:tag" content="sql注入"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201211010924.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2020/12/08/sqlilabs8/"},"headline":"sqlilabs8","image":["https://raw.githubusercontent.com/Hwwg/myphoto/master/20201211010924.png","https://raw.githubusercontent.com/Hwwg/myphoto/master/20201208221422.png","https://raw.githubusercontent.com/Hwwg/myphoto/master/20201208221816.png","https://raw.githubusercontent.com/Hwwg/myphoto/master/20201217165349.png"],"datePublished":"2020-12-08T14:00:02.000Z","dateModified":"2020-12-18T13:11:03.490Z","author":{"@type":"Person","name":"vague huang"},"publisher":{"@type":"Organization","name":"Tlife","logo":{"@type":"ImageObject"}},"description":"第46关在这一关中我们看标题 是order by注入 那么我们就先再把order by了解一下吧"}</script><link rel="canonical" href="http://example.com/2020/12/08/sqlilabs8/"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Tlife</a></div><div class="navbar-menu"><div class="navbar-end"></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-12-08T14:00:02.000Z" title="2020/12/8 下午10:00:02">2020-12-08</time></span><span class="level-item">Updated&nbsp;<time dateTime="2020-12-18T13:11:03.490Z" title="2020/12/18 下午9:11:03">2020-12-18</time></span></div></div><h1 class="title is-3 is-size-4-mobile">sqlilabs8</h1><div class="content"><h2 id="第46关"><a href="#第46关" class="headerlink" title="第46关"></a>第46关</h2><p>在这一关中我们看标题 是order by注入</p>
<p>那么我们就先再把order by了解一下吧          <a id="more"></a><br>感觉现在才真正理解order by为什么在前面可以用来查询字段数（列数），因为order by可以让每个列明按照升序或者降序的方式进行排序，所以当不存在这么多列的时候，他就不存在了。（这个理解有点浅薄，故再去查找了一下资料）:<br>其实在看完说明书后，我还不是很理解，不是很懂order by为什么可以注入 因为我觉得他不像报错注入时间盲注那些有地方可以直接让我写代码，他后面还需要加数字，所以我就很纳闷。<br>但是：在我发现order by后面的排序可以变成升序或者降序输入的时候，我突然有了一丝感觉：<br>注入究竟是啥？指的不就是我们在外部输入的命令能被带进去数据库里面执行吗，所以只要满足：能被代入数据库执行命令，其实就存在可能注入点<br>知道这点我们<img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201211010924.png" alt="img"></p>
<p>我们可以发现，order by后面的<strong>数字</strong>是一个可控的参数，我们可以利用这个来构造我们的语句，使其被数据库执行，</p>
<p>而在这题中<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201208221422.png" alt="img"></p>
<p>他的查询语句是对我们输入的那一行进行排序输出的<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201208221816.png" alt="img"></p>
<p>看上面 他要求我们输入的一个sort  所以我们现在不能再?id=多少 而是要?sort=多少，然后再看他的查询语句，对于id是没有加引号之类的，所以是数字型注入，然后我们在想，要在order by 后面加上什么才会被执行呢，首先是<strong>不能有引号</strong>语句，如果有要将引号内的内容转给十六进制的，如果要加select，我们需要union来拼接，但是在这题中是行不通的，这是一个语法问题，：有union的时候，order by要以最后一个union为准，所以 order by必须放在最后一个union后面，那么我们只能换一种，<br>首先我们先来考查一下是否存在注入点——根据我们输入的语句，页面发生变化<br>构建<strong>payload:</strong>?sort=rand(true)<br>                       ?sort=rand(false)<br>rand()是产生一个随机数，但其实我们这里赋予了一个true和false，他里面的值就会不一样，而如果页面发生了改变，就说明我们的注入已经生效了，其实这里的本质是，测试这里能使用的语句都有啥，我们使用了rand(）函数，发现是可以产生页面变化的，然后里面的true和false其实代表的是1和0</p>
<p><strong>rand()函数</strong>：<br>RAND()函数调用可以在0和1之间产生一个随机数：</p>
<p>首先是报错注入：<br>?sort=(extractvalue(1,concat(‘~’,database())) //这里连注释都不用，因为这个id后无其他语句<br><img src="https://raw.githubusercontent.com/Hwwg/myphoto/master/20201217165349.png" alt="img" style="zoom:50%;"><br>这样子是成功的，下一个语句：堆叠注入，由于没有mysqli_multi_query所以不行<br>接下来是时间盲注<br>?sort =1 and if(substr((select database()),1,8)=0x7365637572697479),1,sleep(5)<br>有效果，但是时间很长，所以我就在想为什么，(<strong>注意 sleep 是存在一个满足条件的行就会延迟指定的时间，比如sleep(5)，但是实际上查找到两个满足条件的行，那么就会延迟10s,这其实是一个非常重要的信息，在真实的渗透测试过程中，我们有时候不清楚整个表的情况的话，可以用这样的方式进行刺探，比如设置成 sleep(0.001) 看最后多少秒有结果，推断表的行数</strong>)<br>原来是这样，参考链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43536759/article/details/104882964">https://blog.csdn.net/weixin_43536759/article/details/104882964</a><br>这里再介绍另外一种时间盲注：<br>benchmark（a,md5(1))是对某个计算（md5)重复多(a)次，不能精确掌控延迟时间<br>构建payload：<br>?sort= (select if(substring(current,1,1)=CHAR(115),BENCHMARK(50000000,md5(‘1’)),null) from (select database() as current) as test)</p>
<p>接下来是布尔盲注<br>无反应<br><strong>procedure analyse</strong> 注入<br>procredure analyse中 支持两个参数：<br>那么我们就来构造试试，在mysql8.0中好像已经移除了，所以我们就蛮看一下，这个主要是用在oder by limit后面的<br> <strong>payload</strong>SELECT field FROM user WHERE id &gt;0 ORDER BY id LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);<br>这个是构建的payload 而这里添加除了time-base的语句 其他好像都不太行</p>
<p>学习链接：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/57528.html">https://www.freebuf.com/articles/web/57528.html</a></p>
<p>试试上传文件注入 正好好久没碰了，复习一下</p>
<p>在之前我们是通过构建<br> union select “?php @eval($_post[cmd]);?&gt;” into oufile 目标文件夹（能被PHP在网页打开的文件地址）<br>然后构造完以后我们就可以利用菜刀连接就行了<br>下面我们在这里试一下，也是可以的</p>
<p>第四十七关：加个单引号<br>第四十八关：无报错，所以只能用时间盲注，或者布尔盲注<br>第四十九关：同上</p>
<h3 id="第五十关"><a href="#第五十关" class="headerlink" title="第五十关"></a>第五十关</h3><p>看到了<strong>mysql_multi-query</strong><br>所以我们可以用堆栈注入，直接拼接就行，再看后面也无啥过滤的东西</p>
<p>51关：加了个单引号<br>52关：没有报错，但是可以继续堆栈注入<br>53关：单引号无报错，可堆栈注入，时间，布尔啥的就不说了</p>
<h2 id="第五十四关"><a href="#第五十四关" class="headerlink" title="第五十四关"></a>第五十四关</h2><p>在这关当中，他是需要我们最后提交一个key，并且这个key是藏在一个新的库里面的，并且过了十秒钟后这个key就会刷新，<br>我们看了一下源码，可以发现，<br>**next_tryy();**就代表着时间，随意修改时间次数<br>他其实需要两种传输方式<br>POST：提交key<br>GET：获取id<br>并且在KEY那一栏有了过滤使用了mysqli_real_escape_string以及addslashes两个函数进行过滤<br>但是在id那一栏里面啥也没过滤，并且是以单引号进行闭合的。<br>所以我们就在id那边进行注入<br>思考：如果我们没看源代码，如何知道呢？<br>题目黄字就说 input the id了 而下面的key现在只是在迷惑你哈哈</p>
<p>好的知道这些再来看源码 他是不报错的，在我们登录后 他是有跳出两个栏，所以我们试一下union拼接select 注入<br>先用order by查询字段数，然后打一套组合拳就可以了<br><strong>payload：</strong><br>?id=-1’union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=’challenges’ –+<br>接下来就是根据他的动态码去编写payload即可<br>往后的关卡都是变形，没啥好说的。</p>
<h4 id="sqlilabs做题小结："><a href="#sqlilabs做题小结：" class="headerlink" title="sqlilabs做题小结："></a>sqlilabs做题小结：</h4><p>1.知道他是需要获取什么数据 是?sort 还是?id<br>2.判断是否有注入点<br>常见闭合形式：<br>‘ ’‘ “ ’） ‘’）。。。。。。基于此变形，就是单引号和括号的组合<br>判断手法&amp; 和| 还有 rand()<br>3.order by后注入 还是直接 where后注入<br>4.判断要使用什么注入手法：<br>有报错——报错注入<br>union可用——考虑union 拼接select<br>除此以外——考虑文件上传注入（一句话木马），时间，布尔盲注<br>是否有gbk编码，考虑宽字节注入<br>是否有mysqli_multi_query 考虑堆栈注入</p>
<p>5.是否有waf需要绕过<br>例如空格可以采取%a0 还有and or 大小写联合书写，或者重复书写，过滤单引号，根据过滤方式选择手段，是直接转义添加/还是直接去掉变成null，在书写select的时候可以将最后’库名’转化为十六进制进行书写0x*<strong>**</strong>类似<br>6.然后还有很多要学，继续努力</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/sql%E6%B3%A8%E5%85%A5/">sql注入</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/12/15/bugku1/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">bugku1&amp;攻防世界</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/12/06/http%E5%8E%9F%E7%90%86/"><span class="level-item">http原理</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Tlife</a><p class="is-size-7"><span>&copy; 2023 vague huang</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><!--!--><script src="/js/main.js" defer></script><!--!--><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body></html>